"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[6766],{77879:(M,y,i)=>{i.d(y,{H:()=>b});var p=i(64537),l=i(53074);let b=(()=>{class d{constructor(m){this.masterRepo=m}ngOnInit(){}isOldFYearDB(){return 1===this.masterRepo.userSetting.IsOldFyearDB}}return d.\u0275fac=function(m){return new(m||d)(p.Y36(l.P))},d.\u0275dir=p.lG2({type:d,selectors:[["","appOldFYearDB",""]],exportAs:["appOldFYearDB"]}),d})()},36766:(M,y,i)=>{i.r(y),i.d(y,{RouteCoverageModule:()=>J});var p=i(88692),l=i(20092),b=i(35732),d=i(79765),e=i(64537),m=i(67297),C=i(71180);let _=(()=>{class r{constructor(t,n,o){this.http=t,this.authService=n,this.state=o;const a=this.state.getGlobalSetting("apiUrl");a&&a.length>0&&(this.apiUrl=a)}getAllSalesmanList(){let t={status:"error",result:""},n=new d.xQ;return this.http.get(this.apiUrl+"/getSalesmanList",this.getRequestOption()).subscribe(o=>{n.next(o),n.unsubscribe()},o=>{t.status="error",t.result=o,n.next(t),n.unsubscribe()}),n}getRouteSchedule(t,n){let o={status:"error",result:""},a=new d.xQ;return this.http.get(`${this.apiUrl}/getRouteSchedule?routeCode=${t}&SalesmanID=${n}`).subscribe(s=>{console.log("getROuteSchedule result",s),a.next(s),a.unsubscribe()},s=>{o.status="error",o.result=s,a.next(o),a.unsubscribe()}),a}saveRouteSchedule(t){let n={status:"error",result:""},o=new d.xQ;return this.http.post(`${this.apiUrl}/saveRouteSchedule`,{mode:"new",data:t},this.getRequestOption()).subscribe(s=>{o.next(s),o.unsubscribe()},s=>{n.status="error",n.result=s,o.next(n),o.unsubscribe()}),o}getSalesmanRoute(t){let n={status:"error",result:""},o=new d.xQ;return this.http.get(`${this.apiUrl}/getRouteBySalesMan?SALESMANID=${t}`,this.getRequestOption()).subscribe(a=>{o.next(a),o.unsubscribe()},a=>{n.status="error",n.result=a,o.next(n),o.unsubscribe()}),o}getRequestOption(){return{headers:new b.WM({"Content-type":"application/json",Authorization:this.authService.getAuth().token})}}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(b.eN),e.LFG(m.e),e.LFG(C.q))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var Z=i(7976),R=i(16738),f=i.n(R),x=i(248),T=i(67311),A=i(14970),D=i(77879);const w=["routeSelected"],O=["SalesmanID"];function P(r,u){if(1&r&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&r){const t=u.$implicit;e.Q6J("value",t.SALESMANID),e.xp6(1),e.hij("",null==t?null:t.NAME," ")}}function U(r,u){if(1&r&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&r){const t=u.$implicit;e.Q6J("value",t.RouteCode),e.xp6(1),e.hij("",null==t?null:t.RouteName," ")}}function F(r,u){if(1&r&&(e.ynx(0,51)(1,52),e.TgZ(2,"tr",27)(3,"td")(4,"span")(5,"strong"),e._uU(6),e.qZA()()(),e.TgZ(7,"td")(8,"label"),e._UZ(9,"input",53),e.qZA()(),e.TgZ(10,"td")(11,"label"),e._UZ(12,"input",54),e.qZA()(),e.TgZ(13,"td")(14,"label"),e._UZ(15,"input",55),e.qZA()(),e.TgZ(16,"td")(17,"label"),e._UZ(18,"input",56),e.qZA()(),e.TgZ(19,"td")(20,"label"),e._UZ(21,"input",57),e.qZA()(),e.TgZ(22,"td")(23,"label"),e._UZ(24,"input",58),e.qZA()(),e.TgZ(25,"td")(26,"label"),e._UZ(27,"input",59),e.qZA()()(),e.BQk()()),2&r){const t=u.index;e.xp6(1),e.Q6J("formGroupName",t),e.xp6(5),e.hij("Week ",t+1,"")}}function k(r,u){if(1&r&&(e.ynx(0),e.TgZ(1,"tr",60)(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA()(),e.BQk()),2&r){const t=u.index,n=e.oxw(3);e.xp6(3),e.hij(" ",n.salesManGeneratedschedule[t]," "),e.xp6(2),e.hij(" ",n.particularDaysList[t]," ")}}function Y(r,u){if(1&r){const t=e.EpF();e.TgZ(0,"div",22)(1,"div",23)(2,"form",24)(3,"table",25)(4,"thead")(5,"tr")(6,"th",26),e._uU(7," Weeks "),e.qZA(),e.TgZ(8,"th",27)(9,"strong"),e._uU(10,"Sun"),e.qZA()(),e.TgZ(11,"th",27)(12,"strong"),e._uU(13,"Mon"),e.qZA()(),e.TgZ(14,"th",27)(15,"strong"),e._uU(16,"Tue"),e.qZA()(),e.TgZ(17,"th",27)(18,"strong"),e._uU(19,"Wed"),e.qZA()(),e.TgZ(20,"th",27)(21,"strong"),e._uU(22,"Thu"),e.qZA()(),e.TgZ(23,"th",27)(24,"Strong"),e._uU(25,"Fri"),e.qZA()(),e.TgZ(26,"th",27)(27,"strong"),e._uU(28,"Sat"),e.qZA()()()(),e.TgZ(29,"tbody",28),e.YNc(30,F,28,2,"ng-container",29),e.qZA()()()(),e.TgZ(31,"div",23)(32,"div",8)(33,"div",23)(34,"select",30),e.NdJ("ngModelChange",function(o){e.CHM(t);const a=e.oxw(2);return e.KtG(a.currentMonth=o)}),e.TgZ(35,"option",31),e._uU(36,"Select Month"),e.qZA(),e.TgZ(37,"option",32),e._uU(38,"January"),e.qZA(),e.TgZ(39,"option",33),e._uU(40,"February"),e.qZA(),e.TgZ(41,"option",34),e._uU(42,"March"),e.qZA(),e.TgZ(43,"option",35),e._uU(44,"April"),e.qZA(),e.TgZ(45,"option",36),e._uU(46,"May"),e.qZA(),e.TgZ(47,"option",37),e._uU(48,"June"),e.qZA(),e.TgZ(49,"option",38),e._uU(50,"July"),e.qZA(),e.TgZ(51,"option",39),e._uU(52,"August"),e.qZA(),e.TgZ(53,"option",40),e._uU(54,"September"),e.qZA(),e.TgZ(55,"option",41),e._uU(56,"October"),e.qZA(),e.TgZ(57,"option",42),e._uU(58,"November"),e.qZA(),e.TgZ(59,"option",43),e._uU(60,"December"),e.qZA()()(),e.TgZ(61,"div",23)(62,"button",44),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.generateSchedule())}),e._uU(63,"Generate Schedule"),e.qZA()()(),e.TgZ(64,"div",45)(65,"div",46)(66,"table",47)(67,"tr",48)(68,"th"),e._uU(69,"Date"),e.qZA(),e.TgZ(70,"th"),e._uU(71,"Days"),e.qZA()()()(),e.TgZ(72,"table",49)(73,"tbody"),e.YNc(74,k,6,2,"ng-container",50),e.qZA()()()()()}if(2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("formGroup",t.weekArray),e.xp6(28),e.Q6J("ngForOf",t.weekArray.get("weeks").controls),e.xp6(4),e.Q6J("ngModel",t.currentMonth),e.xp6(40),e.Q6J("ngForOf",t.salesManGeneratedschedule)}}function N(r,u){if(1&r&&(e.TgZ(0,"div",20),e.YNc(1,Y,75,4,"div",21),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.weekArray)}}const q=[{path:"",component:(()=>{class r{constructor(t,n,o,a,s,c){this.preventNavigationService=t,this.alertService=n,this.loadingService=o,this._RouteMasterservice=a,this.router=s,this.fb=c,this.showRoutePlan=!1,this.subcriptions=[],this.currentMonth="",this.today=new Date,this.currentYear=this.today.getFullYear(),this.salesManGeneratedschedule=[],this.particularDaysList=[]}ngOnInit(){try{this._RouteMasterservice.getAllSalesmanList().subscribe(t=>{console.log("Salesman List",t),this.allSalesmanList=t})}catch(t){this.alertService.error(t)}}buildArrayOfWeek(t=null){this.weekArray=this.fb.group({weeks:this.fb.array([])});const n=this.weekArray.get("weeks");for(let o=0;o<=5;o++)n.push(this.weekGroup(t&&t[o]))}weekGroup(t){return this.fb.group({Sunday:new l.NI(!!t&&t.Sunday),Monday:new l.NI(!!t&&t.Monday),Tuesday:new l.NI(!!t&&t.Tuesday),Wednesday:new l.NI(!!t&&t.Wednesday),Thursday:new l.NI(!!t&&t.Thursday),Friday:new l.NI(!!t&&t.Friday),Saturday:new l.NI(!!t&&t.Saturday)})}onFormChanges(){this.form.valueChanges.subscribe(()=>{this.form.dirty&&this.preventNavigationService.preventNavigation(!0)})}cancel(){try{this.router.navigate(["/pages/dashboard"])}catch(t){this.alertService.error(t)}}ngOnDestroy(){try{this.subcriptions.forEach(t=>{t.unsubscribe()})}catch(t){this.alertService.error(t)}}saveRoutePlan(){if(null==this.SalesmanID.nativeElement.value||null==this.SalesmanID.nativeElement.value||""==this.SalesmanID.nativeElement.value)return void this.alertService.error("Please select a valid salesman to proceed");if(null==this.routeSelected.nativeElement.value||null==this.routeSelected.nativeElement.value||""==this.routeSelected.nativeElement.value)return void this.alertService.error("Please select a route salesman to proceed");let t=this.weekArray.value;t.SalesmanID=this.SalesmanID.nativeElement.value,t.RouteCode=this.routeSelected.nativeElement.value,this.loadingService.show("Please wait! Saving Route Schedule.."),this._RouteMasterservice.saveRouteSchedule(t).subscribe(n=>{"ok"==n.status&&(this.loadingService.hide(),this.alertService.success("Route schedule changed"),this.resolveRouteSchedule(this.routeSelected.nativeElement.value))},n=>{this.loadingService.hide(),this.alertService.error(n)})}getRouteSchedule(t){this.resolveRouteSchedule(t.target.value)}getSalesmanRoute(t){null!=t.target.value&&""!=t.target.value&&null!=t.target.value?(console.log("Selected Salesman"),this.resolveSalesmanRoute(t.target.value)):this.showRoutePlan=!1}resolveRouteSchedule(t){this._RouteMasterservice.getRouteSchedule(t,this.SalesmanID.nativeElement.value).subscribe(n=>{this.salesmanRouteSchedule=n.result,this.effectiveDate=f()(n.result2[0].effectivedate).format("YYYY-MM-DD"),this.buildArrayOfWeek(n.result),this.showRoutePlan=!0})}resolveSalesmanRoute(t){this._RouteMasterservice.getSalesmanRoute(t).subscribe(n=>{this.allRouteMasterList=n})}generateSchedule(){if(""==this.currentMonth||null==this.currentMonth||null==this.currentMonth)return void this.alertService.error("please select a valid month");this.loadingService.show("Please Wait! Generating Schedule");let t=[],n=Number(this.currentMonth);for(;n<=11;n++){this.dateArray=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],this.routePlanForm=this.fb.group({weeks:this.fb.array([])});let o=this.weeksInMOnth(this.currentYear,n),a=new Date(this.currentYear,n).getDay(),s=this.getTotalDaysInMonth(n,this.currentYear),c=1,S=this.routePlanForm.get("weeks");for(let g=0;g<o;g++)S.push(this.getWeekFormRow(this.salesmanRouteSchedule[g]));let h=0;this.routePlanForm.get("weeks").controls.forEach(g=>{for(let v=0;v<7;v++)if(0===h&&v<a||c>s){let G=this.getDisabledKey(v);g.get(G).disable(),this.dateArray[h][v]=0}else this.dateArray[h][v]=c++;h++}),t.push({month:n,monthValidDays:this.routePlanForm,date:this.dateArray})}setTimeout(()=>{this.calculateSchedule(t)},0),this.loadingService.hide()}calculateSchedule(t){this.salesManGeneratedschedule=[],this.particularDaysList=[];for(let n in t){let o=0;t[n].monthValidDays.get("weeks").controls.forEach(a=>{for(let c=0;c<7;c++){let S=this.getDisabledKey(c);if("DISABLED"!=a.get(S).status&&1==a.get(S).value){let h=this.currentYear+"-"+("0"+(Number(t[n].month)+1)).slice(-2)+"-"+t[n].date[o][c],g=f()(new Date(h)).format("YYYY-MM-DD");f()(g).isSameOrAfter(f()(this.effectiveDate))&&(this.salesManGeneratedschedule.push(f()(new Date(h)).format("Do-MMMM-YYYY")),this.particularDaysList.push(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(h).getDay()]))}}o++})}}getWeekFormRow(t){return this.fb.group({Sunday:[!!t&&t.Sunday],Monday:[!!t&&t.Monday],Tuesday:[!!t&&t.Tuesday],Wednesday:[!!t&&t.Wednesday],Thursday:[!!t&&t.Thursday],Friday:[!!t&&t.Friday],Saturday:[!!t&&t.Saturday]})}getDisabledKey(t){let n="";return 0==t?n="Sunday":1==t?n="Monday":2==t?n="Tuesday":3==t?n="Wednesday":4==t?n="Thursday":5==t?n="Friday":6==t&&(n="Saturday"),n}getTotalDaysInMonth(t,n){return new Date(n,Number(t)+1,0).getDate()}weeksInMOnth(t,n){var o=new Date(t,n,1).getDay(),a=this.getTotalDaysInMonth(this.currentMonth,this.currentYear);return 5==o&&30==a?5:5==o&&31==a||6==o&&30==a||6==o&&31==a?6:28==a||29==a?Math.floor(a/7)+1:Math.ceil(a/7)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(x.d),e.Y36(T.c),e.Y36(A.V),e.Y36(_),e.Y36(Z.F0),e.Y36(l.qu))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-route-coverage-plan"]],viewQuery:function(t,n){if(1&t&&(e.Gf(w,5),e.Gf(O,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.routeSelected=o.first),e.iGM(o=e.CRH())&&(n.SalesmanID=o.first)}},decls:32,vars:4,consts:[[1,"sticky-top","row"],[1,"col-md-4"],[1,"col-md-8"],[1,"row","pull-right",2,"margin-right","10px"],["type","submit","appOldFYearDB","",1,"btn","btn-info","btn-sm",3,"disabled","click"],["isOldFYearDB","appOldFYearDB"],["type","button",1,"btn","btn-info","btn-sm",3,"click"],[1,"main-container",2,"padding-top","10px","margin-bottom","0px"],[1,"row"],[1,"col-md-4","row"],[1,"col-md-3",2,"font-weight","bold","text-align","end"],[1,"col-md-7"],[1,"form-control",2,"padding","0px 5px",3,"change"],["SalesmanID",""],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-5","row"],["routeSelected",""],["id","route-schedule-sheet","style","margin-top: 2rem;","class","row",4,"ngIf"],[3,"value"],["id","route-schedule-sheet",1,"row",2,"margin-top","2rem"],["class","col-md-12 row",4,"ngIf"],[1,"col-md-12","row"],[1,"col-md-6"],[3,"formGroup"],[1,"table","table-striped",2,"background-color","white"],[1,"text-left"],[1,"text-center"],[2,"overflow","hidden"],["formArrayName","weeks",4,"ngFor","ngForOf"],[1,"form-control",2,"padding","0px 5px",3,"ngModel","ngModelChange"],["value",""],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","6"],["value","7"],["value","8"],["value","9"],["value","10"],["value","11"],[1,"btn","btn-info",3,"click"],[1,"clearfix",2,"margin-top","10px","height","400px","overflow-y","hidden","margin-left","15px"],[2,"position","sticky","top","0"],[1,"table","table","table-striped",2,"width","72%"],[2,"border-bottom","2px solid #E6E6E6","border-top","2px solid #E6E6E6","height","30px","background","silver","color","black"],[1,"table","table-striped",2,"width","72%","margin-top","-1rem"],[4,"ngFor","ngForOf"],["formArrayName","weeks"],[3,"formGroupName"],["type","checkbox","formControlName","Sunday"],["type","checkbox","formControlName","Monday"],["type","checkbox","formControlName","Tuesday"],["type","checkbox","formControlName","Wednesday"],["type","checkbox","formControlName","Thursday"],["type","checkbox","formControlName","Friday"],["type","checkbox","formControlName","Saturday"],[2,"border","1px solid #e3e3e3"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h5"),e._uU(3,"Route Coverage Plan"),e.qZA()(),e.TgZ(4,"div",2)(5,"div",3)(6,"button",4,5),e.NdJ("click",function(){return n.saveRoutePlan()}),e._uU(8,"Save"),e.qZA(),e.TgZ(9,"button",6),e.NdJ("click",function(){return n.cancel()}),e._uU(10,"Back"),e.qZA()()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"label",10),e._uU(15," Salesman:"),e.qZA(),e.TgZ(16,"div",11)(17,"select",12,13),e.NdJ("change",function(a){return n.getSalesmanRoute(a)}),e.TgZ(19,"option",14),e._uU(20,"Select Salesman"),e.qZA(),e.YNc(21,P,2,2,"option",15),e.qZA()()(),e.TgZ(22,"div",16)(23,"label",10),e._uU(24,"Route List:"),e.qZA(),e.TgZ(25,"div",11)(26,"select",12,17),e.NdJ("change",function(a){return n.getRouteSchedule(a)}),e.TgZ(28,"option",14),e._uU(29,"Select Route"),e.qZA(),e.YNc(30,U,2,2,"option",15),e.qZA()()()(),e.YNc(31,N,2,1,"div",18),e.qZA()),2&t){const o=e.MAs(7);e.xp6(6),e.Q6J("disabled",o.isOldFYearDB()),e.xp6(15),e.Q6J("ngForOf",n.allSalesmanList),e.xp6(9),e.Q6J("ngForOf",n.allRouteMasterList),e.xp6(1),e.Q6J("ngIf",n.showRoutePlan)}},dependencies:[p.sg,p.O5,l._Y,l.YN,l.Kr,l.Wl,l.EJ,l.JJ,l.JL,l.On,l.sg,l.u,l.x0,l.CE,D.H],styles:[".card[_ngcontent-%COMP%]{margin:36px 30px 0 300px!important;width:60%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}label[_ngcontent-%COMP%]{height:25px;font-size:14px}.col-sm-7[_ngcontent-%COMP%]{padding-left:1px}.form-control[_ngcontent-%COMP%]{font-size:14px}tbody[_ngcontent-%COMP%]{display:block;height:55vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}th[_ngcontent-%COMP%]{font-size:15px}td[_ngcontent-%COMP%]{font-size:13px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}"]}),r})()}];let I=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[Z.Bz.forChild(q),Z.Bz]}),r})();var E=i(46543);let J=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[_],imports:[p.ez,l.u5,l.UX,I,E.m]}),r})()}}]);