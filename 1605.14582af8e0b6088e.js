"use strict";var Gr=Object.defineProperty,Yr=(_e,re,A)=>re in _e?Gr(_e,re,{enumerable:!0,configurable:!0,writable:!0,value:A}):_e[re]=A,ar=(_e,re,A)=>(Yr(_e,"symbol"!=typeof re?re+"":re,A),A);(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[1605],{93105:_e=>{var t,re="object"==typeof Reflect?Reflect:null,A=re&&"function"==typeof re.apply?re.apply:function(g,y,L){return Function.prototype.apply.call(g,y,L)};t=re&&"function"==typeof re.ownKeys?re.ownKeys:Object.getOwnPropertySymbols?function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:function(g){return Object.getOwnPropertyNames(g)};var E=Number.isNaN||function(g){return g!=g};function m(){m.init.call(this)}_e.exports=m,_e.exports.once=function N(x,g){return new Promise(function(y,L){function D(U){x.removeListener(g,J),L(U)}function J(){"function"==typeof x.removeListener&&x.removeListener("error",D),y([].slice.call(arguments))}j(x,g,J,{once:!0}),"error"!==g&&function O(x,g,y){"function"==typeof x.on&&j(x,"error",g,y)}(x,D,{once:!0})})},m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var $=10;function F(x){if("function"!=typeof x)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function S(x){return void 0===x._maxListeners?m.defaultMaxListeners:x._maxListeners}function K(x,g,y,L){var D,J,U;if(F(y),void 0===(J=x._events)?(J=x._events=Object.create(null),x._eventsCount=0):(void 0!==J.newListener&&(x.emit("newListener",g,y.listener?y.listener:y),J=x._events),U=J[g]),void 0===U)U=J[g]=y,++x._eventsCount;else if("function"==typeof U?U=J[g]=L?[y,U]:[U,y]:L?U.unshift(y):U.push(y),(D=S(x))>0&&U.length>D&&!U.warned){U.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.emitter=x,H.type=g,H.count=U.length,function e(x){console&&console.warn&&console.warn(x)}(H)}return x}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(x,g,y){var L={fired:!1,wrapFn:void 0,target:x,type:g,listener:y},D=C.bind(L);return D.listener=y,L.wrapFn=D,D}function V(x,g,y){var L=x._events;if(void 0===L)return[];var D=L[g];return void 0===D?[]:"function"==typeof D?y?[D.listener||D]:[D]:y?function B(x){for(var g=new Array(x.length),y=0;y<g.length;++y)g[y]=x[y].listener||x[y];return g}(D):W(D,D.length)}function w(x){var g=this._events;if(void 0!==g){var y=g[x];if("function"==typeof y)return 1;if(void 0!==y)return y.length}return 0}function W(x,g){for(var y=new Array(g),L=0;L<g;++L)y[L]=x[L];return y}function j(x,g,y,L){if("function"==typeof x.on)L.once?x.once(g,y):x.on(g,y);else{if("function"!=typeof x.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(g,function D(J){L.once&&x.removeEventListener(g,D),y(J)})}}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return $},set:function(x){if("number"!=typeof x||x<0||E(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");$=x}}),m.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(g){if("number"!=typeof g||g<0||E(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this},m.prototype.getMaxListeners=function(){return S(this)},m.prototype.emit=function(g){for(var y=[],L=1;L<arguments.length;L++)y.push(arguments[L]);var D="error"===g,J=this._events;if(void 0!==J)D=D&&void 0===J.error;else if(!D)return!1;if(D){var U;if(y.length>0&&(U=y[0]),U instanceof Error)throw U;var H=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw H.context=U,H}var G=J[g];if(void 0===G)return!1;if("function"==typeof G)A(G,this,y);else{var Z=G.length,te=W(G,Z);for(L=0;L<Z;++L)A(te[L],this,y)}return!0},m.prototype.on=m.prototype.addListener=function(g,y){return K(this,g,y,!1)},m.prototype.prependListener=function(g,y){return K(this,g,y,!0)},m.prototype.once=function(g,y){return F(y),this.on(g,u(this,g,y)),this},m.prototype.prependOnceListener=function(g,y){return F(y),this.prependListener(g,u(this,g,y)),this},m.prototype.off=m.prototype.removeListener=function(g,y){var L,D,J,U,H;if(F(y),void 0===(D=this._events))return this;if(void 0===(L=D[g]))return this;if(L===y||L.listener===y)0==--this._eventsCount?this._events=Object.create(null):(delete D[g],D.removeListener&&this.emit("removeListener",g,L.listener||y));else if("function"!=typeof L){for(J=-1,U=L.length-1;U>=0;U--)if(L[U]===y||L[U].listener===y){H=L[U].listener,J=U;break}if(J<0)return this;0===J?L.shift():function Y(x,g){for(;g+1<x.length;g++)x[g]=x[g+1];x.pop()}(L,J),1===L.length&&(D[g]=L[0]),void 0!==D.removeListener&&this.emit("removeListener",g,H||y)}return this},m.prototype.removeAllListeners=function(g){var y,L,D;if(void 0===(L=this._events))return this;if(void 0===L.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==L[g]&&(0==--this._eventsCount?this._events=Object.create(null):delete L[g]),this;if(0===arguments.length){var U,J=Object.keys(L);for(D=0;D<J.length;++D)"removeListener"!==(U=J[D])&&this.removeAllListeners(U);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(y=L[g]))this.removeListener(g,y);else if(void 0!==y)for(D=y.length-1;D>=0;D--)this.removeListener(g,y[D]);return this},m.prototype.listeners=function(g){return V(this,g,!0)},m.prototype.rawListeners=function(g){return V(this,g,!1)},m.listenerCount=function(x,g){return"function"==typeof x.listenerCount?x.listenerCount(g):w.call(x,g)},m.prototype.listenerCount=w,m.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},75810:(_e,re,A)=>{A.d(re,{x:()=>Wn});var t=A(64537),e=A(42326),E=A(28698),m=A(37051),$=A(82484),F=A(27009),S=A(64752),K=A(71732),C=A(88692),u=A(23815),V=A(15613),w=A(53074),W=A(87584),Y=A(69389),B=A(54536),N=A(20092),O=A(7976),j=A(67311),x=A(67297),g=A(14970),y=A(74263),L=A(60694),D=A(7782),J=A(48063),U=A(33612),H=A(71800),G=A(98692),Z=A(90994),te=A(64657),de=A(59963),Ce=A(65171),ge=A(32711),Ie=A(87454),Re=A(86857),Le=A(94619),je=A(14173);function Ze(v,k){if(1&v&&(t.TgZ(0,"tr",10)(1,"td",11),t._uU(2),t.qZA(),t.TgZ(3,"td",12),t._uU(4),t.qZA(),t.TgZ(5,"td",12),t._uU(6),t.qZA()()),2&v){const r=k.$implicit,l=k.index;t.xp6(2),t.Oqu(l+1),t.xp6(2),t.Oqu(r.Warehouse),t.xp6(2),t.Oqu(r.Stock)}}function He(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),t._uU(4,"Warehouse Wise Stock"),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.itemBatchClosed())}),t.TgZ(6,"span",6),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"table",7)(9,"tr",8)(10,"th"),t._uU(11,"Sn."),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Warehouse"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Stock"),t.qZA()(),t.TgZ(16,"tbody"),t.YNc(17,Ze,7,3,"tr",9),t.qZA()()()()}if(2&v){const r=t.oxw();t.xp6(17),t.Q6J("ngForOf",r.wareHouseStockList)}}let Ge=(()=>{class v{constructor(r,l){this.masterRepo=r,this._trnMainService=l,this.isActive=!1,this.wareHouseStockList=[]}ngOnInit(){}show(r,l){this.isActive=!0,this.wareHouseStockList=[],this.indexRow=l,this.masterRepo.getWarehouseWiseStock(r).subscribe(c=>{this.wareHouseStockList=c})}itemBatchClosed(){this.isActive=!1,setTimeout(()=>{this.masterRepo.focusAnyControl("alternateQty"+this.indexRow)},50)}}return v.\u0275fac=function(r){return new(r||v)(t.Y36(w.P),t.Y36(W.p))},v.\u0275cmp=t.Xpm({type:v,selectors:[["warehousewisestock"]],decls:1,vars:1,consts:[["class","modal-sticky","style","width: 50vw;",4,"ngIf"],[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],["aria-disabled","true","class","highlight",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"]],template:function(r,l){1&r&&t.YNc(0,He,18,1,"div",0),2&r&&t.Q6J("ngIf",l.isActive)},dependencies:[C.sg,C.O5],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }"]}),v})();var at=A(89952);let ct=(()=>{class v{constructor(r){this._trnMainService=r}transform(r){return this.showColumnInProductInsert(r)}showColumnInProductInsert(r){switch(r){case"showNetAmtHeadercolumn":return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment);case"showVATcolumn":return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||(this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation)&&0==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment);case"showNetAmtNonEditable":return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.StockIssueReturn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Stockadjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ReverseProductionEntry&&!(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT);case"showNetAmtEditable":return this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this._trnMainService.userSetting.ENABLE_NETAMOUNT_EDIT}}}return v.\u0275fac=function(r){return new(r||v)(t.Y36(W.p,16))},v.\u0275pipe=t.Yjl({name:"showColumn",type:v,pure:!0}),v})();var lt=A(77398),ht=A(79700),dt=A(84260),ut=A(56529);let Tt=(()=>{class v{constructor(r,l){this.authservice=r,this._trnMainService=l}transform(r){return this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1!==this.authservice.getSetting().ENABLESINGLEBATCHMODE}}return v.\u0275fac=function(r){return new(r||v)(t.Y36(x.e,16),t.Y36(W.p,16))},v.\u0275pipe=t.Yjl({name:"checkBatchMode",type:v,pure:!0}),v})();const _t=["genericGridSupplierPopup"],Vi=["barCodeGridPopup"],Mt=["PetrolGrid"],pt=["genericGridMulitplePricePopup"],vt=["matrixitemgrid"],St=["warehouseWiseStockPopup"],Ui=["itemEditGrid"],mt=["authenticationPopup"],Bi=["rateValidatoin"],Ot=["genericGrid"],Ki=["focusBatch"];function Zi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function Fi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1,"Code"),t.qZA())}function Qi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Barcode "),t.qZA())}function gt(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Alt.Unit "),t.qZA())}function ft(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Alt.Qty "),t.qZA())}const ke=function(){return{width:"10%"}};function Ye(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," BatchNo "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function bt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Source Barcode "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function Ct(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," Source Batch Rate "),t.qZA())}function Et(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," S.. BatchId "),t.qZA())}function Je(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Source Batch "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}function It(v,k){1&v&&(t.TgZ(0,"th",52),t._uU(1," P-Stock "),t.qZA())}function At(v,k){1&v&&(t.TgZ(0,"th",52),t._uU(1," C-Stock "),t.qZA())}function Pt(v,k){1&v&&(t.TgZ(0,"th",53),t._uU(1," Quantity "),t.qZA())}function yt(v,k){1&v&&(t.TgZ(0,"th",53),t._uU(1," Other Unit Qty "),t.qZA())}const Ke=function(){return{width:"8%"}};function xt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Request Qty "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Ke):null)}}function Lt(v,k){if(1&v&&(t.TgZ(0,"th",6),t._uU(1," Approved Qty "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Ke):null)}}function Rt(v,k){if(1&v&&(t.TgZ(0,"th",6),t._uU(1," Sellable Stock "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",90==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Ke):null)}}function it(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Adjusting Barcode "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,ke):null)}}const Fe=function(){return{width:"7%"}};function Nt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Adjusting Batch "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Fe):null)}}function jt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Adjusting Batch Rate "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?t.DdM(1,Fe):t.DdM(2,ke))}}function wt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," A.. BatchId "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Fe):null)}}function Dt(v,k){if(1&v&&(t.TgZ(0,"th",50),t._uU(1," Variance Amnt "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",89==r._trnMainService.TrnMainObj.VoucherType&&1==r.userSetting.EnableBatchIdInAdjustment?t.DdM(1,Fe):t.DdM(2,ke))}}function kt(v,k){if(1&v&&(t.TgZ(0,"th",51),t._uU(1),t.qZA()),2&v){const r=t.oxw();t.xp6(1),t.hij(" ",r.FCRATELABEL," ")}}const Vt=function(){return{width:"15%"}},Ut=function(){return{width:"20%"}};function Bt(v,k){if(1&v&&(t.TgZ(0,"th",54),t._uU(1," Rate "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",19==r._trnMainService.TrnMainObj.VoucherType||8==r._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Vt):null)("ngStyle",7==r._trnMainService.TrnMainObj.VoucherType?t.DdM(4,Ut):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?t.DdM(5,Ke):null)}}function Kt(v,k){1&v&&(t.TgZ(0,"th",55),t._uU(1," MRP "),t.qZA())}function Zt(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," P.Rate "),t.qZA())}function Ft(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1,"Amount"),t.qZA())}function Qt(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," Con.Factor "),t.qZA())}function Ht(v,k){1&v&&(t.TgZ(0,"th",56),t._uU(1," Amt "),t.qZA())}function Gt(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," ECS "),t.qZA())}const qe=function(){return{width:"6.5%"}};function Yt(v,k){if(1&v&&(t.TgZ(0,"th",54),t._uU(1," Amt "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",8==r._trnMainService.TrnMainObj.VoucherType||15==r._trnMainService.TrnMainObj.VoucherType||1==r._trnMainService.TrnMainObj.VoucherType||7==r._trnMainService.TrnMainObj.VoucherType?t.DdM(2,qe):null)("ngStyle",10==r._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Ke):null)}}function Jt(v,k){1&v&&(t.TgZ(0,"th",57),t._uU(1," Dis% "),t.qZA())}function qt(v,k){1&v&&(t.TgZ(0,"th",58),t._uU(1," Dis Amt "),t.qZA())}function Wt(v,k){1&v&&(t.TgZ(0,"th",58),t._uU(1," Total Disc "),t.qZA())}function $t(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," Sales Price "),t.qZA())}function zt(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," Sales Price(W/V) "),t.qZA())}function Xt(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," WSP "),t.qZA())}function ei(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," WSP(W/V) "),t.qZA())}function ti(v,k){1&v&&(t.TgZ(0,"th",57),t._uU(1," Dis% "),t.qZA())}function ii(v,k){1&v&&(t.TgZ(0,"th",58),t._uU(1," Dis Amt "),t.qZA())}function ni(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1," S.Charge "),t.qZA())}function We(v,k){1&v&&(t.TgZ(0,"th",51),t._uU(1,"VAT"),t.qZA())}function ri(v,k){1&v&&(t.TgZ(0,"th",56),t._uU(1,"Net Amt"),t.qZA())}function oi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Net Rate "),t.qZA())}function si(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function ai(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Approval "),t.qZA())}function ci(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," MASTER ITEM "),t.qZA())}function li(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1,"OUT-QTY"),t.qZA())}function hi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1,"UNIT"),t.qZA())}function di(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Order Comments "),t.qZA())}const nt=function(){return{width:"130px"}};function ui(v,k){if(1&v&&(t.TgZ(0,"th",6),t._uU(1," Mfg Date "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,qe):t.DdM(2,nt))}}function Ti(v,k){if(1&v&&(t.TgZ(0,"th",6),t._uU(1," Exp Date "),t.qZA()),2&v){const r=t.oxw();t.Q6J("ngStyle",24==r._trnMainService.TrnMainObj.VoucherType?t.DdM(1,qe):t.DdM(2,nt))}}function _i(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," Old Expiry Date "),t.qZA())}function Mi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," New Mfg Date "),t.qZA())}function pi(v,k){1&v&&(t.TgZ(0,"th"),t._uU(1," New Exp Date "),t.qZA())}function vi(v,k){1&v&&(t.TgZ(0,"th",59),t._uU(1," Remarks "),t.qZA())}function Si(v,k){if(1&v&&(t.TgZ(0,"td",103),t._uU(1),t.qZA()),2&v){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",r.MENUCODE," ")}}function mi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",104)(1,"input",105),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.BC=c)})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ItemBarCodeClick(T,c))})("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ItemBarCodeClick(T,c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ItemBarCodeClick(T,c))})("focusout",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ItemBarCodeFoucusOut(T,c))})("focus",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ItemBarCodeClickFocusIn(T,c))}),t.ALo(2,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","barcode",l,""),t.Q6J("ngModel",c.BC)("readonly","VIEW"==c.rowMode)("disabled",t.Dn7(2,5,"disableBarcodeField",l,T._trnMainService.callPipe)),t.uIk("disabled",!0)}}const $e=function(v){return{tooltipChild:v}};function Oi(v,k){if(1&v&&(t.ynx(0),t._UZ(1,"span",106),t.BQk()),2&v){const r=t.oxw().index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,$e,l.hoverId==r))("innerHTML",l.itemDescHoverValue,t.oJD)}}function gi(v,k){if(1&v&&(t.ynx(0),t.TgZ(1,"option",110),t._uU(2),t.qZA(),t.BQk()),2&v){const r=k.$implicit;t.xp6(1),t.s9C("value",r.ALTUNIT),t.xp6(1),t.Oqu(r.ALTUNIT)}}function fi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",107)(1,"select",108),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ALTERNATEUNIT=c)}),t.YNc(2,gi,3,2,"ng-container",109),t.qZA()()}if(2&v){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.ALTERNATEUNIT),t.xp6(1),t.Q6J("ngForOf",null==r.Product?null:r.Product.AlternateUnits)}}function bi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",111)(1,"input",112),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.OPQTY=c)}),t.qZA()()}if(2&v){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.OPQTY)}}function Ci(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",113)(1,"input",114,115),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.BATCH=c)})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))})("keydown",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.onKeydownOnBatch(c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))}),t.ALo(3,"disable"),t.qZA(),t.TgZ(4,"span",67),t._uU(5,"press ENTER or TAB to Select Batch"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","batch",l,""),t.Q6J("ngModel",c.BATCH)("disabled",t.Dn7(3,3,"disableBatch",l,T._trnMainService.callPipe))}}function Ei(v,k){if(1&v&&(t.ynx(0),t.TgZ(1,"option",110),t._uU(2),t.qZA(),t.BQk()),2&v){const r=k.$implicit;t.xp6(1),t.s9C("value",r.ALTUNIT),t.xp6(1),t.Oqu(r.ALTUNIT)}}function Ii(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",107)(1,"select",116),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.SelectUnit(c))})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.AlternateUnitEnterEventClick(T,c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.AlternateUnitEnterEventClick(T,c))})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ALTUNIT=c)}),t.ALo(2,"disable"),t.YNc(3,Ei,3,2,"ng-container",109),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","alternateunit",l,""),t.Q6J("ngModel",c.ALTUNIT)("disabled",t.Dn7(2,4,"disableAltUnit",l,T._trnMainService.callPipe)),t.xp6(2),t.Q6J("ngForOf",null==c.Product?null:c.Product.AlternateUnits)}}function Ai(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",117)(1,"input",118),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.BC=c)})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))})("keydown",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.onKeydownOnBatch(c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebc",l,""),t.Q6J("ngModel",c.BC)("disabled",0==c.HASVARIANT)}}function Pi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",111)(1,"input",119),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.BATCHID=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebatchId",l,""),t.Q6J("ngModel",c.BATCHID)("readonly",!0)}}function yi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",107)(1,"input",120),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ALTUNIT=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","punit",l,""),t.Q6J("ngModel",c.ALTUNIT)}}function xi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",121)(1,"input",122),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.VRATE=c)}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","sourceRate",l,""),t.Q6J("ngModel",T.applyPipeInRate?t.lcZ(2,3,c.VRATE):c.VRATE)("readonly",!0)}}function Li(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",113)(1,"input",123),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.BATCH=c)})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))})("keydown",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.onKeydownOnBatch(c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.BatchEnter(T,c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","sourcebatch",l,""),t.Q6J("ngModel",c.BATCH)("disabled",c.isDisabled||"VIEW"==c.rowMode)}}function R(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",125),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.PSTOCK=c)})("keydown.Enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.PstockEnter(T,c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","physicalStock",l,""),t.Q6J("ngModel",c.PSTOCK)("disabled","VIEW"==T._trnMainService.TrnMainObj.Mode||"stock-adjustment"===T.activeurlpath)}}function q(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",126),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.CSTOCK=c)})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.CstockEnter(T,c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","computerStock",l,""),t.Q6J("ngModel",c.CSTOCK)("disabled","VIEW"==T._trnMainService.TrnMainObj.Mode||"stock-adjustment"===T.activeurlpath)}}function a(v,k){if(1&v&&(t.ynx(0),t._UZ(1,"span",106),t.BQk()),2&v){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,$e,l.qtyId==r))("innerHTML",l.qtyValue,t.oJD)}}function d(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",127),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ALTERNATEQUANTIY=c)})("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.QuantityChangeEvent(c))})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.focusToRate(T,c))})("keydown.Enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.AlternateQuantityEventClick(T,c))})("keypress",function(c){t.CHM(r);const T=t.oxw(),b=T.$implicit,z=T.index,ie=t.oxw();return t.KtG(1==b.NATURETYPE&&1!=b.isPurchaseOrder?ie.AlternateQuantityEventClick(z,c):ie.return)})("mouseover",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverQty(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverLeaveQty(c))}),t.ALo(2,"disable"),t.qZA(),t.YNc(3,a,2,4,"ng-container",4),t.qZA()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","alternateQty",l,""),t.Q6J("ngModel",c.ALTERNATEQUANTIY)("readonly",c.isQuantityReadonly)("disabled",t.Dn7(2,6,"disableAltQty",l,T._trnMainService.callPipe))("OnlyWholeNumber",1==c.StopDecimal),t.xp6(2),t.Q6J("ngIf",T.showtooltip)}}function h(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"input",128),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.OtherUnitQty=c)}),t.ALo(1,"disable"),t.qZA()}if(2&v){const r=t.oxw(),l=r.$implicit,c=r.index,T=t.oxw();t.Q6J("ngModel",l.OtherUnitQty)("disabled",t.Dn7(1,2,"disableAltQty",c,T._trnMainService.callPipe))}}function p(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",129),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.APPROVEDALTQTY=c)})("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.approvedQtyEnter(T,c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.approvedQtyEnter(c))}),t.ALo(2,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","approvedQty",l,""),t.Q6J("ngModel",c.APPROVEDALTQTY)("disabled",t.Dn7(2,3,"disableAprroveQty",l,T._trnMainService.callPipe))}}function P(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",130),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.STOCK=c)}),t.ALo(2,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","stock",l,""),t.Q6J("ngModel",c.STOCK)("disabled",t.Dn7(2,3,"disableGridForReqApproval",l,T._trnMainService.callPipe))}}function X(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",113)(1,"input",131),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ADJUSTBC=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.AdjustBatchEnter(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustbc",l,""),t.Q6J("ngModel",c.ADJUSTBC)("disabled",0==c.HASVARIANT)}}function oe(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",132)(1,"input",131),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ADJUSTBATCH=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.AdjustBatchEnter(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustbatch",l,""),t.Q6J("ngModel",c.ADJUSTBATCH)("disabled",c.isDisabled)}}function Me(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",111)(1,"input",133),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.INVRATE=c)}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","sourceRate",l,""),t.Q6J("ngModel",T.applyPipeInRate?t.lcZ(2,3,c.INVRATE):c.INVRATE)("readonly",!0)}}function Ae(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",111)(1,"input",119),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.MANUFACTURER=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","adjustBatchId",l,""),t.Q6J("ngModel",c.MANUFACTURER)("readonly",!0)}}function Se(v,k){if(1&v&&(t.TgZ(0,"td",134),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","varianceAmount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function me(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",135)(1,"input",136),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.INVRATE=c)})("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.FCRATEChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.fcrateEnterEvent(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.fcrateEnterEvent(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","fcrate",l,""),t.Q6J("ngModel",c.INVRATE)("disabled",T._trnMainService.disableRateOnPOselect)}}const Ve=function(v){return{"tooltipChild disabled-rate":v}};function Ue(v,k){if(1&v&&(t.ynx(0),t._UZ(1,"span",106),t.BQk()),2&v){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,Ve,l.rateId===r))("innerHTML",l.rateInnerHTML,t.oJD)}}function Ri(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",137)(1,"input",138),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ALTRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.MRPChangeEvent(T,b))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.mrpEnterEvent(T,b))})("keydown.enter",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.mrpEnterEvent(T,b))})("keyup",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateChange(c))})("focusout",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateFocusOut(c))})("mouseover",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverRate(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverLeaveRate(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.ALo(4,"checkBatchMode"),t.qZA(),t.YNc(5,Ue,2,4,"ng-container",4),t.qZA()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.Q6J("hidden",89==T._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.MGl("id","rate",l,""),t.Q6J("ngModel",T.applyPipeInRate?t.lcZ(2,6,c.ALTRATE):c.ALTRATE)("disabled",t.Dn7(3,8,"disableRateandDiscount",l,T._trnMainService.callPipe))("readonly",t.lcZ(4,12,T.disableRate())),t.xp6(4),t.Q6J("ngIf",T.showtooltip)}}function ze(v,k){if(1&v&&(t.TgZ(0,"td",139),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","grossamnt",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.GROSSAMNT))," ")}}function Te(v,k){if(1&v&&(t.TgZ(0,"td",140),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.MRP))," ")}}function rt(v,k){if(1&v&&(t.TgZ(0,"td",134),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","amount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function Xe(v,k){if(1&v&&(t.TgZ(0,"td",134),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","confactor",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.ALTCONFACTOR))," ")}}function pe(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",141),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.MRPChangeEvent(c))}),t.TgZ(1,"input",142),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ECSAMOUNT=c)})("focusout",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSFocusOut())})("focusin",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSFocusIn())})("keyup",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.ECSValueChange())})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ECSEnterClicked(T,c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.ECSEnterClicked(T,c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","ECSAmount",l,""),t.Q6J("ngModel",T.applyPipeInECS?t.lcZ(2,3,c.ECSAMOUNT):c.ECSAMOUNT)("disabled",T.disableECS(c))}}function ot(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",143),t.NdJ("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.MRPChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.mrpEnterEvent(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.mrpEnterEvent(c))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()}if(2&v){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function Be(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",145,146),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.INDDISCOUNTRATE=c)})("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.IndDiscountRateChangeEvent(c))})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.IndDiscountRateChange(c,T))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discRateEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discRateEnterClicked(c))}),t.ALo(3,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","discount",l,""),t.Q6J("ngModel",c.INDDISCOUNTRATE)("readonly",T.disableDiscount())("disabled",t.Dn7(3,4,"disableDiscountRate",l,T._trnMainService.callPipe))}}function et(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",147),t.NdJ("keyup",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateChange(c))})("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.IndDiscountAmountChangeEvent(T,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.INDDISCOUNT=c)})("focusout",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateFocusOut(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","discountAmt",l,""),t.Q6J("readonly",T.disableDiscount())("ngModel",T.applyPipeInRate?t.lcZ(2,4,c.INDDISCOUNT):c.INDDISCOUNT)("disabled",t.Dn7(3,6,"disableDiscountAmount",l,T._trnMainService.callPipe))}}function Ni(v,k){if(1&v&&(t.ynx(0),t._UZ(1,"span",106),t.BQk()),2&v){const r=t.oxw(2).index,l=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,$e,l.hoverId==r))("innerHTML",l.stringValue,t.oJD)}}function ji(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",148),t.NdJ("mouseover",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverDiscountt(c))})("mouseleave",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.hoverLeaveDiscountt(c))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.YNc(3,Ni,2,4,"ng-container",4),t.qZA()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","totalDisc",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,3,T._trnMainService.nullToZeroConverter(c.DISCOUNT))," "),t.xp6(2),t.Q6J("ngIf",c.DISCOUNT>0)}}function wi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",149),t.NdJ("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.IndDiscountAmountChangeOfRetailerVATINCEvent(T,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))}),t.ALo(2,"number"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","discountAmtVATInclusiveForretailer",l,""),t.Q6J("ngModel",t.xi3(2,3,T._trnMainService.nullToZeroConverter(c.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem)}}function tt(v,k){if(1&v&&(t.TgZ(0,"td",150),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.AMOUNT))," ")}}function $i(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",151)(1,"input",152),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.MRP=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateMRP())})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabMRP(c,T))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabMRP(c,T))})("keyup",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateChange(c))})("focusout",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.rateFocusOut(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","MRP",l,""),t.Q6J("ngModel",T.applyPipeInRate?t.lcZ(2,3,c.MRP):c.MRP)("disabled","VIEW"==T._trnMainService.TrnMainObj.Mode)}}function zi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",151)(1,"input",153),t.NdJ("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateSPRICE())})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.SPRICE=c)})("keydown.tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabSPRICE(c,T))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabSPRICE(c,T))})("keyup",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.spriceChange(c))})("focusout",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.spriceFocusOut(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","SPRICE",l,""),t.Q6J("ngModel",T.applyPipeInSprice?t.lcZ(2,3,c.SPRICE):c.SPRICE)("disabled","VIEW"==c.rowMode)}}function Xi(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",151)(1,"input",154),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.VSRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateVSRATE())})("keydown.tab",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.onTabVSRATE(c))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw(2);return t.KtG(T.onTabVSRATE(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","VSRATE",l,""),t.Q6J("ngModel",c.VSRATE)}}function en(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",151)(1,"input",154),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.VPRATE=c)})("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.RecalculateVPRATE())})("keydown.tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabVPRATE(c,T))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.onTabVPRATE(c,T))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","VPRATE",l,""),t.Q6J("ngModel",c.VPRATE)}}function tn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",145,146),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.INDDISCOUNTRATE=c)})("change",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.IndDiscountRateChangeEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discRateEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discRateEnterClicked(c))}),t.ALo(3,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","discountIP",l,""),t.Q6J("ngModel",c.INDDISCOUNTRATE)("readonly",T._trnMainService.disableProd||T.disableDiscount())("disabled",t.Dn7(3,4,"disableDiscountRateImpPurchase",l,T._trnMainService.callPipe))}}function nn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",155),t.NdJ("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.IndDiscountAmountChangeEvent(T,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.discEnterClicked(c))}),t.ALo(2,"twoDigitNumber"),t.ALo(3,"disable"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","discountAmti",l,""),t.Q6J("readonly",T.disableDiscount())("ngModel",t.lcZ(2,4,T._trnMainService.nullToZeroConverter(c.INDDISCOUNT)))("disabled",t.Dn7(3,6,"disableDiscountAmountImpPurchase",l,T._trnMainService.callPipe))}}function rn(v,k){if(1&v&&(t.TgZ(0,"td",156),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.SERVICETAX))," ")}}function on(v,k){if(1&v&&(t.TgZ(0,"td",157),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw().$implicit,l=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,l._trnMainService.nullToZeroConverter(r.VAT))," ")}}function sn(v,k){if(1&v&&(t.TgZ(0,"td",139),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","netamount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.NETAMOUNT))," ")}}function an(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",139)(1,"input",158),t.NdJ("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.changeONNetAmount(T,c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.clickOnNetAmount(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.clickOnNetAmount(c))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","netamount",l,""),t.xp6(1),t.MGl("id","netamounteditable",l,""),t.Q6J("ngModel",t.lcZ(2,4,T._trnMainService.nullToZeroConverter(c.NETAMOUNT)))("disabled","VIEW"==c.rowMode)}}function cn(v,k){if(1&v&&(t.TgZ(0,"td",159),t._UZ(1,"input",160),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","mrp",l,""),t.xp6(1),t.Q6J("ngModel",c.CRATE)("disabled",1==T._trnMainService.disableAllFieldinPurchase||T._trnMainService.disableOnGRNload)("readonly",!0)}}function ln(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",161)(1,"select",162),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.IsApproveStockSettlement=c)}),t.TgZ(2,"option",110),t._uU(3,"Approved"),t.qZA(),t.TgZ(4,"option",110),t._uU(5,"Not Approved"),t.qZA()()()}if(2&v){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.IsApproveStockSettlement),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function hn(v,k){if(1&v&&(t.TgZ(0,"td",134),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.MGl("id","amount",l,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,T._trnMainService.nullToZeroConverter(c.AMOUNT))," ")}}function dn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",161)(1,"select",162),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.isApproved=c)}),t.TgZ(2,"option",110),t._uU(3,"Approved"),t.qZA(),t.TgZ(4,"option",110),t._uU(5,"Not Approved"),t.qZA()()()}if(2&v){const r=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",r.isApproved),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function un(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",163)(1,"input",164),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.PDESCA=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","masteritem",l,""),t.Q6J("ngModel",c.PDESCA)("disabled","VIEW"==T._trnMainService.TrnMainObj.Mode)}}function Tn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",124)(1,"input",165),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.ROUTQTY=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","outqty",l,""),t.Q6J("ngModel",c.ROUTQTY)("disabled","VIEW"==T._trnMainService.TrnMainObj.Mode)}}function _n(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",107)(1,"input",120),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.PUNIT=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","punit",l,""),t.Q6J("ngModel",c.PUNIT)}}function Mn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",166)(1,"input",167),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.MFGDATE=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.productHelperService.CalculateExpiryDate(T.MFGDATE,b,T))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.MFGDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.MFGDateEnterEvent(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","mfgdate",l,""),t.s9C("type",T.mfgExpDateType),t.Q6J("ngModel",c.MFGDATE)("max",T.maxDate)("disabled","VIEW"==c.rowMode||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==T.activeurlpath||T._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==T._trnMainService.TrnMainObj.VoucherType||7==T._trnMainService.TrnMainObj.VoucherType||1==T.masterService.disableQtyInStockIssueReturn)}}function pn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",166)(1,"input",168),t.NdJ("change",function(){t.CHM(r);const c=t.oxw(2);return t.KtG(c.onChangeExpDate())})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.EXPDATE=c)})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.expDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.expDateEnterEvent(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","expdate",l,""),t.s9C("type",T.mfgExpDateType),t.Q6J("ngModel",c.EXPDATE)("max",T.maxDate)("min",T.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled||c.isPurchaseOrderItem||"stock-issue-approval"==T.activeurlpath||T._trnMainService.disableOnGRNload||null!=c.BATCH&&1==c.REQEXPDATE&&5==T._trnMainService.TrnMainObj.VoucherType||7==T._trnMainService.TrnMainObj.VoucherType||1==T.masterService.disableQtyInStockIssueReturn)}}function vn(v,k){if(1&v&&(t.TgZ(0,"td",169),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&v){const r=t.oxw(),c=r.$implicit;t.MGl("id","oldexpiry",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.EXPDATE)," ")}}function Sn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",170)(1,"input",167),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.TransferMfgDate=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.productHelperService.CalculateExpiryDate(T.TransferMfgDate,b,T))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.newMFGDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.newMFGDateEnterEvent(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","newmanufacture",l,""),t.s9C("type",T.mfgExpDateType),t.Q6J("ngModel",c.TransferMfgDate)("max",T.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function mn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",170)(1,"input",171),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.TransferExpiryDate=c)})("ngModelChange",function(){t.CHM(r);const c=t.oxw(),T=c.$implicit,b=c.index,z=t.oxw();return t.KtG(z.productHelperService.CalculateExpiryDate(T.TransferExpiryDate,b,T))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.newExpDateEnterEvent(c))})("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.newExpDateEnterEvent(c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw();t.xp6(1),t.MGl("id","newexpiry",l,""),t.s9C("type",T.mfgExpDateType),t.Q6J("ngModel",c.TransferExpiryDate)("max",T.maxDate)("min",T.currDate)("disabled","VIEW"==c.rowMode||c.isDisabled)}}function On(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",172)(1,"select",173),t.NdJ("keydown.Tab",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.OrderComment(c))})("keydown.enter",function(){t.CHM(r);const c=t.oxw().index,T=t.oxw();return t.KtG(T.OrderComment(c))})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.COMMENTS=c)}),t.TgZ(2,"option",174),t._uU(3,"Urgent"),t.qZA(),t.TgZ(4,"option"),t._uU(5,"Needed"),t.qZA(),t.TgZ(6,"option"),t._uU(7,"Nil"),t.qZA()()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","OrderComment",l,""),t.Q6J("ngModel",c.COMMENTS)}}function gn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",172)(1,"input",175),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.COMMENTS=c)}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","Comment",l,""),t.Q6J("ngModel",c.COMMENTS)}}function fn(v,k){if(1&v&&(t.TgZ(0,"td",176),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&v){const r=t.oxw(),c=r.$implicit;t.MGl("id","mfgdateNonedit",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.MFGDATE)," ")}}function bn(v,k){if(1&v&&(t.TgZ(0,"td",176),t._uU(1),t.ALo(2,"monthYear"),t.qZA()),2&v){const r=t.oxw(),c=r.$implicit;t.MGl("id","expdateNonedit",r.index,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,c.EXPDATE)," ")}}function Cn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",144)(1,"input",177),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.REMARKS=c)})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.RemarksEnterCommand(c,T))})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw();return t.KtG(b.RemarksEnterCommand(c,T))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit;t.xp6(1),t.MGl("id","remarks",l,""),t.Q6J("ngModel",c.REMARKS)("disabled","VIEW"==c.rowMode)}}const En=function(){return{width:"22%"}},In=function(){return[5,81]},An=function(){return[14,16,57,64,73]},Hi=function(){return[3,14,16,57,64,73,64,74,89]};function Pn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"tbody",60)(1,"tr",61),t.NdJ("click",function(){const T=t.CHM(r).index,b=t.oxw();return t.KtG(b.RowClick(T))})("keydown.Shift.delete",function(){const T=t.CHM(r).index,b=t.oxw();return t.KtG(b.deleteRow(T))}),t.TgZ(2,"td",62),t._uU(3),t.qZA(),t.YNc(4,Si,2,1,"td",63),t.ALo(5,"activeColumn"),t.YNc(6,mi,3,9,"td",64),t.ALo(7,"activeColumn"),t.TgZ(8,"td",65),t.NdJ("mouseover",function(){const T=t.CHM(r).index,b=t.oxw();return t.KtG(b.hoverItemDesc(T))})("mouseleave",function(){const T=t.CHM(r).index,b=t.oxw();return t.KtG(b.hoverLeaveItemDesc(T))}),t.TgZ(9,"input",66),t.NdJ("ngModelChange",function(c){const b=t.CHM(r).$implicit;return t.KtG(b.ITEMDESC=c)})("keydown.enter",function(c){const b=t.CHM(r).index,z=t.oxw();return z.ItemkeyEvent(b,c),t.KtG(z.displayProductDetailInViewMode(z.event))})("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onClicked())}),t.ALo(10,"disable"),t.qZA(),t.TgZ(11,"span",67),t._uU(12,"Press ENTER to Select Item"),t.qZA(),t.ynx(13),t._UZ(14,"br")(15,"span",68),t.BQk(),t.YNc(16,Oi,2,4,"ng-container",4),t.qZA(),t.YNc(17,fi,3,2,"td",69),t.YNc(18,bi,2,1,"td",70),t.YNc(19,Ci,6,7,"td",71),t.ALo(20,"activeColumn"),t.YNc(21,Ii,4,8,"td",69),t.ALo(22,"activeColumn"),t.YNc(23,Ai,2,3,"td",72),t.YNc(24,Pi,2,3,"td",70),t.YNc(25,yi,2,2,"td",69),t.YNc(26,xi,3,5,"td",73),t.YNc(27,Li,2,3,"td",71),t.YNc(28,R,2,3,"td",74),t.YNc(29,q,2,3,"td",74),t.YNc(30,d,4,10,"td",74),t.ALo(31,"activeColumn"),t.YNc(32,h,2,6,"input",75),t.YNc(33,p,3,7,"td",74),t.YNc(34,P,3,7,"td",74),t.YNc(35,X,2,3,"td",71),t.YNc(36,oe,2,3,"td",76),t.YNc(37,Me,3,5,"td",70),t.YNc(38,Ae,2,3,"td",70),t.YNc(39,Se,3,4,"td",77),t.YNc(40,me,2,3,"td",78),t.ALo(41,"activeColumn"),t.YNc(42,Ri,6,14,"td",79),t.YNc(43,ze,3,4,"td",80),t.YNc(44,Te,3,3,"td",81),t.YNc(45,rt,3,4,"td",77),t.YNc(46,Xe,3,4,"td",77),t.ALo(47,"activeColumn"),t.YNc(48,pe,3,5,"td",82),t.ALo(49,"activeColumn"),t.YNc(50,ot,3,3,"td",83),t.YNc(51,Be,4,8,"td",84),t.ALo(52,"activeColumn"),t.YNc(53,et,4,10,"td",84),t.ALo(54,"activeColumn"),t.YNc(55,ji,4,5,"td",85),t.YNc(56,wi,3,6,"td",84),t.ALo(57,"activeColumn"),t.YNc(58,tt,3,3,"td",86),t.YNc(59,$i,3,5,"td",87),t.YNc(60,zi,3,5,"td",87),t.YNc(61,Xi,2,2,"td",87),t.YNc(62,en,2,2,"td",87),t.YNc(63,tn,4,8,"td",84),t.ALo(64,"activeColumn"),t.YNc(65,nn,4,10,"td",84),t.ALo(66,"activeColumn"),t.YNc(67,rn,3,3,"td",88),t.YNc(68,on,3,3,"td",89),t.ALo(69,"activeColumn"),t.YNc(70,sn,3,4,"td",90),t.ALo(71,"showColumn"),t.YNc(72,an,3,6,"td",90),t.ALo(73,"showColumn"),t.YNc(74,cn,2,4,"td",91),t.YNc(75,ln,6,3,"td",92),t.YNc(76,hn,3,4,"td",77),t.YNc(77,dn,6,3,"td",92),t.YNc(78,un,2,3,"td",93),t.YNc(79,Tn,2,3,"td",74),t.YNc(80,_n,2,2,"td",69),t.YNc(81,Mn,2,5,"td",94),t.ALo(82,"activeColumn"),t.YNc(83,pn,2,6,"td",94),t.ALo(84,"activeColumn"),t.YNc(85,vn,3,4,"td",95),t.YNc(86,Sn,2,5,"td",96),t.YNc(87,mn,2,6,"td",96),t.YNc(88,On,8,2,"td",97),t.YNc(89,gn,2,2,"td",97),t.YNc(90,fn,3,4,"td",98),t.ALo(91,"activeColumn"),t.YNc(92,bn,3,4,"td",98),t.ALo(93,"activeColumn"),t.YNc(94,Cn,2,3,"td",84),t.TgZ(95,"td",99)(96,"div",100)(97,"button",101),t.NdJ("click",function(){const T=t.CHM(r).index,b=t.oxw();return t.KtG(b.deleteRow(T))}),t.ALo(98,"disable"),t._UZ(99,"img",102),t.qZA()()()()()}if(2&v){const r=k.$implicit,l=k.index,c=t.oxw();t.xp6(1),t.ekj("selected",c.isTableRowSelected(l))("highlighted",l+1==c.highlightBarCodeWiseRow())("bgforlessstockitem",c.highlightLessStockItem(l)),t.xp6(1),t.MGl("id","sno",l,""),t.xp6(1),t.hij(" ",l+1," "),t.xp6(1),t.Q6J("ngIf",t.lcZ(5,78,"MENUCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,80,"BARCODE_HEADER")),t.xp6(2),t.Q6J("ngStyle",3==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||74==c._trnMainService.TrnMainObj.VoucherType||31==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType?t.DdM(139,En):null),t.xp6(1),t.MGl("id","itemDesc",l,""),t.Q6J("readonly",c.ReadOnlyForDescription(l))("ngModel",r.ITEMDESC)("disabled",t.Dn7(10,82,"disableItemDesc",l,c._trnMainService.callPipe)),t.xp6(6),t.Q6J("innerHtml",r.VARIANTDESCA,t.oJD),t.xp6(1),t.Q6J("ngIf","export-sales-invoice"===c.activeurlpath&&r.REMARKS),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.DisplayAltQtyInSales&&(1==c._trnMainService.TrnMainObj.VoucherType||14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",t.lcZ(20,86,"BATCH_EDITABLE")),t.xp6(2),t.Q6J("ngIf",t.xi3(22,88,"UNIT_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(31,91,"QUANTITY_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableOtherUnitQtyInTI),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType&&0==c.userSetting.LogBasedRequisitionApproval),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&0==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",t.xi3(41,94,"FCRATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType&&0==c.userSetting.LogBasedRequisitionApproval||90!=c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",3==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||t.DdM(140,In).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1&&1==c.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",t.DdM(141,An).indexOf(c._trnMainService.TrnMainObj.VoucherType)>-1||"add-purchase-order"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.lcZ(47,97,"CONFACTOR")),t.xp6(2),t.Q6J("ngIf",t.lcZ(49,99,"ECSAmount")),t.xp6(2),t.Q6J("ngIf",-1==t.DdM(142,Hi).indexOf(c._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=c.activeurlpath&&!c.userSetting.IsBBSM||90==c._trnMainService.TrnMainObj.VoucherType&&0===c.userSetting.LogBasedRequisitionApproval&&c.userSetting.IsBBSM),t.xp6(1),t.Q6J("ngIf",t.xi3(52,101,"DISCOUNT_PER_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",t.xi3(54,104,"DISCOUNT_AMT_EDITABLE",l)),t.xp6(2),t.Q6J("ngIf",(14==c._trnMainService.TrnMainObj.VoucherType||15==c._trnMainService.TrnMainObj.VoucherType||1==c._trnMainService.TrnMainObj.VoucherType||3==c._trnMainService.TrnMainObj.VoucherType||64==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=c.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.xi3(57,107,"DISCOUNT_AMT_EDITABLE_VATINCLU",l)),t.xp6(2),t.Q6J("ngIf",6===c.pType),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE||74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",24==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.BATCHWISEPRICE&&1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",t.xi3(64,110,"DISCOUNT_IMPORTPURCHASE",l)),t.xp6(2),t.Q6J("ngIf",t.xi3(66,113,"DISCOUNT_IMPORTPURCHASE",l)),t.xp6(2),t.Q6J("ngIf",14==c._trnMainService.TrnMainObj.VoucherType&&1==c.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",t.xi3(69,116,"GST_AMT_NONEDITABLE",l)),t.xp6(2),t.Q6J("ngIf",t.lcZ(71,119,"showNetAmtNonEditable")),t.xp6(2),t.Q6J("ngIf",t.lcZ(73,121,"showNetAmtEditable")),t.xp6(2),t.Q6J("ngIf",(3==c._trnMainService.TrnMainObj.VoucherType||37==c._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||31==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",c.approvalFlag),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf","add-creditnote-itembase-approval"==c.activeurlpath||"add-stock-issue-approval"==c.activeurlpath||"transfer-out-approval"==c.activeurlpath||"stock-issue-approval"==c.activeurlpath),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(82,123,"MFGDATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(84,126,"EXPDATE_EDITABLE",0)),t.xp6(2),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY&&1==c.userSetting.enableDayWiseMfgEXPDate),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==c._trnMainService.TrnMainObj.VoucherType&&1==c._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",80==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==c._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(91,129,"MFGDATE_NONEDITABLE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(93,132,"EXPDATE_NONEDITABLE",0)),t.xp6(2),t.Q6J("ngIf",64==c._trnMainService.TrnMainObj.VoucherType||20==c._trnMainService.TrnMainObj.VoucherType||90==c._trnMainService.TrnMainObj.VoucherType||89==c._trnMainService.TrnMainObj.VoucherType||57==c._trnMainService.TrnMainObj.VoucherType||19==c._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=c._trnMainService.TrnMainObj.AdditionalObj.tag||80==c._trnMainService.TrnMainObj.VoucherType),t.xp6(3),t.Q6J("disabled",t.Dn7(98,135,"disableRowDelete",l,c._trnMainService.callPipe))}}function yn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"span",178),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.addRowInsert())}),t.TgZ(1,"p"),t._uU(2,"+"),t.qZA()()}}function xn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"tr",187),t.NdJ("click",function(){const T=t.CHM(r).$implicit,b=t.oxw(2);return t.KtG(b.selectProductDetails(T))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&v){const r=k.$implicit;t.xp6(2),t.Oqu(r.color),t.xp6(2),t.Oqu(r.size),t.xp6(2),t.Oqu(r.imeI1),t.xp6(2),t.Oqu(r.imeI2)}}function Ln(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div")(1,"div",179)(2,"div",180)(3,"div")(4,"div")(5,"div",181)(6,"h4",182),t._uU(7," Product Details "),t.qZA(),t.TgZ(8,"button",42),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeProductDetails())}),t.TgZ(9,"span",43),t._uU(10,"\xd7"),t.qZA()()(),t.TgZ(11,"div",183)(12,"table",184)(13,"thead")(14,"tr",185)(15,"th"),t._uU(16,"Color Group"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Size Group"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"IMEI 1"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"IMEI 2"),t.qZA()()(),t.TgZ(23,"tbody"),t.YNc(24,xn,9,4,"tr",186),t.qZA()()()()()()()()}if(2&v){const r=t.oxw();t.xp6(24),t.Q6J("ngForOf",r.selectedProductDetails)}}function Rn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div",188)(1,"PItemList",189),t.NdJ("dbClickEvent",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.dblClickPopupItem(c))})("itemCloseClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.model1Closed())}),t.qZA()()}if(2&v){const r=t.oxw();t.xp6(1),t.Q6J("title",r.masterService.PlistTitle)}}function Nn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div",190)(1,"PBatchList",191),t.NdJ("dbClickEvent",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.dblClickPopupBatch(c))})("BatchClosedClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.model1Closed())})("returnBatchValue",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.returnBatch(c))}),t.qZA()()}if(2&v){const r=t.oxw();t.xp6(1),t.Q6J("AlternateUnits",r.AlternateUnits)("activerowIndex",r.activerowIndex)("title",r.masterService.PlistTitle)("BList",r.batchlist)("voucherType",r._trnMainService.TrnMainObj.VoucherType)("activeurlpath",r.activeurlpath)}}function jn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div",190)(1,"popPartyChoose",192),t.NdJ("dbClickEvent",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.dblClickPopupParty(c))})("partyCloseClick",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.partypopupClosed())}),t.qZA()()}if(2&v){const r=t.oxw();t.xp6(1),t.Q6J("partyList",r._trnMainService.partyList)}}function wn(v,k){1&v&&(t.TgZ(0,"th",212),t._uU(1," CURRENT WS-PRICE "),t.qZA())}function Dn(v,k){1&v&&(t.TgZ(0,"th",213),t._uU(1," NEW WS-PRICE "),t.qZA())}function kn(v,k){if(1&v&&(t.TgZ(0,"td",215),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&v){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,r.WSRATE_A)," ")}}function Vn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"td",215)(1,"input",217),t.NdJ("change",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw(2);return t.KtG(b.onChangePurchasePrice(T,c))})("ngModelChange",function(c){t.CHM(r);const T=t.oxw().$implicit;return t.KtG(T.WNRATE_A=c)})("keydown.enter",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw(2);return t.KtG(b.onChangePurchasePrice(T,c))})("keydown.Tab",function(c){t.CHM(r);const T=t.oxw().index,b=t.oxw(2);return t.KtG(b.onChangePurchasePrice(T,c))}),t.qZA()()}if(2&v){const r=t.oxw(),l=r.index,c=r.$implicit,T=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",l,""),t.Q6J("ngModel",c.WNRATE_A)("disabled","VIEW"==c.rowMode||c.isPurchaseOrderItem||T._trnMainService.TrnMainObj.ProdList[T.activerowIndex].BASEUNIT!=c.UNIT)}}function Un(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"tbody")(1,"tr",214)(2,"td",215),t._uU(3),t.qZA(),t.TgZ(4,"td",215),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA(),t.YNc(7,kn,3,3,"td",216),t.TgZ(8,"td",215)(9,"input",217),t.NdJ("change",function(c){const b=t.CHM(r).index,z=t.oxw(2);return t.KtG(z.onChangePurchasePrice(b,c))})("ngModelChange",function(c){const b=t.CHM(r).$implicit;return t.KtG(b.NRATE_A=c)})("keydown.enter",function(c){const b=t.CHM(r).index,z=t.oxw(2);return t.KtG(z.onChangePurchasePrice(b,c))})("keydown.Tab",function(c){const b=t.CHM(r).index,z=t.oxw(2);return t.KtG(z.onChangePurchasePrice(b,c))}),t.qZA()(),t.YNc(10,Vn,2,3,"td",216),t.qZA()()}if(2&v){const r=k.$implicit,l=k.index,c=t.oxw(2);t.xp6(3),t.Oqu(r.UNIT),t.xp6(2),t.hij(" ",t.lcZ(6,7,r.CRATE_A)," "),t.xp6(2),t.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING),t.xp6(2),t.MGl("id","newSellingPrice",l,""),t.Q6J("ngModel",r.NRATE_A)("disabled","VIEW"==r.rowMode||r.isPurchaseOrderItem||c._trnMainService.TrnMainObj.ProdList[c.activerowIndex].BASEUNIT!=r.UNIT),t.xp6(1),t.Q6J("ngIf",1==c.userSetting.ENABLEWSALESRATEBILLING)}}function Bn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div",193)(1,"div",194)(2,"div",195)(3,"h4",196),t._uU(4," Selling Price Setting "),t.qZA()(),t.TgZ(5,"div",197)(6,"div")(7,"h5",196),t._uU(8," Cost Price has been changed.Please reset your new Selling Price "),t.qZA(),t._UZ(9,"hr",198),t.qZA(),t.TgZ(10,"div",45)(11,"label"),t._uU(12,"Label MRP:"),t.qZA(),t.TgZ(13,"input",199),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T._trnMainService.TrnMainObj.ProdList[T.activerowIndex].LABELMRP=c)}),t.qZA()(),t.TgZ(14,"fieldset")(15,"legend",200),t._uU(16," New Selling Price Setting "),t.qZA(),t.TgZ(17,"table",184)(18,"thead")(19,"tr",201)(20,"th",202),t._uU(21,"UOM"),t.qZA(),t.TgZ(22,"th",203),t._uU(23,"CURRENT S-PRICE"),t.qZA(),t.YNc(24,wn,2,0,"th",204),t.TgZ(25,"th",205),t._uU(26,"NEW S-PRICE"),t.qZA(),t.YNc(27,Dn,2,0,"th",206),t.qZA()(),t.YNc(28,Un,11,9,"tbody",109),t.qZA(),t.TgZ(29,"div",45)(30,"div",207)(31,"h6"),t._uU(32),t.qZA()(),t.TgZ(33,"div",208),t._UZ(34,"div",209),t.qZA()()(),t.TgZ(35,"button",210),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyClickNewPrice())})("keydown.enter",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyClickNewPrice())}),t._uU(36," APPLY "),t.qZA(),t.TgZ(37,"button",211),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyOldPriceClick())})("keydown.enter",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.onApplyOldPriceClick())}),t._uU(38," APPLY OLD S-PRICE "),t.qZA()()()()}if(2&v){const r=t.oxw();t.xp6(13),t.Q6J("ngModel",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].LABELMRP),t.xp6(11),t.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),t.xp6(3),t.Q6J("ngIf",1==r.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngForOf",r._trnMainService.priceChangeList),t.xp6(4),t.hij(" Recommended Margin: ",r._trnMainService.selectedProdcutRecMargin,"% ")}}function Kn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div")(1,"div",218)(2,"div",219)(3,"div",181)(4,"h5",182),t._uU(5," Discount authorization "),t.qZA(),t.TgZ(6,"button",42),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t.TgZ(7,"span",43),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",44)(10,"div",220)(11,"label",221),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",222)(14,"input",223),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.disAuthObj.username=c)}),t.qZA()()(),t.TgZ(15,"div",220)(16,"label",221),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",222)(19,"input",224),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.disAuthObj.password=c)}),t.qZA()()(),t.TgZ(20,"div",220)(21,"label",221),t._uU(22,"Discount:"),t.qZA(),t.TgZ(23,"div",225)(24,"input",226),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.disAuthObj.discount=c)}),t.qZA()(),t.TgZ(25,"div",227)(26,"a"),t._uU(27,"% \xa0"),t.qZA()()(),t.TgZ(28,"div",228)(29,"fieldset",229)(30,"legend",230),t._uU(31," Discount authorization remarks: "),t.qZA(),t.TgZ(32,"textarea",231),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.disAuthObj.remarks=c)}),t.qZA()()()(),t.TgZ(33,"div",232)(34,"button",233),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.discountAuthConfirm())}),t._uU(35," Confirm "),t.qZA()()()()()}if(2&v){const r=t.oxw();t.xp6(14),t.Q6J("ngModel",r.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",r.disAuthObj.password),t.xp6(5),t.Q6J("ngModel",r.disAuthObj.discount),t.xp6(8),t.Q6J("ngModel",r.disAuthObj.remarks)}}function Zn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",234),t.NdJ("BatchClosedEmit",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.BatchPopupClosed())})("dbClickEvent",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.dblClickPopupBatchs(c))}),t.qZA()()}if(2&v){const r=t.oxw();t.xp6(1),t.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function Fn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",234),t.NdJ("BatchClosedEmit",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.AdjustPopupClosed())})("dbClickEvent",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T.DblClickPopupAdjust(c))}),t.qZA()()}if(2&v){const r=t.oxw();t.xp6(1),t.Q6J("Blist",r.batchList)("HASVARIANT",r._trnMainService.TrnMainObj.ProdList[r.activerowIndex].HASVARIANT)}}function Qn(v,k){if(1&v){const r=t.EpF();t.TgZ(0,"div")(1,"div",235)(2,"div",219)(3,"div",181)(4,"h6",182),t._uU(5," Authorization for Negative Stock Entry "),t.qZA(),t.TgZ(6,"button",42),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t.TgZ(7,"span",43),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",44)(10,"div",220)(11,"label",221),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",222)(14,"input",236),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T._trnMainService.disAuthObj.username=c)}),t.qZA()()(),t.TgZ(15,"div",220)(16,"label",221),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",222)(19,"input",224),t.NdJ("ngModelChange",function(c){t.CHM(r);const T=t.oxw();return t.KtG(T._trnMainService.disAuthObj.password=c)}),t.qZA()()()(),t.TgZ(20,"div",232)(21,"button",233),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.confirmAuthorization())}),t._uU(22," Confirm "),t.qZA(),t.TgZ(23,"button",237),t.NdJ("click",function(){t.CHM(r);const c=t.oxw();return t.KtG(c.closeModal())}),t._uU(24," Cancel "),t.qZA()()()()()}if(2&v){const r=t.oxw();t.xp6(14),t.Q6J("ngModel",r._trnMainService.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",r._trnMainService.disAuthObj.password)}}const Hn=function(){return{width:"28%"}},Gn=function(){return{width:"25%"}},Yn=function(){return{width:"24%"}},Jn=function(){return{width:"40%"}},qn=function(){return{backdrop:"static"}};let Wn=(()=>{class v{constructor(r,l,c,T,b,z,ie,fe,we,be,Ee,$n,zn,Xn,er,tr){this.masterService=r,this._trnMainService=l,this.setting=c,this.dialog=T,this.fb=b,this.arouter=z,this.alertService=ie,this.authservice=fe,this.changeDetection=we,this.loader=be,this.validationService=Ee,this.responseMsgService=$n,this.userRightAuthService=zn,this.productHelperService=Xn,this.focusService=er,this.salesRateDisabled=tr,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.stringValue="",this.hoverId=null,this.onHoverItemDesc=!1,this.itemDescHoverValue="",this.TotalBill=new t.vpe,this.gridPopupSettingsForSupplier=new E.im,this.barcodeGridSettings=new E.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new t.vpe,this.onChangeProductionItem=new t.vpe,this.indexEmit=new t.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.showtooltip=!1,this.qtyValue="",this.qtyId=null,this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new E.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInSprice=!0,this.applyPipeInECS=!0,this.mfgExpDateType="month",this.currDate="",this.maxDate="",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=Gi=>{let ve=Object.assign({},this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),Yi=[],Ji=0;for(var Oe of Gi)if(ve.VaraintDetailS=[],this.masterService.nullToZeroConverter(Oe.QTY)>0){let ki="";ve.VARIANTDESCA="";var qi={};for(var Qe in Oe)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Qe)&&(ki+=Oe[Qe].VARIANTBARCODE,ve.VARIANTDESCA=ve.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Qe)}</b>:${Oe[Qe].NAME} &nbsp;`,qi[Oe[Qe].VARIANTNAME]=Oe[Qe].NAME);ve.VaraintDetailS.push(qi),ve.VARIANTLIST=Oe,ve.BC=Oe.BARCODE?Oe.BARCODE:ve.MCODE+ki,ve.Quantity=Oe.QTY,ve.MRP=Oe.MRP,ve.ALTMRP=Oe.MRP,ve.REALQTY_IN=Oe.QTY,ve.ALTERNATEQUANTIY=Oe.QTY,ve.AltQty=Oe.QTY,ve.PRATE=Oe.PRATE,ve.RATE=Oe.PRATE,ve.REALRATE=Oe.PRATE,ve.ALTRATE=Oe.PRATE,ve.SPRICE=Oe.SRATE,ve.SellingPrice=Oe.SRATE,ve.ALTRATE2=Oe.SRATE,this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&(ve.SELLRATEBEFORETAX=Oe.SRATE),ve.BATCH=`-${Ji}`,Yi.push(Object.assign({},ve)),Ji++}let Di=this._trnMainService.TrnMainObj.ProdList.slice(0,this.activerowIndex),nr=this._trnMainService.TrnMainObj.ProdList.slice(this.activerowIndex+1);for(var rr of(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex),Yi))Di.push(rr);for(var or of nr)Di.push(or);this._trnMainService.TrnMainObj.ProdList=Di,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)};const ir=new Date;this.currDate=(0,C.p6)(ir,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this._trnMainService.TrnMainObj.VoucherType&&(this.AppSettings=c.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(this.showDiscount=!1),r.ShowMore=!0}catch{}this.activeurlpath=z.snapshot.url[0].path,this._trnMainService.TrnMainObj.CHALANNO="","export-sales-invoice"==this.activeurlpath?this.FCRATELABEL="FC E.Rate":(e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(this.FCRATELABEL="FC P.Rate")}ngAfterContentChecked(){this.changeDetection.detectChanges()}updown(r){"number"===r.target.type&&("-"===r.key||"Minus"===r.key)&&r.preventDefault(),"F2"===r.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F7"==r.code&&(r.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===r.code&&(r.preventDefault(),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&this._trnMainService.inputCode&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.length>0&&this.dialougeOpen()),"F11"==r.code&&r.ctrlKey&&(r.preventDefault(),this._trnMainService.barCodes.BC||null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&this.checkBatchWiseRate()),"Escape"==r.code&&(r.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}model1Closed(){this.masterService.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;const r=new Date;0==this.userSetting.EnablePreviousDateInExpiry&&(this.currDate=(0,C.p6)(r,"yyyy-MM-dd","en-US"),this.maxDate="2999-12-31",0==this.userSetting.enableDayWiseMfgEXPDate&&(this.currDate=(0,C.p6)(r,"yyyy-MM","en-US"),this.maxDate="2999-12"))}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(r=>{this.colorLists=r&&r.result?r.result:[]})}RowClick(r){this.activerowIndex=this.rowIndex=r,this.masterService.ShowMore=!1,console.log("row click",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(r)}disableECS(r){return this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&!this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||r.ECSRATE>0||0==r.HASECSCHARGE}descriptionEditOnRowClick(r){this._trnMainService.allowDescriptionEdit=1==this._trnMainService.TrnMainObj.ProdList[r].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let r=0;if(r=this._trnMainService.TrnMainObj.ProdList.length-1,this._trnMainService.TrnMainObj.ProdList&&null!=this._trnMainService.TrnMainObj.ProdList[0].MENUCODE)return this._trnMainService.TrnMainObj.ProdList.findIndex(c=>c.BC==this._trnMainService.barCodes.BC&&0==c.FulfillBatchQty)+1}highlightLessStockItem(r){return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.ProdList[r].MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this._trnMainService.TrnMainObj.ProdList[r].APPROVEDALTQTY}showPOQtyRate(r){this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this._trnMainService.TrnMainObj.ProdList[r].POSTOCK,this._trnMainService.purchaseOrderRate=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE,this._trnMainService.produstWiseOrderUnit=this._trnMainService.TrnMainObj.ProdList[r].BASEUNIT)}openDialog(r){this.selectedIndex=r}ItemBarCodeClick(r,l){if(this.activerowIndex=r,this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry||this._trnMainService.TrnMainObj.BILLTO){if(!this._trnMainService.TrnMainObj.ProdList[r].BC&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&"NEW"!==this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[r].ProductDetails,this._trnMainService.TrnMainObj.ProdList[r].visible=!0,this.getProductColorMcodeWise(),!1;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&"PI"===this._trnMainService.TrnMainObj.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[r].ProductDetails,this._trnMainService.TrnMainObj.ProdList[r].visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this._trnMainService.TrnMainObj.Mode||"EDIT"===this._trnMainService.TrnMainObj.Mode)&&6===this._trnMainService.TrnMainObj.ProdList[r].Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this._trnMainService.TrnMainObj.ProdList[r].BC||null==this._trnMainService.TrnMainObj.ProdList[r].BC||""==this._trnMainService.TrnMainObj.ProdList[r].BC)1==this._trnMainService.TrnMainObj.ProdList[r].isBarcodeOfPtypeSix&&(this._trnMainService.TrnMainObj.ProdList[r].isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this._trnMainService.TrnMainObj.ProdList[r]={}},0)),null!=document.getElementById("itemDesc"+r)&&setTimeout(()=>{document.getElementById("itemDesc"+r).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesReturn){let c=this._trnMainService.TrnMainObj.ProdList.filter(b=>b.BC==this._trnMainService.TrnMainObj.ProdList[r].BC);if(null!=c&&c?.length>1)return this.alertService.info(`Duplicate barcode:${this._trnMainService.TrnMainObj.ProdList[r].BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(b=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)});this._trnMainService.TrnMainObj.ProdList.filter(b=>6==b.PTYPE).forEach(b=>b.ProductDetails?.forEach(z=>{if(z.IEMI1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)return this.alertService.info(`Duplicte IMEI1 :${z.IEMI1} is found on Bulk Entry Grid`),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=null,!1}))}this._trnMainService.TrnMainObj.ProdList[r].BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this._trnMainService.TrnMainObj.ProdList[r].BC,this._trnMainService.TrnMainObj.REFBILL).subscribe(c=>{"ok"==c.status?(this._trnMainService.ReturnStockObj=c.result,this.loadBarcodeWiseProductList(c.result.TotalStock)):(this.alertService.info(c.result),this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{document.getElementById("barcode"+r).focus()},0)}))},c=>{this.alertService.info(c.result)}):this._trnMainService.checkBarcode(this._trnMainService.TrnMainObj.ProdList[r].BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(c=>{"ok"==c.status?this.loadBarcodeWiseProductList():this.alertService.info(c.result)},c=>{this.alertService.info(c.result)}))}}else this.alertService.info("Please select Production warehouse")}ItemkeyEvent(r,l){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"export-sales-invoice"===this.activeurlpath){if(console.log("CHECKED",this._trnMainService.TrnMainObj.FCurrency,this._trnMainService.TrnMainObj.EXRATE),""===this._trnMainService.TrnMainObj.FCurrency||null==this._trnMainService.TrnMainObj.FCurrency){const c=this.alertService.emitShowHideSubject.subscribe(T=>{this.masterService.ShowMore=!0,this.alertService.info("Currency cannnot be null"),setTimeout(()=>{c.unsubscribe()},1e3)});return}if(null==this._trnMainService.TrnMainObj.EXRATE)return void this.alertService.info("EX Rate cannnot be null")}if(l.preventDefault(),this.activerowIndex=r,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this._trnMainService.TrnMainObj.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(c=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});this.showStockedQuantityOnly=0}else this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE??""):this.showStockedQuantityOnly=0;if("performa-invoice"==this.activeurlpath&&null==this._trnMainService.TrnMainObj.BILLTO){const c=this.alertService.emitShowHideSubject.subscribe(T=>{this.masterService.ShowMore=!0,this.alertService.warning("Please select customer first"),setTimeout(()=>{c.unsubscribe(),document.getElementById("customerselectid").focus()},1e3)});return}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&1!==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(0!==this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_GRN_IN_PI)&&"purchase-import"!==this.activeurlpath&&0==this.userSetting.DisablePOReferenceRequired||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&0==this.userSetting.DisablePOReferenceRequired||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&0!==this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&1==this.userSetting.SOREFERENCE_REQUIRED||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER){if(console.log("eta hai1"),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0!=this.userSetting.ENABLE_QUOTATTION_INSO||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&1===this._trnMainService.TrnMainObj.ISLOADFROMORDER){if(!this._trnMainService.TrnMainObj.REFORDBILL){console.log("ETA ROKYO ?");let c=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(c),!1}}else if(null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.info(this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj)),!1;this.gridPopupSettings.apiEndpoints=`/getMenuitemFromProdForIssueReturnPagedList/${this._trnMainService.TrnMainObj.BILLTO}`}else if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath&&1==this.userSetting.DisablePOReferenceRequired&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE&&0!=this.userSetting.ENABLE_GRN_IN_PI&&1==this.userSetting.DisablePOReferenceRequired&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this._trnMainService.TrnMainObj.VoucherType!=e.Km.Sales&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice||0===this.userSetting.ENABLE_SOINTI||0!=this.userSetting.SOREFERENCE_REQUIRED||null==this._trnMainService.TrnMainObj.REFORDBILL)if(this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&0==this.userSetting.SOREFERENCE_REQUIRED&&null!=this._trnMainService.TrnMainObj.REFORDBILL)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";else{let T,c="";"self-billing"===this.activeurlpath?c="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(c=this._trnMainService.TrnMainObj.VoucherPrefix);let b="";if(b=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(b=this._trnMainService.TrnMainObj.BILLTO,null==this._trnMainService.TrnMainObj.BILLTO))return void this.alertService.info("Please select From Warehouse before selecting an item ");if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&(null==this._trnMainService.TrnMainObj.MWAREHOUSE||""==this._trnMainService.TrnMainObj.MWAREHOUSE))return void this.alertService.info("Please select Warehouse before selecting item");if(T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,(0==this.userSetting.GblBarcodeWiseBilling||null==T||void 0===T||""==T)&&(T="A"),this.productListInGenericPopup(r,T,c,b),this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please select Production warehouse");b=this._trnMainService.TrnMainObj.BILLTO}this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.INVOICETYPE&&"StockIssue"==this._trnMainService.TrnMainObj.INVOICETYPE&&(b=this._trnMainService.TrnMainObj.BILLTO),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${T}/all/${c}/${b}`}else this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList";if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE){let c="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(c=this._trnMainService.TrnMainObj.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}if("add-membership-sales-invoice"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getMenuItemListForMembershipSales"),this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag){if(null==this._trnMainService.TrnMainObj.BILLTO||void 0===this._trnMainService.TrnMainObj.BILLTO||""==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please Choose Supplier to Proceed...");if(!this._trnMainService.TrnMainObj.EXRATE)return void this.alertService.info("Please choose exchange rate to proceed or exchange rate cannot be zero...")}return this._trnMainService.itemselectevent=!0,this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||"FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL),!1}this.displayProductDetailInViewMode(l)}}productListInGenericPopup(r,l,c,T){if(1==this._trnMainService.TrnMainObj.ProdList[r].ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let b=this._trnMainService.TrnMainObj.ProdList[r].ITEMDESC;b&&""!=b?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+r).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${T}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${l}/all/${c}/${T}`}displayProductDetailInViewMode(r){console.log("eventlog",r),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==r.code&&this.dialougeOpen()}onChangeExpDate(){}loadBarcodeWiseProductList(r=0){this.loadFromBarcode=!1;let c=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(b=>{if("ok"===b.status)if(c=b.result.data,0===c.length)this.alertService.info("Product is out of Stock ");else if(1===c.length){this.loadFromBarcode=!0;var z=c[0];if(this._trnMainService.CheckIfSalesReturn()){z.STOCK=r;var ie=0;for(let be of this._trnMainService.TrnMainObj.ProdList)be.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(ie+=be.ALTERNATEQUANTIY);if(z.STOCK<ie)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(z),this.loadFromBarcode=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",z.barcodeDetails){var fe=JSON.parse(z.barcodeDetails);for(var we in console.log("varDetail",fe),fe)this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${we}</b>:${fe[we]} &nbsp;`}}else this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(b.result.error)})}checkDuplicatProductWithBarcode(){let r=[];return r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.BARCODE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE),r.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}checkBatchWiseRate(){console.log("CHECK BATCH WISE RATE"),this.batchlist=[];let r=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this.activeurlpath&&(r="SF");let l="";l=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE;let c="";c=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse;let T="";("add-sales-invoice-wholesale"===this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate)&&(T="wholesale"),this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${l}&voucherPrefix=${r}&warehouse=${encodeURIComponent(c)}&barcode=&tag=${T}&CUSTID=${this._trnMainService.TrnMainObj.PARAC}&PRICEMODE=${this._trnMainService.TrnMainObj.PRICEMODE}&UNIT=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT}`).subscribe(b=>{if("ok"===b.status)this.batchlist=b.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===b.message&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this.batchWiseStockTax(b.result),this.changeBatchWiseRate(b.result[0].RATE)),"replacerate"===b.message&&(this.changeBatchWiseRate(b.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(b.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=b.result[0].costprice),"SHOWPRICEPOPUP"===b.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(b.result[0].RATE)),console.log("rerate",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!");else if("error"===b.status)return void this.alertService.info(b.result)})}checkBatchWiseRateSettingZero(){this.batchlist=[];let l="",c="";l=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,c=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${l}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${c}&barcode=`).subscribe(T=>{"ok"===T.status&&(this.batchlist=T.result,"SHOWPRICEPOPUP"===T.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(r){(this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(r)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=r,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):r,console.log("ratealt",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,r),this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(r){null!=this._trnMainService.TrnMainObj.ProdList[r].Product.AlternateUnits.filter(c=>1==c.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[r].ALTRATE=this._trnMainService.TrnMainObj.ProdList[r].RATE*this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(r){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==r[0].MFGDATE?"":r[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==r[0].EXPDATE?"":r[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r[0].BATCH)}batchWiseSalesRateBeforeTax(r){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r)}batchWiseStockTax(r){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=r.map(l=>l.STOCK).reduce((l,c)=>l+c,0))}onKeydownOnBatch(r){this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||"Enter"===r.key||"Tab"===r.key||r.preventDefault()}BatchEnter(r,l){l.preventDefault();let c=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=l.LANDINGCOST,2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&c in e.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&89!==c&&this.checkBatchWiseRate(),null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){this.batchList=[];let T=this._trnMainService.TrnMainObj.ProdList[r].MCODE,b=this.masterService.userProfile.userWarehouse;T&&this.masterService.getItemWiseBatch(T,b).subscribe(z=>{"ok"==z.status&&(this.batchList=z.result.filter(ie=>ie.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}PstockEnter(r,l){l.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("computerStock"+r).focus()}CstockEnter(r,l){l.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("alternateQty"+r).focus()}AdjustBatchEnter(r){if(this._trnMainService.TrnMainObj.VoucherType=e.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let l=this._trnMainService.TrnMainObj.ProdList[r].MCODE,c=this.masterService.userProfile.userWarehouse;l&&this.masterService.getAdjustingBatch(l,c).subscribe(T=>{console.log("get batch list",T),"ok"==T.status&&(this.batchList=T.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(r){this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCHID=r.BATCHID),1==this._trnMainService.TrnMainObj.ADJUSTEXPIRY&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=r.EXPDATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=r.MRP,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.COSTPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASERATE=r.COSTPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.COSTPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.COSTPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r.COSTPRICE)),this.checkDuplicateSourceBarcode(r.BATCHCODE,r.MCODE)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=r.STOCK,1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BC),this.showBatchPopup=!1,this.masterService.focusAnyControl("alternateQty"+this.activerowIndex))}checkDuplicateSourceBarcode(r,l){return!r||!this._trnMainService.TrnMainObj.ProdList.find(c=>c.BATCH==r&&c.MCODE==l)||(this.alertService.info(`Batch ${r} is already selected as a source barcode for the item.`),!1)}DblClickPopupAdjust(r){r.BATCHCODE!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBATCH=r.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INVRATE=r.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MANUFACTURER=r.BATCHID),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBC=r.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}selectProductDetails(r){let l=[];l=r,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(l),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,vchrno:this._trnMainService.TrnMainObj.REFBILL}).subscribe(l=>{l&&"ok"===l.status?(this.isProductDetailView=!0,this.selectedProductDetails=l.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},l=>{this.selectedProductDetails=[]})}discEnterClicked(r,l){return this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOFULLRETURN?0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(r)):document.getElementById("mfgdate"+r).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?this.checkValidation(r):this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(r):this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?this.checkValidation(r):this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?document.getElementById("remarks"+r).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?this.checkValidation(r):document.getElementById("mfgdate"+r).focus(),!1}ECSEnterClicked(r,l){l.preventDefault(),null!=document.getElementById("discount"+r)&&document.getElementById("discount"+r).focus(),this._trnMainService.ReCalculateBillWithNormal()}approvedQtyEnter(r){let c=this._trnMainService.TrnMainObj.ProdList[r];if(this.validationService.checkStockforApprovalQty(c)&&!c.isConfirmed&&0==this.userSetting.LogBasedRequisitionApproval){console.log("reach");let T=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(T,"ReqApproval")}c.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(c,r)&&setTimeout(()=>{null!=document.getElementById("remarks"+r)&&document.getElementById("remarks"+r).focus()},50),this.validationService.validateStockinReqApproval(c,r,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(r){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let l=this.masterService.userProfile.roleRights.find(c=>"DISLIMIT"==c.right);console.log("disLimt on discount rate",l),l&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit of :"+l.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let l=this.masterService.userProfile.userRights.find(c=>"SODiscountLimit"==c.right);l&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>l?.value&&(this.alertService.warning("Discount limit for sales order ("+l.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(c=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)?document.getElementById("discountAmt"+r).focus():document.getElementById("remarks"+r).focus()},0)}))}(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0?this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder?document.getElementById("discountAmt"+r).focus():this.checkValidation(r):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"purchase-import"==this.activeurlpath?document.getElementById("discountAmti"+r).focus():null!=document.getElementById("discountAmt"+r)?document.getElementById("discountAmt"+r).focus():null!=document.getElementById("discountAmti"+r)&&document.getElementById("discountAmti"+r).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+r).focus():document.getElementById("mfgdate"+r).focus())}addRowInsert(){this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.fromRequistionToTransferOut&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==this.userSetting.EnableRequisitionPopup&&1==this._trnMainService.requisitionFromNotification||"VIEW"!=this._trnMainService.TrnMainObj.Mode&&this._trnMainService.addRow()}checkValidation(r){var l=this._trnMainService.TrnMainObj.ProdList[r];if(null!=l){if(null==l.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==l.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${l.ITEMDESC} (${l.MENUCODE}) Please Check Your Entry.`),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE){var c=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(b=>0==b.ISUNKNOWN&&0==b.REQEXPDATE),function(b){return[b.MCODE,b.RATE,b.BC,b.BATCH]});for(const b of c)if(b.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){let b=this._trnMainService.TrnMainObj.ProdList.filter(z=>1==z.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(z.EXPDATE))[0];if(null!=b&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${b.ITEMDESC}`),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ADJUSTEXPIRY){let b=this._trnMainService.TrnMainObj.ProdList.filter(ie=>ie.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(ie.TransferExpiryDate))[0];if(null!=b&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Exp Date is required for item:${b.ITEMDESC}`),!1;let z=this._trnMainService.TrnMainObj.ProdList.filter(ie=>ie.REQEXPDATE&&0===this._trnMainService.nullToZeroConverter(ie.TransferMfgDate))[0];if(null!=z&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`New Mfg Date is required for item:${z.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[r].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+r).focus(),!1;if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[r].Quantity>this._trnMainService.TrnMainObj.ProdList[r].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[r].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[r].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&10!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():(this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()),!this._trnMainService.TrnMainObj.ProdList.some(b=>null==b.MCODE)&&!1===this._trnMainService.addRow())return;let T=r+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?setTimeout(()=>{const b=document.getElementById("barcode"+T);null!=document.getElementById("barcode"+T)&&1!=b.disabled?(console.log("rn1"),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote?(document.getElementById("itemDesc"+T).focus(),this.resetDescriptionEdit()):this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut?document.getElementById("itemDesc"+T).focus():document.getElementById("barcode"+T).focus()):document.getElementById("itemDesc"+T).focus()},0):setTimeout(()=>{null!=document.getElementById("itemDesc"+T)&&(document.getElementById("itemDesc"+T).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+T)&&document.getElementById("itemDesc"+T).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}returnBatch(r){if("self-billing"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.filter(T=>T.BATCH==r.BATCH&&T.MCODE==r.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.assignBatchToActiveProdRow(r,this.activerowIndex),this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected=!0,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT)for(var l in this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST=r.VARIANTDETAIL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST)console.log("Var attribute",l,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[l]),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${l}</b>:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[l]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)}}dblClickPopupBatch(r){console.log("eta aaucha ????/"),this.returnBatch(r)}QuantityChangeEvent(r){let l=this._trnMainService.TrnMainObj.VoucherType;if((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||"abbreviated-sales-invoice"==this.activeurlpath||"performa-invoice"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation)&&1==this.userSetting.EnablePartyWiseTaxableBill&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&this._trnMainService.vatFreeBill(),this.checkBCForMatrxiItem(),1==this.userSetting.EnableOnetoOneProduction&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&(this._trnMainService.disableCalculateButton=null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY||null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY||0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&this._trnMainService.calculateBatchAdjustmentVariance(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(l in e.SL&&(c=this.ValidateQuantityinEDITMode())&&!c.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=c.userEnterQty,void this.alertService.info(c.message);if(l in e.fr&&1!=this._trnMainService.TrnMainObj.ProdList[r].NATURETYPE&&1==this.userSetting.ENABLEBATCHWISEPRICE){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase())if(!0!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected)this.checkBatchWiseRateinEditMode();else{var c;if((c=this.ValidateQtyEDITModeForOUt())&&!c.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=c.userEnterQty,void this.alertService.info(c.message)}else if((c=this.ValidateQtyEDITModeForOUt())&&!c.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=c.userEnterQty,void this.alertService.info(c.message);let b=this.checkItemStockINEditModeForOutQty();if(b&&!b.status)return void this.alertService.info(b.message)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&(console.log("active",T),"EDIT"===T.RowMode.toUpperCase()&&T&&!this.ValidateQtyINEditModeFroProduction(T)))return}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[r].ITEMDESC} cannot have quantity more than one for membership sales invoice`),this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{null!==document.getElementById("rate"+r)&&document.getElementById("rate"+r).focus()},100)})),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote(),this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,this.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn){let T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],b=0;if(this._trnMainService.TrnMainObj.ProdList.filter(z=>z.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).forEach(z=>b+=z.Quantity),!this._trnMainService.validateIssueQtyInStockIssueReturn(T.TotalReqQuantity,b,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(this._trnMainService.allowNegativeBilling(this.activerowIndex)||10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&(console.log("check entered product stock"),this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(console.log("selabel soprodlist",this._trnMainService.TrnMainObj.ProdList),this.checkSaleableQuantityInSalesOrder()),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0==this.userSetting.allowQtyChangeInQuotationReference&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!==this.userSetting.PODELIVERYMODE){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.GoodsReceived&&0==this.userSetting.AllowQtyExceedInPo&&7==this._trnMainService.TrnMainObj.ProdList[r].NATURETYPE)return;if(this._trnMainService.TrnMainObj.ProdList.filter(b=>b.MENUCODE==this._trnMainService.TrnMainObj.ProdList[r].MENUCODE).map(b=>b.ALTERNATEQUANTIY).reduce((b,z)=>b+z,0)>this._trnMainService.TrnMainObj.ProdList[r].POSTOCK){if(1==this.userSetting.EnableBatchWisePrice&&"add-sales-invoice"===this.activeurlpath)return this.alertService.info("Quantity is more than SO Stock!!"),this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0,document.getElementById("alternateQty"+r).focus(),void this._trnMainService.ReCalculateBillWithNormal();let b="Quantity is more than PO Stock!! Are you sure you want to proceed further";if((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(b="Quantity is more than SO Stock!! Are you sure you want to proceed further"),!confirm(b))return this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0,document.getElementById("alternateQty"+r).focus(),void this._trnMainService.ReCalculateBillWithNormal()}}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn)&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&10!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseStockOut(),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)&&null!=this._trnMainService.TrnMainObj.REFORDBILL&&""!=this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"===this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),l in e.po){let T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,b=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,z=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT,ie=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,fe=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISUNKNOWN;const we=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH,be=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE;!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&0==this.userSetting.allowQtyChangeInQuotationReference&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkItemTotalQtyWithStock(T,ie,z,b,this.activerowIndex),"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE&&1!=this._trnMainService.TrnMainObj.ProdList[r].NATURETYPE&&(we||this.valiadateDuplicateRateItem(z,T,b,fe,this.activerowIndex,be))}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&(0==this.userSetting.ENABLEMANUALSALESRETURN||0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN)&&(this.checkBatchWiseEnterStock()?document.getElementById("ALTRATE"+this.activerowIndex)?.focus():this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `)),1==this.userSetting.EnableRateFromConsumption&&"production-entry"==this.activeurlpath&&this._trnMainService.calculateRateForProductionFromConsumption(),this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==this._trnMainService.fromRequistionToTransferOut&&!this.validationService.validateRequestQtyDoingTransferOut(this._trnMainService.TrnMainObj.ProdList[r],this._trnMainService.TrnMainObj.ProdList))return void(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0)}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.PARAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}ratechangeEvent(r){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(r){this._trnMainService.calculateNetRATE(r),this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=0,this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE=100),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountRateChange(r,l){return console.log("change disocunt entered generic",r,l),r>100?(this.alertService.info("Discount rate cannot be greater than 100%"),void(this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNTRATE=0)):r<0?(this.alertService.info("Discount rate cannot be less than 0%"),void(this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNTRATE=0)):void 0}IndDiscountAmountChangeEvent(r,l){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let c=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),T=this.masterService.userProfile.roleRights.find(b=>"DISLIMIT"==b.right);console.log("dis rate",c,"dislimit",T),T&&c>T?.value&&(this.alertService.warning("Discount limit of :"+T.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(b=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[r].UNIT==this._trnMainService.TrnMainObj.ProdList[r].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[r].NETRATE=this._trnMainService.TrnMainObj.ProdList[r].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[r].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[r].CRATE=this._trnMainService.TrnMainObj.ProdList[r].NETRATE):(this._trnMainService.TrnMainObj.ProdList[r].NETRATE=this._trnMainService.TrnMainObj.ProdList[r].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[r].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[r].Quantity),this._trnMainService.TrnMainObj.ProdList[r].CRATE=this._trnMainService.TrnMainObj.ProdList[r].NETRATE)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let c=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),T=this.masterService.userProfile.userRights.find(b=>"SODiscountLimit"==b.right);console.log(" so dis rate",c,"dislimit",T),T&&c>T?.value&&(this.alertService.warning("Discount limit of :"+T.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(b=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+r)&&document.getElementById("discountAmt"+r).focus()},0)}))}this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT<0?this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=0:this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[r].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[r].AMOUNT),this._trnMainService.vatFreeBill(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote()}IndDiscountAmountChangeOfRetailerVATINCEvent(r,l){this._trnMainService.TrnMainObj.ProdList[r].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(l.target.value),this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[r].INDIVIDUALDISCOUNT_WITHVAT<0?this._trnMainService.TrnMainObj.ProdList[r].INDIVIDUALDISCOUNT_WITHVAT=0:this._trnMainService.TrnMainObj.ProdList[r].INDIVIDUALDISCOUNT_WITHVAT>this._trnMainService.TrnMainObj.ProdList[r].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[r].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.TrnMainObj.ProdList[r].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}QuantityEventClick(r){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].Quantity)<1||(this.activerowIndex=r,this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived?document.getElementById("alternateunit"+r).focus():(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&document.getElementById("remarks"+r).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(r){return{status:"error",error:r}}}isTableRowSelected(r){return this.activerowIndex===r}deleteRow(r){if("stock-adjustment"!=this._trnMainService.activeurlpath&&"VIEW"!=this._trnMainService.TrnMainObj?.Mode?.toUpperCase()){if("EDIT"==this._trnMainService.TrnMainObj?.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this._trnMainService.TrnMainObj.VoucherType))return;if((this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}`),(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].TOTALOUTWARDSTOCK)>0&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase())return void this.alertService.info(`Transaction has been completed for this item::${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}, cannot delete.`)}this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")&&(this.activerowIndex=this.rowIndex=r,this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&1==this._trnMainService.TrnMainObj.ProdList.length?0:1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")}}restrictPercentageNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNTRATE=0:(parseFloat(r)>100||isNaN(parseFloat(r)))&&(this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(r,l){try{parseFloat(r)<0||isNaN(parseFloat(r))?this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNT=0:parseFloat(r)>this._trnMainService.TrnMainObj.ProdList[l].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[l].AMOUNT)}catch{}}SelectUnit(r,l,c){console.log("altunit",this._trnMainService.TrnMainObj.ProdList[r]),this._trnMainService.TrnMainObj.ProdList[r].DiscountOnAltUnit=!1,this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[r].CRATE=0;let T=this._trnMainService.TrnMainObj.ProdList[r].Product.AlternateUnits.find(b=>b.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[r].StopDecimal=T.StopDecimal,1==this.userSetting.EnableAltUnitDiscOnRate&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)&&0==this.userSetting.EnableBatchWisePrice&&this.assignRate(T,r),this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[r].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[r].ALTRATE=0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?this._trnMainService.TrnMainObj.ProdList[r].BASERATE:this._trnMainService.TrnMainObj.ProdList[r].RATE,this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[r].UNITDISCOUNTRATE=0,this._trnMainService.TrnMainObj.VoucherType!=e.Km.CreditNote&&(this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[r].INDDISCOUNT=0)):(console.log("altunit",T,this._trnMainService.TrnMainObj.ProdList[r]),this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR=T.CONFACTOR,0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this._trnMainService.TrnMainObj.ProdList[r].RATE=this._trnMainService.TrnMainObj.ProdList[r].BASERATE),this._trnMainService.TrnMainObj.ProdList[r].ALTRATE=this._trnMainService.TrnMainObj.ProdList[r].RATE*this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[r].WSRATE_DISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[r].ALTRATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE-this._trnMainService.TrnMainObj.ProdList[r].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[r].WSRATE_DISCOUNT/100),this._trnMainService.TrnMainObj.ProdList[r].RATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this.applyDiscountOnUnitChange(T,r),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation)&&this.applyDiscountOnUnitChangeOnSales(T,r),this._trnMainService.ReCalculateBillWithNormal()),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&(console.log("something here",this._trnMainService.TrnMainObj.ProdList[r]),this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT!=this._trnMainService.TrnMainObj.ProdList[r].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[r].REQUESTTOTALQTY/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR:this._trnMainService.TrnMainObj.ProdList[r].REQUESTTOTALQTY,this.approvedQtyEnter(r),this._trnMainService.CalculateApprovalBill())}assignRate(r,l){let c=this._trnMainService.TrnMainObj.ProdList[l].BASERATE;this._trnMainService.TrnMainObj.ProdList[l].RATE=c,this._trnMainService.TrnMainObj.ProdList[l].ALTRATE=c*r.CONFACTOR}applyDiscountOnUnitChange(r,l){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)1==this.userSetting.EnableAltUnitDiscOnRate?(console.log("unit1"),this._trnMainService.TrnMainObj.ProdList[l].ALTRATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE-this._trnMainService.TrnMainObj.ProdList[l].ALTRATE*(("add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT)/100),this._trnMainService.TrnMainObj.ProdList[l].RATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE):1==this.userSetting.EnableDiscountInAltUnit&&(this._trnMainService.TrnMainObj.ProdList[l].UNITDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT);else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let c=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?r.SRATE_DISCOUNT:r.WSRATE_DISCOUNT);this._trnMainService.TrnMainObj.ProdList[l].ALTRATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE-this._trnMainService.TrnMainObj.ProdList[l].ALTRATE*(c/100)}}applyDiscountOnUnitChangeOnSales(r,l){1==this.userSetting.EnableAltUnitDiscOnRate?(console.log("unit2"),this._trnMainService.TrnMainObj.ProdList[l].ALTRATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE-this._trnMainService.TrnMainObj.ProdList[l].ALTRATE*(("add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT)/100),this._trnMainService.TrnMainObj.ProdList[l].RATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE):1==this.userSetting.EnableDiscountInAltUnit&&(this._trnMainService.TrnMainObj.ProdList[l].INDDISCOUNTRATE="add-sales-invoice-wholesale"==this.activeurlpath?r.WSRATE_DISCOUNT:r.SRATE_DISCOUNT)}returnMultiBatchScheme(r){for(let l of r)this._trnMainService.assignBatchToActiveProdRow(l,this.activerowIndex)}flatDisChange(r){this.flatDiscountValue=r,this.flatDiscountAssign()}flatDiscountUnitChange(r){this.radioFlatDiscount=r,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let r=this._trnMainService.TrnMainObj.ProdList.reduce((l,c)=>l+(this._trnMainService.nullToZeroConverter(c.AMOUNT)-this._trnMainService.nullToZeroConverter(c.INDDISCOUNT)),0);this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue*r/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(r,l){this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l)}RemarksEnterCommand(r,l){if(r.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(l)||this.masterService.focusAnyControl("remarks"+l),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval){let c=l+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+c)&&document.getElementById("alternateunit"+c).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let l="";l=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}&VCHRNO=${this._trnMainService.TrnMainObj.VCHRNO}&warehouse=${l}`).subscribe(c=>{if("ok"===c.status&&(this.batchlist=c.result,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===c.message&&(this.changeBatchWiseRate(c.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=c.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(c.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=c.result[0].costprice),"SHOWPRICEPOPUP"===c.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(c.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){var T=this.ValidateQtyEDITModeForOUt();if(T&&!T.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=T.userEnterQty,void this.alertService.info(T.message)}})}dblClickPricePopUP(r){let l=this._trnMainService.mulitplePriceItemList.filter(be=>this._trnMainService.nullToZeroConverter(be.qty)>0),c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT,b=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,z=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE,ie=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC,fe=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AlternateUnits,we=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR;if(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(be=>0!=this._trnMainService.nullToZeroConverter(be.ALTERNATEQUANTIY)),null!=l)for(let be=0;be<l.length;be++){let Ee={Product:{}};Ee.MCODE=b,Ee.MENUCODE=z,Ee.INDDISCOUNT=l[be].dcamount,Ee.INDDISCOUNTRATE=l[be].dcrate,Ee.ITEMDESC=ie,Ee.UNIT=c,Ee.BASEUNIT=T,Ee.RATE=l[be].rate,Ee.ALTRATE=l[be].rate,Ee.ALTERNATEQUANTIY=l[be].qty,Ee.inputMode=!0,Ee.CRATE=l[be].netrate,Ee.ALTCONFACTOR=we,Ee.Product.AlternateUnits=fe,this._trnMainService.TrnMainObj.ProdList.push(Ee)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(r){console.log("dblclickpar"),null!=r&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TRNAC=r.ACID,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ACNAME=r.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this._trnMainService.TrnMainObj.PARAC=r.ACID,this._trnMainService.TrnMainObj.BILLTO=r.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=r.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=r.VATNO,this._trnMainService.TrnMainObj.BILLTOMOB=r.MOBILE,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=r.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}SupplierEnterClicked(r){return r.preventDefault(),document.getElementById("supplier"+this.activerowIndex).blur(),this.genericGridSupplierPopup.show(),!1}onKeydownPreventEdit(r){"Enter"===r.key||"Tab"===r.key||r.preventDefault()}batchKeyDownEvent(){return!1}newMFGDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("newexpiry"+this.activerowIndex).focus(),!1}newExpDateEnterEvent(r){return this.checkValidation(r)||document.getElementById("remarks"+this.activerowIndex).focus(),!1}MFGDateEnterEvent(r){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(r){return this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction||this.checkValidation(r)||this.masterService.focusAnyControl("remarks"+r),!1}AlternateUnitEnterEventClick(r,l){l.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&(document.getElementById("alternateQty"+r).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&document.getElementById("approvedQty"+r).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("physicalStock"+r).focus()),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this._trnMainService.TrnMainObj.ProdList[r].BC&&""!=this._trnMainService.TrnMainObj.ProdList[r].BC&&void 0!==this._trnMainService.TrnMainObj.ProdList[r].BC&&document.getElementById("rate"+r).focus(),74==this._trnMainService.TrnMainObj.VoucherType&&null!=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&null!=this._trnMainService.TrnMainObj.ProdList[r].ALTUNIT&&document.getElementById("alternaetqty"+r).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&document.getElementById("alternateQty"+r).focus()}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discount"+this.activerowIndex).focus(),!1}mrpEnterEvent(r,l){if(!this.blockMoveToNextrow()){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1!=this._trnMainService.TrnMainObj.ProdList[l].PTYPE&&this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length&&0==this._trnMainService.TrnMainObj.ProdList[l].ALTUNITObj.RATE_A&&0==this._trnMainService.TrnMainObj.ProdList[l].MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(r,l),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance)null!=document.getElementById("MRP"+l)?document.getElementById("MRP"+l).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(l);else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||57==this._trnMainService.TrnMainObj.VoucherType)"Non-Discountable"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].DISMODE?this.checkValidation(l):this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE&&2==this.userSetting.ENABLE_ECS?document.getElementById("ECSAmount"+this.activerowIndex).focus():null!=document.getElementById("discount"+this.activerowIndex)?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("mfgdate"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(l)}else this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack?this.checkValidation(l):this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(l)):null!=document.getElementById("discount"+this.activerowIndex)?document.getElementById("discount"+this.activerowIndex).focus():null!=document.getElementById("remarks"+this.activerowIndex)?document.getElementById("remarks"+this.activerowIndex).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+this.activerowIndex).focus());return(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(l),1==this.userSetting.EnableBatch&&this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.calculateTradingNontradingTotalinDebitNote(),!1}}blockMoveToNextrow(){return("EDIT"==this._trnMainService.TrnMainObj.Mode||1==this._trnMainService.TrnMainObj.DOFULLRETURN)&&"RQ"==this._trnMainService.TrnMainObj.REFBILL?.substring(0,2)&&1==this.userSetting.EnableRequisitionPopup}setItemPopupUrl(){this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this._trnMainService.TrnMainObj,this._trnMainService.activeurlpath),this.gridPopupSettingsForSupplier=this.productHelperService.getGridPopUpSettingForSupplier()}assignValueForReturnModeInProd(r){this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=r.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==r.MFGDATE?"":r.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==r.EXPDATE?"":r.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=r.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=r.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=r.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=r.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=r.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=r.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=r.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=r.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=r.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=r.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=r.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=r.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=r.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=r.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=r.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=r.ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(r){this.activerowIndex=r,this.batchlist=[]}validateRate(r,l){if(0==this._trnMainService.nullToZeroConverter(r.ALTRATE))return!confirm(" Zero  Rate Entry Detected For Item '"+r.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")&&(document.getElementById("rate"+l).focus(),!0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation){let c=this.getSellingRate();this.validateSellingPriceBelowLandingCost(c,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE,this.activerowIndex)}}getSellingRate(){let r=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE;return 1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation)&&(r=1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate),r}validateSellingPriceBelowLandingCost(r,l,c){if(r<l)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(T=>{setTimeout(()=>{null!==document.getElementById("discount"+c)?document.getElementById("discount"+c).focus():document.getElementById("remarks"+c).focus()},0)}),!1}MRPChangeEvent(r,l){let c=this._trnMainService.TrnMainObj.ProdList[l].PTYPE;if("goods-received-note"==this.activeurlpath&&"NEW"==this._trnMainService.TrnMainObj.Mode){let T=this.masterService.userProfile.roleRights.find(b=>"ALLOWRATECHANGEINPI"==b.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==T.value&&(this._trnMainService.TrnMainObj.ProdList[l].TEMP_ALTRATE==this._trnMainService.TrnMainObj.ProdList[l].ALTRATE||confirm("PRATE DIDN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this._trnMainService.TrnMainObj.ProdList[l].ALTRATE=this._trnMainService.TrnMainObj.ProdList[l].TEMP_ALTRATE))}this.validateRate(r,l),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&0==this.userSetting.EnableBatchWisePrice&&this.validateRateForSalesInvoiceOnEnter(),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&1!=c&&(console.log("rnk1"),this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&this.validateCostPrice(),this._trnMainService.TrnMainObj.ProdList[l].UNIT==this._trnMainService.TrnMainObj.ProdList[l].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[l].RATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[l].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[l].RATE=this._trnMainService.TrnMainObj.ProdList[l].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[l].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkRateisChangedinSoFromQT()}validateRateForSalesInvoiceOnEnter(){this.validateSellingPriceBelowLandingCost(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE,this.activerowIndex)}checkRateisChangedinSoFromQT(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE&&(confirm("Rate is change Do you want to proceed .")||(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE))}AlternateQuantityEventClick(r,l){if(l.preventDefault(),this.QuantityChangeEvent(r),"QuantityExceed"!=this._trnMainService.quantityExceedCheck){var c;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&setTimeout(()=>{document.getElementById("rate"+r).focus()},20),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn)&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DONONSALEABLERETURN)if(c=this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[r].MCODE),this._trnMainService.TrnMainObj.ProdList[r].STOCK<c)return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity");if((this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL>0&&this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL<this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[r].MCODE))return void this.alertService.warning("Quantity cannot exceed the minimum stock level");if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder)&&(this.alertService.info("Please select variants first!"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}`).subscribe(b=>{"ok"==b.status&&b.result&&b.result.length&&this.alertService.emitShowHideSubject.subscribe(z=>{setTimeout(()=>{this.matrixItemAtrribute=b.result,this.matrixitemgrid.show()})})})),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[]),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(0,K.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&(1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)?(null==this._trnMainService.TrnMainObj.ProdList[r].BC||""==this._trnMainService.TrnMainObj.ProdList[r].BC||null==this._trnMainService.TrnMainObj.ProdList[r].BC)&&this.dialougeOpen():this.dialougeOpen())),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.checkMaxStockLevel(r),10!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&this.checkReorderStocklevel(r),(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales)&&this.getSchemeDiscountForItem(this._trnMainService.TrnMainObj.ProdList[r]),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(console.log("abc",this._trnMainService.allowNegativeBilling(this.activerowIndex)),this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&(1==this.userSetting.REFBILLCOMPULSORINCNOTE&&1!=this.userSetting.ENABLEMANUALSALESRETURN&&1!=this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&1!=this._trnMainService.TrnMainObj.DOMANUALSALESRETURN)&&this.checkValidation(r),"self-billing"===this.activeurlpath&&this.checkValidation(r),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY>0&&this.focusToRate(r,l),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ADJUSTEXPIRY&&setTimeout(()=>{document.getElementById("newexpiry"+this.activerowIndex).focus()},20),1==this.userSetting.EnableRateFromConsumption&&"production-entry"==this.activeurlpath&&this._trnMainService.calculateRateForProductionFromConsumption(),this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==this._trnMainService.fromRequistionToTransferOut&&!this.validationService.validateRequestQtyDoingTransferOut(this._trnMainService.TrnMainObj.ProdList[r],this._trnMainService.TrnMainObj.ProdList))return void(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0)}}focusAfterQuantityClick(){if(0!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE||1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE||this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)document.getElementById("fcrate"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag){if(0==this.userSetting.IMPORTPOBILLMODE)return void document.getElementById("fcrate"+this.activerowIndex).focus();document.getElementById("discount"+this.activerowIndex).focus()}this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"export-sales-invoice"==this.activeurlpath?document.getElementById("fcrate"+this.activerowIndex).focus():(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE)&&this._trnMainService.TrnMainObj.REFORDBILL||"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL?document.getElementById("discount"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath?this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&(1==this._trnMainService.TrnMainObj.ADJUSTEXPIRY?(console.log("suru ma ya chircha ki nai hernu paryo",this.activerowIndex),setTimeout(()=>{document.getElementById("newmanufacture"+this.activerowIndex).focus()},20)):document.getElementById("adjustbatch"+this.activerowIndex).focus()):this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL?document.getElementById("discount"+this.activerowIndex).focus():this.salesRateDisabled.indexOf(this._trnMainService.TrnMainObj.VoucherType)>=0?this.focusRateOrDiscount():document.getElementById("rate"+this.activerowIndex).focus()}else document.getElementById("ECSAmount"+this.activerowIndex).focus()}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let r=0;if(this._trnMainService.TrnMainObj.ProdList.filter(c=>c.PMCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(c=>{r+=c.ROUTQTY}),console.log("total Enter qty",r,"stokc",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),r>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n      (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n      Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let r=0;if(this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&c.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(c=>{r+=c.ROUTQTY}),r>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n    Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n    (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n    Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n    @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let r=0;if(this._trnMainService.TrnMainObj.ProdList.filter(l=>l.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&l.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&l.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC).forEach(l=>{r+=l.Quantity}),r>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)return this.alertService.info(`Inserted Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity :\n  ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity)}  \n  Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK)} \n  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(r,l){l.preventDefault(),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY)?(0==this._trnMainService.TrnMainObj.ProdList[r].ECSRATE&&2==this.userSetting.ENABLE_ECS&&1==this._trnMainService.TrnMainObj.ProdList[r].HASECSCHARGE&&document.getElementById("ECSAmount"+this.activerowIndex).focus(),this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+r).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect&&7!==this._trnMainService.TrnMainObj.ProdList[r].NATURETYPE?document.getElementById("discount"+r).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath?(console.log("dis"),document.getElementById("discount"+r).focus()):this.salesRateDisabled.indexOf(this._trnMainService.TrnMainObj.VoucherType)>=0?this.focusRateOrDiscount():document.getElementById("rate"+r).focus()):this.alertService.warning(`Qty Is Not Specified For The Item ${this._trnMainService.TrnMainObj.ProdList[r].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[r].MENUCODE}). Please Check Your Entry.`)}BaseQuantityEventClick(r,l){l.preventDefault(),this.activerowIndex=r,null!=document.getElementById("mrp"+r)?this.masterService.focusAnyControl("mrp"+r):this.masterService.focusAnyControl("remarks"+r),this.SelectUnit(r,"EACH",l.target.value)}checkBatchWiseStockOut(){this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `)}checkItemTotalQtyWithStock(r,l,c,T,b){let z=0;if(z=1==c?this._trnMainService.TrnMainObj.ProdList.filter(ie=>ie.MCODE==r&&ie.BC==l&&ie.RATE==T).map(ie=>ie.Quantity).reduce((ie,fe)=>ie+fe,0):this._trnMainService.TrnMainObj.ProdList.filter(ie=>ie.MCODE==r&&ie.RATE==T).map(ie=>ie.Quantity).reduce((ie,fe)=>ie+fe,0),z>0)return z>this._trnMainService.TrnMainObj.ProdList[b].TOTSTOCK&&9!=this._trnMainService.TrnMainObj.ProdList[b].PTYPE?(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[b].ITEMDESC} Entered  Quantity: ${z}  exceed the available stock ${this._trnMainService.TrnMainObj.ProdList[b].TOTSTOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[b].ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(r,l,c,T,b,z){if(console.log("validate duplicate rate item"),0==r&&0==T&&0==z){let ie=this._trnMainService.TrnMainObj.ProdList.filter(fe=>fe.MCODE==l&&fe.RATE==c);if(ie&&ie?.length>1)return this.alertService.info(`${ie[0].ITEMDESC} Item with '${ie[0].RATE}' duplicate rate `),void(this._trnMainService.TrnMainObj.ProdList[b].ALTERNATEQUANTIY=0)}}checkBatchWiseStock(){let r=[];this.masterService.getStockBatchWise(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(l=>{"ok"==l.status&&(r=l.result,null!=r&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity>r[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(r){console.log("petrol pump fxn ",r.MRP,r.ISAMOUNTWISEBILL),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==r.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(r.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}wareHouseWiseStock(r){this.warehouseWiseStockPopup.show(r.MCODE,this.activerowIndex)}assignWSRate(r){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.WRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.WRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASERATE=r.WRATE}dblClickPopupItem(r){this.showtooltip=!0;let l=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={},(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&this.userSetting.CompulsoryHSCodeInput){if(r&&!r.HSNCode)return void this.alertService.warning("HS Code is not registered!");this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HS_Code=r.HSNCode}if(0==this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,r))return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(b=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(r),"add-sales-invoice"==this.activeurlpath&&1==this._trnMainService.showWareHouseWiseStockPopup&&this.wareHouseWiseStock(r),0!=this.ValidateDuplicateItemEntry(r)){if("add-sales-invoice-wholesale"===this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate?this.assignWSRate(r):(this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferOut&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASERATE=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.RATE),this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&1==r.NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASERATE=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.PRATE)),this._trnMainService.NeedToTakePriceFromMenuItem()){let b=r.RATE;l in e.qK&&(l==e.Km.PerformaSalesInvoice&&1==this._trnMainService.TrnMainObj.AdditionalObj.LoadWholeSaleRate&&(b=r.WRATE),this._trnMainService.assignProductMasterRate(this.activerowIndex,b)),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.WRATE),l in e.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,r.PRATE,r.CONFACTOR)}if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE=r.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE=r.ECSRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE=r.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE=r.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ENABLEITEMWISEBATCH=r.ENABLEITEMWISEBATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASBATCH=r.HASBATCH,6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isQuantityReadonly=!0),this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TotalReqQuantity=r.TotalReqQuantity),("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"IS"==this._trnMainService.TrnMainObj.VoucherPrefix||"TO"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BARCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BARCODE),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isBarcodeOfPtypeSix=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=r.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=r.In_Rate_B,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=r.RATE_B)),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.EnableTelcomDevices){if(!this.validationService.validateDuplicateBarcode(r,this._trnMainService.TrnMainObj.ProdList))return;this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BC,this._trnMainService.addRow(),setTimeout(()=>{const b=document.getElementById("itemDesc"+(this.activerowIndex+1));b&&b.focus()},50)}if(this.focusAfterItemSelect(),this.focusService.afterEnterFocousItem(r.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]){this.batchlist=[];let b=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];b.REQEXPDATE=r.REQEXPDATE,b.DISMODE=r.DISMODE,b.PWEIGHT=r.GWEIGHT,b.PROMOTION=0,b.BATCHSCHEME=null,b.ALLSCHEME=null,b.ISVAT=r.ISVAT,b.MENUCODE=r.MENUCODE,b.ITEMDESC=r.DESCA,b.MCODE=r.MCODE,b.WEIGHT=r.GWEIGHT,b.Mcat=r.MCAT,b.BASEUNIT=r.BASEUNIT,b.SHELFLIFE=r.SHELFLIFE,b.Weighable=r.Weighable,b.MRP=r.MRP,b.ALTCONFACTOR=r.CONFACTOR,b.BARCODE=r.BARCODE,b.TOTSTOCK=r.STOCK,b.PSTOCK=r.PSTOCK,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(b.ALTUNIT=r.BASEUNIT,b.PDESCA=r.ParentName,b.PMCODE=r.SUPITEMCODE,b.CONFACTOR=r.CONFACTOR,b.PUNIT=r.PUNIT,b.REPACKRATE=r.PRATE,b.ALTRATE=r.PRATE),b.UNIT=r.BASEUNIT,b.WARRANTY=r.WARRANTY,b.W_MRP=r.W_MRP,b.W_SELLRATEBEFORETAX=r.W_SELLRATEBEFORETAX,b.STOCK=r.STOCK,b.WSRATE_DISCOUNT=r.WSRATE_DISCOUNT,b.MINLEVEL=r.MINLEVEL,b.MAXLEVEL=r.MAXLEVEL,b.ROLEVEL=r.ROLEVEL,b.ROWARN=r.ROWARN,b.MINWARN=r.MINWARN,b.HASVARIANT=r.HASVARIANT,b.Mcat=r.MCAT,b.REMARKS=r.REMARKS,b.PRATE=r.PRATE,b.ISRECURRING=r.ISRECURRING,b.HASCOMMISSIONCHARGE=r.HASCOMMISSIONCHARGE,b.ISAMOUNTWISEBILL=r.ISAMOUNTWISEBILL,b.ISUNKNOWN=r.ISUNKNOWN,b.RSTOCK=r.RSTOCK,1==r.HASVARIANT&&(b.BC=r.BC),r.VARIANTDETAIL&&(b.VARIANTLIST=JSON.parse(r?.VARIANTDETAIL),b.VARIANTDESCA="",b.VARIANTDESCA=this._trnMainService.getVariantDescriptionFromList(b)),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&!(0,K.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SUPCODE=r.SUPCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=r.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.REFBILL&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LOYALTYRATE=this._trnMainService.nullToZeroConverter(r.LOYALTY/(r.STOCK*r.RATE)*100),r.RATEDISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE)),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PROMOTIONRATE=this._trnMainService.nullToZeroConverter(r.PROMOTION/(r.REALQTY*r.RATE)*100),this._trnMainService.vatFreeBill()),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INVRATE=r.INVRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE2=r.ALTRATE2),this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PSTOCK=r.ISSUEQTY,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=r.EXPDATE),this._trnMainService.TrnMainObj.VoucherType in e.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DOFULLRETURN)||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&this.FocusForBatchAdjustment(r.HASVARIANT),this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1===this.userSetting.EnableWSRateGroup&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),1===this.userSetting.ENABLERATEGROUP&&("abbreviated-sales-invoice"===this.activeurlpath||"add-sales-invoice"===this.activeurlpath||"add-sales-invoice-wholesale"===this.activeurlpath)&&(this._trnMainService.nullToZeroConverter(this.userProfile.RateGroupId)>0||this._trnMainService.nullToZeroConverter(this.userProfile.WRateGroupId)>0)&&this._trnMainService.getItemGroupWiseRate(this.activerowIndex),this._trnMainService.NeedToTakePriceFromMenuItem()||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&1===this.userSetting.EnableItemWiseBatch&&1===r.HASBATCH&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseRate(),((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&1==this.userSetting.EnableExpiryTrackinginBilling)&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseRate(),this._trnMainService.NeedToTakePriceFromMenuItem()||(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&1!=r.NATURETYPE||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&10!==r.PTYPE&&9!==r.PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||!1===this.itemFromBC(r.HASVARIANT)&&this.checkBatchWiseRate())),(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&0===this.userSetting.EnableBatchWisePrice&&1===r.HASVARIANT&&this.checkBatchWiseRateSettingZero(),1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=r.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||"production-entry"===this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut&&(7==r.NATURETYPE||10==r.PTYPE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||"self-billing"===this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=r.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=r.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=r.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PREV_PRATE=r.PREV_PRATE):(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=r.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isApproved=0),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(r),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.REFORDBILL&&(0==this.userSetting.DisableSalesOrderRateInTI&&this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(r),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.assignRateandQtyLoadFromSO(r),this.assignOrderedDiscount(r)),this.emitReferenceQuantity(),1==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack&&this._trnMainService.getParentItemStock(this.activerowIndex),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}`).subscribe(ie=>{"ok"==ie.status&&ie.result&&ie.result.length&&(this.matrixItemAtrribute=ie.result,this.matrixitemgrid.show())})}6===r.PTYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex)),(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Quotation)&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1==this.userSetting.PRICEMODEINBILLING&&0==this.userSetting.EnableBatchWisePrice&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)&&this.assignWSRate(r),1==this.userSetting.EnableRateFromConsumption&&"production-entry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=0,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=0,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=0),setTimeout(()=>{console.log("sett",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])},200)}else this.alertService.warning("Cannot enter duplicate item!")}FocusForBatchAdjustment(r){1==r?setTimeout(()=>{document.getElementById("sourcebc"+this.activerowIndex).focus()},200):0==r&&setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).focus()},200)}emitReferenceQuantity(){(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,BASEUNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT})}dialougeOpen(){this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open(F.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList,TrnMainObj:this._trnMainService.TrnMainObj}}).afterClosed().subscribe(c=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?c?.data:c&&c.data&&c.data.productColorList?c.data.productColorList:[],"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists.productColorList,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists.productColorList?this.productLists.productColorList.length:0):(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this.calculateRateForTransferOut(c?.data),(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else console.log("hit here",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.ReCalculateBillWithNormal(),document.getElementById("rate"+this.activerowIndex).focus()},20)})}calculateRateForTransferOut(r){this.productLists=r,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this.productLists[0].LANDINGCOST,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=this.productLists[0].LANDINGCOST,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=this.productLists[0].IEMI1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE;for(let l=1;l<this.productLists?.length;l++){let c=(0,u.cloneDeep)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]);c.ALTRATE=this.productLists[l].LANDINGCOST,c.RATE=this.productLists[l].LANDINGCOST,c.ALTERNATEQUANTIY=1,c.BC=this.productLists[l].IEMI1,c.AMOUNT=c.ALTERNATEQUANTIY*c.ALTRATE,this._trnMainService.TrnMainObj.ProdList.push(c)}}checkMaxStockLevel(r){0!==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].STOCK)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this._trnMainService.TrnMainObj.ProdList[r].MAXLEVEL+" exceeded !")}checkReorderStocklevel(r){var l=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].STOCK)-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY);if(l<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL))return;if(l<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this._trnMainService.TrnMainObj.ProdList[r].MINLEVEL),1===this._trnMainService.TrnMainObj.ProdList[r].MINWARN&&(this._trnMainService.TrnMainObj.ProdList[r].ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].ROLEVEL))return;1===this._trnMainService.TrnMainObj.ProdList[r].ROWARN&&this.alertService.warning("Re-Order level "+this._trnMainService.TrnMainObj.ProdList[r].ROLEVEL+" has been reached !")}}}CancelCommand(){this.showBarCodeDetail=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!1}loadBarCodeRow(r){let c={IEMI1:"",IEMI2:""};c.MCODE=0===this.activerowIndex?"":this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,c.Color="",0===this.activerowIndex?(this._trnMainService.TrnMainObj.ProdList[0].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[0].ProductDetails.push(c)):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(c),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(r){let l={IEMI1:"",IEMI2:""};l.MCODE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,l.Color="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(l),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(r){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].BASEQUANTITY=this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}onApplyOldPriceClick(){let r={};if(1==this.userSetting.EnableBatchWisePrice&&(r=this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.CRATE_A))[0],console.log("INVALID UOM",r),r))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${r.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let r of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AltSellingPrices.find(l=>l.UNIT==r.UNIT).NRATE_A=r.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let r={};return r=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(l=>0==this._trnMainService.nullToZeroConverter(l.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(l=>null==l.NRATE_A||0==l.NRATE_A)[0],!r||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${r.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(r,l){let c=0,T=0,b=0,z=this._trnMainService.priceChangeList[r];if(null!=z){if(z.UNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let ie=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*this.userSetting.VATRate;z.NRATE_A<=ie&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(b=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),z.NRATE_A<=b+b*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?(b=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),z.NRATE_A<=b&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):z.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)),z.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let ie=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE;if(T=ie+ie*this.userSetting.VATRate,z.NRATE_A<=T&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)){let fe=ie+ie*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100);z.NRATE_A<=fe+fe*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?z.NRATE_A<=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):z.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?z.NRATE_A<=c+c*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):z.NRATE_A<=c&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(r),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[r].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[r].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[r].WNRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.priceChangeList[r].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_MRP=this._trnMainService.priceChangeList[r].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.PODetailList[r].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[r].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[r].WNRATE_A)}changeSellingPrice(r){for(const l of this._trnMainService.priceChangeList)l.SNO>1&&(l.NRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].NRATE_A,l.WNRATE_A=l.CONFACTOR*this._trnMainService.priceChangeList[r].WNRATE_A)}checkDeuplicateCodeAndRate(){let r=[],l=this._trnMainService.TrnMainObj.ProdList.filter(c=>c.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE);if(null!=l&&l.length>1){let c=0;for(let T of this._trnMainService.TrnMainObj.ProdList)T.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&r.push(c),c++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableDiscount(){return this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.Sales&&57!=this._trnMainService.TrnMainObj.VoucherType&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.CreditNote?(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this._trnMainService.TrnMainObj?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkEnteredProductStock(){let r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.Quantity>l.STOCK&&7!=l.NATURETYPE&&10!=l.PTYPE&&9!=l.PTYPE)[0];if(null!=r)return this.alertService.info(r.BASEUNIT!=r.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(r.STOCK)} ${r.BASEUNIT}, Item : ${r.ITEMDESC} @Qty = ${r.Quantity} ${r.BASEUNIT} (${r.ALTERNATEQUANTIY} x ${r.ALTCONFACTOR} = ${r.Quantity} ${r.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(r.STOCK)} ${r.BASEUNIT}, Item : ${r.ITEMDESC} @Qty = ${r.Quantity} ${r.BASEUNIT} `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),!1}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(r){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=r.BARCODE,this.ItemBarCodeClick(this.activerowIndex,r)}validateCostPrice(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling price")}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}ECSFocusOut(){this.applyPipeInECS=!0,this._trnMainService.ReCalculateBillWithNormal()}ECSValueChange(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity||(this.alertService.warning("Please Enter Product Quantity!!"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSAMOUNT=0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSAMOUNT>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].GROSSAMNT&&(this.alertService.warning("ECS amount cannot be more than Gross Amount!!"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSAMOUNT=0)}ECSFocusIn(){this.applyPipeInECS=!1}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(r,l){6!=this._trnMainService.TrnMainObj.ProdList[r].PTYPE&&this.focusToRate(r,l)}ItemBarCodeFoucusOut(r,l){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(r,l){this.barcodeDisplay=!0}checkBatchWiseEnterStock(){let r=0;return this._trnMainService.TrnMainObj.ProdList.filter(l=>l.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&l.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(l=>r+=l.Quantity),r>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(r){this._trnMainService.TrnMainObj.ProdList[r].ALTRATE=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[r].INVRATE)*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EXRATE),this._trnMainService.TrnMainObj.ProdList[r].REALRATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[r].RATE=this._trnMainService.TrnMainObj.ProdList[r].ALTRATE/this._trnMainService.TrnMainObj.ProdList[r].ALTCONFACTOR,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(r){this.FCRATEChangeEvent(r),this.masterService.focusAnyControl("discount"+r)}RecalculateMRP(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP}onTabMRP(r,l){r.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+l).focus()}RecalculateSPRICE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE}onTabSPRICE(r,l){r.preventDefault(),null!=document.getElementById("VSRATE"+this.activerowIndex)?document.getElementById("VSRATE"+this.activerowIndex).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}RecalculateVSRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT=1)?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE}onTabVSRATE(r){r.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE}onTabVPRATE(r,l){r.preventDefault(),this.RecalculateSPRICE(),0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(l):document.getElementById("mfgdate"+l).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,1==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0),this.userRightAuthService.showAuthPopup=!1}OrderComment(r){this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&this.masterService.focusAnyControl("remarks"+r)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&0==this.userSetting.AllowRateEditInTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||1==this.masterService.disableQtyInStockIssueReturn||("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}focusAfterItemSelect(){2==this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment?null!=document.getElementById("batch"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},20):(null!=document.getElementById("alternateunit"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),74===this._trnMainService.TrnMainObj.VoucherType&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&null!=document.getElementById("alternateQty"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},20))}itemFromBC(r){return 1==r&&1==this.loadFromBarcode}checkBatchSelectionInMultiplePrice(){return 1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice||1!=this.userSetting.ENABLEBATCHWISEPRICE||!!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected}checkQuantityInPOdeliveryMode(){7==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this.userSetting.AllowQtyExceedInPo||null!=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n        `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n        exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n        `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQT(){null!=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.Quantity>l.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT}\nexceed the item wise QT Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n`:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n        exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n        `),this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQTin(){if(null!=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.Quantity<l.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void document.getElementById("alternateQty"+this.activerowIndex).focus()}checkSaleableQuantityInSalesOrder(){let r=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],l=r.ALTUNIT==r.BASEUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTCONFACTOR;this.masterService.getSaleableQTY(r.MCODE,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNDATE,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(c=>{if("ok"==c.status){let T=c.result[0].SALEABLE_SQTY;l>T&&(r.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),this.alertService.info("Entered qty is greater than its saleable qty:"+T),this.alertService.emitShowHideSubject.subscribe(b=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},0)}))}},c=>{this.alertService.info(c)})}checkQuantityInEditMode(){let r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.Quantity<l.OUTQTY)[0];null!=r?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${r.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(r){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=r.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE=r.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE?r.OPSTOCK:r.POSTOCK}assignOrderedDiscount(r){r?.DISCOUNT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=r.DISCOUNT?100*(r.DISCOUNT-r.RATEDISCOUNT)/(r.AMOUNT-r.RATEDISCOUNT):0:(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=r.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=r.INDDISCOUNTRATE),r.RATEDISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNITDISCOUNTRATE=this._trnMainService.nullToZeroConverter(r.ALTUNITDISCRATE))}clickOnNetAmount(r){this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(r)}changeONNetAmount(r,l){this._trnMainService.TrnMainObj.ProdList[r].NETAMOUNT=this._trnMainService.nullToZeroConverter(l.target.value),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(r){if(r&&r?.length){let l=r.map(c=>c.ADJUSTQTY).reduce((c,T)=>c+T);this._trnMainService.nullToZeroConverter(l)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=l)}}checkRepackStock(){let r=this._trnMainService.TrnMainObj.ProdList.filter(l=>l.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&l.ROUTQTY>l.STOCK)[0];if(null!=r&&null!=r)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(r.STOCK)} ${r.PUNIT}, Item : ${r.ITEMDESC} @Qty = ${r.Quantity} ${r.ALTUNIT} `),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(l=>{setTimeout(()=>{document.getElementById("alternateQty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkItemQtyExceedBilledQty(){let r=0,l=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;return r=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?l:l*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,!(r<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY)}checkItemStockINEditModeForOutQty(){let r={},l=0,c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;if(l=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?c:c*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,"EDIT"!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&l>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r;if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()){let T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BatchWiseEditList?.map(b=>b.INVOICEQTY).reduce((b,z)=>b+z,0);if(l-T>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return r.status=!1,r.message="Enter Qty exceed the batch wise transaction qty",r}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(r=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},this.loader.hide(),"ok"==r.status?"ALLOW"==r.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}) ?`)&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},r=>{this.loader.hide(),this.alertService.info(r)})}ValidateQuantityinEDITMode(){let r={},l=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),c=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY,T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,b=0;return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?b=c:(b=c*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,T/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),0==l&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&(console.log("stock",b,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),b<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY-this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BSTOCK)?(r.status=!1,r.userEnterQty=T,r.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n            ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n            ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,r):l>0&&b<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK?(console.log("stock1",b,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),r.status=!1,r.userEnterQty=T,r.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n            ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} \n            ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}   ) ) `,r):void 0}checkBCForMatrxiItem(){this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||this.alertService.warning(`Variant Details is not selected for Item :${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} `))}ValidateQtyINEditModeFroProduction(r){let l=0;return l=r.BASEUNIT===r.ALTUNIT?r.ALTERNATEQUANTIY:r.ALTERNATEQUANTIY*r.ALTERNATEQUANTIY,!(l<r.OUTQTY&&(this.alertService.info(`Item : ${r.ITEMDESC} entered Qty:${l} ${r.BASEUNIT} is less than transaction Qty:${r.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let r={},c=(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY),T=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,b=0;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?b=c:(b=c*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,T/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),b>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return r.status=!1,r.userEnterQty=T,r.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n        ,Exceed the Stock qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,r}ValidateDuplicateItemEntry(r){if(this._trnMainService.TrnMainObj.VoucherType in e.NA){let c;return c=this._trnMainService.TrnMainObj.ProdList.filter(T=>T.MENUCODE==r.MENUCODE),!(c.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(l=>"AllowQuantityApproval"==l.right)?.value}onUserRightReceived(r){this.alertService.success(r),this.authenticationPopup.hide(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isConfirmed=!0)}hoverDiscountt(r){this.hoverId=r,this._trnMainService.TrnMainObj.ProdList[r].TotalDiscountDescription=this.productHelperService.hoverDiscount(r,this._trnMainService.TrnMainObj.ProdList[r]),this.stringValue=this.productHelperService.hoverDiscount(r,this._trnMainService.TrnMainObj.ProdList[r])}hoverLeaveDiscountt(r){this.hoverId=null}ReadOnlyForDescription(r){return!(1==this._trnMainService.TrnMainObj.ProdList[r].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"salesorder"==this.activeurlpath))}getSchemeDiscountForItem(r){this._trnMainService.getSchemeDiscount(r.MCODE,this._trnMainService.TrnMainObj.DIVISION).subscribe(T=>{r.SchemeList="ok"==T.status?T.result:[]},T=>{})}hoverItemDesc(r){this.onHoverItemDesc=!0,this.hoverId=r,this.itemDescHoverValue=`<spam>Remarks: ${this._trnMainService.TrnMainObj.ProdList[r].REMARKS}`}hoverLeaveItemDesc(r){this.hoverId=null,this.onHoverItemDesc=!1}hoverQty(r){this.qtyId=r,this.qtyValue=this.productHelperService.hoverQty(r,this._trnMainService.TrnMainObj.ProdList[r])}hoverLeaveQty(){this.qtyId=null}hoverRate(r){!this._trnMainService.TrnMainObj.ProdList[r].HASBATCH||(this.rateId=r,this.rateInnerHTML="<span>Rate changing option is disabled when Enable Batch Wise Price is turned on </span>")}hoverLeaveRate(r){!this._trnMainService.TrnMainObj.ProdList[r].HASBATCH||(this.rateId=void 0,this.rateInnerHTML=void 0)}focusRateOrDiscount(){0==this.masterService.userProfile.userRights.find(l=>"AllowRateChangeInSO"==l.right)?.value||1==this.masterService.userSetting.EnableBatchWisePrice||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASBATCH?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus()}}return v.\u0275fac=function(r){return new(r||v)(t.Y36(w.P),t.Y36(W.p),t.Y36(Y.R),t.Y36(B.uw),t.Y36(N.qu),t.Y36(O.gz),t.Y36(j.c),t.Y36(x.e),t.Y36(t.sBO),t.Y36(g.V),t.Y36(y.R),t.Y36(L.T),t.Y36(D.y),t.Y36(J.h),t.Y36(U.i),t.Y36(V.P))},v.\u0275cmp=t.Xpm({type:v,selectors:[["productentry"]],viewQuery:function(r,l){if(1&r&&(t.Gf($.q,5),t.Gf(m.K,5),t.Gf(_t,5),t.Gf(Vi,5),t.Gf(Mt,5),t.Gf(pt,5),t.Gf(vt,5),t.Gf(St,5),t.Gf(Ui,5),t.Gf(mt,5),t.Gf(Bi,5),t.Gf(Ot,5),t.Gf(Ki,5)),2&r){let c;t.iGM(c=t.CRH())&&(l.itemListChild=c.first),t.iGM(c=t.CRH())&&(l.batchlistChild=c.first),t.iGM(c=t.CRH())&&(l.genericGridSupplierPopup=c.first),t.iGM(c=t.CRH())&&(l.barCodeGridPopup=c.first),t.iGM(c=t.CRH())&&(l.PetrolGrid=c.first),t.iGM(c=t.CRH())&&(l.genericGridMulitplePricePopup=c.first),t.iGM(c=t.CRH())&&(l.matrixitemgrid=c.first),t.iGM(c=t.CRH())&&(l.warehouseWiseStockPopup=c.first),t.iGM(c=t.CRH())&&(l.itemEditGrid=c.first),t.iGM(c=t.CRH())&&(l.authenticationPopup=c.first),t.iGM(c=t.CRH())&&(l.rateValidation=c.first),t.iGM(c=t.CRH())&&(l.genericGrid=c.first),t.iGM(c=t.CRH())&&(l.focusBatch=c.first)}},hostBindings:function(r,l){1&r&&t.NdJ("keydown",function(T){return l.updown(T)},!1,t.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit"},decls:130,vars:126,consts:[[2,"margin-right","15px","position","relative",3,"ngClass"],[3,"ngClass"],[1,"wrapper","height-wrapper"],["id","prodlistTableheader",2,"background","silver","color","black","border-right","1px solid #b4b4b4","border-left","1px solid #b4b4b4"],[4,"ngIf"],["scope","col",2,"width","4%"],[3,"ngStyle"],["style","width: 190px",3,"ngStyle",4,"ngIf"],["style","width: 110px",4,"ngIf"],["style","width: 5%",4,"ngIf"],["style","width: 50px",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 100px",3,"ngStyle",4,"ngIf"],["style","width: 95px",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width: 100px",4,"ngIf"],["style","width: 60px",4,"ngIf"],["style","width: 120px",4,"ngIf"],["style","width: 10%",4,"ngIf"],["style","border: 1px",4,"ngFor","ngForOf"],["class","add",3,"click",4,"ngIf"],["class","PList","style","margin-top: 2%; height: 640px; width: 78%",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["warehouseWiseStockPopup",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 370px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],[2,"width","190px",3,"ngStyle"],[2,"width","110px"],[2,"width","5%"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","95px"],[2,"width","100px"],[2,"width","60px"],[2,"width","120px"],[2,"width","10%"],[2,"border","1px"],[2,"border","1px solid #b4b4b4","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #b4b4b4","width","20px",3,"id"],["style","width: 6%",4,"ngIf"],["style","width: 10%; border: 1px solid #b4b4b4",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","30%",3,"ngStyle","mouseover","mouseleave"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["style","height: 23px; border: 1px solid #b4b4b4; width: 5%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 6%",4,"ngIf"],["class","CellWithComment sourceBarCode",4,"ngIf"],["class","sourceBatchRate",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 4%",4,"ngIf"],["style","width: 100%; text-align: right","type","number",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 8%",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",3,"id",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n            ",3,"hidden",4,"ngIf"],["style","height:23px;border: 1px solid #b4b4b4; text-align: right;",3,"id",4,"ngIf"],["id","mrpNoneditable","style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",3,"change",4,"ngIf"],["id","amntId","style","\n            height: 23px;\n            border: 1px solid #b4b4b4;\n            background-color: #f9f9f9;\n            text-align: right;\n          ",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              background-color: #f9f9f9;\n              width: 7rem;\n              text-align: right;\n            ",4,"ngIf"],["style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["id","vatvalue","style","\n              height: 23px;\n              border: 1px solid #b4b4b4;\n              width: 100px;\n              text-align: right;\n            ",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; text-align: right",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 40px",3,"id",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 100px",4,"ngIf"],["class","CellWithComment","style","height: 23px; border: 1px solid #b4b4b4; width: 20%",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center; width: 7%;",3,"id",4,"ngIf"],["style","border: 1px solid #b4b4b4; background-color: #f9f9f9; width: 7%;",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 12%",4,"ngIf"],["style","height: 23px; border: 1px solid #b4b4b4; width: 6.5%;text-align: center;",3,"id",4,"ngIf"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"disabled","click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"],[2,"width","6%"],[2,"width","10%","border","1px solid #b4b4b4"],["autocomplete","off","type","text",2,"width","100%",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[2,"display","none",3,"ngClass","innerHTML"],[2,"height","23px","border","1px solid #b4b4b4","width","5%"],[2,"width","100%",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9"],["type","number",2,"width","100%","text-align","right",3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","6%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],["focusBatch",""],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[1,"CellWithComment","sourceBarCode"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment","barCodeInput",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],["type","text",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","disabled","",2,"width","100%",3,"id","ngModel","ngModelChange"],[1,"sourceBatchRate"],["type","number",1,"batchRateInput",3,"id","ngModel","readonly","ngModelChange"],["type","text","autocomplete","off","placeholder","Press Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.Enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["min","0","type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","OnlyWholeNumber","ngModelChange","change","keydown.Tab","keydown.Enter","keypress","mouseover","mouseleave"],["type","number",2,"width","100%","text-align","right",3,"ngModel","disabled","ngModelChange"],["type","number","autocomplete","off",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.enter"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange"],["type","text","autocomplete","off","placeholder","Please Enter to select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","8%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"id"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9",3,"hidden"],["min","0","type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout","mouseover","mouseleave"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id"],["id","mrpNoneditable",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right",3,"change"],["type","number","autocomplete","off",1,"CellWithComment",2,"height","23px","background-color","#f9f9f9","text-align","right",3,"id","ngModel","disabled","ngModelChange","focusout","focusin","keyup","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","keyup","change","keydown.Tab","keydown.enter","ngModelChange","focusout"],[2,"height","23px","border","1px solid #b4b4b4","text-align","right",3,"id","mouseover","mouseleave"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #b4b4b4","background-color","#f9f9f9","width","7rem","text-align","right"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","ngModelChange","keydown.tab","keydown.enter","keyup","focusout"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange","change","keydown.tab","keydown.enter"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #b4b4b4","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #b4b4b4","width","40px",3,"id"],["type","text",2,"width","3.5rem","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #b4b4b4","width","100px"],[3,"ngModel","ngModelChange"],[1,"CellWithComment",2,"height","23px","border","1px solid #b4b4b4","width","20%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange"],["type","number","autocomplete","off",2,"width","80px","text-align","right",3,"id","ngModel","disabled","ngModelChange"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center","width","7%",3,"id"],[2,"border","1px solid #b4b4b4","background-color","#f9f9f9","width","7%"],[2,"height","33px","width","100%","font-size","11px",3,"id","type","ngModel","max","min","disabled","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #b4b4b4","width","12%"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","keydown.Tab","keydown.enter","ngModelChange"],["selected",""],["type","text","autocomplete","off","disabled","true",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #b4b4b4","width","6.5%","text-align","center",3,"id"],["type","text","autocomplete","off",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],[1,"add",3,"click"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81daac"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #b4b4b4","border-top","2px solid #b4b4b4","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #b4b4b4","max-height","25px"],[2,"border","1px solid #b4b4b4"],["style","border: 1px solid #b4b4b4",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #b4b4b4",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem","bottom","85px"],["type","text","id","AuthUserName","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(r,l){1&r&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"table")(4,"tr",3),t.YNc(5,Zi,2,0,"th",4),t.TgZ(6,"th",5),t._uU(7,"S.No."),t.qZA(),t.YNc(8,Fi,2,0,"th",4),t.ALo(9,"activeColumn"),t.YNc(10,Qi,2,0,"th",4),t.ALo(11,"activeColumn"),t.TgZ(12,"th",6),t._uU(13," Description "),t.qZA(),t.YNc(14,gt,2,0,"th",4),t.YNc(15,ft,2,0,"th",4),t.YNc(16,Ye,2,2,"th",7),t.ALo(17,"activeColumn"),t.TgZ(18,"th"),t._uU(19,"Unit"),t.qZA(),t.YNc(20,bt,2,2,"th",7),t.YNc(21,Ct,2,0,"th",8),t.YNc(22,Et,2,0,"th",8),t.YNc(23,Je,2,2,"th",7),t.YNc(24,It,2,0,"th",9),t.YNc(25,At,2,0,"th",9),t.YNc(26,Pt,2,0,"th",10),t.YNc(27,yt,2,0,"th",10),t.YNc(28,xt,2,2,"th",7),t.YNc(29,Lt,2,2,"th",11),t.YNc(30,Rt,2,2,"th",11),t.YNc(31,it,2,2,"th",7),t.YNc(32,Nt,2,2,"th",7),t.YNc(33,jt,2,3,"th",7),t.YNc(34,wt,2,2,"th",7),t.YNc(35,Dt,2,3,"th",7),t.YNc(36,kt,2,1,"th",8),t.ALo(37,"activeColumn"),t.YNc(38,Bt,2,6,"th",12),t.YNc(39,Kt,2,0,"th",13),t.YNc(40,Zt,2,0,"th",8),t.YNc(41,Ft,2,0,"th",14),t.YNc(42,Qt,2,0,"th",8),t.ALo(43,"activeColumn"),t.YNc(44,Ht,2,0,"th",15),t.YNc(45,Gt,2,0,"th",8),t.ALo(46,"activeColumn"),t.YNc(47,Yt,2,4,"th",12),t.YNc(48,Jt,2,0,"th",16),t.ALo(49,"activeColumn"),t.YNc(50,qt,2,0,"th",17),t.ALo(51,"activeColumn"),t.YNc(52,Wt,2,0,"th",17),t.YNc(53,$t,2,0,"th",8),t.YNc(54,zt,2,0,"th",8),t.YNc(55,Xt,2,0,"th",8),t.YNc(56,ei,2,0,"th",8),t.YNc(57,ti,2,0,"th",16),t.ALo(58,"activeColumn"),t.YNc(59,ii,2,0,"th",17),t.ALo(60,"activeColumn"),t.YNc(61,ni,2,0,"th",8),t.YNc(62,We,2,0,"th",8),t.ALo(63,"showColumn"),t.YNc(64,ri,2,0,"th",15),t.ALo(65,"showColumn"),t.YNc(66,oi,2,0,"th",4),t.YNc(67,si,2,0,"th",4),t.YNc(68,ai,2,0,"th",4),t.YNc(69,ci,2,0,"th",4),t.YNc(70,li,2,0,"th",4),t.YNc(71,hi,2,0,"th",4),t.YNc(72,di,2,0,"th",4),t.YNc(73,ui,2,3,"th",11),t.ALo(74,"activeColumn"),t.YNc(75,Ti,2,3,"th",11),t.ALo(76,"activeColumn"),t.YNc(77,_i,2,0,"th",4),t.YNc(78,Mi,2,0,"th",4),t.YNc(79,pi,2,0,"th",4),t.YNc(80,vi,2,0,"th",18),t._UZ(81,"th"),t.qZA(),t.YNc(82,Pn,100,143,"tbody",19),t.qZA(),t.YNc(83,yn,3,0,"span",20),t.ALo(84,"hide"),t.qZA()()(),t.YNc(85,Ln,25,1,"div",4),t.YNc(86,Rn,2,1,"div",21),t.YNc(87,Nn,2,6,"div",22),t.YNc(88,jn,2,1,"div",22),t.TgZ(89,"generic-popup-grid",23,24),t.NdJ("onItemDoubleClick",function(T){return l.dblClickPopupItem(T)}),t.qZA(),t.TgZ(91,"generic-popup-grid",23,25),t.NdJ("onItemDoubleClick",function(T){return l.dblClickPopupParty(T)}),t.qZA(),t.TgZ(93,"barcode-popup-grid",23,26),t.NdJ("onItemDoubleClick",function(T){return l.dblClickbarcodePopUP(T)}),t.qZA(),t.TgZ(95,"multiple-price-popup-grid",23,27),t.NdJ("onItemDoubleClick",function(T){return l.dblClickPricePopUP(T)}),t.qZA(),t.TgZ(97,"matrix-item-grid",28,29),t.NdJ("onApplyClicked",function(T){return l.setVariantData(T)}),t.qZA(),t.TgZ(99,"batch-wise-item-edit",30,31),t.NdJ("onApplyClicked",function(T){return l.setBatchWiseEditData(T)}),t.qZA(),t.TgZ(101,"authentication-entry",32,33),t.NdJ("onUserRightReceived",function(T){return l.onUserRightReceived(T)}),t.qZA(),t._UZ(103,"popup-petrol",null,34)(105,"warehousewisestock",null,35),t.YNc(107,Bn,39,5,"div",36),t.TgZ(108,"div")(109,"div",37,38)(111,"div",39)(112,"div",40)(113,"div",41)(114,"button",42),t.NdJ("click",function(){return l.onClickNo()}),t.TgZ(115,"span",43),t._uU(116,"\xd7"),t.qZA()()(),t.TgZ(117,"div",44)(118,"div",45)(119,"div",46),t._uU(120),t.qZA(),t.TgZ(121,"div",47)(122,"button",48),t.NdJ("click",function(){return l.onClickYes()}),t._uU(123," Yes "),t.qZA(),t.TgZ(124,"button",49),t.NdJ("click",function(){return l.onClickNo()}),t._uU(125," No "),t.qZA()()()()()()()(),t.YNc(126,Kn,36,4,"div",4),t.YNc(127,Zn,2,2,"div",4),t.YNc(128,Fn,2,2,"div",4),t.YNc(129,Qn,25,2,"div",4)),2&r&&(t.Q6J("ngClass",l.masterService.ShowMore?"":"classadded"),t.xp6(1),t.Q6J("ngClass",81==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType||74==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType?"inventorymngtclass2":""),t.xp6(4),t.Q6J("ngIf",l.approvalFlag),t.xp6(3),t.Q6J("ngIf",t.lcZ(9,82,"MENUCODE_HEADER")),t.xp6(2),t.Q6J("ngIf",t.lcZ(11,84,"BARCODE_HEADER")),t.xp6(2),t.Q6J("ngStyle",24==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType||5==l._trnMainService.TrnMainObj.VoucherType?t.DdM(120,Hn):null)("ngStyle",8==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType?t.DdM(121,Gn):null)("ngStyle",89==l._trnMainService.TrnMainObj.VoucherType?t.DdM(122,Yn):null)("ngStyle",80==l._trnMainService.TrnMainObj.VoucherType?t.DdM(123,Jn):null),t.xp6(2),t.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",1==l.userSetting.DisplayAltQtyInSales&&(1==l._trnMainService.TrnMainObj.VoucherType||14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType)),t.xp6(1),t.Q6J("ngIf",t.lcZ(17,86,"BATCH_HEADER")),t.xp6(4),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",10==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90!=l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableOtherUnitQtyInTI),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",90==l._trnMainService.TrnMainObj.VoucherType&&0==l.userSetting.LogBasedRequisitionApproval),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&"variant-adjustment"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableBatchIdInAdjustment),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&0==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",t.xi3(37,88,"FCRATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType&&0==l.userSetting.LogBasedRequisitionApproval||14==l._trnMainService.TrnMainObj.VoucherType||43==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType||41==l._trnMainService.TrnMainObj.VoucherType||9==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||1==l._trnMainService.TrnMainObj.VoucherType||5==l._trnMainService.TrnMainObj.VoucherType||7==l._trnMainService.TrnMainObj.VoucherType||8==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||73==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||74==l._trnMainService.TrnMainObj.VoucherType||80==l._trnMainService.TrnMainObj.VoucherType||88==l._trnMainService.TrnMainObj.VoucherType||75==l._trnMainService.TrnMainObj.VoucherType||81==l._trnMainService.TrnMainObj.VoucherType||10==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||(5==l._trnMainService.TrnMainObj.VoucherType||81==l._trnMainService.TrnMainObj.VoucherType)&&1==l.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType||16==l._trnMainService.TrnMainObj.VoucherType||40==l._trnMainService.TrnMainObj.VoucherType||31==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==l._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",3==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.lcZ(43,91,"CONFACTOR")),t.xp6(2),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType||16===l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||73==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",t.lcZ(46,93,"ECSAmount")),t.xp6(2),t.Q6J("ngIf",-1==t.DdM(124,Hi).indexOf(l._trnMainService.TrnMainObj.VoucherType)&&"add-purchase-order"!=l.activeurlpath&&!l.userSetting.IsBBSM||90==l._trnMainService.TrnMainObj.VoucherType&&0===l.userSetting.LogBasedRequisitionApproval&&l.userSetting.IsBBSM),t.xp6(1),t.Q6J("ngIf",t.xi3(49,95,"DISCOUNT_PER_HEADER",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(51,98,"DISCOUNT_AMT_HEADER",0)),t.xp6(2),t.Q6J("ngIf",(14==l._trnMainService.TrnMainObj.VoucherType||15==l._trnMainService.TrnMainObj.VoucherType||1==l._trnMainService.TrnMainObj.VoucherType||3==l._trnMainService.TrnMainObj.VoucherType||64==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType)&&"self-billing"!=l.activeurlpath),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE||74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",24==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.BATCHWISEPRICE&&1==l.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngIf",t.xi3(58,101,"DISCOUNT_IMPORTPURCHASE",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(60,104,"DISCOUNT_IMPORTPURCHASE",0)),t.xp6(2),t.Q6J("ngIf",14==l._trnMainService.TrnMainObj.VoucherType&&1==l.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",t.lcZ(63,107,"showVATcolumn")),t.xp6(2),t.Q6J("ngIf",t.lcZ(65,109,"showNetAmtHeadercolumn")),t.xp6(2),t.Q6J("ngIf",(3==l._trnMainService.TrnMainObj.VoucherType||37==l._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||31==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",l.approvalFlag),t.xp6(1),t.Q6J("ngIf","add-creditnote-itembase-approval"==l.activeurlpath||"add-stock-issue-approval"==l.activeurlpath||"transfer-out-approval"==l.activeurlpath||"stock-issue-approval"==l.activeurlpath),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",74==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",80==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",t.xi3(74,111,"MFGDATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",t.xi3(76,114,"EXPDATE_HEADER",0)),t.xp6(2),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",89==l._trnMainService.TrnMainObj.VoucherType&&1==l._trnMainService.TrnMainObj.ADJUSTEXPIRY),t.xp6(1),t.Q6J("ngIf",64==l._trnMainService.TrnMainObj.VoucherType||20==l._trnMainService.TrnMainObj.VoucherType||89==l._trnMainService.TrnMainObj.VoucherType||90==l._trnMainService.TrnMainObj.VoucherType||57==l._trnMainService.TrnMainObj.VoucherType||19==l._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=l._trnMainService.TrnMainObj.AdditionalObj.tag||80==l._trnMainService.TrnMainObj.VoucherType),t.xp6(2),t.Q6J("ngForOf",l._trnMainService.TrnMainObj.ProdList),t.xp6(1),t.Q6J("ngIf",t.xi3(84,117,"hideAddButton",l._trnMainService.callPipe)),t.xp6(2),t.Q6J("ngIf",l.isProductDetailView),t.xp6(1),t.Q6J("ngIf","itemList"==l.masterService.PlistTitle&&l.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","Batch Price Selection"==l.masterService.PlistTitle||"Item Variant Selection"==l.masterService.PlistTitle||"Batch Selection"==l.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","partyPopUp"==l.masterService.PlistTitle),t.xp6(1),t.Q6J("popupsettings",l.gridPopupSettings),t.xp6(2),t.Q6J("popupsettings",l.gridPopupSettingsForSupplier),t.xp6(2),t.Q6J("popupsettings",l.barcodeGridSettings),t.xp6(2),t.Q6J("popupsettings",l.gridPopupSettingsForMultiplePrice),t.xp6(2),t.Q6J("activerowIndex",l.activerowIndex)("matrixItemAtrribute",l.matrixItemAtrribute),t.xp6(2),t.Q6J("BatchWiseEditList",l.BatchWiseEditList),t.xp6(8),t.Q6J("ngIf",l._trnMainService.showPriceChangeDetail&&1==l.userSetting.ShowPriceChangePopup),t.xp6(2),t.Q6J("config",t.DdM(125,qn)),t.xp6(11),t.hij(" ",l.rateValidationDisplayMessage," "),t.xp6(6),t.Q6J("ngIf",l.showDiscountAuth),t.xp6(1),t.Q6J("ngIf",l.showBatchPopup),t.xp6(1),t.Q6J("ngIf",l.showAdjustPopup),t.xp6(1),t.Q6J("ngIf",1==l._trnMainService.showNegativeBilling||1==l.userRightAuthService.showAuthPopup))},dependencies:[H.oB,C.mk,C.sg,C.O5,C.PC,N.YN,N.Kr,N.Fj,N.wV,N.EJ,N.JJ,N.qQ,N.Fd,N.On,E.Zl,G.n,Z.r,te.F,$.q,m.K,de.H,Ce.j,S._v,ge.ed,Ie.t,Re.l,Le.m,je.l,Ge,C.JJ,at.g,ct,lt.e,ht.w,dt.R,ut.A,Tt],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}",'table[_ngcontent-%COMP%] {\n    width: 100%;\n    border-collapse: collapse;\n  }\n\n  .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 13%;\n\n  }\n\n  .disabled-rate[_ngcontent-%COMP%]{\n    background: rgb(75, 78, 77);\n    line-height:19px !important;\n  }\n\n  th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n    padding: 8px;\n  }\n\n  th[_ngcontent-%COMP%] {\n    text-align: left;\n    background: #eee;\n    position: sticky;\n    top: 0px;\n  }\n\n   .add[_ngcontent-%COMP%]{\n  color: #04AA6D;\n  border: 2px solid #04AA6D;\n  margin-top: 5px;\n}\nspan.add[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{\n  position: absolute;\n  left: 50%;\n  top:50%;\n  transform: translate(-50%, -50%);\n\n}\n  span.add[_ngcontent-%COMP%]{\n   display: inline-block;\n    width: 22px;\n    height: 22px;\n    text-align: center;\n    font-size: 20px;\n    font-family: "Roboto";\n    border-radius: 50%;\n    background: #FFF;\n    position: relative;\n    cursor: pointer;\n}\n.closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}\n\n .tooltiptext[_ngcontent-%COMP%] {\n    \n     visibility: hidden;\n    opacity:0;\n      text-align: center;\n    border-radius: 3px;\n    \n    right: 0;\n    font-size: 7px;\n    \n    align-items: center;\n    line-height: 2;\n    z-index: 99;\n    margin-top: -14px;\n    display: block;\n    width: 30px;\n    \n    position: relative;\n    color: #000;\n    white-space: nowrap;\n}\n\n.close-wrapper[_ngcontent-%COMP%]:hover   .tooltiptext[_ngcontent-%COMP%] {\n  visibility: visible;\n  opacity:1;\n}\n\n  \n    \n  \n   \n\n  .col1[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 10em;\n    left: 0em;\n    top: auto;\n  }\n\n  .col2[_ngcontent-%COMP%] {\n    position: absolute;\n    width: 5em;\n    left: 10em;\n    top: auto;\n  }\n\n  .modal-footer[_ngcontent-%COMP%] {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n    cursor: pointer;\n    position: absolute;\n    top: 10px;\n    right: 10px;\n  }\n\n  .modal-backdrop[_ngcontent-%COMP%] {\n    display: none;\n  }',".modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 13px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n    padding: 3px;\n  }\n\n  thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 94%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    white-space: nowrap;\n  }\n\n  .close[_ngcontent-%COMP%] {\n    margin: -9px 0px -9px 0px;\n  }\n\n  .highlighted[_ngcontent-%COMP%] {\n    background-color: #7ed0ff;\n  }\n  .bgforlessstockitem[_ngcontent-%COMP%] {\n    background-color: #ffc107d2;\n  }"]}),v})()},32635:(_e,re,A)=>{A.d(re,{j:()=>Li});var t=A(64537),e=A(42326),E=A(28698),m=A(37051),$=A(82484),F=A(27009),S=A(64752),K=A(71732),C=A(92340),u=A(53074),V=A(87584),w=A(69389),W=A(54536),Y=A(20092),B=A(7976),N=A(67311),O=A(67297),j=A(14970),x=A(74263),g=A(60694),y=A(7782),L=A(33612),D=A(71800),J=A(88692),U=A(98692),H=A(64657);const G=["inputBox"];function Z(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"tbody",10),t.NdJ("dblclick",function(){const p=t.CHM(a).$implicit,P=t.oxw();return t.KtG(P.dblClickItemList(p))}),t.TgZ(1,"tr",11)(2,"td",12),t._uU(3),t.qZA(),t.TgZ(4,"td",13),t._uU(5),t.qZA(),t.TgZ(6,"td",13),t._uU(7),t.qZA(),t.TgZ(8,"td",13),t._uU(9),t.qZA()()()}if(2&R){const a=q.$implicit,d=q.index,h=t.oxw();t.ekj("active",d==h.selectedRow),t.xp6(3),t.Oqu(a.schemeName),t.xp6(2),t.Oqu(a.schemeType),t.xp6(2),t.Oqu(2==a.discountRateType?"Buy "+a.minQty+"Get "+a.schemeDisRate+" free":a.schemeDisRate),t.xp6(2),t.Oqu(0==a.discountRateType?"%":1==a.discountRateType?"Amount":2==a.discountRateType?"Quantity":"Type Not Found")}}let te=(()=>{class R{constructor(a,d){this.masterService=a,this._trnMainService=d,this.dbClickEvent=new t.vpe,this.schemeCloseClick=new t.vpe,this.schemeList=[],this.title="Available Active Schemes on Item"}ngAfterViewInit(){}ngOnInit(){}SearchList(a){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(a){this.dbClickEvent.emit(a)}schemeListClosed(){this.schemeCloseClick.emit()}}return R.\u0275fac=function(a){return new(a||R)(t.Y36(u.P),t.Y36(V.p))},R.\u0275cmp=t.Xpm({type:R,selectors:[["PSalesSchemeList"]],viewQuery:function(a,d){if(1&a&&t.Gf(G,5),2&a){let h;t.iGM(h=t.CRH())&&(d._el=h.first)}},inputs:{schemeList:"schemeList"},outputs:{dbClickEvent:"dbClickEvent",schemeCloseClick:"schemeCloseClick"},decls:20,vars:2,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"active","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(a,d){1&a&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),t.NdJ("click",function(){return d.schemeListClosed()}),t.TgZ(4,"span",3),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",4),t._uU(7),t.qZA()(),t.TgZ(8,"div",5)(9,"table",6)(10,"tr",7)(11,"th",8),t._uU(12,"Scheme Name"),t.qZA(),t.TgZ(13,"th"),t._uU(14,"Scheme Type"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Discount"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Dis. Type"),t.qZA()(),t.YNc(19,Z,10,6,"tbody",9),t.qZA()()()()),2&a&&(t.xp6(7),t.Oqu(d.title),t.xp6(12),t.Q6J("ngForOf",d.schemeList))},dependencies:[J.sg],encapsulation:2}),R})();var de=A(59963),Ce=A(65171),ge=A(32711),Ie=A(87454),Re=A(86857),Le=A(94619),je=A(14173),Ze=A(89952);const He=["genericGridSupplierPopup"],Ge=["barCodeGridPopup"],at=["PetrolGrid"],ct=["genericGridMulitplePricePopup"],lt=["matrixitemgrid"],ht=["itemEditGrid"],dt=["authenticationPopup"],ut=["rateValidatoin"],Tt=["genericGrid"],_t=["focusBatch"];function Vi(R,q){1&R&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}function Mt(R,q){1&R&&(t.TgZ(0,"th"),t._uU(1,"Code"),t.qZA())}function pt(R,q){1&R&&(t.TgZ(0,"th"),t._uU(1,"Barcode"),t.qZA())}const vt=function(){return{width:"10%"}};function St(R,q){if(1&R&&(t.TgZ(0,"th",47),t._uU(1,"BatchNo"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",89==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,vt):null)}}function Ui(R,q){1&R&&(t.TgZ(0,"th",48),t._uU(1," Quantity"),t.qZA())}const mt=function(){return{width:"15%"}},Bi=function(){return{width:"20%"}},Ot=function(){return{width:"8%"}};function Ki(R,q){if(1&R&&(t.TgZ(0,"th",49),t._uU(1," Rate"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",19==a._trnMainService.TrnMainObj.VoucherType||8==a._trnMainService.TrnMainObj.VoucherType?t.DdM(3,mt):null)("ngStyle",7==a._trnMainService.TrnMainObj.VoucherType?t.DdM(4,Bi):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?t.DdM(5,Ot):null)}}function Zi(R,q){1&R&&(t.TgZ(0,"th",50),t._uU(1,"MRP"),t.qZA())}function Fi(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"FC P.Rate"),t.qZA())}function Qi(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"P.Rate"),t.qZA())}function gt(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"Amount"),t.qZA())}function ft(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"Con.Factor"),t.qZA())}function ke(R,q){1&R&&(t.TgZ(0,"th",52),t._uU(1," Amt"),t.qZA())}function Ye(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"ECS"),t.qZA())}function bt(R,q){1&R&&(t.TgZ(0,"th",53),t._uU(1," Dis%"),t.qZA())}function Ct(R,q){1&R&&(t.TgZ(0,"th",54),t._uU(1,"Dis Amt"),t.qZA())}function Et(R,q){1&R&&(t.TgZ(0,"th",55),t._uU(1,"Total Disc"),t.qZA())}const Je=function(){return{width:"6.5%"}};function It(R,q){if(1&R&&(t.TgZ(0,"th",49),t._uU(1," Amt"),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",8==a._trnMainService.TrnMainObj.VoucherType||15==a._trnMainService.TrnMainObj.VoucherType||1==a._trnMainService.TrnMainObj.VoucherType||7==a._trnMainService.TrnMainObj.VoucherType?t.DdM(2,Je):null)("ngStyle",10==a._trnMainService.TrnMainObj.VoucherType?t.DdM(3,Ot):null)}}function At(R,q){1&R&&(t.TgZ(0,"th",53),t._uU(1," Dis%"),t.qZA())}function Pt(R,q){1&R&&(t.TgZ(0,"th",54),t._uU(1,"Dis Amt "),t.qZA())}function yt(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"S.Charge"),t.qZA())}function Ke(R,q){1&R&&(t.TgZ(0,"th",51),t._uU(1,"VAT"),t.qZA())}function xt(R,q){1&R&&(t.TgZ(0,"th",52),t._uU(1," Net Amt"),t.qZA())}function Lt(R,q){1&R&&(t.TgZ(0,"th"),t._uU(1," Net Rate"),t.qZA())}function Rt(R,q){1&R&&(t.TgZ(0,"th"),t._uU(1,"Approval Flag"),t.qZA())}const it=function(){return{width:"130px"}};function Fe(R,q){if(1&R&&(t.TgZ(0,"th",5),t._uU(1,"Mfg Date "),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Je):t.DdM(2,it))}}function Nt(R,q){if(1&R&&(t.TgZ(0,"th",5),t._uU(1,"Exp Date "),t.qZA()),2&R){const a=t.oxw();t.Q6J("ngStyle",24==a._trnMainService.TrnMainObj.VoucherType?t.DdM(1,Je):t.DdM(2,it))}}function jt(R,q){1&R&&(t.TgZ(0,"th",56),t._uU(1,"Remarks"),t.qZA())}function wt(R,q){if(1&R&&(t.TgZ(0,"td",88),t._uU(1),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",a.MENUCODE," ")}}function Dt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",89)(1,"input",90),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.BC=h)})("keydown.Tab",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.ItemBarCodeClick(p,h))})("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.ItemBarCodeClick(p,h))})("keydown.enter",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.ItemBarCodeClick(p,h))})("focusout",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.ItemBarCodeFoucusOut(p,h))})("focus",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.ItemBarCodeClickFocusIn(p,h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","barcode",d,""),t.Q6J("ngModel",h.BC)("readonly","VIEW"==h.rowMode)("disabled",p.disableBarcodeField(d))}}function kt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",91)(1,"input",92,93),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.BATCH=h)})("keydown.Tab",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.BatchTabClick(p,h))})("keydown",function(h){t.CHM(a);const p=t.oxw(2);return t.KtG(p.onKeydownOnBatch(h))})("keydown.enter",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.BatchEnter(p,h))}),t.qZA(),t.TgZ(3,"span",64),t._uU(4,"press ENTER or TAB to Select Batch"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","batch",d,""),t.Q6J("ngModel",h.BATCH)("disabled",p.disableBatch(h))}}function Vt(R,q){if(1&R&&(t.ynx(0),t.TgZ(1,"option",97),t._uU(2),t.qZA(),t.BQk()),2&R){const a=q.$implicit;t.xp6(1),t.s9C("value",a.ALTUNIT),t.xp6(1),t.Oqu(a.ALTUNIT)}}function Ut(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",94)(1,"select",95),t.NdJ("change",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.SelectUnit(h))})("keydown.Tab",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.AlternateUnitEnterEventClick(p,h))})("keydown.enter",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.AlternateUnitEnterEventClick(p,h))})("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.ALTUNIT=h)}),t.YNc(2,Vt,3,2,"ng-container",96),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","alternateunit",d,""),t.Q6J("ngModel",h.ALTUNIT)("disabled",p.disableAltUnit(d)),t.xp6(1),t.Q6J("ngForOf",null==h.Product?null:h.Product.AlternateUnits)}}function Bt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",98)(1,"input",99),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.ALTERNATEQUANTIY=h)})("ngModelChange",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.QuantityChangeEvent(h))})("keydown.Tab",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.focusToRate(p,h))})("focusout",function(h){t.CHM(a);const p=t.oxw(2);return t.KtG(p.quantityFocusOut(h))})("keydown.Enter",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.AlternateQuantityEventClick(p,h))})("keyup",function(h){t.CHM(a);const p=t.oxw(2);return t.KtG(p.quantityChange(h))})("keypress",function(h){t.CHM(a);const p=t.oxw(),P=p.$implicit,X=p.index,oe=t.oxw();return t.KtG(6==P.PTYPE&&1!=P.isPurchaseOrder?oe.AlternateQuantityEventClick(X,h):oe.return)}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","alternateqty",d,""),t.Q6J("ngModel",h.ALTERNATEQUANTIY)("readonly",h.isQuantityReadonly)("disabled",p.disableAltQty(d)||p.disableRequestQTY(d))}}function Kt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",100)(1,"input",101),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.INVRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.FCRATEChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.fcrateEnterEvent(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.fcrateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","fcrate",d,""),t.Q6J("ngModel",h.INVRATE)("disabled",p._trnMainService.disableRateOnPOselect)}}function Zt(R,q){if(1&R&&(t.TgZ(0,"td",102),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","grossamnt",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,p._trnMainService.nullToZeroConverter(h.GROSSAMNT))," ")}}function Ft(R,q){if(1&R&&(t.TgZ(0,"td",103),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","amount",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,p._trnMainService.nullToZeroConverter(h.AMOUNT)),"")}}function Qt(R,q){if(1&R&&(t.TgZ(0,"td",103),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","confactor",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,p._trnMainService.nullToZeroConverter(h.ALTCONFACTOR)),"")}}function Ht(R,q){if(1&R&&(t.TgZ(0,"td",104),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.ECSAMOUNT)," ")}}function Gt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",106,107),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.INDDISCOUNTRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.IndDiscountRateChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discRateEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discRateEnterClicked(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","discount",d,""),t.Q6J("ngModel",h.INDDISCOUNTRATE)("readonly",p.disableDiscount())("disabled","VIEW"==h.rowMode||p.disableRAteDisandAmt()||1==p._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||null!=p._trnMainService.TrnMainObj.DCRATE&&0!=p._trnMainService.TrnMainObj.DCRATE&&16!==p._trnMainService.TrnMainObj.VoucherType||null!=p._trnMainService.TrnMainObj.FLATDCAMNT&&0!=p._trnMainService.TrnMainObj.FLATDCAMNT&&16!==p._trnMainService.TrnMainObj.VoucherType||p._trnMainService.disableOnPerFormaSelect||15==p._trnMainService.TrnMainObj.VoucherType&&0==p._trnMainService.TrnMainObj.DOFULLRETURN&&0==p._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&p._trnMainService.TrnMainObj.REFBILL&&1==p._trnMainService.userSetting.REFBILLCOMPULSORINCNOTE)}}function qe(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",108),t.NdJ("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.IndDiscountAmountChangeEvent(p,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))})("click",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.DisAmtclick())}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","discountAmt",d,""),t.Q6J("readonly",p.disableDiscount())("ngModel",t.lcZ(2,4,p._trnMainService.nullToZeroConverter(h.INDDISCOUNT)))("disabled","VIEW"==h.rowMode||p.disableRAteDisandAmt()||1==p._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem||p._trnMainService.disableOnGRNload||null!=p._trnMainService.TrnMainObj.DCRATE&&0!=p._trnMainService.TrnMainObj.DCRATE&&16!==p._trnMainService.TrnMainObj.VoucherType||null!=p._trnMainService.TrnMainObj.FLATDCAMNT&&0!=p._trnMainService.TrnMainObj.FLATDCAMNT&&16!==p._trnMainService.TrnMainObj.VoucherType||p._trnMainService.disableOnPerFormaSelect||15==p._trnMainService.TrnMainObj.VoucherType&&0==p._trnMainService.TrnMainObj.DOFULLRETURN&&0==p._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&p._trnMainService.TrnMainObj.REFBILL&&1==p._trnMainService.userSetting.REFBILLCOMPULSORINCNOTE)}}const Yt=function(R){return{tooltipChild:R}};function Jt(R,q){if(1&R&&(t.ynx(0),t.TgZ(1,"span",110)(2,"b"),t._uU(3,"Indv Discount "),t.qZA(),t._uU(4),t.ALo(5,"twoDigitNumber"),t._UZ(6,"br"),t.TgZ(7,"b"),t._uU(8,"Flat Dsicount"),t.qZA(),t._uU(9),t.ALo(10,"twoDigitNumber"),t.qZA(),t.BQk()),2&R){const a=t.oxw(2),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(7,Yt,p.hoverId==d)),t.xp6(3),t.hij(" : ",t.lcZ(5,3,h.INDDISCOUNT)," "),t.xp6(5),t.hij(" : ",t.lcZ(10,5,h.FLATDISCOUNT)," ")}}function qt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",109),t.NdJ("mouseover",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.hoverDiscount(h))})("mouseleave",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.hoverLeaveDiscount(h))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.YNc(3,Jt,11,9,"ng-container",3),t.qZA()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","totalDisc",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,3,p._trnMainService.nullToZeroConverter(h.DISCOUNT))," "),t.xp6(2),t.Q6J("ngIf",h.DISCOUNT>0)}}function Wt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",111),t.NdJ("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.IndDiscountAmountChangeOfRetailerVATINCEvent(p,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))}),t.ALo(2,"number"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","discountAmtVATInclusiveForretailer",d,""),t.Q6J("ngModel",t.xi3(2,3,p._trnMainService.nullToZeroConverter(h.INDIVIDUALDISCOUNT_WITHVAT),"1.2-2"))("disabled","VIEW"==h.rowMode||h.isPurchaseOrderItem)}}function $t(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",112),t.NdJ("change",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.MRPChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.mrpEnterEvent(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.mrpEnterEvent(h))}),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()}if(2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function zt(R,q){if(1&R&&(t.TgZ(0,"td",113),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.AMOUNT)),"")}}function Xt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",106,107),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.INDDISCOUNTRATE=h)})("change",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.IndDiscountRateChangeEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discRateEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discRateEnterClicked(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","discount",d,""),t.Q6J("ngModel",h.INDDISCOUNTRATE)("readonly",p._trnMainService.disableProd||p.disableDiscount())("disabled","VIEW"==h.rowMode||p.disableRAteDisandAmt()||1==p._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem)}}function ei(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",105)(1,"input",108),t.NdJ("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.IndDiscountAmountChangeEvent(p,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.discEnterClicked(h))})("click",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.DisAmtclick())}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","discountAmti",d,""),t.Q6J("readonly",p.disableDiscount())("ngModel",t.lcZ(2,4,p._trnMainService.nullToZeroConverter(h.INDDISCOUNT)))("disabled","VIEW"==h.rowMode||p.disableRAteDisandAmt()||1==p._trnMainService.disableAllFieldinPurchase||h.isPurchaseOrderItem)}}function ti(R,q){if(1&R&&(t.TgZ(0,"td",114),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.SERVICETAX)),"")}}function ii(R,q){if(1&R&&(t.TgZ(0,"td",115),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit,d=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,d._trnMainService.nullToZeroConverter(a.VAT)),"")}}function ni(R,q){if(1&R&&(t.TgZ(0,"td",102),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","netamount",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,p._trnMainService.nullToZeroConverter(h.NETAMOUNT)),"")}}function We(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",102)(1,"input",116),t.NdJ("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw();return t.KtG(P.changeONNetAmount(p,h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.clickOnNetAmount(h))})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.clickOnNetAmount(h))}),t.ALo(2,"twoDigitNumber"),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","netamount",d,""),t.xp6(1),t.MGl("id","netamounteditable",d,""),t.Q6J("ngModel",t.lcZ(2,4,p._trnMainService.nullToZeroConverter(h.NETAMOUNT)))("disabled","VIEW"==h.rowMode)}}function ri(R,q){if(1&R&&(t.TgZ(0,"td",117),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.MGl("id","mrp",d,""),t.xp6(1),t.hij(" ",t.lcZ(2,2,p._trnMainService.nullToZeroConverter(h.CRATE))," ")}}function oi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",118)(1,"select",119),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.IsApproveStockSettlement=h)}),t.TgZ(2,"option",97),t._uU(3,"Approved "),t.qZA(),t.TgZ(4,"option",97),t._uU(5,"Not Approved"),t.qZA()()()}if(2&R){const a=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",a.IsApproveStockSettlement),t.xp6(1),t.Q6J("value",1),t.xp6(2),t.Q6J("value",0)}}function si(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",120)(1,"input",121),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.MFGDATE=h)})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.MFGDateEnterEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.MFGDateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","mfgdate",d,""),t.s9C("type",p.mfgExpDateType),t.Q6J("ngModel",h.MFGDATE)("disabled","VIEW"==h.rowMode||h.isDisabled||h.isPurchaseOrderItem||"stock-issue-approval"==p.activeurlpath||p._trnMainService.disableOnGRNload||null!=h.BATCH&&1==h.REQEXPDATE&&5==p._trnMainService.TrnMainObj.VoucherType||7==p._trnMainService.TrnMainObj.VoucherType)}}function ai(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",120)(1,"input",122),t.NdJ("change",function(){t.CHM(a);const h=t.oxw(2);return t.KtG(h.onChangeExpDate())})("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.EXPDATE=h)})("keydown.enter",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.expDateEnterEvent(h))})("keydown.Tab",function(){t.CHM(a);const h=t.oxw().index,p=t.oxw();return t.KtG(p.expDateEnterEvent(h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw();t.xp6(1),t.MGl("id","expdate",d,""),t.s9C("type",p.mfgExpDateType),t.Q6J("ngModel",h.EXPDATE)("disabled","VIEW"==h.rowMode||h.isDisabled||h.isPurchaseOrderItem||"stock-issue-approval"==p.activeurlpath||p._trnMainService.disableOnGRNload||null!=h.BATCH&&1==h.REQEXPDATE&&5==p._trnMainService.TrnMainObj.VoucherType||7==p._trnMainService.TrnMainObj.VoucherType)}}function ci(R,q){if(1&R&&(t.TgZ(0,"td",123),t._uU(1),t.ALo(2,"date"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij("",t.xi3(2,1,a.MFGDATE,"dd-MM-yyyy")," ")}}function li(R,q){if(1&R&&(t.TgZ(0,"td",124),t._uU(1),t.ALo(2,"date"),t.qZA()),2&R){const a=t.oxw(),h=a.$implicit;t.MGl("id","expdate",a.index,""),t.xp6(1),t.hij("",t.xi3(2,2,h.EXPDATE,"dd-MM-yyyy")," ")}}const hi=function(){return{width:"22%"}};function di(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"tbody",57)(1,"tr",58),t.NdJ("click",function(){const p=t.CHM(a).index,P=t.oxw();return t.KtG(P.RowClick(p))})("keydown.Shift.delete",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.deleteRow())}),t.TgZ(2,"td",59),t._uU(3),t.qZA(),t.YNc(4,wt,2,1,"td",60),t.YNc(5,Dt,2,4,"td",61),t.TgZ(6,"td",62)(7,"input",63),t.NdJ("ngModelChange",function(h){const P=t.CHM(a).$implicit;return t.KtG(P.ITEMDESC=h)})("keydown.enter",function(h){const P=t.CHM(a).index,X=t.oxw();return X.ItemkeyEvent(P,h),t.KtG(X.displayProductDetailInViewMode(X.event))})("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onClicked())}),t.qZA(),t.TgZ(8,"span",64),t._uU(9,"Press ENTER to Select Item"),t.qZA(),t.ynx(10),t._UZ(11,"br")(12,"span",65),t.BQk(),t.qZA(),t.YNc(13,kt,5,3,"td",66),t.YNc(14,Ut,3,4,"td",67),t.YNc(15,Bt,2,4,"td",68),t.YNc(16,Kt,2,3,"td",69),t.TgZ(17,"td",70)(18,"input",71),t.NdJ("ngModelChange",function(h){const P=t.CHM(a).$implicit;return t.KtG(P.ALTRATE=h)})("change",function(){const h=t.CHM(a),p=h.$implicit,P=h.index,X=t.oxw();return t.KtG(X.MRPChangeEvent(p,P))})("keydown.Tab",function(){const h=t.CHM(a),p=h.$implicit,P=h.index,X=t.oxw();return t.KtG(X.mrpEnterEvent(p,P))})("keydown.enter",function(){const h=t.CHM(a),p=h.$implicit,P=h.index,X=t.oxw();return t.KtG(X.mrpEnterEvent(p,P))})("keyup",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.rateChange(h))})("focusout",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.rateFocusOut(h))}),t.ALo(19,"twoDigitNumber"),t.qZA()(),t.YNc(20,Zt,3,4,"td",72),t.YNc(21,Ft,3,4,"td",73),t.YNc(22,Qt,3,4,"td",73),t.YNc(23,Ht,3,3,"td",74),t.YNc(24,Gt,3,4,"td",75),t.YNc(25,qe,3,6,"td",75),t.YNc(26,qt,4,5,"td",76),t.YNc(27,Wt,3,6,"td",77),t.YNc(28,$t,3,3,"td",78),t.YNc(29,zt,3,3,"td",79),t.YNc(30,Xt,3,4,"td",75),t.YNc(31,ei,3,6,"td",75),t.YNc(32,ti,3,3,"td",80),t.YNc(33,ii,3,3,"td",81),t.YNc(34,ni,3,4,"td",82),t.YNc(35,We,3,6,"td",82),t.YNc(36,ri,3,4,"td",83),t.YNc(37,oi,6,3,"td",84),t.YNc(38,si,2,4,"td",85),t.YNc(39,ai,2,4,"td",85),t.YNc(40,ci,3,4,"td",86),t.YNc(41,li,3,5,"td",87),t.qZA()()}if(2&R){const a=q.$implicit,d=q.index,h=t.oxw();t.xp6(1),t.ekj("selected",h.isTableRowSelected(d))("highlighted",d+1==h.highlightBarCodeWiseRow())("bgforlessstockitem",h.highlightLessStockItem(d)),t.xp6(1),t.MGl("id","sno",d,""),t.xp6(1),t.Oqu(d+1),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("BARCODE_HEADER",d)),t.xp6(1),t.Q6J("ngStyle",3==h._trnMainService.TrnMainObj.VoucherType||89==h._trnMainService.TrnMainObj.VoucherType||74==h._trnMainService.TrnMainObj.VoucherType||31==h._trnMainService.TrnMainObj.VoucherType?t.DdM(49,hi):null),t.xp6(1),t.MGl("id","itemDesc",d,""),t.Q6J("readonly",h.ReadOnlyForDescription(d))("ngModel",a.ITEMDESC)("disabled",h.disableItemDesc(d)||h.disableGridForReqApproval(d)),t.xp6(5),t.Q6J("innerHtml",a.VARIANTDESCA,t.oJD),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("BATCH_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("UNIT_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("QUANTITY_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("FCRATE_EDITABLE",0)),t.xp6(1),t.Q6J("hidden",89==h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.MGl("id","rate",d,""),t.Q6J("ngModel",h.applyPipeInRate?t.lcZ(19,47,a.ALTRATE):a.ALTRATE)("disabled",h.disableRateandDiscount(d))("readonly",h.disableRate()),t.xp6(2),t.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16==h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType||57==h._trnMainService.TrnMainObj.VoucherType||64==h._trnMainService.TrnMainObj.VoucherType||73==h._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("CONFACTOR",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("ECS_AMOUNT",0)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_PER_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE",d)),t.xp6(1),t.Q6J("ngIf",3==h._trnMainService.TrnMainObj.VoucherType||16===h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_AMT_EDITABLE_VATINCLU",d)),t.xp6(1),t.Q6J("ngIf",14!==h._trnMainService.TrnMainObj.VoucherType&&16!==h._trnMainService.TrnMainObj.VoucherType&&57!=h._trnMainService.TrnMainObj.VoucherType&&64!=h._trnMainService.TrnMainObj.VoucherType&&74!=h._trnMainService.TrnMainObj.VoucherType&&89!=h._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=h.activeurlpath&&3!=h._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",6===h.pType),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",d)),t.xp6(1),t.Q6J("ngIf",14==h._trnMainService.TrnMainObj.VoucherType&&1==h.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("GST_AMT_NONEDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.showNetAmtNonEditable()),t.xp6(1),t.Q6J("ngIf",h.showNetAmtEditable()),t.xp6(1),t.Q6J("ngIf",(3==h._trnMainService.TrnMainObj.VoucherType||37==h._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=h._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",h.approvalFlag),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MFGDATE_EDITABLE",d)&&"consumption-entry"!==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("EXPDATE_EDITABLE",d)&&"consumption-entry"!==h.activeurlpath),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("MFGDATE_NONEDITABLE",d)),t.xp6(1),t.Q6J("ngIf",h.ShowProductInsertTableColumns("EXPDATE_NONEDITABLE",d))}}function nt(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"tr",133),t.NdJ("click",function(){const p=t.CHM(a).$implicit,P=t.oxw(2);return t.KtG(P.selectProductDetails(p))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&R){const a=q.$implicit;t.xp6(2),t.Oqu(a.color),t.xp6(2),t.Oqu(a.size),t.xp6(2),t.Oqu(a.imeI1),t.xp6(2),t.Oqu(a.imeI2)}}function ui(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",125)(2,"div",126)(3,"div")(4,"div")(5,"div",127)(6,"h4",128),t._uU(7,"Product Details"),t.qZA(),t.TgZ(8,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeProductDetails())}),t.TgZ(9,"span",40),t._uU(10,"\xd7"),t.qZA()()(),t.TgZ(11,"div",129)(12,"table",130)(13,"thead")(14,"tr",131)(15,"th"),t._uU(16,"Color Group"),t.qZA(),t.TgZ(17,"th"),t._uU(18,"Size Group"),t.qZA(),t.TgZ(19,"th"),t._uU(20,"IMEI 1"),t.qZA(),t.TgZ(21,"th"),t._uU(22,"IMEI 2"),t.qZA()()(),t.TgZ(23,"tbody"),t.YNc(24,nt,9,4,"tr",132),t.qZA()()()()()()()()}if(2&R){const a=t.oxw();t.xp6(24),t.Q6J("ngForOf",a.selectedProductDetails)}}function Ti(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div",134)(1,"PItemList",135),t.NdJ("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.dblClickPopupItem(h))})("itemCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.model1Closed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("title",a.masterService.PlistTitle)}}function _i(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"PBatchList",137),t.NdJ("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.dblClickPopupBatch(h))})("BatchClosedClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.model1Closed())})("returnBatchValue",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.returnBatch(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("AlternateUnits",a.AlternateUnits)("activerowIndex",a.activerowIndex)("title",a.masterService.PlistTitle)("BList",a.batchlist)("voucherType",a._trnMainService.TrnMainObj.VoucherType)("activeurlpath",a.activeurlpath)}}function Mi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"PSalesSchemeList",138),t.NdJ("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.dblClickPopupScheme(h))})("schemeCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.schemepopupClosed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("schemeList",a.schemeList)}}function pi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div",136)(1,"popPartyChoose",139),t.NdJ("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.dblClickPopupParty(h))})("partyCloseClick",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.partypopunpClosed())}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("partyList",a._trnMainService.partyList)}}function vi(R,q){1&R&&(t.TgZ(0,"th",159),t._uU(1,"CURRENT WS-PRICE"),t.qZA())}function Si(R,q){1&R&&(t.TgZ(0,"th",160),t._uU(1,"NEW WS-PRICE"),t.qZA())}function mi(R,q){if(1&R&&(t.TgZ(0,"td",162),t._uU(1),t.ALo(2,"twoDigitNumber"),t.qZA()),2&R){const a=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.WSRATE_A)," ")}}function $e(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"td",162)(1,"input",164),t.NdJ("change",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw(2);return t.KtG(P.onChangePurchasePrice(p,h))})("ngModelChange",function(h){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.WNRATE_A=h)})("keydown.enter",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw(2);return t.KtG(P.onChangePurchasePrice(p,h))})("keydown.Tab",function(h){t.CHM(a);const p=t.oxw().index,P=t.oxw(2);return t.KtG(P.onChangePurchasePrice(p,h))}),t.qZA()()}if(2&R){const a=t.oxw(),d=a.index,h=a.$implicit,p=t.oxw(2);t.xp6(1),t.MGl("id","newWholeSellingPrice",d,""),t.Q6J("ngModel",h.WNRATE_A)("disabled","VIEW"==h.rowMode||h.isPurchaseOrderItem||p._trnMainService.TrnMainObj.ProdList[p.activerowIndex].BASEUNIT!=h.UNIT)}}function Oi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"tbody")(1,"tr",161)(2,"td",162),t._uU(3),t.qZA(),t.TgZ(4,"td",162),t._uU(5),t.ALo(6,"twoDigitNumber"),t.qZA(),t.YNc(7,mi,3,3,"td",163),t.TgZ(8,"td",162)(9,"input",164),t.NdJ("change",function(h){const P=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(P,h))})("ngModelChange",function(h){const P=t.CHM(a).$implicit;return t.KtG(P.NRATE_A=h)})("keydown.enter",function(h){const P=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(P,h))})("keydown.Tab",function(h){const P=t.CHM(a).index,X=t.oxw(2);return t.KtG(X.onChangePurchasePrice(P,h))}),t.qZA()(),t.YNc(10,$e,2,3,"td",163),t.qZA()()}if(2&R){const a=q.$implicit,d=q.index,h=t.oxw(2);t.xp6(3),t.hij(" ",a.UNIT," "),t.xp6(2),t.hij(" ",t.lcZ(6,7,a.CRATE_A)," "),t.xp6(2),t.Q6J("ngIf",1==h.userSetting.ENABLEWSALESRATEBILLING),t.xp6(2),t.MGl("id","newSellingPrice",d,""),t.Q6J("ngModel",a.NRATE_A)("disabled","VIEW"==a.rowMode||a.isPurchaseOrderItem||h._trnMainService.TrnMainObj.ProdList[h.activerowIndex].BASEUNIT!=a.UNIT),t.xp6(1),t.Q6J("ngIf",1==h.userSetting.ENABLEWSALESRATEBILLING)}}function gi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div",140)(1,"div",141)(2,"div",142)(3,"h4",143),t._uU(4,"Selling Price Setting "),t.qZA()(),t.TgZ(5,"div",144)(6,"div")(7,"h5",143),t._uU(8,"Cost Price has been changed.Please reset you new Selling Price"),t.qZA(),t._UZ(9,"hr",145),t.qZA(),t.TgZ(10,"div",42)(11,"label"),t._uU(12,"Label MRP:"),t.qZA(),t.TgZ(13,"input",146),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p._trnMainService.TrnMainObj.ProdList[p.activerowIndex].LABELMRP=h)}),t.qZA()(),t.TgZ(14,"fieldset")(15,"legend",147),t._uU(16,"New Selling Price Setting"),t.qZA(),t.TgZ(17,"table",130)(18,"thead")(19,"tr",148)(20,"th",149),t._uU(21,"UOM"),t.qZA(),t.TgZ(22,"th",150),t._uU(23,"CURRENT S-PRICE "),t.qZA(),t.YNc(24,vi,2,0,"th",151),t.TgZ(25,"th",152),t._uU(26,"NEW S-PRICE"),t.qZA(),t.YNc(27,Si,2,0,"th",153),t.qZA()(),t.YNc(28,Oi,11,9,"tbody",96),t.qZA(),t.TgZ(29,"div",42)(30,"div",154)(31,"h6"),t._uU(32),t.qZA()(),t.TgZ(33,"div",155),t._UZ(34,"div",156),t.qZA()()(),t.TgZ(35,"button",157),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyClickNewPrice())})("keydown.enter",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyClickNewPrice())}),t._uU(36," APPLY "),t.qZA(),t.TgZ(37,"button",158),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyOldPriceClick())})("keydown.enter",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.onApplyOldPriceClick())}),t._uU(38," APPLY OLD S-PRICE "),t.qZA()()()()}if(2&R){const a=t.oxw();t.xp6(13),t.Q6J("ngModel",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].LABELMRP),t.xp6(11),t.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),t.xp6(3),t.Q6J("ngIf",1==a.userSetting.ENABLEWSALESRATEBILLING),t.xp6(1),t.Q6J("ngForOf",a._trnMainService.priceChangeList),t.xp6(4),t.hij(" Recommended Margin: ",a._trnMainService.selectedProdcutRecMargin,"%")}}function fi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h5",128),t._uU(5,"Discount authorization"),t.qZA(),t.TgZ(6,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t.TgZ(7,"span",40),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",41)(10,"div",167)(11,"label",168),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",169)(14,"input",170),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.disAuthObj.username=h)}),t.qZA()()(),t.TgZ(15,"div",167)(16,"label",168),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",169)(19,"input",171),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.disAuthObj.password=h)}),t.qZA()()(),t.TgZ(20,"div",167)(21,"label",168),t._uU(22,"Discount:"),t.qZA(),t.TgZ(23,"div",172)(24,"input",173),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.disAuthObj.discount=h)}),t.qZA()(),t.TgZ(25,"div",174)(26,"a"),t._uU(27,"% \xa0"),t.qZA()()(),t.TgZ(28,"div",175)(29,"fieldset",176)(30,"legend",177),t._uU(31,"Discount authorization remarks:"),t.qZA(),t.TgZ(32,"textarea",178),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.disAuthObj.remarks=h)}),t.qZA()()()(),t.TgZ(33,"div",179)(34,"button",180),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.discountAuthConfirm())}),t._uU(35,"Confirm"),t.qZA()()()()()}if(2&R){const a=t.oxw();t.xp6(14),t.Q6J("ngModel",a.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",a.disAuthObj.password),t.xp6(5),t.Q6J("ngModel",a.disAuthObj.discount),t.xp6(8),t.Q6J("ngModel",a.disAuthObj.remarks)}}function bi(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",181),t.NdJ("BatchClosedEmit",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.BatchPopupClosed())})("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.dblClickPopupBatchs(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ci(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"itemwisebatch",181),t.NdJ("BatchClosedEmit",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.AdjustPopupClosed())})("dbClickEvent",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p.DblClickPopupAdjust(h))}),t.qZA()()}if(2&R){const a=t.oxw();t.xp6(1),t.Q6J("Blist",a.batchList)("HASVARIANT",a._trnMainService.TrnMainObj.ProdList[a.activerowIndex].HASVARIANT)}}function Ei(R,q){if(1&R){const a=t.EpF();t.TgZ(0,"div")(1,"div",165)(2,"div",166)(3,"div",127)(4,"h6",128),t._uU(5,"Authorization for Negative Stock Entry"),t.qZA(),t.TgZ(6,"button",39),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t.TgZ(7,"span",40),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",41)(10,"div",167)(11,"label",168),t._uU(12,"User Name:"),t.qZA(),t.TgZ(13,"div",169)(14,"input",170),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p._trnMainService.disAuthObj.username=h)}),t.qZA()()(),t.TgZ(15,"div",167)(16,"label",168),t._uU(17,"Password:"),t.qZA(),t.TgZ(18,"div",169)(19,"input",171),t.NdJ("ngModelChange",function(h){t.CHM(a);const p=t.oxw();return t.KtG(p._trnMainService.disAuthObj.password=h)}),t.qZA()()()(),t.TgZ(20,"div",179)(21,"button",180),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.confirmAuthorization())}),t._uU(22,"Confirm"),t.qZA(),t.TgZ(23,"button",182),t.NdJ("click",function(){t.CHM(a);const h=t.oxw();return t.KtG(h.closeModal())}),t._uU(24,"Cancel"),t.qZA()()()()()}if(2&R){const a=t.oxw();t.xp6(14),t.Q6J("ngModel",a._trnMainService.disAuthObj.username),t.xp6(5),t.Q6J("ngModel",a._trnMainService.disAuthObj.password)}}const Ii=function(){return{width:"28%"}},Ai=function(){return{width:"25%"}},Pi=function(){return{width:"24%"}},yi=function(){return{width:"40%"}},xi=function(){return{backdrop:"static"}};let Li=(()=>{class R{constructor(a,d,h,p,P,X,oe,Me,Ae,Se,me,Ve,Ue,Ri){this.masterService=a,this._trnMainService=d,this.setting=h,this.dialog=p,this.fb=P,this.arouter=X,this.alertService=oe,this.authservice=Me,this.changeDetection=Ae,this.loader=Se,this.validationService=me,this.responseMsgService=Ve,this.userRightAuthService=Ue,this.focusService=Ri,this.matrixItemAtrribute=[],this.loadFromBarcode=!1,this.BatchWiseEditList=[],this.TotalBill=new t.vpe,this.gridPopupSettingsForSupplier=new E.im,this.barcodeGridSettings=new E.im,this.gridPopupSettingsForMultiplePrice=new S.JP,this.onClickItemSelectPopUp=new t.vpe,this.onChangeProductionItem=new t.vpe,this.indexEmit=new t.vpe,this.ServiceTaxRate=0,this.VatRate=0,this.batchlist=[],this.tableValidation=!1,this.ItemList=[],this.barcodeDisplay=!1,this.subscriptions=[],this.showBatchPopup=!1,this.showAdjustPopup=!1,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new E.im,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.moveToNextRow=!0,this.showBarCodeDetail=!1,this.showBatchWiseDetail=!1,this.isMovetoNextRowinOPFromBatch=!1,this.applyPipeInRate=!0,this.applyPipeInQuantity=!0,this.applyPipeInSprice=!0,this.mfgExpDateType="month",this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=ze=>{let Te=Object.assign({},this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),rt=[],Xe=0;for(var pe of(console.log("vardata",ze),ze))if(Te.VaraintDetailS=[],this.masterService.nullToZeroConverter(pe.QTY)>0){let tt="";Te.VARIANTDESCA="";var ot={};for(var Be in pe)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(Be)&&(tt+=pe[Be].VARIANTBARCODE,Te.VARIANTDESCA=Te.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(Be)}</b>:${pe[Be].NAME} &nbsp;`,ot[pe[Be].VARIANTNAME]=pe[Be].NAME);Te.VaraintDetailS.push(ot),Te.VARIANTLIST=pe,Te.BC=pe.BARCODE?pe.BARCODE:Te.MCODE+tt,Te.Quantity=pe.QTY,Te.MRP=pe.MRP,Te.ALTMRP=pe.MRP,Te.REALQTY_IN=pe.QTY,Te.ALTERNATEQUANTIY=pe.QTY,Te.AltQty=pe.QTY,Te.PRATE=pe.PRATE,Te.RATE=pe.PRATE,Te.REALRATE=pe.PRATE,Te.ALTRATE=pe.PRATE,Te.SPRICE=pe.SRATE,Te.SellingPrice=pe.SRATE,Te.ALTRATE2=pe.SRATE,this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&(Te.SELLRATEBEFORETAX=pe.SRATE),Te.BATCH=`-${Xe}`,rt.push(Object.assign({},Te)),Xe++}let et=this._trnMainService.TrnMainObj.ProdList.slice(0,this.activerowIndex),Ni=this._trnMainService.TrnMainObj.ProdList.slice(this.activerowIndex+1);for(var ji of(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex),rt))et.push(ji);for(var wi of Ni)et.push(wi);this._trnMainService.TrnMainObj.ProdList=et,this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillWithNormal(),setTimeout(()=>{document.getElementById("rate"+this.activerowIndex).focus()},500)},this.hoverId=null,this.stringValue="",this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),this.userProfile=this.authservice.getUserProfile(),this.AppMode=C.N.appMode,1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this._trnMainService.TrnMainObj.VoucherType&&(this.AppSettings=h.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(this.showDiscount=!1),a.ShowMore=!0}catch{}this.activeurlpath=X.snapshot.url[0].path,this.form=this.fb.group({demoArray:this.fb.array([])}),this._trnMainService.TrnMainObj.CHALANNO=""}ngAfterContentChecked(){this.changeDetection.detectChanges()}updown(a){"ArrowRight"===a.code&&a.preventDefault(),"ArrowLeft"===a.code&&a.preventDefault(),("ArrowDown"==a.code||"ArrowUp"==a.code)&&a.preventDefault(),"F2"===a.code&&this.barcodeDisplay&&this.getBarodePagedList(),"F5"===a.code&&(a.preventDefault(),this.petrolPopup(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex])),"F7"==a.code&&(a.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show())),"F9"===a.code&&(a.preventDefault(),this._trnMainService.inputCode&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.length>0&&this.dialougeOpen()),"F11"==a.code&&a.ctrlKey&&(a.preventDefault(),this._trnMainService.barCodes.BC||null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&this.checkBatchWiseRate()),"Escape"==a.code&&(a.preventDefault(),1==this._trnMainService.showNegativeBilling&&this.closeModal())}ngAfterViewInit(){console.log("type",this._trnMainService.TrnMainObj.VoucherType)}model1Closed(){this.masterService.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batch"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},300)}ngOnInit(){if("StockSettlementEntryApproval"===this.activeurlpath)return this.approvalFlag=!0;this.arrayItems=[],console.log("ptype",this.pType)}getProductColorMcodeWise(){this.colorLists=[],this.masterService.getProductColorByMCode(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(a=>{this.colorLists=a&&a.result?a.result:[]})}get demoArray(){return this.form.get("demoArray")}addItem(a){this.arrayItems.push(a),this.demoArray.push(this.fb.control(!1))}removeItem(){this.arrayItems.pop(),this.demoArray.removeAt(this.demoArray.length-1)}RowClick(a){this.activerowIndex=this.rowIndex=a,this.masterService.ShowMore=!1,console.log("row click",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE),this.descriptionEditOnRowClick(this.activerowIndex),this.showPOQtyRate(a)}descriptionEditOnRowClick(a){this._trnMainService.allowDescriptionEdit=1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)}highlightBarCodeWiseRow(){let a=0;if(a=this._trnMainService.TrnMainObj.ProdList.length-1,this._trnMainService.TrnMainObj.ProdList&&null!=this._trnMainService.TrnMainObj.ProdList[0].MENUCODE)return this._trnMainService.TrnMainObj.ProdList.findIndex(h=>h.BC==this._trnMainService.barCodes.BC&&0==h.FulfillBatchQty)+1}highlightLessStockItem(a){return this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.ProdList[a].MENUCODE&&1==this._trnMainService.afterAutoloadCheck&&0===this._trnMainService.TrnMainObj.ProdList[a].APPROVEDALTQTY}showPOQtyRate(a){this._trnMainService.TrnMainObj.REFORDBILL&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.IMPORTPOBILLMODE&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE)&&(this._trnMainService.purchaseOrderQty=this._trnMainService.TrnMainObj.ProdList[a].POSTOCK,this._trnMainService.purchaseOrderRate=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE,this._trnMainService.produstWiseOrderUnit=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT)}openDialog(a){this.selectedIndex=a}ItemBarCodeClick(a,d){if(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry||this._trnMainService.TrnMainObj.BILLTO){if(!this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&"NEW"!==this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&"PI"===this._trnMainService.TrnMainObj.REFBILL.substring(0,2).toUpperCase())return this.showBarCodeDetail=!0,this.productWiseBarCode=this._trnMainService.TrnMainObj.ProdList[a].ProductDetails,this._trnMainService.TrnMainObj.ProdList[a].visible=!0,this.getProductColorMcodeWise(),!1;if(("VIEW"===this._trnMainService.TrnMainObj.Mode||"EDIT"===this._trnMainService.TrnMainObj.Mode)&&6===this._trnMainService.TrnMainObj.ProdList[a].Ptype&&(this.getProductColorMcodeWise(),this.showBarCodeDetail=!0),void 0===this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC)1==this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix&&(this._trnMainService.TrnMainObj.ProdList[a].isBarcodeOfPtypeSix=!1,setTimeout(()=>{console.log("k1"),this._trnMainService.TrnMainObj.ProdList[a]={}},0)),null!=document.getElementById("itemDesc"+a)&&setTimeout(()=>{document.getElementById("itemDesc"+a).focus()},50);else{if(this._trnMainService.hideProductDescriptionPopUp=!0,this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.SalesReturn){let h=this._trnMainService.TrnMainObj.ProdList.filter(P=>P.BC==this._trnMainService.TrnMainObj.ProdList[a].BC);if(null!=h&&h?.length>1)return this.alertService.info(`Duplicate barcode:${this._trnMainService.TrnMainObj.ProdList[a].BC} is detected.`),void this.alertService.emitShowHideSubject.subscribe(P=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)});this._trnMainService.TrnMainObj.ProdList.filter(P=>6==P.PTYPE).forEach(P=>P.ProductDetails?.forEach(X=>{if(X.IEMI1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)return this.alertService.info(`Duplicte IMEI1 :${X.IEMI1} is found on Bulk Entry Grid`),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=null,!1}))}this._trnMainService.TrnMainObj.ProdList[a].BC&&(this._trnMainService.CheckIfSalesReturn()?this._trnMainService.checkBarcodeForSalesReturn(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.REFBILL).subscribe(h=>{"ok"==h.status?(this._trnMainService.ReturnStockObj=h.result,this.loadBarcodeWiseProductList(h.result.TotalStock)):(this.alertService.info(h.result),this.alertService.emitShowHideSubject.subscribe(p=>{setTimeout(()=>{document.getElementById("barcode"+a).focus()},0)}))},h=>{this.alertService.info(h.result)}):this._trnMainService.checkBarcode(this._trnMainService.TrnMainObj.ProdList[a].BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(h=>{"ok"==h.status?this.loadBarcodeWiseProductList():this.alertService.info(h.result)},h=>{this.alertService.info(h.result)}))}}else this.alertService.info("Please select Production warehouse")}heightChange(){let a;return this.masterService.ShowMore?this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval?(a=64,(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=66)):this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry?a=67:this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder?a=61:this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment?a=72:this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?(a=48,this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1!==this.masterService.userSetting.GblBarcodeWiseBilling&&(a=51)):a=this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn?70:this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||1!==this.masterService.userSetting.GblBarcodeWiseBilling?55:49:a=(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)&&1!==this.masterService.userSetting.GblBarcodeWiseBilling?75:(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote)&&1==this.masterService.userSetting.GblBarcodeWiseBilling?72:81,a}onChangeBarCode(a){}ItemkeyEvent(a,d){if(d.preventDefault(),this.activerowIndex=a,this.setItemPopupUrl(),this._trnMainService.currentIndexProductDetails=[],this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))this.alertService.info("Flat Discount is already given could not add new product");else{if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){if("self-billing"===this.activeurlpath){if(""==this._trnMainService.TrnMainObj.MWAREHOUSE)return this.alertService.warning("Please select an unsalable warehouse!"),void this.alertService.emitShowHideSubject.subscribe(h=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("warehouseId").focus()},100)});if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Name!");if(""==this._trnMainService.TrnMainObj.TRNACName||null==this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.warning("Please select an Account Before self billing!");if(""==this._trnMainService.TrnMainObj.REMARKS||null==this._trnMainService.TrnMainObj.REMARKS)return this.alertService.warning("Remarks is mandatory!"),void this.alertService.emitShowHideSubject.subscribe(h=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("remarksid").focus()},100)});console.log("Check Tna",this._trnMainService.TrnMainObj.TRNACName,this._trnMainService.TrnMainObj.REMARKS),this.showStockedQuantityOnly=0}else this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?(this.showStockedQuantityOnly=1,this.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE??""):this.showStockedQuantityOnly=0;if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&1!==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!==this.userSetting.PODELIVERYMODE&&"purchase-import"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI&&1==this.userSetting.SOREFERENCE_REQUIRED||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1==this.userSetting.SOREFERENCE_REQUIRED){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice){if(!this._trnMainService.TrnMainObj.REFORDBILL){let h=this.responseMsgService.getProperMessageForRefBill(this._trnMainService.TrnMainObj);return this.alertService.info(h),!1}}else if(null==this._trnMainService.TrnMainObj.REFBILL||""==this._trnMainService.TrnMainObj.REFBILL)return this.alertService.info("Please Load the ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE){if(!this._trnMainService.TrnMainObj.REFORDBILL)return this.alertService.warning("Please Load the Import PO Ref bill for return"),!1;this.gridPopupSettings.apiEndpoints="/getMenuitemFromProdForReturnPagedList"}else{let p,h="";"self-billing"===this.activeurlpath?h="SB":null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(h=this._trnMainService.TrnMainObj.VoucherPrefix);let P="";P=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,((0,K.isNullOrUndefined)(p)||0==this.userSetting.GblBarcodeWiseBilling||null==p||void 0===p||""==p)&&(p="A"),this.productListInGenericPopup(a,p,h,P)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE){let h="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(h=this._trnMainService.TrnMainObj.VoucherPrefix),this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/PI/${this._trnMainService.userProfile.userWarehouse}`}return this._trnMainService.itemselectevent=!0,console.log("credinote",this._trnMainService.TrnMainObj.DOMANUALSALESRETURN),this._trnMainService.allowDescriptionEdit||this.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote?this._trnMainService.TrnMainObj.REFBILL:""),!1}this.displayProductDetailInViewMode(d)}}productListInGenericPopup(a,d,h,p){if(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN){this._trnMainService.allowDescriptionEdit=!0;let P=this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC;P&&""!=P?.trim()?setTimeout(()=>{document.getElementById("alternateunit"+a).focus()},0):(this._trnMainService.allowDescriptionEdit=!1,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${d}/all/${h}/${p}`)}else this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${d}/all/${h}/${p}`}displayProductDetailInViewMode(a){console.log("eventlog",a),"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==a.code&&this.dialougeOpen()}onChangeExpDate(){}loadBarcodeWiseProductList(a=0){this.loadFromBarcode=!1;let h=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(P=>{if("ok"===P.status)if(h=P.result.data,0===h.length)this.alertService.info("Product is out of Stock ");else if(1===h.length){this.loadFromBarcode=!0;var X=h[0];if(this._trnMainService.CheckIfSalesReturn()){X.STOCK=a;var oe=0;for(let Se of this._trnMainService.TrnMainObj.ProdList)Se.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(oe+=Se.ALTERNATEQUANTIY);if(X.STOCK<oe)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(X),this.loadFromBarcode=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",X.barcodeDetails){var Me=JSON.parse(X.barcodeDetails);for(var Ae in console.log("varDetail",Me),Me)this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${Ae}</b>:${Me[Ae]} &nbsp;`}}else console.log("response data > 1",this.gridPopupSettings),this.ItemkeyEvent(this.activerowIndex,event);else this.alertService.info(P.result.error)})}checkDuplicatProductWithBarcode(){let a=[];return a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.BARCODE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE),a.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}checkBatchWiseRate(){this.batchlist=[];let a=this._trnMainService.TrnMainObj.VoucherPrefix;"self-billing"===this.activeurlpath&&(a="SF");let d="";d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE;let h="";h=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${d}&voucherPrefix=${a}&warehouse=${h}&barcode=`).subscribe(p=>{"ok"===p.status&&(this.batchlist=p.result,this._trnMainService.checkBatchWiseApiResponses=!0,console.log("batchlist",this.batchList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===p.message&&(this.changeBatchWiseRate(p.result[0].RATE),this.assignBarcodeWiseMFGEXPDATE(p.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=p.result[0].costprice),"SHOWPRICEPOPUP"===p.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!"))})}checkBatchWiseRateSettingZero(){console.log("check batch wise rate for setting"),this.batchlist=[];let d="",h="";d=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,h=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getVariantItemDetails?mcode=${d}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${h}&barcode=`).subscribe(p=>{"ok"===p.status&&(this.batchlist=p.result,"SHOWPRICEPOPUP"===p.message&&(this.masterService.PlistTitle="Item Variant Selection"))})}changeBatchWiseRate(a){(this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(a)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):a,this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(a){null!=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.filter(h=>1==h.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR)}assignBarcodeWiseMFGEXPDATE(a){1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a[0].MFGDATE?"":a[0].MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a[0].EXPDATE?"":a[0].EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a[0].BATCH)}batchWiseSalesRateBeforeTax(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a)}batchWiseStockTax(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.map(d=>d.STOCK).reduce((d,h)=>d+h,0))}BatchTabClick(a,d){if(console.log("BATCH TAB CLICK called"),d?.preventDefault(),this.activerowIndex=a,(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH||null==this._trnMainService.TrnMainObj.ProdList[a]||null==this._trnMainService.TrnMainObj.ProdList[a].MCODE||""===this._trnMainService.TrnMainObj.ProdList[a].MCODE)return!1;let h=this._trnMainService.userProfile.userWarehouse;return this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&(h=this._trnMainService.TrnMainObj.BILLTO),this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||0!=this._trnMainService.prodListForUnfinedBill||"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote||this.masterService.masterPostmethod("/getBatchListOfItem",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE,onlynonexpireditem:this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice?1:0,voucherprefix:this._trnMainService.TrnMainObj.VoucherPrefix,warehouse:h}).subscribe(p=>{"ok"==p.status?(console.log("Reus",p),this.batchlist=JSON.parse(p.result),1==this.batchlist.length?this.masterService.PlistTitle="Batch Price Selection":0==this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?alert("Rate not Detected!"):0==this.batchlist.length&&"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||(this.masterService.PlistTitle="Batch Price Selection")):console.log("error on getting BatchListOfItem "+p.result)},p=>{console.log("error on getting BatchListOfItem ",p)}),!1}onKeydownOnBatch(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||"Enter"===a.key||"Tab"===a.key||a.preventDefault()}assignedSchemeToBatch(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME;if(null!=a)if(null==a.batches||""===a.batches)this.batchlist.forEach(d=>{d.SCHEME=a,d.SCHEMERATE=a.schemeDisRate,d.SCHEMENAME=a.schemeName,d.SchemeRateType=a.discountRateType});else{let d=a.batches.toString().split(",");this.batchlist.forEach(h=>{null!=d.find(p=>p===h.BATCH)&&(h.SCHEME=a,h.SCHEMERATE=a.schemeDisRate,h.SCHEMENAME=a.schemeName,h.SchemeRateType=a.discountRateType)})}}ReturnedSchemeValue(){}BatchEnter(a,d){d.preventDefault();let h=this._trnMainService.TrnMainObj.VoucherType;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=d.LANDINGCOST,2==this.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&h in e.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(console.log("rn"),this.checkBatchWiseRate()),null!=document.getElementById("alternateunit"+this.activerowIndex)&&"variant-adjustment"!==this.activeurlpath&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment||"variant-adjustment"==this.activeurlpath){console.log("entewews"),this.batchList=[];let p=this._trnMainService.TrnMainObj.ProdList[a].MCODE,P=this.masterService.userProfile.userWarehouse;p&&this.masterService.getItemWiseBatch(p,P).subscribe(X=>{console.log("get batch list",X),"ok"==X.status&&(this.batchList=X.result.filter(oe=>oe.STOCK>0),this.batchList?(setTimeout(()=>{document.getElementById("sourcebatch"+this.activerowIndex).blur(),document.getElementById("sourcebc"+this.activerowIndex).blur()},200),this.showBatchPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}return this.showBatchWiseDetail=!0,!1}PstockEnter(a,d){d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("computerStock"+a).focus()}CstockEnter(a,d){d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("alternateqty"+a).focus()}AdjustBatchEnter(a){if(this._trnMainService.TrnMainObj.VoucherType=e.Km.BatchAdjustment){console.log("entewews"),this.batchList=[];let d=this._trnMainService.TrnMainObj.ProdList[a].MCODE,h=this.masterService.userProfile.userWarehouse;d&&this.masterService.getAdjustingBatch(d,h).subscribe(p=>{console.log("get batch list",p),"ok"==p.status&&(this.batchList=p.result,this.batchList?(setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).blur(),document.getElementById("adjustbc"+this.activerowIndex).blur()},200),this.showAdjustPopup=!0,setTimeout(()=>{this.masterService.focusAnyControl("filter")},200)):this.alertService.info("There are no batch assigned for this item"))})}}BatchPopupClosed(){this.showBatchPopup=!1}AdjustPopupClosed(){this.showAdjustPopup=!1}dblClickPopupBatchs(a){this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCHID=a.BATCHID)),this.checkDuplicateSourceBarcode(a.BATCHCODE)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BC),this.showBatchPopup=!1,this.masterService.focusAnyControl("alternateQty"+this.activerowIndex))}checkDuplicateSourceBarcode(a){return!a||!this._trnMainService.TrnMainObj.ProdList.find(d=>d.BATCH==a)||(this.alertService.info(`Batch ${a} is already selected as a source barcode.`),!1)}DblClickPopupAdjust(a){a.BATCHCODE!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBATCH=a.BATCHCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INVRATE=a.LANDINGCOST,1==this.userSetting.EnableBatchIdInAdjustment&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MANUFACTURER=a.BATCHID),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ADJUSTBC=a.BC),this.showAdjustPopup=!1,this.masterService.focusAnyControl("remarks"+this.activerowIndex)):this.alertService.info("Assign Batch and Adjust Batch could not be same")}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}prepareProductDetails(){let d={color:""};d.quantity=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,d.IEMI1=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE,d.IEMI2="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(d)}selectProductDetails(a){let d=[];d=a,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(d),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,vchrno:this._trnMainService.TrnMainObj.REFBILL}).subscribe(d=>{d&&"ok"===d.status?(this.isProductDetailView=!0,this.selectedProductDetails=d.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},d=>{this.selectedProductDetails=[]})}dblClickPopupScheme(a){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALLSCHEME=a,this.assignedSchemeToBatch(),null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}discEnterClicked(a,d){return this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOFULLRETURN?0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(a)):document.getElementById("mfgdate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?1===this.userSetting.ENABLE_NETAMOUNT_EDIT?null!=document.getElementById("netamounteditable"+this.activerowIndex)&&document.getElementById("netamounteditable"+this.activerowIndex).focus():this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice?this.checkValidation(a):this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?document.getElementById("remarks"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?this.checkValidation(a):document.getElementById("mfgdate"+a).focus(),!1}approvedQtyEnter(a){console.log("hit while change");let h=this._trnMainService.TrnMainObj.ProdList[a];if(this.validationService.checkStockforApprovalQty(h)&&!h.isConfirmed){console.log("reach");let p=[];this.checkRightsForQtyApproval()&&this.authenticationPopup.show(p,"ReqApproval")}h.isConfirmed||this.checkRightsForQtyApproval()||this.validationService.validateStockinReqApproval(h,a)&&setTimeout(()=>{null!=document.getElementById("remarks"+a)&&document.getElementById("remarks"+a).focus()},50),this.validationService.validateStockinReqApproval(h,a,!0),this._trnMainService.CalculateApprovalBill()}discRateEnterClicked(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let d=this.masterService.userProfile.roleRights.find(h=>"DISLIMIT"==h.right);console.log("disLimt on discount rate",d),d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>d?.value&&(this.alertService.warning("Discount limit of :"+d.value+"% exceeded"),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let d=this.masterService.userProfile.userRights.find(h=>"SODiscountLimit"==h.right);d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>d?.value&&(this.alertService.warning("Discount limit for sales order ("+d.value+") exceeded"),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():document.getElementById("remarks"+a).focus()},0)}))}return(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(console.log("DISCOUNT",this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder?document.getElementById("discountAmt"+a).focus():(console.log("reach12"),this.checkValidation(a)):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"purchase-import"==this.activeurlpath?document.getElementById("discountAmti"+a).focus():null!=document.getElementById("discountAmt"+a)?document.getElementById("discountAmt"+a).focus():null!=document.getElementById("discountAmti"+a)&&document.getElementById("discountAmti"+a).focus():(console.log("quoatioin enter"),this._trnMainService.TrnMainObj.VoucherType==e.Km.PurchaseOrder&&"add-purchase-order"==this.activeurlpath?document.getElementById("discountAmt"+a).focus():document.getElementById("mfgdate"+a).focus())),!1}checkValidation(a){console.log("reached cehck validation");var d=this._trnMainService.TrnMainObj.ProdList[a];if(null!=d){if(null==d.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==d.ALTERNATEQUANTIY)return this.alertService.warning(`Qty Is Not Specified For The Item ${d.ITEMDESC} (${d.MENUCODE}) Please Check Your Entry.`),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!=this.activeurlpath){var h=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(P=>0==P.ISUNKNOWN),function(P){return[P.MCODE,P.RATE,P.BC]});for(const P of h)if(P.length>1)return this.alertService.warning("Cannot enter same Item with same rate "),!1}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){let P=this._trnMainService.TrnMainObj.ProdList.filter(X=>1==X.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(X.EXPDATE))[0];if(null!=P&&1!=this.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${P.ITEMDESC}`),!1}if("superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&null!=this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].SELECTEDITEM.MAXLEVEL))return this.alertService.info("You can not Order more than maximum stock assign to you..."),document.getElementById("quantity"+a).focus(),!1;if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this._trnMainService.TrnMainObj.ProdList[a].Quantity>this._trnMainService.TrnMainObj.ProdList[a].STOCK&&"EDIT"!==this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase()&&this._trnMainService.TrnMainObj.ProdList[a].STOCK>0&&9!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&10!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE)return this.alertService.info("Quantity Exceed the available Stock."),void document.getElementById("basequantity"+this.activerowIndex).focus();if(this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval?this._trnMainService.CalculateApprovalBill():this._trnMainService.ReCalculateBillWithNormal(),!this._trnMainService.TrnMainObj.ProdList.some(P=>null==P.MCODE)&&!1===this._trnMainService.addRow())return;let p=a+1;1==this.userSetting.GblBarcodeWiseBilling?(console.log("GBLbarcodewisebilling = 1 "),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?setTimeout(()=>{null!=document.getElementById("barcode"+p)?(console.log("rn1"),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote?(document.getElementById("itemDesc"+p).focus(),this.resetDescriptionEdit()):document.getElementById("barcode"+p).focus()):document.getElementById("itemDesc"+p).focus()},50):setTimeout(()=>{null!=document.getElementById("itemDesc"+p)&&(document.getElementById("itemDesc"+p).focus(),this.resetDescriptionEdit())},50)):(console.log("GBLbarcodewisebilling = 0 "),setTimeout(()=>{null!=document.getElementById("itemDesc"+p)&&document.getElementById("itemDesc"+p).focus()},50))}resetDescriptionEdit(){this._trnMainService.allowDescriptionEdit&&(this._trnMainService.allowDescriptionEdit=!1)}onChangeColor(){}returnBatch(a){if("self-billing"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.filter(p=>p.BATCH==a.BATCH&&p.MCODE==a.MCODE).length>0)this.alertService.warning("Cannot add same item with same batch");else{if(this._trnMainService.assignBatchToActiveProdRow(a,this.activerowIndex),this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected=!0,console.log("priceselected",this._trnMainService.TrnMainObj.ProdList),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT)for(var d in this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST=a.VARIANTDETAIL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST)console.log("Var attribute",d,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[d]),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTDESCA+=`<b>${d}</b>:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VARIANTLIST[d]} &nbsp;`;(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack)&&this.masterService.focusAnyControl("alternateQty"+this.activerowIndex)}}dblClickPopupBatch(a){console.log("value ma k aaucha",a),this.returnBatch(a)}QuantityChangeEvent(a){let d=this._trnMainService.TrnMainObj.VoucherType;if(this.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(d in e.SL&&(h=this.ValidateQuantityinEDITMode())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message);if(d in e.fr){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase())if(!0!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected)this.checkBatchWiseRateinEditMode();else{var h;if((h=this.ValidateQtyEDITModeForOUt())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message)}else if((h=this.ValidateQtyEDITModeForOUt())&&!h.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h.userEnterQty,void this.alertService.info(h.message);let P=this.checkItemStockINEditModeForOutQty();if(P&&!P.status)return void this.alertService.info(P.message)}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry&&(console.log("active",p),"EDIT"===p.RowMode.toUpperCase()&&p&&!this.ValidateQtyINEditModeFroProduction(p)))return}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue)&&!this.checkBatchSelectionInMultiplePrice())return this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} has multiple batch price. Please select batch price first to proceed.`),void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY>1&&(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[a].ITEMDESC} cannot have quantity more than one for membership sales invoice`),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=1,this.alertService.emitShowHideSubject.subscribe(p=>{setTimeout(()=>{null!==document.getElementById("rate"+a)&&document.getElementById("rate"+a).focus()},100)})),this._trnMainService.calculateNetRATE(a),this._trnMainService.ReCalculateBillWithNormal(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&this.onChangeProductionItem.emit(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&"lite"==this._trnMainService.AppMode&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL){console.log("STOCK CHECK IN CN",this._trnMainService.TrnMainObj.ProdList[a]);let p=this._trnMainService.TrnMainObj.ProdList[a];if(p.ALTERNATEQUANTIY>p.STOCK)return this.alertService.warning(`Entered quantity: ${p.ALTERNATEQUANTIY} is greater than issued quantity: ${p.STOCK}`),void(p.ALTERNATEQUANTIY=0)}if(this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||1!=this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.validatePurchaseQtyInDebitNote(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,this.activerowIndex,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC)){if(10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&this.checkEnteredProductStock(),this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssueReturn){let p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(!this._trnMainService.validateIssueQtyInStockIssueReturn(p.PSTOCK,p.ALTERNATEQUANTIY,this.activerowIndex))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=0)}if(console.log("activerowinsert",this.activerowIndex),this._trnMainService.allowNegativeBilling(this.activerowIndex)?console.log("check user irghrs here"):10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue&&"NEW"===this._trnMainService.TrnMainObj?.Mode?.toUpperCase()||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&1===this.userSetting.INVBASEPROFORMA||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)&&(console.log("check entered product stock"),this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&0==this.userSetting.ENABLESINGLEBATCHMODE&&this.checkDuplicateproductEnterQuantity(),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&1==this.userSetting.CheckSaleableQtyInSO&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&7!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(console.log("selabel soprodlist",this._trnMainService.TrnMainObj.ProdList),this.checkSaleableQuantityInSalesOrder()),this._trnMainService.TrnMainObj.REFORDBILL&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this.checkQuantityInSOLoadFromQT(),this.checkQuantityInSOLoadFromQTin()),((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.TrnMainObj.ProdList[a].Quantity<this._trnMainService.TrnMainObj.ProdList[a].POSTOCK){let p="Quantity is less than PO Stock!! Are you sure you want to proceed further";if((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(p="Quantity is less than SO Stock!! Are you sure you want to proceed further"),!confirm(p))return this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,document.getElementById("alternateqty"+a).focus(),void this._trnMainService.ReCalculateBillWithNormal()}if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this.checkRepackStock(),this.checkChildproductEnterQuantity(),this.checkSameproductEnterQuantity())),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this.checkQuantityInEditMode(),this._trnMainService.allowNegativeBilling(this.activerowIndex)||(this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn)&&9!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&10!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseStockOut(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE}),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!==this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkQuantityInPOdeliveryMode(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(1===this.userSetting.PODELIVERYMODE||2===this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!==this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"===this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE)&&this.checkQuantityInPOdeliveryMode(),d in e.po){let p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,P=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,X=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT,oe=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC,Me=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISUNKNOWN;console.log("activeulr",this.activeurlpath),!this._trnMainService.allowNegativeBilling(this.activerowIndex)&&"self-billing"!=this.activeurlpath&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkItemTotalQtyWithStock(p,oe,X,P,this.activerowIndex),"self-billing"!=this.activeurlpath&&this.valiadateDuplicateRateItem(X,p,P,Me,this.activerowIndex)}this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this.userSetting.ENABLEMANUALSALESRETURN&&(console.log("JJJJJ"),this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n          Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n          @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `))}}getContractPriceandOtherDiscount(){this._trnMainService.getItemRelatedDiscount(this.activerowIndex,{MCODE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,QUANTITY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,AMOUNT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].AMOUNT,UNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,CUSTID:this._trnMainService.TrnMainObj.TRNAC,PRICEMODE:this._trnMainService.TrnMainObj.PRICEMODE})}ratechangeEvent(a){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(a){this._trnMainService.calculateNetRATE(a),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=100),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeEvent(a,d){if(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.nullToZeroConverter(d.target.value),console.log("inddiscount",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales){let h=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),p=this.masterService.userProfile.roleRights.find(P=>"DISLIMIT"==P.right);console.log("dis rate",h,"dislimit",p),p&&h>p?.value&&(this.alertService.warning("Discount limit of :"+p.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(P=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}if((this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[a].UNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE):(this._trnMainService.TrnMainObj.ProdList[a].NETRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[a].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[a].Quantity),this._trnMainService.TrnMainObj.ProdList[a].CRATE=this._trnMainService.TrnMainObj.ProdList[a].NETRATE)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=100*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),p=this.masterService.userProfile.userRights.find(P=>"SODiscountLimit"==P.right);console.log(" so dis rate",h,"dislimit",p),p&&h>p?.value&&(this.alertService.warning("Discount limit of :"+p.value+"% exceeded, with given discount amount : "+this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT),this.alertService.emitShowHideSubject.subscribe(P=>{setTimeout(()=>{null!==document.getElementById("discountAmt"+a)&&document.getElementById("discountAmt"+a).focus()},0)}))}this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT<0?this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=0:this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeOfRetailerVATINCEvent(a,d){this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(d.target.value),this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT<0?this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=0:this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT>this._trnMainService.TrnMainObj.ProdList[a].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[a].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.TrnMainObj.ProdList[a].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}discountRateToAmnt(){}QuantityEventClick(a){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].Quantity)<1||(this.activerowIndex=a,this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived?document.getElementById("alternateunit"+a).focus():(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&document.getElementById("remarks"+a).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(a){return{status:"error",error:a}}}isTableRowSelected(a){return this.activerowIndex===a}deleteRow(){if("EDIT"==this._trnMainService.TrnMainObj?.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.BranchTransferOut)){if(this.userRightAuthService.checkuserrightfordelete(this.activerowIndex,this._trnMainService.TrnMainObj.VoucherType))return;(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&2==this.userSetting.ALLOWMINUSTOCK_PURCHASE||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance&&2==this.userSetting.ALLOWMINUSTOCK_OPENING)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item::${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}`)}this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&confirm("Are you sure u you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")}restrictPercentageNumeric(a,d){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=0:(parseFloat(a)>100||isNaN(parseFloat(a)))&&(this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(a,d){try{parseFloat(a)<0||isNaN(parseFloat(a))?this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNT=0:parseFloat(a)>this._trnMainService.TrnMainObj.ProdList[d].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[d].AMOUNT)}catch{}}SelectUnit(a,d,h){this._trnMainService.TrnMainObj.ProdList[a].DiscountOnAltUnit=!1,this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[a].CRATE=0;let p=this._trnMainService.TrnMainObj.ProdList[a].Product.AlternateUnits.find(P=>P.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder?this._trnMainService.TrnMainObj.ProdList[a].BASERATE:this._trnMainService.TrnMainObj.ProdList[a].RATE,this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=0):(this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR=p.CONFACTOR,0===this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].BASERATE),this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].RATE*this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,"add-sales-invoice-wholesale"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE-this._trnMainService.TrnMainObj.ProdList[a].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[a].WSRATE_DISCOUNT/100),this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR),console.log("prodlist1",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this.applyDiscountOnUnitChange(p,a),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&this.applyDiscountOnUnitChangeOnSales(p,a),this._trnMainService.ReCalculateBillWithNormal()),this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&(console.log("something here",this._trnMainService.TrnMainObj.ProdList[a]),this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT!=this._trnMainService.TrnMainObj.ProdList[a].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR:this._trnMainService.TrnMainObj.ProdList[a].REQUESTTOTALQTY,this.approvedQtyEnter(a),this._trnMainService.CalculateApprovalBill())}applyDiscountOnUnitChange(a,d){if(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER)this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=1==this.userSetting.ENABLE_WSRATE_INSORDER?a.WSRATE_DISCOUNT:a.SRATE_DISCOUNT;else if(0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER){let h=this._trnMainService.nullToZeroConverter(0==this.userSetting.ENABLE_WSRATE_INSORDER?a.SRATE_DISCOUNT:a.WSRATE_DISCOUNT);console.log("discount",h),this._trnMainService.TrnMainObj.ProdList[d].ALTRATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE-this._trnMainService.TrnMainObj.ProdList[d].ALTRATE*(h/100)}}applyDiscountOnUnitChangeOnSales(a,d){this._trnMainService.TrnMainObj.ProdList[d].INDDISCOUNTRATE=a.SRATE_DISCOUNT}schemepopupClosed(){this.schemeList=[],document.getElementById("showScheme").style.display="none",null!=document.getElementById("batch"+this.activerowIndex)?(document.getElementById("batch"+this.activerowIndex).focus(),this.BatchTabClick(this.activerowIndex,null)):document.getElementById("quantity"+this.activerowIndex).focus()}returnMultiBatchScheme(a){for(let d of a)this._trnMainService.assignBatchToActiveProdRow(d,this.activerowIndex)}flatDisChange(a){this.flatDiscountValue=a,this.flatDiscountAssign()}flatDiscountUnitChange(a){this.radioFlatDiscount=a,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let a=this._trnMainService.TrnMainObj.ProdList.reduce((d,h)=>d+(this._trnMainService.nullToZeroConverter(h.AMOUNT)-this._trnMainService.nullToZeroConverter(h.INDDISCOUNT)),0);this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue*a/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(a,d){this.showBatchWiseDetail=!1,this.checkValidation(d)||this.masterService.focusAnyControl("remarks"+d)}RemarksEnterCommand(a,d){if(a.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(d)||this.masterService.focusAnyControl("remarks"+d),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval){let h=d+1;setTimeout(()=>{null!=document.getElementById("alternateunit"+h)&&document.getElementById("alternateunit"+h).focus()},50)}return!1}checkBatchWiseRateinEditMode(){this.batchlist=[];let d="";d=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getPrductMultiplePriceInEdit?mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}&VCHRNO=${this._trnMainService.TrnMainObj.VCHRNO}&warehouse=${d}`).subscribe(h=>{if("ok"===h.status&&(this.batchlist=h.result,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===h.message&&(this.changeBatchWiseRate(h.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=h.result[0].STOCK,this.assignBarcodeWiseMFGEXPDATE(h.result),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=h.result[0].costprice),"SHOWPRICEPOPUP"===h.message&&(this.masterService.PlistTitle="Batch Price Selection",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice=1,this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack&&this.changeBatchWiseRate(h.result[0].RATE)),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()){var p=this.ValidateQtyEDITModeForOUt();if(p&&!p.status)return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=p.userEnterQty,void this.alertService.info(p.message)}})}dblClickPricePopUP(a){let d=this._trnMainService.mulitplePriceItemList.filter(Se=>this._trnMainService.nullToZeroConverter(Se.qty)>0),h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT,P=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,X=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE,oe=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC,Me=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AlternateUnits,Ae=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR;if(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(Se=>0!=this._trnMainService.nullToZeroConverter(Se.ALTERNATEQUANTIY)),null!=d)for(let Se=0;Se<d.length;Se++){let me={Product:{}};me.MCODE=P,me.MENUCODE=X,me.INDDISCOUNT=d[Se].dcamount,me.INDDISCOUNTRATE=d[Se].dcrate,me.ITEMDESC=oe,me.UNIT=h,me.BASEUNIT=p,me.RATE=d[Se].rate,me.ALTRATE=d[Se].rate,me.ALTERNATEQUANTIY=d[Se].qty,me.inputMode=!0,me.CRATE=d[Se].netrate,me.ALTCONFACTOR=Ae,me.Product.AlternateUnits=Me,this._trnMainService.TrnMainObj.ProdList.push(me)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(a){console.log("dblclickpar"),null!=a&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TRNAC=a.ACID,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ACNAME=a.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this._trnMainService.TrnMainObj.PARAC=a.ACID,this._trnMainService.TrnMainObj.BILLTO=a.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=a.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=a.VATNO,this._trnMainService.TrnMainObj.BILLTOMOB=a.MOBILE,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=a.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}onKeydownPreventEdit(a){"Enter"===a.key||"Tab"===a.key||a.preventDefault()}batchKeyDownEvent(){return!1}popUpBatchList(){}MFGDateEnterEvent(a){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(a){return this._trnMainService.TrnMainObj.VoucherType==e.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction||this.checkValidation(a)||this.masterService.focusAnyControl("remarks"+a),!1}AlternateUnitEnterEventClick(a,d){d.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&(document.getElementById("alternateqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&document.getElementById("approvedQty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.Stockadjustment&&document.getElementById("physicalStock"+a).focus()),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1===this.userSetting.GblBarcodeWiseBilling&&null!=this._trnMainService.TrnMainObj.ProdList[a].BC&&""!=this._trnMainService.TrnMainObj.ProdList[a].BC&&void 0!==this._trnMainService.TrnMainObj.ProdList[a].BC&&document.getElementById("rate"+a).focus(),74==this._trnMainService.TrnMainObj.VoucherType&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&null!=this._trnMainService.TrnMainObj.ProdList[a].ALTUNIT&&document.getElementById("alternaetqty"+a).focus(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.REFORDBILL&&document.getElementById("alternateqty"+a).focus()}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discount"+this.activerowIndex).focus(),!1}mrpEnterEvent(a,d){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length&&0==this._trnMainService.TrnMainObj.ProdList[d].ALTUNITObj.RATE_A&&0==this._trnMainService.TrnMainObj.ProdList[d].MRP&&(this.rateValidationDisplayMessage="This Product has 0 selling rate. Please enter selling price. ",this.alertService.warning(this.rateValidationDisplayMessage),this.alertService.emitShowHideSubject.subscribe(h=>{setTimeout(()=>{null!==document.getElementById("newSellingPrice0")&&document.getElementById("newSellingPrice0").focus()},100)}),this._trnMainService.showPriceChangeDetail=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)),this.validateRate(a,d),console.log("clicktab"),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance)null!=document.getElementById("MRP"+d)?document.getElementById("MRP"+d).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath)this.checkValidation(d);else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)"Non-Discountable"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].DISMODE?this.checkValidation(d):null!=document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():document.getElementById("mfgdate"+d).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry)null!=document.getElementById("OrderComment"+this.activerowIndex)&&document.getElementById("OrderComment"+this.activerowIndex).focus();else if(this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry){if(console.log("raktab"),1==this.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(d)}else this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack?this.checkValidation(d):this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue?(console.log("stock issue when batch selected"),this.checkValidation(d)):null!=document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():null!=document.getElementById("remarks"+d)?document.getElementById("remarks"+d).focus():(console.log("foucsmfg"),document.getElementById("mfgdate"+d).focus());return(this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===e.Km.ProductionEntry)&&(this._trnMainService.calculateNetRATE(d),this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),!1}setItemPopupUrl(){console.log("set item popup url",this.userSetting.DefaultFilterIndex);let a=!0,d=!0,h=!0,p=!0,P="STOCK",X=!0,oe=!0,Me=!0,Ae=!1,Se=!0,me=!0,Ve=!0,Ue=!1;this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssueReturn&&(d=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE&&(a=!1,h=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote)&&(p=!1,P="Remaining QTY",Se=!1,1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(Se=!0,Ue=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.IMPORTPOBILLMODE)&&(X=!1,Ae=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived&&0!=this.userSetting.PODELIVERYMODE&&(X=!1),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&(oe=!1),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&(this._trnMainService.TrnMainObj.REFORDBILL?(Ve=!0,Me=!1,Ae=!0):(Ve=!1,Me=!0,Ae=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.REFORDBILL&&(me=!1),this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:Ae,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:a,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:d,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:h,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:p,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:Ve,noSearch:!0},{key:"STOCK",title:P,hidden:Ue,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:me,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:Se,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:X,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:oe,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:Me,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:X,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:Me,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:Ve,noSearch:!0,alignment:"right",pipe:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}ShowProductInsertTableColumns(a,d){let h=this._trnMainService.TrnMainObj.VoucherType,p={};null!=this._trnMainService.TrnMainObj.ProdList&&(p=this._trnMainService.TrnMainObj.ProdList[d]);let P=!1;switch(a){case"BATCH_HEADER":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.Purchase||h===e.Km.OpeningStockBalance||h===e.Km.PurchaseReturn||h===e.Km.SalesReturn||h===e.Km.DebitNote)&&(P=!0);break;case"MENUCODE_HEADER":if(1==this.userSetting.GblBarcodeWiseBilling&&(h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote||h===e.Km.Sales))return!1;(h===e.Km.Purchase||h===e.Km.ReversePurchase||h===e.Km.DebitNote||h===e.Km.OpeningStockBalance)&&(P=!0);break;case"BARCODE_HEADER":if("self-billing"==this.activeurlpath||0==this.userSetting.GblBarcodeWiseBilling)return!1;(h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.Sales||h==e.Km.DebitNote)&&(P=!0);break;case"BATCH_EDITABLE":if("self-billing"==this.activeurlpath)return!0;if(0==this.userSetting.EnableBatch||1==this.userSetting.EnableBatch&&0===this.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.Sales||h===e.Km.Purchase||h===e.Km.OpeningStockBalance||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(P=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(P=!0);break;case"BATCH_NONEDITABLE":((h===e.Km.OpeningStockBalance||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.Quotation||h===e.Km.GoodsReceived)&&!1===p.inputMode||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"MFGDATE_HEADER":case"EXPDATE_HEADER":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"MFGDATE_EDITABLE":case"EXPDATE_EDITABLE":if(0==this.userSetting.EnableBatch)return!1;h===e.Km.ReversePurchase&&(P=!0);break;case"MFGDATE_NONEDITABLE":case"EXPDATE_NONEDITABLE":if(0==this.userSetting.EnableBatch||"add-membership-sales-invoice"==this.activeurlpath)return!1;(h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"QUANTITY_EDITABLE":(h===e.Km.OpeningStockBalance||h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.Purchase||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"QUANTITY_NONEDITABLE":(h===e.Km.OpeningStockBalance||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote||h===e.Km.DebitNote||this._trnMainService.showPerformaApproveReject)&&!1===p.inputMode&&(P=!0);break;case"MRP_NONEDITABLE":case"UNIT_EDITABLE":default:P=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"CONFACTOR":break;case"GST_AMT_NONEDITABLE":(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoice||h===e.Km.TaxInvoiceCancel||h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"COSTPRICE_HEADER":h===e.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||h===e.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||h===e.Km.CreditNote||h===e.Km.OpeningStockBalance||h===e.Km.StockSettlement||h===e.Km.StockIssue||h===e.Km.ReverseCreditNote||(P=!0);break;case"COSTPRICE2_NONEDITABLE":(h===e.Km.Sales||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.SalesReturn)&&(P=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(h===e.Km.PurchaseOrder||h===e.Km.PurchaseOrderCancel||h===e.Km.SalesOrder||h===e.Km.PerformaSalesInvoice||h===e.Km.Quotation||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.DebitNote||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.GoodsReceived||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(P=!0);break;case"SELLINGPRICE2_NONEDITABLE":(h===e.Km.PurchaseOrder||h===e.Km.Purchase||h==e.Km.GoodsReceived)&&(P=!0);break;case"SELLING_HEADER":(h===e.Km.PerformaSalesInvoice||h===e.Km.Quotation||h===e.Km.Purchase||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.GoodsReceived||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.PurchaseOrder||h===e.Km.SalesOrder)&&(P=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this.activeurlpath)return void(P=!1);(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this.activeurlpath)return void(P=!1);(h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.PurchaseReturn||h===e.Km.Sales||h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this.activeurlpath)return void(P=!1);(h===e.Km.PurchaseReturn||h===e.Km.ReversePurchase||h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoiceCancel||h===e.Km.TaxInvoice||h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this.activeurlpath)return void(P=!1);(h===e.Km.PurchaseReturn||h===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.Sales||h===e.Km.ReversePurchase||h===e.Km.SalesReturn||h===e.Km.DebitNote||h===e.Km.CreditNote||h===e.Km.TaxInvoice||h===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||h===e.Km.ReverseCreditNote)&&(P=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":P=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":h===e.Km.OpeningStockBalance&&(P=!0);break;case"OTHER_DIS_HEADER":(h===e.Km.Sales||h===e.Km.SalesReturn||h===e.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||h===e.Km.TaxInvoiceCancel&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(P=!0);break;case"UNIT_NONEDITABLE":(h===e.Km.CreditNote||h===e.Km.DebitNote||h===e.Km.ReverseCreditNote)&&(P=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(P=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(P=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":case"DISCOUNT_IMPORTPURCHASE":(h==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||h==e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(P=!0);break;case"ECS_AMOUNT":1==this.userSetting.ENABLE_ECS?(h==e.Km.Purchase||h==e.Km.GoodsReceived)&&(P=!0):2==this.userSetting.ENABLE_ECS?(h==e.Km.TaxInvoice||h==e.Km.CreditNote)&&(P=!0):3==this.userSetting.ENABLE_ECS&&(h==e.Km.TaxInvoice||h==e.Km.Purchase||h==e.Km.GoodsReceived)&&(P=!0)}return P}assignValueForReturnModeInProd(a){console.log("ineditmode",a),this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.RATE,console.log("prodRAte",a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=a.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==a.MFGDATE?"":a.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==a.EXPDATE?"":a.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=a.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=a.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=a.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=a.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=a.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=a.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),0==a.INDDISCOUNTRATE&&a.INDDISCOUNT>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=100*a.INDDISCOUNT/(a.REALQTY*a.RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=a.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=a.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=a.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=a.ALTCONFACTOR,console.log("RATE",this._trnMainService.TrnMainObj.ProdList,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE),this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(a){this.activerowIndex=a,this.batchlist=[]}validateRate(a,d){if(0==this._trnMainService.nullToZeroConverter(a.ALTRATE))return confirm(" Zero  Rate Entry Detected For Item '"+a.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")?(console.log("reachq"),!1):(document.getElementById("rate"+d).focus(),console.log("reachq"),!0);if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=0;if(h=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this.userSetting.VatConRate:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,h<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE)return this.alertService.warning("Entered rate is less than purchase rate !"),this.alertService.emitShowHideSubject.subscribe(p=>{setTimeout(()=>{null!==document.getElementById("discount"+d)?document.getElementById("discount"+d).focus():document.getElementById("remarks"+d).focus()},0)}),!1}}MRPChangeEvent(a,d){if("goods-received-note"==this.activeurlpath&&"NEW"==this._trnMainService.TrnMainObj.Mode){let h=this.masterService.userProfile.roleRights.find(p=>"ALLOWRATECHANGEINPI"==p.right);0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==h.value&&(this._trnMainService.TrnMainObj.ProdList[d].TEMP_ALTRATE==this._trnMainService.TrnMainObj.ProdList[d].ALTRATE||confirm("PRATE DOEN'T MATCHED WITH PURCHASE ORDER RATE. DO YOU WANT TO PROCEED ANYWAY ?")||(this._trnMainService.TrnMainObj.ProdList[d].ALTRATE=this._trnMainService.TrnMainObj.ProdList[d].TEMP_ALTRATE))}this.validateRate(a,d),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&1===this.userSetting.HALTSPRICECHAGEDASKED&&(this._trnMainService.showPriceChangeDetail=!0,console.log(this._trnMainService.priceChangeList),this._trnMainService.showPriceChangeDetailINDisc=!0,this._trnMainService.getAllSelingPriceOfItem(this.activerowIndex),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},800)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&this.validateCostPrice(),this._trnMainService.TrnMainObj.ProdList[d].UNIT==this._trnMainService.TrnMainObj.ProdList[d].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[d].RATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[d].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[d].RATE=this._trnMainService.TrnMainObj.ProdList[d].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[d].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this.userSetting.VatConRate)),this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder&&this._trnMainService.TrnMainObj.REFORDBILL&&this.checkRateisChangedinSoFromQT()}checkRateisChangedinSoFromQT(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE&&(confirm("Rate is change Do you want to proceed .")||(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE))}BarcodeKeyDownEvent(a,d){}AlternateKeyUp(a,d){}AlternateQuantityEventClick(a,d){var h;if((d.preventDefault(),this.QuantityChangeEvent(a),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&"EDIT"===this._trnMainService.TrnMainObj.Mode&&setTimeout(()=>{document.getElementById("rate"+a).focus()},20),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesReturn)&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DONONSALEABLERETURN)&&(h=this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE),this._trnMainService.TrnMainObj.ProdList[a].STOCK<h))return void this.alertService.warning("Quantity cannot exceed the actual Sales Quantity");(this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn)&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL>0&&this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL<this._trnMainService.ReturnStockReconcile(this._trnMainService.TrnMainObj.ProdList[a].MCODE)?this.alertService.warning("Quantity cannot exceed the minimum stock level"):(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"SHOWPRICEPOPUP"==this._trnMainService.showBatchWiseQtyEntryPopup&&6!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()),console.log("ITEM CHECK eneabletelecomdevices",this.userSetting.EnableTelcomDevices,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[]),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(0,K.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE)||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(1!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE||this._trnMainService.TrnMainObj.VoucherType!==e.Km.CreditNote&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null==this._trnMainService.TrnMainObj.ProdList[a].BC||""==this._trnMainService.TrnMainObj.ProdList[a].BC||null==this._trnMainService.TrnMainObj.ProdList[a].BC)&&this.dialougeOpen()),(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.checkMaxStockLevel(a),10!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==e.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut)&&this.checkReorderStocklevel(a),this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&(this._trnMainService.allowNegativeBilling(this.activerowIndex)||this.checkEnteredProductStock()),this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINCNOTE?this.checkValidation(a):this.focusToRate(a,d)),console.log(this.activeurlpath),"self-billing"===this.activeurlpath&&this.checkValidation(a),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&"self-billing"!==this.activeurlpath&&6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,d),"self-billing"!==this.activeurlpath&&this.focusAfterQuantityClick(),"variant-adjustment"==this.activeurlpath&&(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT?setTimeout(()=>{document.getElementById("adjustbc"+this.activerowIndex).focus()},20):setTimeout(()=>{document.getElementById("adjustbatch"+this.activerowIndex).focus()},20)),this.focusToRate(a,d))}focusAfterQuantityClick(){this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag?0!=this.userSetting.IMPORTPOBILLMODE?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("fcrate"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType!==e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.GoodsReceived||!this._trnMainService.TrnMainObj.REFORDBILL?"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL?document.getElementById("discount"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment&&"variant-adjustment"!==this.activeurlpath?document.getElementById("adjustbatch"+this.activerowIndex).focus():this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType==e.Km.SalesOrder&&0==this.masterService.userProfile.userRights.find(d=>"AllowRateChangeInSO"==d.right)?.value?document.getElementById("discount"+this.activerowIndex).focus():document.getElementById("rate"+this.activerowIndex).focus():document.getElementById("discount"+this.activerowIndex).focus()}checkChildproductEnterQuantity(){console.log("check child product enter quantitiy");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.PMCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PMCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(h=>{a+=h.ROUTQTY}),console.log("total Enter qty",a,"stokc",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n        (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n        Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkSameproductEnterQuantity(){console.log("r2");let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(h=>{a+=h.ROUTQTY}),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT},\n      (-${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex-1].ROUTQTY}   ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PUNIT} ) \n      Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}checkDuplicateproductEnterQuantity(){let a=0;if(this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&h.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&h.BC==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC).forEach(h=>{a+=h.Quantity}),console.log("totalEnterQuantitty",a),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTSTOCK&&9!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE)return this.alertService.info(`Inserted Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity :\n    ${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity)}  \n    Is Greater Than Its Available Stock =${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}`),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0);this._trnMainService.quantityExceedCheck=""}focusToRate(a,d){console.log("FOCUS TO RATE",a,d),d.preventDefault(),this._trnMainService.TrnMainObj.VoucherType===e.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag?document.getElementById("fcrate"+a).focus():this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.disableRateOnPOselect||this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&"self-billing"==this.activeurlpath?document.getElementById("discount"+a).focus():document.getElementById("rate"+a).focus()}newNulltoconverter(){}BaseQuantityEventClick(a,d){d.preventDefault(),this.activerowIndex=a,null!=document.getElementById("mrp"+a)?this.masterService.focusAnyControl("mrp"+a):this.masterService.focusAnyControl("remarks"+a),this.SelectUnit(a,"EACH",d.target.value)}stockCheck(a,d){this.realQty=0,this.realQtyin=0,this.finalRes=0,this.masterService.getStockForCheck(a).subscribe(h=>{if("ok"===h.status){if(this.stockList=h.result,this.stockList.forEach(p=>{this.realQty+=p.RealQty,this.realQtyin+=p.REALQTY_IN}),this.finalRes=this.realQty-this.realQtyin,this._trnMainService.TrnMainObj.TOTALQTY>this.finalRes)return this.alertService.info("Quantity exceed the transaction stock"),void(this._trnMainService.QuantityMsg="GreaterQuantity");this._trnMainService.QuantityMsg=""}else this.alertService.info(h.result)})}checkBatchWiseStockOut(){this.checkBatchWiseEnterStock()||this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n        Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)} \n        ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}, Item : ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} \n        @Qty = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} `)}checkItemTotalQtyWithStock(a,d,h,p,P){let X=0;if(X=1==h?this._trnMainService.TrnMainObj.ProdList.filter(oe=>oe.MCODE==a&&oe.BC==d&&oe.RATE==p).map(oe=>oe.Quantity).reduce((oe,Me)=>oe+Me,0):this._trnMainService.TrnMainObj.ProdList.filter(oe=>oe.MCODE==a&&oe.RATE==p).map(oe=>oe.Quantity).reduce((oe,Me)=>oe+Me,0),X>0)return X>this._trnMainService.TrnMainObj.ProdList[P].STOCK&&9!=this._trnMainService.TrnMainObj.ProdList[P].PTYPE?(this.alertService.info(`Item ${this._trnMainService.TrnMainObj.ProdList[P].ITEMDESC} Entered  Quantity: ${X}  exceed the available stock ${this._trnMainService.TrnMainObj.ProdList[P].STOCK} `),this._trnMainService.quantityExceedCheck="QuantityExceed",void(this._trnMainService.TrnMainObj.ProdList[P].ALTERNATEQUANTIY=0)):void(this._trnMainService.quantityExceedCheck="")}valiadateDuplicateRateItem(a,d,h,p,P){if(console.log("validate duplicate rate item"),0==a&&0==p){let X=this._trnMainService.TrnMainObj.ProdList.filter(oe=>oe.MCODE==d&&oe.RATE==h);if(X&&X?.length>1)return this.alertService.info(`Item:${X[0].ITEMDESC} duplicate rate:${X[0].RATE} is detected.`),void(this._trnMainService.TrnMainObj.ProdList[P].ALTERNATEQUANTIY=0)}}checkBatchWiseStock(){let a=[];this.masterService.getStockBatchWise(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(d=>{"ok"==d.status&&(a=d.result,null!=a&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity>a[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}getBatchWiseDateForNoBill(a){if(this.activerowIndex=a,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH)return!1;this.masterService.masterGetmethod("/batch/getmfgdate?batchCode="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH+"&&selfLife="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SHELFLIFE).subscribe(d=>{"ok"===d.status?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=d.result.mfgdate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=d.result.expdate,this.masterService.focusAnyControl("alternateqty"+a)):this.alertService.info("Invalid BatchCode.Error Details: "+d.message)},d=>{this.alertService.info("Invalid BatchCode.Error Details: "+d)})}onClicked(){this._trnMainService.inputCode=!0}petrolPopup(a){console.log("petrol pump fxn ",a.MRP,a.ISAMOUNTWISEBILL),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&0!=this.masterService.userSetting.EnableAmountWiseBill&&1==a.ISAMOUNTWISEBILL&&(this.PetrolGrid.show(a.MRP,this.activerowIndex),setTimeout(()=>{document.getElementById("modalquant").focus()},50))}dblClickPopupItem(a){console.log("value",a.ISAMOUNTWISEBILL,a);let d=this._trnMainService.TrnMainObj.VoucherType;this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]={};var h=this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,a);if(console.log("duplication",h),0==h)return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(P=>{setTimeout(()=>{document.getElementById("itemDesc"+this.activerowIndex).focus()},0)});if(this.petrolPopup(a),0!=this.ValidateDuplicateItemEntry(a)){if("add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.WRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.WRATE),this._trnMainService.NeedToTakePriceFromMenuItem()&&(d in e.qK&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.RATE),"add-sales-invoice-wholesale"===this.activeurlpath&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.WRATE),d in e.N7&&this._trnMainService.assignProductMasterRate(this.activerowIndex,a.PRATE,a.CONFACTOR)),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE=a.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE=a.ECSRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE=a.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE=a.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ENABLEITEMWISEBATCH=a.ENABLEITEMWISEBATCH,6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isQuantityReadonly=!0),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isPurchaseOrder=!1,("TI"==this._trnMainService.TrnMainObj.VoucherPrefix||"consumption-entry"==this.activeurlpath)&&(null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isBarcodeOfPtypeSix=!0)),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&1==this.userSetting.BATCHWISEPRICE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=a.RATE_A,1==this.userSetting.BATCHWISEPRICE&&1==this.userSetting.ENABLEWSALESRATEBILLING&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=a.In_Rate_B,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=a.RATE_B)),this.focusService.afterEnterFocousItem(a.ISUNKNOWN,this.activerowIndex,this.activeurlpath),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]){this.batchlist=[];let P=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];P.REQEXPDATE=a.REQEXPDATE,P.DISMODE=a.DISMODE,P.PWEIGHT=a.GWEIGHT,P.PROMOTION=0,P.BATCHSCHEME=null,P.ALLSCHEME=null,P.ISVAT=a.ISVAT,P.MENUCODE=a.MENUCODE,P.ITEMDESC=a.DESCA,P.MCODE=a.MCODE,P.WEIGHT=a.GWEIGHT,P.Mcat=a.MCAT,P.BASEUNIT=a.BASEUNIT,P.SHELFLIFE=a.SHELFLIFE,P.Weighable=a.Weighable,P.MRP=a.MRP,P.ALTCONFACTOR=a.CONFACTOR,P.BARCODE=a.BARCODE,P.TOTSTOCK=a.STOCK,P.PSTOCK=a.PSTOCK,P.UNIT=a.BASEUNIT,P.WARRANTY=a.WARRANTY,P.W_MRP=a.W_MRP,P.W_SELLRATEBEFORETAX=a.W_SELLRATEBEFORETAX,P.STOCK=a.STOCK,P.WSRATE_DISCOUNT=a.WSRATE_DISCOUNT,P.MINLEVEL=a.MINLEVEL,P.MAXLEVEL=a.MAXLEVEL,P.ROLEVEL=a.ROLEVEL,P.ROWARN=a.ROWARN,P.MINWARN=a.MINWARN,P.HASVARIANT=a.HASVARIANT,P.Mcat=a.MCAT,P.REMARKS=a.REMARKS,P.PRATE=a.PRATE,P.ISRECURRING=a.ISRECURRING,P.HASCOMMISSIONCHARGE=a.HASCOMMISSIONCHARGE,P.ISAMOUNTWISEBILL=a.ISAMOUNTWISEBILL,P.ISUNKNOWN=a.ISUNKNOWN,1==a.HASVARIANT&&(P.BC=a.BC),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&!(0,K.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SUPCODE=a.SUPCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType in e.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DOFULLRETURN)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales&&"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),this._trnMainService.NeedToTakePriceFromMenuItem()||((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&1===this.userSetting.EnableItemWiseBatch&&1===a.HASBATCH&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseRate(),(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.Sales)&&0===this.userSetting.EnableItemWiseBatch&&1===this.userSetting.EnableBatchWisePrice&&10!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE&&this.checkBatchWiseRate()),this._trnMainService.NeedToTakePriceFromMenuItem()||(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0===this.userSetting.REFBILLCOMPULSORINDNOTE||"self-billing"===this.activeurlpath)&&(this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&10!==a.PTYPE&&9!==a.PTYPE&&((this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice)&&this._trnMainService.TrnMainObj.REFORDBILL||!1===this.itemFromBC(a.HASVARIANT)&&this.checkBatchWiseRate())),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0===this.userSetting.EnableBatchWisePrice&&1===a.HASVARIANT&&this.checkBatchWiseRateSettingZero(),this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1==this.userSetting.EnableContractPrice&&this.getContractPriceandOtherDiscount(),1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE&&this.checkBatchWiseRate(),this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=a.CRATE),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.OpeningStockBalance||"self-billing"===this.activeurlpath?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=a.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=a.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PREV_PRATE=a.PREV_PRATE):(this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&0==this.userSetting.REFBILLCOMPULSORINDNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE)&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1==this.userSetting.REFBILLCOMPULSORINCNOTE&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1==this.userSetting.REFBILLCOMPULSORINDNOTE)&&this.assignValueForReturnModeInProd(a),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.assignRateandQtyLoadFromSO(a),this.assignOrderedDiscount(a)),this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&(this.assignRateandQtyLoadFromSO(a),this.assignOrderedDiscount(a)),this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this.assignOrderedDiscount(a),this.emitReferenceQuantity(),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)&&this.masterService.masterGetmethod(`/getItemWiseVariantAttributes?mcat=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Mcat}&mcode=${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}`).subscribe(oe=>{"ok"==oe.status&&oe.result&&oe.result.length&&(this.matrixItemAtrribute=oe.result,this.matrixitemgrid.show())})}6===a.PTYPE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&(this.getProductColorMcodeWise(),!0===this._trnMainService.hideProductDescriptionPopUp&&(this.showBarCodeDetail=!0),0===this.activerowIndex?this.loadBarCodeRow(this.activerowIndex):6===this.userSetting.EnableTelcomDevices&&this.addNewBarCodeDetailRow(this.activerowIndex))}else this.alertService.warning("Cannot enter duplicate item!")}emitReferenceQuantity(){(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.PODELIVERYMODE||this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag&&0!=this.userSetting.IMPORTPOBILLMODE||(this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder)&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this.onClickItemSelectPopUp.emit({ALTERNATEQTY:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK,RATE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE,BASEUNIT:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT})}dialougeOpen(){console.log("dialouge open ProductDetails",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails),this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open(F.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(h=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote?h?.data:h&&h.data&&h.data.productColorList?h.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else document.getElementById("rate"+this.activerowIndex).focus()},20)})}checkMaxStockLevel(a){0!==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY)>this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL)&&this.alertService.warning("Maximum stock level "+this._trnMainService.TrnMainObj.ProdList[a].MAXLEVEL+" exceeded !")}checkReorderStocklevel(a){var d=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].STOCK)-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY);if(d<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL)){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))return;if(d<this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL))this.alertService.warning("Stock for this item has receded the minimun stock level "+this._trnMainService.TrnMainObj.ProdList[a].MINLEVEL),1===this._trnMainService.TrnMainObj.ProdList[a].MINWARN&&(this._trnMainService.TrnMainObj.ProdList[a].ALTERNATEQUANTIY=0);else{if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL))return;1===this._trnMainService.TrnMainObj.ProdList[a].ROWARN&&this.alertService.warning("Re-Order level "+this._trnMainService.TrnMainObj.ProdList[a].ROLEVEL+" has been reached !")}}}deleteRowBarCodeDetailRow(){confirm("Are you sure you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails[this.barcodeDetailActiverowIndex].splice(this.barcodeDetailActiverowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this.addNewBarCodeDetailRow(this.barcodeDetailActiverowIndex))}ItemIEMI1Click(a,d){}ItemIMEI2Click(a,d){this.addNewBarCodeDetailRow(a)}CancelCommand(){this.showBarCodeDetail=!1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!1}loadBarCodeRow(a){let h={IEMI1:"",IEMI2:""};h.MCODE=0===this.activerowIndex?"":this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,h.Color="",0===this.activerowIndex?(this._trnMainService.TrnMainObj.ProdList[0].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[0].ProductDetails.push(h)):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(h),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}addNewBarCodeDetailRow(a){let p={IEMI1:"",IEMI2:""};p.MCODE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,p.Color="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(p),setTimeout(()=>{null!=document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`)&&document.getElementById(`Color${this.barCodeAdded}${this.barcodeWiseProductIndex}`).focus()},20)}onClickSubmitBarCode(a){this.addSelectedBarCodeWiseItemtoProd()}addSelectedBarCodeWiseItemtoProd(){this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].BASEQUANTITY=this._trnMainService.TrnMainObj.ProdList[this.barcodeWiseProductIndex].ProductDetails.length,this.showBarCodeDetail=!1,document.getElementById("rate"+this.activerowIndex).focus()}getProductPriceBatchWise(a){this.masterService.masterPostmethod("/getBatchwisePurchaseRate",{mcode:this._trnMainService.TrnMainObj.ProdList[a].MCODE}).subscribe(h=>{"ok"==h.status&&(this.batchWisePricList=JSON.parse(h.result),this.batchWisePricList.length>0&&(this._trnMainService.TrnMainObj.ProdList[a].RATE=this.batchWisePricList[0].RATE,this._trnMainService.TrnMainObj.ProdList[a].CRATE=this.batchWisePricList[0].NETRATE,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNT=this.batchWisePricList[0].DCAMOUNT,this._trnMainService.TrnMainObj.ProdList[a].INDDISCOUNTRATE=this.batchWisePricList[0].DCRATE))})}onApplyOldPriceClick(){let a={};if(1==this.userSetting.EnableBatchWisePrice&&(a=this._trnMainService.priceChangeList.filter(d=>0==this._trnMainService.nullToZeroConverter(d.CRATE_A))[0],console.log("INVALID UOM",a),a))return console.log("ERROR"),void this.alertService.warning(`selling price for this item with UOM: ${a.UNIT} cannot be 0, Please enter valid selling rate`);this._trnMainService.showPriceChangeDetail=!1}checkCarriedOnOpeninbgStock(){let h=[];this.masterService.masterGetmethod(`/getBatchWiseOPPreviousItemInfo/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE}/${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH}`).subscribe(p=>{"ok"==p.status&&(h=p.result,h.length>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=h[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=h[0].REALRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=h[0].PREVIOUSINQTY,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isCarriedOnStock=1,this._trnMainService.ReCalculateBillWithNormal(),this.checkValidation(this.activerowIndex)))})}onApplyClickNewPrice(){if(this.validateNewSellingRate()){for(let a of this._trnMainService.priceChangeList)1!=this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AltSellingPrices.find(d=>d.UNIT==a.UNIT).NRATE_A=a.NRATE_A),setTimeout(()=>{this.masterService.focusAnyControl("barcodeField")},0);this._trnMainService.showPriceChangeDetail=!1,console.log("prodlist",this._trnMainService.TrnMainObj.ProdList)}}onCloseClick(){this._trnMainService.showPriceChangeDetail=!1}validateNewSellingRate(){let a={};return a=1==this.userSetting.EnableBatchWisePrice?this._trnMainService.priceChangeList.filter(d=>0==this._trnMainService.nullToZeroConverter(d.NRATE_A))[0]:this._trnMainService.priceChangeList.filter(d=>null==d.NRATE_A||0==d.NRATE_A)[0],!a||(this.alertService.warning(`Invalid new selling price for this item with UOM: ${a.UNIT}, Please enter valid selling rate`),!1)}onChangePurchasePrice(a,d){let h=0,p=0,P=0,X=this._trnMainService.priceChangeList[a];if(null!=X){if(X.UNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let oe=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*this.userSetting.VATRate;X.NRATE_A<=oe&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(P=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE)*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),X.NRATE_A<=P+P*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?(P=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100),X.NRATE_A<=P&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):X.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)&&(h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)),X.NRATE_A<=h&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT){let oe=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE;if(p=oe+oe*this.userSetting.VATRate,X.NRATE_A<=p&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)){let Me=oe+oe*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100);X.NRATE_A<=Me+Me*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?X.NRATE_A<=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):X.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE/this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE)?X.NRATE_A<=h+h*(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):X.NRATE_A<=h&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());setTimeout(()=>{null!==document.getElementById("newWholeSellingPrice0")?document.getElementById("newWholeSellingPrice0").focus():document.getElementById("apply").focus()},0)}this.changeSellingPrice(a),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.priceChangeList[a].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[a].WNRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].W_MRP=this._trnMainService.priceChangeList[a].WNRATE_A,1==this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.PODetailList[a].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[a].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[a].WNRATE_A)}changeSellingPrice(a){for(const d of this._trnMainService.priceChangeList)d.SNO>1&&(d.NRATE_A=d.CONFACTOR*this._trnMainService.priceChangeList[a].NRATE_A,d.WNRATE_A=d.CONFACTOR*this._trnMainService.priceChangeList[a].WNRATE_A)}checkDeuplicateCodeAndRate(){let a=[],d=this._trnMainService.TrnMainObj.ProdList.filter(h=>h.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE);if(null!=d){if(d.length>1){let p=0;for(let P of this._trnMainService.TrnMainObj.ProdList)P.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&a.push(p),p++}let h=1;for(let p of a)(this._trnMainService.TrnMainObj.ProdList[p].RATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE||this._trnMainService.TrnMainObj.ProdList[p].EXPDATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)&&(this._trnMainService.TrnMainObj.ProdList[p].BATCH=`-${h}`),h++}}onClickYes(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}onClickNo(){this.rateValidation.hide(),setTimeout(()=>{document.getElementById("newSellingPrice0").focus()},500)}disableRateandDiscount(a){let d=this._trnMainService.TrnMainObj.ProdList[a];if(this._trnMainService.TrnMainObj.VoucherType===e.Km.SalesOrder){let h=this.masterService.userProfile.userRights.find(p=>"AllowRateChangeInSO"==p.right);if(h&&0==h?.value)return!0}if(this._trnMainService.TrnMainObj.VoucherType==e.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==e.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&0==this._trnMainService.TrnMainObj.DOMANUALSALESRETURN&&this._trnMainService.TrnMainObj.REFBILL&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINCNOTE)return!0;if(("add-purchase-invoice"==this.activeurlpath||"goods-received-note"==this.activeurlpath)&&"NEW"==this._trnMainService.TrnMainObj.Mode){let h=this.masterService.userProfile.roleRights.find(p=>"ALLOWRATECHANGEINPI"==p.right);if(h&&0==this._trnMainService.disableRateOnGRNload&&0!=this.userSetting.PODELIVERYMODE&&1==this.userSetting.RATECHANGE_IN_POBASEPI&&1==h?.value)return!1}return!!(this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN||"VIEW"==d.rowMode||d.isDisabled||this.disableRAteDisandAmt()||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||"purchase-import-order"==this.activeurlpath||this._trnMainService.disableRateOnPOselect||"add-sales-invoice"==this.activeurlpath&&this._trnMainService.TrnMainObj.REFORDBILL||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||this._trnMainService.disableRateOnGRNload||this._trnMainService.TrnMainObj.VoucherType==e.Km.PerformaSalesInvoice&&this._trnMainService.TrnMainObj.REFORDBILL||"self-billing"==this.activeurlpath)}disableRAteDisandAmt(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1!==this._trnMainService.TrnMainObj.DONONSALEABLERETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE||this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINDNOTE}disableDiscount(){return this._trnMainService.TrnMainObj.VoucherType!==e.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.Sales?(this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===e.Km.GoodsReceived)&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.FLATDCAMNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0)&&(this._trnMainService.disableProd=!1,!0):"Non-Discountable"===this._trnMainService.TrnMainObj?.ProdList[this.activerowIndex]?.DISMODE||void 0}checkRepackStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.BATCH===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH&&d.ROUTQTY>d.STOCK)[0];if(null!=a&&null!=a)return this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.PUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.ALTUNIT} `),console.log("repor1"),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}checkEnteredProductStock(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.STOCK&&7!=d.NATURETYPE&&10!=d.PTYPE)[0];if(console.log("prod stock obj",a),null!=a)return console.log("STOCK EXCEEDED"),this.alertService.info(a.BASEUNIT!=a.ALTUNIT?`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} (${a.ALTERNATEQUANTIY} x ${a.ALTCONFACTOR} = ${a.Quantity} ${a.BASEUNIT}) `:`Inserted Quantity Is Greater Than Its Available Stock Qty=${this._trnMainService.nullToZeroConverter(a.STOCK)} ${a.BASEUNIT}, Item : ${a.ITEMDESC} @Qty = ${a.Quantity} ${a.BASEUNIT} `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}),this._trnMainService.ReCalculateBillWithNormal(),!1}getBarodePagedList(){this.barcodeGridSettings=this.masterService.getGenericGridPopUpSettings("barcodeList"),this.barCodeGridPopup.show()}dblClickbarcodePopUP(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC=a.BARCODE,this.ItemBarCodeClick(this.activerowIndex,a)}validateCostPrice(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX&&this.alertService.info("Cost Price is grater than selling pirce")}rateChange(){this.applyPipeInRate=!1}quantityChange(){this.applyPipeInQuantity=!1}rateFocusOut(){this.applyPipeInRate=!0}quantityFocusOut(){this.applyPipeInQuantity=!0}spriceChange(){this.applyPipeInSprice=!1}spriceFocusOut(){this.applyPipeInSprice=!0}AtFocusOut(a,d){6!=this._trnMainService.TrnMainObj.ProdList[a].PTYPE&&this.focusToRate(a,d)}ItemBarCodeFoucusOut(a,d){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(a,d){this.barcodeDisplay=!0}DisAmtclick(){}checkBatchWiseEnterStock(){let a=0;return this._trnMainService.TrnMainObj.ProdList.filter(d=>d.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&d.BATCH==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH).forEach(d=>a+=d.Quantity),console.log("total batch wise qty",a,"stock",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK),a>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK?(this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}FCRATEChangeEvent(a){this._trnMainService.TrnMainObj.ProdList[a].ALTRATE=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[a].INVRATE)*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EXRATE),this._trnMainService.TrnMainObj.ProdList[a].REALRATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[a].RATE=this._trnMainService.TrnMainObj.ProdList[a].ALTRATE/this._trnMainService.TrnMainObj.ProdList[a].ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal()}fcrateEnterEvent(a){this.FCRATEChangeEvent(a),this.masterService.focusAnyControl("discount"+a)}RecalculateMRP(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP}onTabMRP(a,d){a.preventDefault(),this.RecalculateMRP(),document.getElementById("SPRICE"+d).focus()}RecalculateSPRICE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MRP=1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT?1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE,console.log("hit sprice")}onTabSPRICE(a,d){a.preventDefault(),this.RecalculateSPRICE(),null!=document.getElementById("VSRATE"+this.activerowIndex)?document.getElementById("VSRATE"+this.activerowIndex).focus():0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus()}RecalculateVSRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE=(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ISVAT=1)?this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE/1.13:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE}onTabVSRATE(a){a.preventDefault(),this.RecalculateSPRICE(),document.getElementById("VPRATE"+this.activerowIndex).focus()}RecalculateVPRATE(){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VSRATE=1.13*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VPRATE}onTabVPRATE(a,d){a.preventDefault(),this.RecalculateSPRICE(),0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?this.checkValidation(d):document.getElementById("mfgdate"+d).focus()}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBilling=!1,1==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0),this.userRightAuthService.showAuthPopup=!1}OrderComment(a){this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionEntry&&this.checkValidation(a)}confirmAuthorization(){1==this._trnMainService.showNegativeBilling&&this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex),1==this.userRightAuthService.showAuthPopup&&this.DeleteAuthConfirm()}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}disableRate(){return this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType===e.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===e.Km.StockIssue||("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath)&&1==this.userSetting.EnableBatchWisePrice}disableBatch(a){return(2!=this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType!=e.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry)&&(0===a.REQEXPDATE||null===a.REQEXPDATE||void 0===a.REQEXPDATE&&89!=this._trnMainService.TrnMainObj.VoucherType||void 0)}itemFromBC(a){return 1==a&&1==this.loadFromBarcode}disableItemDesc(a){if("EDIT"===this._trnMainService.TrnMainObj.ProdList[a].rowMode?.toUpperCase())return!0;let d=this._trnMainService.TrnMainObj.ProdList[a];return!!(d.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||!0===this._trnMainService.disableOnPerFormaSelect||1===this.userSetting.REFBILLCOMPULSORINCNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)||(1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice?(console.log("disableitemdesc2"),!0):this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)}disableAltUnit(a){let d=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"===d.rowMode||d.isDisabled||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"===this.activeurlpath||"stock-issue-approval"===this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||1===this.userSetting.REFBILLCOMPULSORINCNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE}disableRequestQTY(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval)return!0}disableGridForReqApproval(a){if(this._trnMainService.TrnMainObj.VoucherType===e.Km.RequisitionApproval&&null!=this._trnMainService.TrnMainObj.REFORDBILL)return!0}disableAltQty(a){let d=this._trnMainService.TrnMainObj.ProdList[a];return!!("VIEW"==d.rowMode||d.isDisabled||d.isBarcodeOfPtypeSix||1==this._trnMainService.disableAllFieldinPurchase||d.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||this._trnMainService.disableOnGRNload||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||1===this.userSetting.REFBILLCOMPULSORINCNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.CreditNote||1===this.userSetting.REFBILLCOMPULSORINDNOTE&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType===e.Km.DebitNote||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.IMPORTPOBILLMODE&&this._trnMainService.TrnMainObj.VoucherType===e.Km.Purchase||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&0!==this.userSetting.ENABLE_SOINTI&&this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice)||this._trnMainService.TrnMainObj.VoucherType==e.Km.DebitNote&&1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE}disableAprroveQty(a){if("VIEW"==this._trnMainService.TrnMainObj.ProdList[a].rowMode)return!0}disableBarcodeField(a){return!!(1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.ProdList[a].isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE||null!=this._trnMainService.TrnMainObj.DCRATE&&0!=this._trnMainService.TrnMainObj.DCRATE&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||null!=this._trnMainService.TrnMainObj.FLATDCAMNT&&0!=this._trnMainService.TrnMainObj.FLATDCAMNT&&this._trnMainService.TrnMainObj.VoucherType!==e.Km.DebitNote||this._trnMainService.disableOnPerFormaSelect||"lite"==this.AppMode)}showVATcolumn(){return!(this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag)}showNetAmtHeadercolumn(){return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance}showNetAmtNonEditable(){return this._trnMainService.TrnMainObj.VoucherType!=e.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferIn&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.StockSettlement&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.ProductionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Repack&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.BatchAdjustment&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionEntry&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.RequisitionApproval&&this._trnMainService.TrnMainObj.VoucherType!=e.Km.Stockadjustment&&!(this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT)}showNetAmtEditable(){return this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT}checkBatchSelectionInMultiplePrice(){return 1!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HasMulitplePrice||!!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PriceSelected}checkQuantityInPOdeliveryMode(){console.log("reachdownpodelivery"),null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQT(){null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity>d.POSTOCK)[0]&&(this.alertService.info(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT}\n  exceed the item wise QT Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n  `:`Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} Quantity ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} )\n          exceed the item wise PO Quantity  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK}\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}\n          `),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,this.alertService.emitShowHideSubject.subscribe(d=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()})}))}checkQuantityInSOLoadFromQTin(){if(null!=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity<d.POSTOCK)[0]&&!confirm("Quantity is less than QT stock !Are you sure you want to proceed ? "))return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=0,void document.getElementById("alternateqty"+this.activerowIndex).focus()}checkSaleableQuantityInSalesOrder(){let a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],d=a.ALTUNIT==a.BASEUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTCONFACTOR;this.masterService.getSaleableQTY(a.MCODE,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNDATE,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(h=>{if("ok"==h.status){let p=h.result[0].SALEABLE_SQTY;d>p&&(a.ALTERNATEQUANTIY=0,this._trnMainService.ReCalculateBillWithNormal(),this.alertService.info("Entered qty is greater than its saleable qty:"+p),this.alertService.emitShowHideSubject.subscribe(P=>{setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},0)}))}},h=>{this.alertService.info(h)})}checkQuantityInEditMode(){let a=this._trnMainService.TrnMainObj.ProdList.filter(d=>d.Quantity<d.OUTQTY)[0];null!=a?(this._trnMainService.quantityExceedCheck="QuantityExceed",this.alertService.warning(`Item ${a.ITEMDESC} Quantity exceed the batch wise transaction stock`)):this._trnMainService.quantityExceedCheck=""}assignRateandQtyLoadFromSO(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE,this._trnMainService.TrnMainObj.VoucherType==e.Km.TaxInvoice&&0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=a.PRATE/this.userSetting.VatConRate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=a.PRATE/this.userSetting.VatConRate),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=a.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PORATE=a.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&0!=this.userSetting.ENABLE_SOINTI||this._trnMainService.TrnMainObj.VoucherType===e.Km.PerformaSalesInvoice&&0!=this.userSetting.PERFOMASOBILLMODE?a.OPSTOCK:a.POSTOCK}assignOrderedDiscount(a){this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=a.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=a.INDDISCOUNTRATE}clickOnNetAmount(a){this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.VoucherType===e.Km.TaxInvoice&&1===this.userSetting.ENABLE_NETAMOUNT_EDIT&&this.checkValidation(a)}changeONNetAmount(a,d){this._trnMainService.TrnMainObj.ProdList[a].NETAMOUNT=this._trnMainService.nullToZeroConverter(d.target.value),this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NETAMOUNT)>0&&this._trnMainService.ReverseReCalculateBillWithNormal()}setBatchWiseEditData(a){if(a&&a?.length){let d=a.map(h=>h.ADJUSTQTY).reduce((h,p)=>h+p);this._trnMainService.nullToZeroConverter(d)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=d)}}checkItemQtyExceedBilledQty(){let a=0,d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;return a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?d:d*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,!(a<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY)}checkItemStockINEditModeForOutQty(){let a={},d=0,h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY;if(d=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?h:h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,"EDIT"!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&d>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a;if("EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()){let p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BatchWiseEditList?.map(P=>P.INVOICEQTY).reduce((P,X)=>P+X,0);if(d-p>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.message="Enter Qty exceed the batch wise transaction qty",a}}DeleteAuthConfirm(){this.loader.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this._trnMainService.disAuthObj).subscribe(a=>{this._trnMainService.disAuthObj={username:"",password:"",discount:0,discountType:"0",remarks:""},console.log("Negative stock responee",a),this.loader.hide(),"ok"==a.status?"ALLOW"==a.result?(this.alertService.success("User Right Granted !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1,console.log("ALLOW TO DELETE HERE",this.activerowIndex),(this._trnMainService.TrnMainObj.VoucherType==e.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==e.Km.OpeningStockBalance)&&"EDIT"===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].rowMode?.toUpperCase()&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&this.alertService.info(`Edited Quantity Exceed the transaction stock  for the item:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}.`),confirm(`Are you sure u you want to delete item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}) ?`)&&(this._trnMainService.TrnMainObj.ProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ProdList.length&&this._trnMainService.addRow(),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.quantityExceedCheck="")):(this.alertService.warning("this user has no rights to do delete in  negative stock billing !"),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1):(this.alertService.warning("Authorization Failed, cannot delete."),this._trnMainService.showNegativeBilling=!1,this.userRightAuthService.showAuthPopup=!1)},a=>{this.loader.hide(),this.alertService.info(a)})}ValidateQuantityinEDITMode(){console.log("prdList",this._trnMainService.TrnMainObj.ProdList);let a={},d=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY,p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,P=0;return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?P=h:(P=h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,p/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),0==d&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK)>0&&P<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY-this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BSTOCK?(a.status=!1,a.userEnterQty=p,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a):d>0&&P<this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK?(a.status=!1,a.userEnterQty=p,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n              ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT} \n              ,Exceed the transaction qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TOTALOUTWARDSTOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}   ) ) `,a):void 0}checkBCForMatrxiItem(){this._trnMainService.TrnMainObj.VoucherType===e.Km.BatchAdjustment&&1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASVARIANT&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC||this.alertService.warning(`Variant Details is not selected for Item :${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} `))}ValidateQtyINEditModeFroProduction(a){let d=0;return d=a.BASEUNIT===a.ALTUNIT?a.ALTERNATEQUANTIY:a.ALTERNATEQUANTIY*a.ALTERNATEQUANTIY,!(d<a.OUTQTY&&(this.alertService.info(`Item : ${a.ITEMDESC} entered Qty:${d} ${a.BASEUNIT} is less than transaction Qty:${a.OUTQTY}`),1))}ValidateQtyEDITModeForOUt(){let a={},h=(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EDITABLEQTY),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY),p=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BILLEDQTY,P=0;if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT?P=h:(P=h*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR,p/=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR),console.log("stock",P,this._trnMainService.TrnMainObj.ProdList),P>this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK)return a.status=!1,a.userEnterQty=p,a.message=`Item(${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC}) entered qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY})\n          ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} x ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR} = ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR*this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY} ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}) \n          ,Exceed the Stock qty (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK}  ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT}  ) ) `,a}ValidateDuplicateItemEntry(a){if(this._trnMainService.TrnMainObj.VoucherType in e.NA){let h;return h=this._trnMainService.TrnMainObj.ProdList.filter(p=>p.MENUCODE==a.MENUCODE),!(h.length>0&&1==this.userSetting.DisableDuplicateItemEntry)}}checkRightsForQtyApproval(){return 0!=this.masterService.userProfile.userRights.find(d=>"AllowQuantityApproval"==d.right)?.value}AllowNegativeAuthConfirm(){console.log("AUTH ASEKD")}onUserRightReceived(a){console.log("ebent ma k aaucha",a,this._trnMainService.afterAutoloadCheck),this.alertService.success(a),this.authenticationPopup.hide(),this._trnMainService.TrnMainObj.VoucherType==e.Km.RequisitionApproval&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isConfirmed=!0)}hoverDiscount(a){let d=this._trnMainService.TrnMainObj.ProdList[a];this.stringValue="",this.hoverId=a,console.log("prod discount",d.DISCOUNT),0!==d.DISCOUNT&&(this.stringValue=`<b>Indv Discount </b> : ${d.INDDISCOUNT} <br> <b>Flat Dsicount</b> : ${d.FLATDISCOUNT}`)}hoverLeaveDiscount(a){this.hoverId=null}ReadOnlyForDescription(a){return!(1==this._trnMainService.TrnMainObj.ProdList[a].ISUNKNOWN&&("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath))}}return R.\u0275fac=function(a){return new(a||R)(t.Y36(u.P),t.Y36(V.p),t.Y36(w.R),t.Y36(W.uw),t.Y36(Y.qu),t.Y36(B.gz),t.Y36(N.c),t.Y36(O.e),t.Y36(t.sBO),t.Y36(j.V),t.Y36(x.R),t.Y36(g.T),t.Y36(y.y),t.Y36(L.i))},R.\u0275cmp=t.Xpm({type:R,selectors:[["productentryLite"]],viewQuery:function(a,d){if(1&a&&(t.Gf($.q,5),t.Gf(m.K,5),t.Gf(He,5),t.Gf(Ge,5),t.Gf(at,5),t.Gf(ct,5),t.Gf(lt,5),t.Gf(ht,5),t.Gf(dt,5),t.Gf(ut,5),t.Gf(Tt,5),t.Gf(_t,5)),2&a){let h;t.iGM(h=t.CRH())&&(d.itemListChild=h.first),t.iGM(h=t.CRH())&&(d.batchlistChild=h.first),t.iGM(h=t.CRH())&&(d.genericGridSupplierPopup=h.first),t.iGM(h=t.CRH())&&(d.barCodeGridPopup=h.first),t.iGM(h=t.CRH())&&(d.PetrolGrid=h.first),t.iGM(h=t.CRH())&&(d.genericGridMulitplePricePopup=h.first),t.iGM(h=t.CRH())&&(d.matrixitemgrid=h.first),t.iGM(h=t.CRH())&&(d.itemEditGrid=h.first),t.iGM(h=t.CRH())&&(d.authenticationPopup=h.first),t.iGM(h=t.CRH())&&(d.rateValidation=h.first),t.iGM(h=t.CRH())&&(d.genericGrid=h.first),t.iGM(h=t.CRH())&&(d.focusBatch=h.first)}},hostBindings:function(a,d){1&a&&t.NdJ("keydown",function(p){return d.updown(p)},!1,t.evT)},inputs:{voucherType:"voucherType"},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp",onChangeProductionItem:"onChangeProductionItem",indexEmit:"indexEmit"},decls:82,vars:58,consts:[[2,"margin-right","15px"],[1,"wrapper"],["id","prodlistTableheader",2,"background","silver","color","black"],[4,"ngIf"],["scope","col",2,"width","4%"],[3,"ngStyle"],["style","width: 190px;",3,"ngStyle",4,"ngIf"],["style","width: 50px;",4,"ngIf"],["style","width:100px",3,"ngStyle",4,"ngIf"],["style","width: 95px;",4,"ngIf"],["style","width: 110px;",4,"ngIf"],["style","width:100px",4,"ngIf"],["style","width: 60px;",4,"ngIf"],["style","width: 120px;",4,"ngIf"],["style","width: 90px;",4,"ngIf"],["style","width: 100px;",4,"ngIf"],[3,"ngStyle",4,"ngIf"],["style","width: 15%;",4,"ngIf"],["style","border: 1px;",4,"ngFor","ngForOf"],["class","PList","style","    margin-top: 2%;\nheight: 640px;\nwidth: 78%; ",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],["barCodeGridPopup",""],["genericGridMulitplePricePopup",""],[3,"activerowIndex","matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[3,"BatchWiseEditList","onApplyClicked"],["itemEditGrid",""],[3,"onUserRightReceived"],["authenticationPopup",""],["PetrolGrid",""],["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;height: 370px;\nposition: absolute;right: 20%;top: 5px;width: 50%;z-index: 9999999",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],[2,"width","190px",3,"ngStyle"],[2,"width","50px"],[2,"width","100px",3,"ngStyle"],[2,"width","95px"],[2,"width","110px"],[2,"width","100px"],[2,"width","60px"],[2,"width","120px"],[2,"width","90px"],[2,"width","15%"],[2,"border","1px"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #e6e6e6","width","20px",3,"id"],["style","width: 6%;",4,"ngIf"],["style","width: 10%;",4,"ngIf"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","30%",3,"ngStyle"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["class","CellWithComment","style","height:23px;border: 1px solid #e6e6e6;width:7%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:4%",4,"ngIf"],["width","100px","style","text-align: right; padding-right: 4px !important",4,"ngIf"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9",3,"hidden"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; width: 7rem; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6; text-align: right;",3,"id","mouseover","mouseleave",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;",4,"ngIf"],["id","amntId","style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",3,"change","keydown.Tab","keydown.enter",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px; text-align: right;",4,"ngIf"],["id","vatvalue","style","height:23px;border: 1px solid #e6e6e6;width:100px;text-align: right;",4,"ngIf"],["style","height:23px; border: 1px solid #e6e6e6; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width: 5vw; text-align: right;",3,"id",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:100px",4,"ngIf"],["style","border: 1px solid #e6e6e6;background-color: #f9f9f9;",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",4,"ngIf"],["style","height:23px;border: 1px solid #e6e6e6;width:6.5%",3,"id",4,"ngIf"],[2,"width","6%"],[2,"width","10%"],["autocomplete","off","type","text",2,"width","100%","border","1px solid",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","7%"],["type","text","autocomplete","off","placeholder","Please Enter to Select",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],["focusBatch",""],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","focusout","keydown.Enter","keyup","keypress"],["width","100px",2,"text-align","right","padding-right","4px !important"],["OnlyNumber","true","type","number","autocomplete","off",2,"text-align","right","padding-right","4px !important","width","100%",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","width","7rem","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6"],["type","number","decimalPlacesRestriction","2","min","0","max","100",2,"width","100%","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.enter"],["focusDiscount",""],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%","text-align","right",3,"id","readonly","ngModel","disabled","change","keydown.Tab","keydown.enter","click"],[2,"height","23px","border","1px solid #e6e6e6","text-align","right",3,"id","mouseover","mouseleave"],[2,"display","none",3,"ngClass"],["type","number","decimalPlacesRestriction","2","step","0.01",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],["id","amntId",2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right"],[2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["id","vatvalue",2,"height","23px","border","1px solid #e6e6e6","width","100px","text-align","right"],["type","number","step","0.01",2,"width","100%","text-align","right",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter"],[2,"height","23px","border","1px solid #e6e6e6","width","5vw","text-align","right",3,"id"],[2,"height","23px","border","1px solid #e6e6e6","width","100px"],[3,"ngModel","ngModelChange"],[2,"border","1px solid #e6e6e6","background-color","#f9f9f9"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","ngModelChange","keydown.enter","keydown.Tab"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%"],[2,"height","23px","border","1px solid #e6e6e6","width","6.5%",3,"id"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81DAAC"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","activeurlpath","dbClickEvent","BatchClosedClick","returnBatchValue"],[3,"schemeList","dbClickEvent","schemeCloseClick"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","370px","position","absolute","right","20%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","10px"],[2,"margin-top","4px","margin-bottom","2px"],["type","number",3,"ngModel","ngModelChange"],[2,"font-size","13px","width","32%"],[2,"border-bottom","2px solid #E6E6E6","border-top","2px solid #E6E6E6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","22%"],["scope","col","style","width: 25%;",4,"ngIf"],["scope","col",2,"width","20%"],["scope","col","style","width: 40%;",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],["id","apply",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click","keydown.enter"],["scope","col",2,"width","25%"],["scope","col",2,"width","40%"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["style","border: 1px solid #e6e6e6;",4,"ngIf"],["type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-sm-2",2,"padding","0px"],["type","number","id","Parent","autocomplete","off","readonly","",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"col-md-4",2,"padding","0px","margin-left","0.4rem"],[1,"form-group-row",2,"margin","0.5rem"],[2,"border","2px solid #d9d9d9","width","100%"],[2,"font-size","13px","text-align","left","margin-bottom","3px","width","auto"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],[3,"Blist","HASVARIANT","BatchClosedEmit","dbClickEvent"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(a,d){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"table")(3,"tr",2),t.YNc(4,Vi,2,0,"th",3),t.TgZ(5,"th",4),t._uU(6,"S.No."),t.qZA(),t.YNc(7,Mt,2,0,"th",3),t.YNc(8,pt,2,0,"th",3),t.TgZ(9,"th",5),t._uU(10," Description"),t.qZA(),t.YNc(11,St,2,2,"th",6),t.TgZ(12,"th"),t._uU(13," Unit"),t.qZA(),t.YNc(14,Ui,2,0,"th",7),t.YNc(15,Ki,2,6,"th",8),t.YNc(16,Zi,2,0,"th",9),t.YNc(17,Fi,2,0,"th",10),t.YNc(18,Qi,2,0,"th",10),t.YNc(19,gt,2,0,"th",10),t.YNc(20,ft,2,0,"th",10),t.YNc(21,ke,2,0,"th",11),t.YNc(22,Ye,2,0,"th",10),t.YNc(23,bt,2,0,"th",12),t.YNc(24,Ct,2,0,"th",13),t.YNc(25,Et,2,0,"th",14),t.YNc(26,It,2,4,"th",8),t.YNc(27,At,2,0,"th",12),t.YNc(28,Pt,2,0,"th",13),t.YNc(29,yt,2,0,"th",10),t.YNc(30,Ke,2,0,"th",10),t.YNc(31,xt,2,0,"th",15),t.YNc(32,Lt,2,0,"th",3),t.YNc(33,Rt,2,0,"th",3),t.YNc(34,Fe,2,3,"th",16),t.YNc(35,Nt,2,3,"th",16),t.YNc(36,jt,2,0,"th",17),t.qZA(),t.YNc(37,di,42,50,"tbody",18),t.qZA()()(),t.YNc(38,ui,25,1,"div",3),t.YNc(39,Ti,2,1,"div",19),t.YNc(40,_i,2,6,"div",20),t.YNc(41,Mi,2,1,"div",20),t.YNc(42,pi,2,1,"div",20),t.TgZ(43,"generic-popup-grid",21,22),t.NdJ("onItemDoubleClick",function(p){return d.dblClickPopupItem(p)}),t.qZA(),t.TgZ(45,"generic-popup-grid",21,23),t.NdJ("onItemDoubleClick",function(p){return d.dblClickPopupParty(p)}),t.qZA(),t.TgZ(47,"barcode-popup-grid",21,24),t.NdJ("onItemDoubleClick",function(p){return d.dblClickbarcodePopUP(p)}),t.qZA(),t.TgZ(49,"multiple-price-popup-grid",21,25),t.NdJ("onItemDoubleClick",function(p){return d.dblClickPricePopUP(p)}),t.qZA(),t.TgZ(51,"matrix-item-grid",26,27),t.NdJ("onApplyClicked",function(p){return d.setVariantData(p)}),t.qZA(),t.TgZ(53,"batch-wise-item-edit",28,29),t.NdJ("onApplyClicked",function(p){return d.setBatchWiseEditData(p)}),t.qZA(),t.TgZ(55,"authentication-entry",30,31),t.NdJ("onUserRightReceived",function(p){return d.onUserRightReceived(p)}),t.qZA(),t._UZ(57,"popup-petrol",null,32),t.YNc(59,gi,39,5,"div",33),t.TgZ(60,"div")(61,"div",34,35)(63,"div",36)(64,"div",37)(65,"div",38)(66,"button",39),t.NdJ("click",function(){return d.onClickNo()}),t.TgZ(67,"span",40),t._uU(68,"\xd7"),t.qZA()()(),t.TgZ(69,"div",41)(70,"div",42)(71,"div",43),t._uU(72),t.qZA(),t.TgZ(73,"div",44)(74,"button",45),t.NdJ("click",function(){return d.onClickYes()}),t._uU(75,"Yes"),t.qZA(),t.TgZ(76,"button",46),t.NdJ("click",function(){return d.onClickNo()}),t._uU(77,"No"),t.qZA()()()()()()()(),t.YNc(78,fi,36,4,"div",3),t.YNc(79,bi,2,2,"div",3),t.YNc(80,Ci,2,2,"div",3),t.YNc(81,Ei,25,2,"div",3)),2&a&&(t.xp6(1),t.Udp("height",d.heightChange()+"vh"),t.xp6(3),t.Q6J("ngIf",d.approvalFlag),t.xp6(3),t.Q6J("ngIf",d.ShowProductInsertTableColumns("MENUCODE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("BARCODE_HEADER",0)),t.xp6(1),t.Q6J("ngStyle",24==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType||5==d._trnMainService.TrnMainObj.VoucherType?t.DdM(53,Ii):null)("ngStyle",8==d._trnMainService.TrnMainObj.VoucherType||7==d._trnMainService.TrnMainObj.VoucherType?t.DdM(54,Ai):null)("ngStyle",89==d._trnMainService.TrnMainObj.VoucherType?t.DdM(55,Pi):null)("ngStyle",80==d._trnMainService.TrnMainObj.VoucherType?t.DdM(56,yi):null),t.xp6(2),t.Q6J("ngIf",d.ShowProductInsertTableColumns("BATCH_HEADER",0)),t.xp6(3),t.Q6J("ngIf",90!=d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",24==d._trnMainService.TrnMainObj.VoucherType||14==d._trnMainService.TrnMainObj.VoucherType||15==d._trnMainService.TrnMainObj.VoucherType||41==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||1==d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||(5==d._trnMainService.TrnMainObj.VoucherType||81==d._trnMainService.TrnMainObj.VoucherType)&&1==d.userSetting.BATCHWISEPRICE),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("FCRATE_HEADER",0)),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||37==d._trnMainService.TrnMainObj.VoucherType||16==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"==d._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16===d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("CONFACTOR",0)),t.xp6(1),t.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType||"add-purchase-order"==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("ECS_AMOUNT",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_PER_HEADER",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_AMT_HEADER",0)),t.xp6(1),t.Q6J("ngIf",3==d._trnMainService.TrnMainObj.VoucherType||16===d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",14!=d._trnMainService.TrnMainObj.VoucherType&&16!=d._trnMainService.TrnMainObj.VoucherType&&57!=d._trnMainService.TrnMainObj.VoucherType&&64!=d._trnMainService.TrnMainObj.VoucherType&&74!=d._trnMainService.TrnMainObj.VoucherType&&89!=d._trnMainService.TrnMainObj.VoucherType&&"add-purchase-order"!=d.activeurlpath&&3!=d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("DISCOUNT_IMPORTPURCHASE",0)),t.xp6(1),t.Q6J("ngIf",14==d._trnMainService.TrnMainObj.VoucherType&&1==d.userSetting.EnableServiceCharge),t.xp6(1),t.Q6J("ngIf",d.showVATcolumn()),t.xp6(1),t.Q6J("ngIf",d.showNetAmtHeadercolumn()),t.xp6(1),t.Q6J("ngIf",(3==d._trnMainService.TrnMainObj.VoucherType||37==d._trnMainService.TrnMainObj.VoucherType)&&"IMPORT_PURCHASE"!=d._trnMainService.TrnMainObj.AdditionalObj.tag||31==d._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",d.approvalFlag),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("MFGDATE_HEADER",0)&&"consumption-entry"!==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",d.ShowProductInsertTableColumns("EXPDATE_HEADER",0)&&"consumption-entry"!==d.activeurlpath),t.xp6(1),t.Q6J("ngIf",64==d._trnMainService.TrnMainObj.VoucherType||20==d._trnMainService.TrnMainObj.VoucherType||89==d._trnMainService.TrnMainObj.VoucherType||90==d._trnMainService.TrnMainObj.VoucherType||19==d._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE_ORDER"!=d._trnMainService.TrnMainObj.AdditionalObj.tag),t.xp6(1),t.Q6J("ngForOf",d._trnMainService.TrnMainObj.ProdList),t.xp6(1),t.Q6J("ngIf",d.isProductDetailView),t.xp6(1),t.Q6J("ngIf","itemList"==d.masterService.PlistTitle&&d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","Batch Price Selection"==d.masterService.PlistTitle||"Item Variant Selection"==d.masterService.PlistTitle||"Batch Selection"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","schemelist"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("ngIf","partyPopUp"==d.masterService.PlistTitle),t.xp6(1),t.Q6J("popupsettings",d.gridPopupSettings),t.xp6(2),t.Q6J("popupsettings",d.gridPopupSettingsForSupplier),t.xp6(2),t.Q6J("popupsettings",d.barcodeGridSettings),t.xp6(2),t.Q6J("popupsettings",d.gridPopupSettingsForMultiplePrice),t.xp6(2),t.Q6J("activerowIndex",d.activerowIndex)("matrixItemAtrribute",d.matrixItemAtrribute),t.xp6(2),t.Q6J("BatchWiseEditList",d.BatchWiseEditList),t.xp6(6),t.Q6J("ngIf",d._trnMainService.showPriceChangeDetail&&1==d.userSetting.ShowPriceChangePopup),t.xp6(2),t.Q6J("config",t.DdM(57,xi)),t.xp6(11),t.hij(" ",d.rateValidationDisplayMessage," "),t.xp6(6),t.Q6J("ngIf",d.showDiscountAuth),t.xp6(1),t.Q6J("ngIf",d.showBatchPopup),t.xp6(1),t.Q6J("ngIf",d.showAdjustPopup),t.xp6(1),t.Q6J("ngIf",1==d._trnMainService.showNegativeBilling||1==d.userRightAuthService.showAuthPopup))},dependencies:[D.oB,J.mk,J.sg,J.O5,J.PC,Y.YN,Y.Kr,Y.Fj,Y.wV,Y.EJ,Y.JJ,Y.qQ,Y.Fd,Y.On,E.Zl,U.n,H.F,$.q,m.K,te,de.H,Ce.j,S._v,ge.ed,Ie.t,Re.l,Le.m,je.l,J.JJ,J.uU,Ze.g],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}","table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n}\n\nth[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n  padding: 8px;\n}\n\nth[_ngcontent-%COMP%] {\n  text-align: left;\n  background: #eee;\n  position: sticky;\n  top: 0px;\n}\n\n.wrapper[_ngcontent-%COMP%] {\n  border: 1px solid #ddd;\n  width: 100%;\n  overflow-x: hidden;\n  overflow-y:auto ;\n}\n    .col1[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 10em;\n        left: 0em;\n        top: auto;\n    }\n\n    .col2[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 5em;\n        left: 10em;\n        top: auto;\n    }\n\n    .modal-footer[_ngcontent-%COMP%] {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n        cursor: pointer;\n        position: absolute;\n        top: 10px;\n        right: 10px;\n    }\n\n    .modal-backdrop[_ngcontent-%COMP%] {\n        display: none;\n    }",".modal-content[_ngcontent-%COMP%] {\n        padding: 1px;\n        margin: 0px;\n        float: right;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n        background-color: #f3f5f4;\n        cursor: pointer;\n    }\n\n    tr[_ngcontent-%COMP%] {\n        font-size: 13px;\n    }\n\n    .selected-row[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n        line-height: 30px !important;\n        padding: 3px;\n    }\n\nthead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n        line-height: 5px !important;\n    }\n\n   tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n        text-align: left !important;\n        padding: 0px 0px 0px 11px !important;\n    }\n\n    .modal-content[_ngcontent-%COMP%] {\n        box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n\n    .modal-content-main-area[_ngcontent-%COMP%] {\n        max-height: 100%;\n        height: 94%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .modal-content-summary-area[_ngcontent-%COMP%] {\n        max-height: 20%;\n        height: 20%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .ellipsis[_ngcontent-%COMP%] {\n        white-space: nowrap;\n    }\n\n    .close[_ngcontent-%COMP%] {\n        margin: -9px 0px -9px 0px;\n    }\n\n    .highlighted[_ngcontent-%COMP%] {\n        background-color: #7ed0ff;\n    }\n    .bgforlessstockitem[_ngcontent-%COMP%]{\n        background-color: #ffc107d2;\n    }\n    .tooltipChild[_ngcontent-%COMP%]{\n    display:block !important;\n    background: seagreen;\n    position: absolute;\n    border-radius: 17px;\n    text-align: center;\n    color: white;\n    width: 15%;\n\n  }"]}),R})()},33612:(_e,re,A)=>{A.d(re,{i:()=>C});var t=A(92340),e=A(42326),E=A(64537),m=A(67297),$=A(69389),F=A(7976),S=A(87584),K=A(53074);let C=(()=>{class u{constructor(w,W,Y,B,N){this.authservice=w,this.setting=W,this.arouter=Y,this._trnMainService=B,this.masterService=N,this.AppSettings=W.appSetting,this.userprofile=w.getUserProfile(),this.userSetting=w.getSetting(),this.AppMode=t.N.appMode}afterEnterFocousItem(w,W,Y){this.activerowIndex=W,1!=w||"add-sales-invoice"!=Y&&"abbreviated-sales-invoice"!=Y&&"quotation"!=Y&&"performa-invoice"!=Y&&"salesorder"!=Y?"requisition-entry"==Y?setTimeout(()=>{document.getElementById("alternateQty"+W).focus()},5):(this._trnMainService.allowDescriptionEdit=!1,this.focusAfterItemSelect(W)):(this._trnMainService.allowDescriptionEdit=!0,setTimeout(()=>{document.getElementById("itemDesc"+W).focus()},5))}focusAfterItemSelect(w){2==this.userSetting.EnableBatch||this._trnMainService.TrnMainObj.VoucherType==e.Km.BatchAdjustment?null!=document.getElementById("batch"+w)&&setTimeout(()=>{document.getElementById("batch"+w).focus()},20):(null!=document.getElementById("alternateunit"+w)&&setTimeout(()=>{document.getElementById("alternateunit"+w).focus()},20),74===this._trnMainService.TrnMainObj.VoucherType&&null!=document.getElementById("alternateqty"+w)&&setTimeout(()=>{document.getElementById("alternateqty"+w).focus()},20))}}return u.\u0275fac=function(w){return new(w||u)(E.LFG(m.e),E.LFG($.R),E.LFG(F.gz),E.LFG(S.p),E.LFG(K.P))},u.\u0275prov=E.Yz7({token:u,factory:u.\u0275fac}),u})()},32404:(_e,re,A)=>{A.d(re,{i:()=>C});var t=A(92340),e=A(64537),E=A(67297),m=A(69389),$=A(7976),F=A(87584),S=A(53074),K=A(67311);let C=(()=>{class u{constructor(w,W,Y,B,N,O){this.authservice=w,this.setting=W,this.arouter=Y,this._trnMainService=B,this.masterService=N,this.alertService=O,this.AppSettings=W.appSetting,this.userprofile=w.getUserProfile(),this.userSetting=w.getSetting(),this.AppMode=t.N.appMode}saveClickValidationForUnknownItem(w){let W=w.filter(Y=>1==Y.ISUNKNOWN).find(Y=>null==Y.ITEMDESC||""==Y.ITEMDESC||null==Y.ITEMDESC||""==Y.ITEMDESC?.trim());return!(null==W||!W||(this.alertService.warning("Empty description for item detected, Please enter item description to proceed!!!"),0))}}return u.\u0275fac=function(w){return new(w||u)(e.LFG(E.e),e.LFG(m.R),e.LFG($.gz),e.LFG(F.p),e.LFG(S.P),e.LFG(K.c))},u.\u0275prov=e.Yz7({token:u,factory:u.\u0275fac}),u})()},58349:(_e,re,A)=>{A.d(re,{i:()=>Hr});var t=A(8239),e=A(64537),E=A(20092),m=A(10826),$=A(86363),F=A(41439),S=A(42326),K=A(28698),C=A(25370),u=A(91605),V=A(32265),w=A(92340),W=A(19102),Y=A(67311),B=A(14970),N=A(87584),O=A(53074),j=A(88692);const x=["genericGridProduct"];function g(M,I){if(1&M&&(e.TgZ(0,"option",24),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.s9C("value",i.NAME),e.xp6(1),e.hij(" ",i.NAME," ")}}function y(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div")(1,"div")(2,"div",5)(3,"h4",6),e._uU(4),e.qZA(),e.TgZ(5,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e.TgZ(6,"span",8),e._uU(7,"\xd7"),e.qZA()()(),e.TgZ(8,"fieldset")(9,"div",9)(10,"div",10)(11,"div",11)(12,"label",12),e._uU(13,"Barcode:"),e.qZA(),e.TgZ(14,"input",13),e.NdJ("keydown.Enter",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onBarcodeEnter(s))}),e.qZA()()(),e.TgZ(15,"div",10)(16,"label",12),e._uU(17,"Item :"),e.qZA(),e.TgZ(18,"input",14),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.showItemPopUp())})("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.DESCA=s)}),e.qZA()(),e.TgZ(19,"div",10)(20,"label",12),e._uU(21,"Warehouse :"),e.qZA(),e.TgZ(22,"select",15),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.MWAREHOUSE=s)}),e.YNc(23,g,2,2,"option",16),e.qZA()()()(),e.TgZ(24,"fieldset")(25,"legend",17),e._uU(26,"Details:"),e.qZA(),e.TgZ(27,"div",9)(28,"div",18)(29,"label",12),e._uU(30,"Item Name:"),e.qZA(),e.TgZ(31,"label",19),e._uU(32),e.qZA()(),e.TgZ(33,"div",20)(34,"label",12),e._uU(35,"Shelf :"),e.qZA(),e.TgZ(36,"label",21),e._uU(37),e.qZA()()(),e.TgZ(38,"div",9)(39,"div",18)(40,"label",12),e._uU(41,"Item Price:"),e.qZA(),e.TgZ(42,"label",21),e._uU(43),e.qZA()(),e.TgZ(44,"div",20)(45,"label",12),e._uU(46,"Row :"),e.qZA(),e.TgZ(47,"label",21),e._uU(48),e.qZA()()(),e.TgZ(49,"div",9)(50,"div",18)(51,"label",12),e._uU(52,"MRP :"),e.qZA(),e.TgZ(53,"label",21),e._uU(54),e.qZA()(),e.TgZ(55,"div",20)(56,"label",22),e._uU(57,"Stock:"),e.qZA(),e.TgZ(58,"label",21),e._uU(59),e.qZA()()(),e.TgZ(60,"div",9)(61,"div",23)(62,"label",12),e._uU(63,"Cost-Price:"),e.qZA(),e.TgZ(64,"label",21),e._uU(65),e.qZA()()()()()()}if(2&M){const i=e.oxw();e.xp6(4),e.hij(" ",i.itemInfopopupsettings.title," "),e.xp6(10),e.s9C("value",i.itemWiseInfoObj.BARCODE),e.xp6(4),e.s9C("value",i.itemWiseInfoObj.DESCA),e.Q6J("ngModel",i._trnMainService.TrnMainObj.DESCA),e.xp6(4),e.Q6J("ngModel",i._trnMainService.TrnMainObj.MWAREHOUSE),e.xp6(1),e.Q6J("ngForOf",i.warehouseList),e.xp6(9),e.Oqu(i.itemWiseInfoObj.DESCA),e.xp6(5),e.Oqu(i.itemWiseInfoObj.shelf),e.xp6(6),e.Oqu(i.itemWiseInfoObj.In_Rate_A),e.xp6(5),e.Oqu(i.itemWiseInfoObj.RACK),e.xp6(6),e.Oqu(i.itemWiseInfoObj.MRP),e.xp6(5),e.Oqu(i.itemWiseInfoObj.STOCK),e.xp6(6),e.Oqu(i.itemWiseInfoObj.IN_PRATE_A)}}let L=(()=>{class M{constructor(i,n,s,_,f,Q){this.alertService=i,this.loadingService=n,this._trnMainService=s,this.masterService=_,this.renderer=f,this.elem=Q,this.warehouseList=[],this.showStockedQuantityOnly=0,this.itemWiseInfoObj={},this.isActive=!1,this.gridPopupSettingsForproduct=new W.sG,this.doShowInfoPopup=!0,this.masterService.getWarehouseList().subscribe(ee=>{this.warehouseList=ee})}show(i=!0){this.isActive=!0,this.itemWiseInfoObj={},this.doShowInfoPopup=i}hide(){this.isActive=!1}ngOnInit(){this.gridPopupSettingsForproduct={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/A/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"MENUCODE",title:"PRODUCT CODE",hidden:!1,noSearch:!1},{key:"BASEUNIT",title:"UNIT",hidden:!1,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0},{key:"MRP",title:"MRP",hidden:!1,noSearch:!0,alignment:"right",pipe:!0}]}}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),console.log("info popup close"),this.hide())}showItemPopUp(){this.genericGridProduct.show()}onBarcodeEnter(i){console.log("on barcode enter",i),this.loadingService.show("Getting the item info..."),this.loadingService.hide(),this.masterService.loadItemInfo("",i.target.value,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}onProductSelected(i){console.log("on prodcut select",i.MCODE,i.MENUCODE),this.itemWiseInfoObj.MENUCODE=i.DESCA,this.itemWiseInfoObj.MCODE=i.MCODE,this.itemWiseInfoObj.BASEUNIT=i.BASEUNIT,this.itemWiseInfoObj.STOCK=i.STOCK,this.itemWiseInfoObj.MRP=i.MRP,this.itemWiseInfoObj.BARCODE=i.BARCODE,this.loadingService.show("Getting the item info..."),this.masterService.loadItemInfo(this.itemWiseInfoObj.MCODE,"",this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("info",n),"ok"==n.status?(this.loadingService.hide(),console.log("res information",n.result[0]),this.itemWiseInfoObj.DESCA=n.result[0].DESCA,this.itemWiseInfoObj.MRP=n.result[0].MRP,this.itemWiseInfoObj.In_Rate_A=n.result[0].In_Rate_A,this.itemWiseInfoObj.BARCODE=n.result[0].BARCODE,this.itemWiseInfoObj.STOCK=n.result[0].STOCK,this.itemWiseInfoObj.shelf=n.result[0].shelf,this.itemWiseInfoObj.RACK=n.result[0].RACK,this.itemWiseInfoObj.IN_PRATE_A=n.result[0].IN_PRATE_A):"error2"==n.status&&(this.loadingService.hide(),this.alertService.info(n.result.error.result))},n=>{this.loadingService.hide()})}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(Y.c),e.Y36(B.V),e.Y36(N.p),e.Y36(O.P),e.Y36(e.Qsj),e.Y36(e.SBq))},M.\u0275cmp=e.Xpm({type:M,selectors:[["iteminfo-popup"]],viewQuery:function(i,n){if(1&i&&e.Gf(x,5),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridProduct=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(_){return n.handleKeyDownboardEvent(_)},!1,e.evT)},inputs:{itemInfopopupsettings:"itemInfopopupsettings"},decls:5,vars:4,consts:[[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-135px","width","768px"],[1,"modal-content","modal-content-main-area"],[4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridProduct",""],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"padding-left","5px","font-size","1.2rem"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row"],[1,"col-md-6",2,"margin","5px 0px","display","flex","padding","0px"],["for","type",1,"bold"],["type","text","required","",3,"value","keydown.Enter"],["placeholder","Press Enter to select Item","autocomplete","off","readonly","",1,"col-md-8",3,"ngModel","value","keydown.Enter","ngModelChange"],["id","wh","name","selectedWarehouse",1,"form-control",2,"width","67%","height","23px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[2,"font-size","0.8rem","font-weight","600","width","auto"],[1,"col-7"],["for","type",2,"width","65%","height","auto"],[1,"col-5"],["for","type"],["for","type",1,"bold-stock"],[1,"col-6"],[3,"value"]],template:function(i,n){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,y,66,13,"div",2),e.qZA()(),e.TgZ(3,"generic-popup-grid",3,4),e.NdJ("onItemDoubleClick",function(_){return n.onProductSelected(_)}),e.qZA()),2&i&&(e.ekj("modal-sticky-hide",!n.isActive),e.xp6(2),e.Q6J("ngIf",n.itemInfopopupsettings),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForproduct))},dependencies:[j.sg,j.O5,E.YN,E.Kr,E.Fj,E.EJ,E.JJ,E.On,K.Zl],styles:[".modal-content[_ngcontent-%COMP%] {\n      padding: 1px;\n      margin-right: 65%;\n      float: right;\n      width: 85% !important;\n    }\n\n    .bold[_ngcontent-%COMP%]{\n      font-weight: 600;\n    }\n    .bold-stock[_ngcontent-%COMP%]{\n      font-weight: 600;\n      color:#249e24\n    }\n  \n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n      background-color: #f3f5f4;\n      cursor: pointer;\n    }\n  \n    tr[_ngcontent-%COMP%] {\n      font-size: 11px;\n    }\n  \n    .selected-row[_ngcontent-%COMP%] {\n      background-color: #ced6d3 !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n      line-height: 24px !important;\n      padding: 5px 10px;\n      vertical-align: middle;\n    }\n  \n    .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n      line-height: 5px !important;\n    }\n  \n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n      text-align: left !important;\n      padding: 0px 0px 0px 11px !important;\n    }\n  \n    .modal-content[_ngcontent-%COMP%] {\n      box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n  \n    .modal-content-main-area[_ngcontent-%COMP%] {\n      max-height: 100%;\n      height: 65%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .modal-content-summary-area[_ngcontent-%COMP%] {\n      max-height: 20%;\n      height: 20%;\n      overflow: auto;\n      overflow-x: hidden;\n    }\n  \n    .ellipsis[_ngcontent-%COMP%] {\n      \n      white-space: nowrap;\n    }\n\n    fieldset[_ngcontent-%COMP%] {\n    margin-top: 0.2rem;\n    margin-left: 0.3rem;\n    margin-right: 0.3rem;\n    border: 1px solid black;\n    color: black;\n    \n    background: #f3f5f4;\n    }"]}),M})();class D{}var J=A(16738),U=A.n(J),H=A(49457),G=A(23815),Z=A(38011),te=A(5304),de=A(94612),Ce=A(43190),ge=A(25917),Ie=A(69389),Re=A(54536),Le=A(7976),je=A(67297),Ze=A(28475);const He={alert:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>\n        </svg>\n    ',error:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0V0z" fill="none"/>\n            <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>\n        </svg>\n    ',info:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>\n        </svg>\n    ',success:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" height="24" viewBox="0 0 24 24" width="24">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>\n        </svg>\n    ',warn:'\n        <svg class="simple-notification-svg" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="64" viewBox="0 0 64 64" height="64">\n          <circle cx="32.086" cy="50.142" r="2.256"/>\n          <path d="M30.08 25.012V42.32c0 1.107.897 2.005 2.006 2.005s2.006-.897 2.006-2.005V25.012c0-1.107-.897-2.006-2.006-2.006s-2.006.898-2.006 2.006z"/>\n          <path d="M63.766 59.234L33.856 3.082c-.697-1.308-2.844-1.308-3.54 0L.407 59.234c-.331.622-.312 1.372.051 1.975.362.605 1.015.975 1.72.975h59.816c.705 0 1.357-.369 1.721-.975.361-.603.381-1.353.051-1.975zM5.519 58.172L32.086 8.291l26.568 49.881H5.519z"/>\n        </svg>\n    '};var Ge=A(79765);let at=(()=>{class M{constructor(){this.emitter=new Ge.xQ,this.icons=He}set(i,n){return i.id=i.override&&i.override.id?i.override.id:Math.random().toString(36).substring(3),i.click=new e.vpe,i.timeoutEnd=new e.vpe,this.emitter.next({command:"set",notification:i,add:n}),i}success(i="",n="",s){return this.set({title:i,content:n||"",type:"success",icon:this.icons.success,override:s},!0)}error(i="",n="",s){return this.set({title:i,content:n||"",type:"error",icon:this.icons.error,override:s},!0)}alert(i="",n="",s){return this.set({title:i,content:n||"",type:"alert",icon:this.icons.alert,override:s},!0)}info(i="",n="",s){return this.set({title:i,content:n||"",type:"info",icon:this.icons.info,override:s},!0)}warn(i="",n="",s){return this.set({title:i,content:n||"",type:"warn",icon:this.icons.warn,override:s},!0)}bare(i="",n="",s){return this.set({title:i,content:n||"",type:"bare",icon:"bare",override:s},!0)}create(i="",n="",s="success",_){return this.set({title:i,content:n,type:s,icon:this.icons[s],override:_},!0)}html(i,n="success",s,_="bare"){return this.set({html:i,type:n,icon:this.icons[_],override:s},!0)}remove(i){this.emitter.next(i?{command:"clean",id:i}:{command:"cleanAll"})}}return M.\u0275fac=function(i){return new(i||M)},M.\u0275prov=e.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();var gt=A(74263),ft=A(32404),ke=A(48063),Ye=A(35732);let bt=(()=>{class M{constructor(i,n){this.http=i,this.authService=n,this.apiUrl=w.N.apiUrl}printVoucher(i,n,s,_,f,Q){let ee;return this.getBillFormat(i).pipe((0,de.b)(ne=>(ee=ne.result[0].BILLFORMATS,this.getPrintTitleAsCopy(i,n,s,_))),(0,de.b)(ne=>(f.title=ne.result,this.getPrintFileName(Q,f.COMPANYID,ee))),(0,de.b)(ne=>(f.filename=ne.result[0].FileName,f.rownumber=ne.result?ne.result[0].RowsNumber:0,this.getNumberToWords(i,n,s,f.COMPANYID))),(0,de.b)(ne=>(f.numtowords=ne.result?ne.result[0].NUMTOWORDS:"",this.getAllInvoiceData(f)))).subscribe(ne=>{this.print(ne)})}getBillFormat(i){return this.http.post(this.apiUrl+"/getBillFormat",{voucherno:i})}getPrintTitleAsCopy(i,n,s,_){return this.http.get(this.apiUrl+`/getPrintInvoiceTitleAsCopy?VCHRNO=${i}&DIVISION=${n}&PHISCALID=${s}&TRNUSER=${_}`)}getAllInvoiceData(i){return this.http.post(`${this.apiUrl}/Pdf`,{filename:i.filename,Parameter:{voucherno:i.VCHRNO,rowsnumber:i.rownumber,companyname:i.NAME,companyaddress:i.ADDRESS,division:i.INITIAL,phiscalid:i.PhiscalID,companyid:i.COMPANYID,numtowords:i.numtowords,p1:i.panno1,p2:i.panno2,p3:i.panno3,p4:i.panno4,p5:i.panno5,p6:i.panno6,p7:i.panno7,p8:i.panno8,p9:i.panno9,title:i.title,caption:i.caption,phone1:i.phone1,phone2:i.phone2,email:i.EMAIL,vchrno:i.VCHRNO,PRINTBY:i.PRINTBY,companyemail:i.EMAIL,companyvat:i.COMPANYVAT}},this.getRequestOptionForPdfFile())}getRequestOptionForPdfFile(){return{responseType:"blob",headers:new Ye.WM({Authorization:this.authService.getAuth().token})}}getPrintFileName(i,n,s){const _={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getPrintFileName",{voucherprefix:i,companyid:n,billformats:s},_)}getNumberToWords(i,n,s,_){const f={headers:this.authService.getRequestOption(),method:"post"};return this.http.post(this.apiUrl+"/getNumberToWords",{vchrno:i,division:n,phiscalid:s,companyid:_},f)}print(i){const n=new Blob([i],{type:"application/pdf"}),s=URL.createObjectURL(n),_=document.createElement("iframe");_.style.display="none",_.src=s,document.body.appendChild(_),_.contentWindow.print()}}return M.\u0275fac=function(i){return new(i||M)(e.LFG(Ye.eN),e.LFG(je.e))},M.\u0275prov=e.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();var Ct=A(71800),Et=A(71259);function Je(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_.selectAll=s)})("change",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_.onSelectAllChange(s))}),e.qZA()}if(2&M){const i=e.oxw(2);e.Q6J("ngModel",i.selectAll)}}function It(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortChalanData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function At(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortChalanData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Pt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function yt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Ke(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",29),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function xt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",30),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Lt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"input",28),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.ISSELECTED=s)})("change",function(s){e.CHM(i);const _=e.oxw().$implicit,f=e.oxw(2);return e.KtG(f.onSelectChange(s,_))}),e.qZA()}if(2&M){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ISSELECTED)}}function Rt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td"),e.YNc(2,Lt,1,1,"input",18),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td")(15,"input",31),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.QTY=s)})("change",function(){const _=e.CHM(i).$implicit,f=e.oxw(2);return e.KtG(f.onChangeQty(_))}),e.qZA()()()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(2);e.xp6(2),e.Q6J("ngIf",0!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.REF_VOUCHER),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Oqu(i.DELIVEREDQTY),e.xp6(2),e.Q6J("ngModel",i.QTY)("disabled",2!=s.masterService.userSetting.EnablePartialSalesFromDeliveryChalan||1==s.masterService.userSetting.EnablePetrolPumpFeatures)}}function it(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),e._uU(8,"Customer Name:"),e.qZA(),e.TgZ(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.BILLTO=s)}),e.qZA()(),e.TgZ(10,"div",10)(11,"label"),e._uU(12,"As on Date:"),e.qZA(),e.TgZ(13,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.toDate=s)})("change",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onDateChange())}),e.qZA()(),e.TgZ(14,"div",7)(15,"label"),e._uU(16,"Voucher No:"),e.qZA(),e.TgZ(17,"ng-multiselect-dropdown",12),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.DELIVERYREF=s)})("onSelect",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onSelect(s))})("onDeSelect",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onDeSelect(s))})("onSelectAll",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onSelectAll(s))})("onDeSelectAll",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onDeSelectAll(s))}),e.qZA()(),e.TgZ(18,"div",13)(19,"button",14),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(20," \xd7 "),e.qZA()()()()(),e._UZ(21,"hr"),e.qZA(),e.TgZ(22,"div",15)(23,"table")(24,"thead")(25,"tr",16)(26,"th",17),e.YNc(27,Je,1,1,"input",18),e._uU(28," S.No. "),e.qZA(),e.TgZ(29,"th",19),e._uU(30," Chalan No "),e.YNc(31,It,2,0,"span",20),e.YNc(32,At,2,0,"span",21),e.qZA(),e.TgZ(33,"th",19),e._uU(34," Item Code "),e.YNc(35,Pt,2,0,"span",20),e.YNc(36,yt,2,0,"span",21),e.qZA(),e.TgZ(37,"th",22),e._uU(38," Item Name "),e.YNc(39,Ke,2,0,"span",20),e.YNc(40,xt,2,0,"span",21),e.qZA(),e.TgZ(41,"th",23),e._uU(42,"Unit"),e.qZA(),e.TgZ(43,"th",23),e._uU(44,"Delivered Qty"),e.qZA(),e.TgZ(45,"th",23),e._uU(46,"Billed Qty"),e.qZA()(),e.YNc(47,Rt,16,9,"tr",24),e.qZA(),e._UZ(48,"tbody",25),e.qZA()(),e.TgZ(49,"div",26)(50,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApply())}),e._uU(51,"Apply"),e.qZA(),e.TgZ(52,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReset())}),e._uU(53,"Reset"),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(9),e.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),e.xp6(4),e.Q6J("ngModel",i.toDate),e.xp6(4),e.Q6J("placeholder","Select Voucher")("ngModel",i._trnMainService.TrnMainObj.DELIVERYREF)("settings",i.dropdownSettings)("data",i.vchrDetail),e.xp6(10),e.Q6J("ngIf",0!=i.masterService.userSetting.EnablePartialSalesFromDeliveryChalan),e.xp6(4),e.Q6J("ngIf","asc"==i.chalanSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.chalanSortOrder||!i.chalanSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemNameSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),e.xp6(7),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.SalesDeliveryList)}}let Fe=(()=>{class M{constructor(i,n,s,_){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=_,this.isActive=!1,this.fromDate=new Date,this.vchrDetail=[],this.chalanSortOrder="asc",this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){this.dropdownSettings={singleSelection:!1,selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:2,allowSearchFilter:!0,maxHeight:170};const i=new Date;this.currDate=(0,j.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.vchrDetail=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO)),this.isActive=!0})}sortChalanData(i){this.chalanSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.REF_VOUCHER.localeCompare(s.REF_VOUCHER):(n,s)=>s.REF_VOUCHER.localeCompare(n.REF_VOUCHER))}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.SalesDeliveryList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onSelect(i){this.spinnerService.show("Loading Data..."),this.masterService.getDeliveryChalanProdDetails(i,"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&n.result.forEach(s=>{this.assignInList(s)})),this.checkIsSelected()})}onDeSelect(i){this._trnMainService.TrnMainObj.SalesDeliveryList=this._trnMainService.TrnMainObj.SalesDeliveryList.filter(n=>n.REF_VOUCHER!==i),this.checkIsSelected()}onSelectAll(i){this.spinnerService.show("Loading data..."),this.masterService.getDeliveryChalanProdDetails(i.join(),"FORTI").subscribe(n=>{n&&(this.spinnerService.hide(),"ok"===n.status&&(this._trnMainService.TrnMainObj.SalesDeliveryList=[],n.result.forEach(s=>{this.assignInList(s)}))),this.checkIsSelected()})}onDeSelectAll(i){this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.selectAll=!1}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.SalesDeliveryList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.SalesDeliveryList?.length}assignInList(i){this._trnMainService.TrnMainObj.SalesDeliveryList||(this._trnMainService.TrnMainObj.SalesDeliveryList=[]);let n={};n.REF_VOUCHER=i.VCHRNO,n.MENUCODE=i.MENUCODE,n.BATCH=i.BATCH,n.DELIVEREDQTY=i.ALTERNATEQUANTIY,n.QTY=i.ALTERNATEQUANTIY,n.MCODE=i.MCODE,n.ITEMDESC=i.ITEMDESC,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.ISSELECTED=!0,n.ALTRATE=i.ALTRATE,n.BASEUNIT=i.BASEUNIT,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.SalesDeliveryList.push(n)}onSelectChange(i,n){n.QTY=i.target.checked?n.DELIVEREDQTY:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.QTY=n.DELIVEREDQTY):(n.ISSELECTED=!1,n.QTY=0)})}hide(){this.isActive=!1}onDateChange(){this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[],this.masterService.getDeliveryVoucherList(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{this.vchrDetail=[],i.data.forEach(n=>this.vchrDetail.push(n.VCHRNO))})}onChangeQty(i){i.QTY!==i.DELIVEREDQTY&&(i.ISSELECTED=!1,this.selectAll=!1),i.QTY>i.DELIVEREDQTY&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.DELIVEREDQTY}`),i.QTY=0)}onReset(){this.toDate=this.currDate,this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.SalesDeliveryList=[]}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.SalesDeliveryList.forEach(i=>{let n={};n.ITEMDESC=i.ITEMDESC,n.BATCH=i.BATCH,n.ALTERNATEQUANTIY=i.QTY,n.ALTUNIT=i.ALTUNIT,n.UNIT=i.UNIT,n.BASEUNIT=i.BASEUNIT,n.ALTRATE=i.ALTRATE,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.ALTCONFACTOR=i.ALTCONFACTOR,n.ISVAT=i.ISVAT,n.REFDELIVERYBILL=i.REF_VOUCHER,n.RATE=n.ALTRATE/i.ALTCONFACTOR,n.Product=i.Product,n.INDDISCOUNT=i.INDDISCOUNT,n.INDDISCOUNTRATE=i.INDDISCOUNTRATE,i.QTY>0&&this._trnMainService.TrnMainObj.ProdList.push(n)}),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.MWAREHOUSE="Chalan Warehouse",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.hide()}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(Y.c),e.Y36(B.V),e.Y36(N.p))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-delivery-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"custom-asset-dropdown","w-100",3,"placeholder","ngModel","settings","data","ngModelChange","onSelect","onDeSelect","onSelectAll","onDeSelectAll"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change",4,"ngIf"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","30%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","disabled","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,it,54,14,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.Fj,E.wV,E.Wl,E.JJ,E.On,Et.O],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),M})();function Nt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function jt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",28),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemData("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function wt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("asc"))}),e._uU(1,"\u21c5"),e.qZA()}}function Dt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"span",28),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.sortItemByName("desc"))}),e._uU(1,"\u21c5"),e.qZA()}}function kt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"input",17),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ISSELECTED=s)})("change",function(s){const f=e.CHM(i).$implicit,Q=e.oxw(2);return e.KtG(Q.onSelectChange(s,f))}),e.qZA(),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td")(13,"input",29),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ALTERNATEQUANTIY=s)})("change",function(){const _=e.CHM(i).$implicit,f=e.oxw(2);return e.KtG(f.onChangeQty(_))}),e.qZA()()()}if(2&M){const i=I.$implicit,n=I.index;e.xp6(2),e.Q6J("ngModel",i.ISSELECTED),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Oqu(i.ALTQTY_IN),e.xp6(2),e.Q6J("ngModel",i.ALTERNATEQUANTIY)}}function Vt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),e._uU(8,"Supplier Name:"),e.qZA(),e.TgZ(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.BILLTO=s)}),e.qZA()(),e.TgZ(10,"div",10)(11,"label"),e._uU(12,"As on Date:"),e.qZA(),e.TgZ(13,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.toDate=s)})("change",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onDateChange())}),e.qZA()(),e.TgZ(14,"div",12)(15,"button",13),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(16," \xd7 "),e.qZA()()()()(),e._UZ(17,"hr"),e.qZA(),e.TgZ(18,"div",14)(19,"table")(20,"thead")(21,"tr",15)(22,"th",16)(23,"input",17),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.selectAll=s)})("change",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onSelectAllChange(s))}),e.qZA(),e._uU(24," S.No. "),e.qZA(),e.TgZ(25,"th",18),e._uU(26," Item Code "),e.YNc(27,Nt,2,0,"span",19),e.YNc(28,jt,2,0,"span",20),e.qZA(),e.TgZ(29,"th",21),e._uU(30," Item Name "),e.YNc(31,wt,2,0,"span",19),e.YNc(32,Dt,2,0,"span",20),e.qZA(),e.TgZ(33,"th",22),e._uU(34,"Unit"),e.qZA(),e.TgZ(35,"th",22),e._uU(36,"Approved Qty"),e.qZA(),e.TgZ(37,"th",22),e._uU(38,"Order Qty"),e.qZA()(),e.YNc(39,kt,14,7,"tr",23),e.qZA(),e._UZ(40,"tbody",24),e.qZA()(),e.TgZ(41,"div",25)(42,"button",26),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApply())}),e._uU(43,"Apply"),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(9),e.Q6J("ngModel",i._trnMainService.TrnMainObj.BILLTO),e.xp6(4),e.Q6J("ngModel",i.toDate),e.xp6(10),e.Q6J("ngModel",i.selectAll),e.xp6(4),e.Q6J("ngIf","asc"==i.itemSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemSortOrder||!i.itemSortOrder),e.xp6(3),e.Q6J("ngIf","asc"==i.itemNameSortOrder),e.xp6(1),e.Q6J("ngIf","desc"==i.itemNameSortOrder||!i.itemNameSortOrder),e.xp6(7),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.AdditionProdList)}}let Ut=(()=>{class M{constructor(i,n,s,_){this.masterService=i,this.alertService=n,this.spinnerService=s,this._trnMainService=_,this.isActive=!1,this.itemSortOrder="asc",this.itemNameSortOrder="asc"}ngOnInit(){const i=new Date;this.currDate=(0,j.p6)(i,"yyyy-MM-dd","en-US"),this.toDate=this.currDate}show(){this.isActive=!0,this.spinnerService.show("Loading data...."),this._trnMainService.TrnMainObj.AdditionProdList=[],this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}pushToList(i){null==this._trnMainService.TrnMainObj.AdditionProdList&&(this._trnMainService.TrnMainObj.AdditionProdList=[]);let n={};n.ALTCONFACTOR=i.ALTCONFACTOR,n.ALTERNATEQUANTIY=i.ALTERNATEQUANTIY,n.ALTUNIT=i.ALTUNIT,n.CRATE=i.CRATE,n.ALTRATE=i.CRATE,n.RATE=n.ALTRATE/n.ALTCONFACTOR,n.ITEMDESC=i.ITEMDESC,n.MCODE=i.MCODE,n.MENUCODE=i.MENUCODE,n.UNIT=i.BASEUNIT,n.BASEUNIT=i.BASEUNIT,n.WAREHOUSE=i.WAREHOUSE,n.ISSELECTED=!0,n.Product=i.Product,n.ALTQTY_IN=i.ALTERNATEQUANTIY,n.ISVAT=i.VAT,n.MRP=i.MRP,this._trnMainService.TrnMainObj.AdditionProdList.push(n)}onDateChange(){this.spinnerService.show("Loading data...."),this.masterService.getRequisitionListForPO(this._trnMainService.TrnMainObj.PARAC,this.toDate).subscribe(i=>{"ok"==i.status&&(this.spinnerService.hide(),this._trnMainService.TrnMainObj.AdditionProdList=[],i.result.forEach(n=>this.pushToList(n))),this.checkIsSelected()},i=>{this.spinnerService.hide()})}hide(){this.isActive=!1}sortItemData(i){this.itemSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.MENUCODE.localeCompare(s.MENUCODE):(n,s)=>s.MENUCODE.localeCompare(n.MENUCODE))}sortItemByName(i){this.itemNameSortOrder="asc"==i?"desc":"asc",this._trnMainService.TrnMainObj.AdditionProdList.sort("asc"==i?(n,s)=>n.ITEMDESC.localeCompare(s.ITEMDESC):(n,s)=>s.ITEMDESC.localeCompare(n.ITEMDESC))}onChangeQty(i){i.ALTERNATEQUANTIY!==i.ALTQTY_IN&&(i.ISSELECTED=!1,this.selectAll=!1),i.ALTERNATEQUANTIY>i.ALTQTY_IN&&(this.alertService.info(`Entered quantity cannot be greater than Delivered Qty: ${i.ALTQTY_IN}`),i.ALTERNATEQUANTIY=0)}checkIsSelected(){this.selectAll=!this._trnMainService.TrnMainObj.AdditionProdList?.find(i=>!i.ISSELECTED)&&0!=this._trnMainService.TrnMainObj.AdditionProdList?.length}onSelectChange(i,n){n.ALTERNATEQUANTIY=i.target.checked?n.ALTQTY_IN:0,this.checkIsSelected()}onSelectAllChange(i){this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.target.checked?(n.ISSELECTED=!0,n.ALTERNATEQUANTIY=n.ALTQTY_IN):(n.ISSELECTED=!1,n.ALTERNATEQUANTIY=0)})}onApply(){this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.ProdList=(0,G.cloneDeep)(this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.callPipe=!this._trnMainService.callPipe,this.hide()}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(Y.c),e.Y36(B.V),e.Y36(N.p))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-requisition-select-popup"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row","mt-2"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-4",2,"display","flex","align-items","baseline"],[1,"w-50"],["type","text","readonly","",1,"w-100",3,"ngModel","ngModelChange"],[1,"col-md-3",2,"display","flex","align-items","baseline"],["type","date",3,"ngModel","ngModelChange","change"],[1,"col-md-1"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"col-md-12","table-style"],[2,"background","#eeeeee","color","black"],["scope","col",2,"width","10%"],["type","checkbox",3,"ngModel","ngModelChange","change"],[2,"width","15%"],["class","arrow up",3,"click",4,"ngIf"],["class","arrow down",3,"click",4,"ngIf"],[2,"width","45%"],[2,"width","10%"],[4,"ngFor","ngForOf"],[2,"border","1px"],[1,"col-md-12","d-flex","justify-content-end"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"arrow","up",3,"click"],[1,"arrow","down",3,"click"],["type","number",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,Vt,44,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.Fj,E.wV,E.Wl,E.JJ,E.On],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:85%;top:23%;left:11%;height:75vh;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}.table-style[_ngcontent-%COMP%]{height:61vh;overflow-y:auto;overflow-x:hidden}span[_ngcontent-%COMP%]{cursor:pointer}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}.ustom-asset-dropdown[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}select[_ngcontent-%COMP%]{width:75%}  .selected-item{max-width:200px!important}  .dropdown-btn{padding:3px 4px!important}  .multiselect-dropdown{font-size:12px!important}  .filter-textbox{padding:3px 10px!important}  .dropdown-multiselect__caret{width:32px!important;height:30px!important}"]}),M})();var Bt=A(71180);let Kt=(()=>{class M{constructor(i,n){this.http=i,this.state=n;const s=this.state.getGlobalSetting("apiUrl");s&&s.length>0&&(this.apiUrl=s)}loadAdditionalCostDetailsInImportPI(i){return this.http.get(this.apiUrl+`/loadAdditionalCostDetailsInImportPI?vchrno=${i}`)}}return M.\u0275fac=function(i){return new(i||M)(e.LFG(Ye.eN),e.LFG(Bt.q))},M.\u0275prov=e.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const Zt=["genericGridCreditAccount"];function Ft(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",45),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.ok())})("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.ok())}),e._uU(1,"OK"),e.qZA()}if(2&M){const i=e.oxw(2);e.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode||"EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Qt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.saveImportDetails())}),e._uU(1,"SAVE"),e.qZA()}if(2&M){const i=e.oxw(2);e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode)}}function Ht(M,I){1&M&&e._UZ(0,"option",57),2&M&&e.Q6J("value",I.$implicit.ITEMDESC)}function Gt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr",47),e.NdJ("click",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.rowClick(_))})("keydown.Shift.delete",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.deleteRow(_))}),e.TgZ(1,"td",48),e._uU(2),e.qZA(),e.TgZ(3,"td",49)(4,"input",50),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ITEMNAME=s)})("keydown.Enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.masterservice.focusAnyControl("importQty"+_))})("focus",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.rowClick(_))}),e.qZA(),e.TgZ(5,"datalist",51),e.YNc(6,Ht,1,1,"option",52),e.qZA()(),e.TgZ(7,"td",53)(8,"input",54),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.QUANTITY=s)})("keydown.Enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.masterservice.focusAnyControl("importTaxable"+_))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onQuantityChange())}),e.qZA()(),e.TgZ(9,"td",53)(10,"input",55),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.TAXABLE=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.masterservice.focusAnyControl("importNonTaxable"+_))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onTaxableChange())}),e.qZA()(),e.TgZ(11,"td",53)(12,"input",55),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.NONTAXABLE=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.masterservice.focusAnyControl("importVAT"+_))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onNonTaxableChange())}),e.qZA()(),e.TgZ(13,"td",53)(14,"input",55),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.VAT=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.masterservice.focusAnyControl("importNetmant"+_))})("change",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.onVatChange())}),e.qZA()(),e.TgZ(15,"td",53)(16,"input",56),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.NETAMOUNT=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.nextRow(_))})("keydown.tab",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.nextRow(_))}),e.qZA()()()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.MGl("id","importItemname",n,""),e.Q6J("ngModel",i.ITEMNAME)("disabled","EDIT"==s.tranMode),e.xp6(2),e.Q6J("ngForOf",s.productList),e.xp6(2),e.MGl("id","importQty",n,""),e.Q6J("ngModel",i.QUANTITY)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importTaxable",n,""),e.Q6J("ngModel",i.TAXABLE)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importNonTaxable",n,""),e.Q6J("ngModel",i.NONTAXABLE)("disabled","EDIT"==s.tranMode),e.xp6(2),e.MGl("id","importVAT",n,""),e.Q6J("ngModel",i.VAT)("disabled",!0),e.xp6(2),e.MGl("id","importNetmant",n,""),e.Q6J("ngModel",i.NETAMOUNT)("disabled","EDIT"==s.tranMode)}}function qe(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),e._uU(4,"IMPORT DOCUMENT DETAILS"),e.qZA(),e.TgZ(5,"div",7),e.YNc(6,Ft,2,1,"button",8),e.TgZ(7,"button",9),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onclear())})("keydown.F3",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onclear())}),e._uU(8,"RESET"),e.qZA(),e.YNc(9,Qt,2,2,"button",10),e.TgZ(10,"button",11),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(11,"CANCEL"),e.qZA()()(),e.TgZ(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16)(17,"span",17),e._uU(18,"Import Document No:"),e.qZA(),e.TgZ(19,"div",18)(20,"input",19,20),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO=s)}),e.qZA()()(),e.TgZ(22,"div",16),e._uU(23),e.TgZ(24,"fieldset",21)(25,"legend",22)(26,"input",23),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s)})("change",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=s.target.checked?1:0)}),e.qZA(),e._uU(27,"Do Accounting of VAT Amount"),e.qZA(),e.TgZ(28,"div",14)(29,"span",24),e._uU(30,"VAT Credit A/C:"),e.qZA(),e.TgZ(31,"div",25)(32,"input",26),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=s)})("keydown.Enter",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.AccountEnterCommand(s))}),e.qZA()()()()()(),e.TgZ(33,"div",27)(34,"div",16)(35,"span",28),e._uU(36,"L/C No.:"),e.qZA(),e.TgZ(37,"div",18)(38,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM=s)}),e.qZA()(),e.TgZ(39,"div",30)(40,"button",31),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadImportDetails())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadImportDetails())}),e._uU(41,"LOAD INVOICE DETAIL"),e.qZA()()(),e.TgZ(42,"div",16)(43,"span",28),e._uU(44,"Declare VAT:"),e.qZA(),e.TgZ(45,"div",18)(46,"input",32),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT=s)})("keydown.enter",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onDeclareVat(s.target.value))})("input",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onDeclareVat(s.target.value))}),e.qZA()(),e.TgZ(47,"div",30)(48,"button",31),e.NdJ("keydown.Enter",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadAdditionalCost())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.loadAdditionalCost())}),e._uU(49,"LOAD FROM ADDITIONAL COST"),e.qZA()()()()(),e.TgZ(50,"div",14)(51,"label",33),e._uU(52,"Import Details "),e.qZA()(),e.TgZ(53,"div",14)(54,"div",34)(55,"table",35)(56,"thead")(57,"tr",36)(58,"th",37),e._uU(59,"Sn."),e.qZA(),e.TgZ(60,"th",38),e._uU(61,"Item Name"),e.qZA(),e.TgZ(62,"th",39),e._uU(63,"Qty"),e.qZA(),e.TgZ(64,"th",39),e._uU(65,"Taxable"),e.qZA(),e.TgZ(66,"th",39),e._uU(67,"Non-Taxable"),e.qZA(),e.TgZ(68,"th",39),e._uU(69,"VAT"),e.qZA(),e.TgZ(70,"th",39),e._uU(71,"Net amount"),e.qZA()()(),e.TgZ(72,"tbody",40),e.YNc(73,Gt,17,20,"tr",41),e.qZA()()()(),e.TgZ(74,"div",14)(75,"table",35)(76,"tr",42)(77,"th",43),e._uU(78,"TOTAL"),e.qZA(),e.TgZ(79,"th",44),e._uU(80),e.qZA(),e.TgZ(81,"th",44),e._uU(82),e.qZA(),e.TgZ(83,"th",44),e._uU(84),e.qZA(),e.TgZ(85,"th",44),e._uU(86),e.qZA(),e.TgZ(87,"th",44),e._uU(88),e.qZA()()()()()()()()}if(2&M){const i=e.oxw();e.xp6(6),e.Q6J("ngIf","NEW"==i._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngIf","VIEW"==i._trnMainService.TrnMainObj.Mode),e.xp6(11),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)("disabled","EDIT"==i.tranMode),e.xp6(3),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport," "),e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)("disabled","EDIT"==i.tranMode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME)("disabled","EDIT"==i.tranMode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)("disabled","EDIT"==i.tranMode),e.xp6(2),e.Q6J("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(6),e.Q6J("ngModel",i._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)("disabled","EDIT"==i.tranMode),e.xp6(2),e.Q6J("disabled",null==i._trnMainService.TrnMainObj.ProdList[0].MENUCODE)("disabled","EDIT"==i._trnMainService.TrnMainObj.Mode),e.xp6(25),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),e.xp6(7),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALQTY," "),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE," "),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE,""),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,""),e.xp6(2),e.hij(" ",i._trnMainService.TrnMainObj.IMPORTDETAILS.NETAMOUNT,"")}}let Yt=(()=>{class M{constructor(i,n,s,_,f,Q){this.masterservice=i,this._trnMainService=n,this.spinnerService=s,this.alertservice=_,this.authservice=f,this.importPurchaseService=Q,this.productList=[],this.importrowindex=0,this.DoVatAmtAccountForImport=!0,this.loadFromAdditionalCost=!1,this.genericGridCreditAccountSetting=new K.im,this.userSetting=this.authservice.getSetting(),null==n.TrnMainObj.IMPORTDETAILS&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={})}onclear(){this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.masterservice.allowAddNextRow=!0,this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1,this.addRow()}closeDialog(){"NEW"==this._trnMainService.TrnMainObj.Mode?this._trnMainService.TrnMainObj?.IMPORTDETAILS?.prodList?.filter(i=>i.ITEMNAME)?.length>0?confirm("Applied Import Details will be removed. Click OK to confirm!")&&(this.onclear(),this.isActive=!1):(this.onclear(),this.isActive=!1):this.isActive=!1}show(){this.isActive=!0,setTimeout(()=>{document.getElementById("documentno").focus()},500),(!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList||!this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length||null==this._trnMainService.TrnMainObj.IMPORTDETAILS)&&(this._trnMainService.TrnMainObj.IMPORTDETAILS={},this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.addRow()),this.productList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.MENUCODE),console.log("product list",this.productList)}hide(){this.isActive=!1}ok(){if(console.log("IMPORTDETAILS",this._trnMainService.TrnMainObj.IMPORTDETAILS),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=this.DoVatAmtAccountForImport?1:0,("NEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode)&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C")}this.isActive=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}addRow(){try{console.log("add row"),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push({})}catch(n){console.log(n),alert(n)}}rowClick(i){this.importrowindex=i}focusToQty(){let i=this.importrowindex;setTimeout(()=>{document.getElementById("importQty"+i).focus()},200);var n=this.masterservice.groupBy(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList,function(s){return[s.ITEMNAME]});for(const s of n)if(s.length>1)return void this.alertservice.warning("Cannot enter same item")}nextRow(i){if(""==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].ITEMNAME)return void this.alertservice.info("Item Description is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].QUANTITY))return void this.alertservice.info("Quantity is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NONTAXABLE)){if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].TAXABLE))return void this.alertservice.info("Taxable amount is missing");if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].VAT))return void this.alertservice.info("Vat amount is missing")}if(0==this.masterservice.nullToZeroConverter(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[i].NETAMOUNT))return void this.alertservice.info("Net Amount is missing");this.RecalculateImportDetails();let n=this.importrowindex+1;1==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),this.addRow(),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200)),0==this.masterservice.allowAddNextRow&&(console.log("allow add next row is false",this.masterservice.allowAddNextRow),setTimeout(()=>{document.getElementById("importItemname"+n).focus()},200))}enterName(i){setTimeout(()=>{document.getElementById("importQty"+i).focus()},200)}RecalculateImportDetails(){try{this._trnMainService.TrnMainObj.IMPORTDETAILS&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this._trnMainService.calculateImportProdTotalValue()}catch(i){this.alertservice.info("Error in import details calculation: "+i)}}initializeTotalCalcProperty(){}onNonTaxableChange(){this.RecalculateImportDetails()}onTaxableChange(){this.RecalculateImportDetails()}onVatChange(){this.RecalculateImportDetails()}onQuantityChange(){this.RecalculateImportDetails()}deleteRow(i){confirm("Are you sure you want to delete this row ?")&&(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.splice(i,1),0===this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length&&this.addRow())}loadImportDetails(){this.loadFromAdditionalCost=!1,this.masterservice.allowAddNextRow=!1,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.initializeTotalCalcProperty();for(const i of this._trnMainService.TrnMainObj.ProdList){let n={};n.ITEMNAME=i.ITEMDESC,n.QUANTITY=i.Quantity,n.VAT=1==i.ISVAT?(i.AMOUNT-i.DISCOUNT)*this.userSetting.VATRate:0,n.TAXABLE=0,n.NONTAXABLE=0,n.ISVAT=i.ISVAT,1==i.ISVAT&&(n.TAXABLE=i.AMOUNT-i.DISCOUNT),0==i.ISVAT&&(n.NONTAXABLE=i.AMOUNT-i.DISCOUNT),n.NETAMOUNT=n.TAXABLE+n.NONTAXABLE+n.VAT,this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(n),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList),this._trnMainService.calculateImportProdTotalValue()}this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}onDeclareVat(i){this.loadFromAdditionalCost?this.calculationForLoadFromAdditionalCost(this.loadFromAdditionalCostResponse):this.loadImportDetails(),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.filter(n=>1==n.ISVAT).forEach(n=>{n.VAT=this._trnMainService.nullToZeroConverter(Number((this._trnMainService.nullToZeroConverter(n.TAXABLE)/this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE*i).toFixed(2))),n.TAXABLE=this._trnMainService.nullToZeroConverter(n.VAT)/this.masterservice.userSetting.VATRate,n.NETAMOUNT=this._trnMainService.nullToZeroConverter(n.TAXABLE)+n.VAT}),this.adjustDifferenceInDeclareVatAndActualVat(),this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.AdditionalObj.VATAMNT=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT,this._trnMainService.TrnMainObj.AdditionalObj.TAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALTAXABLE,this._trnMainService.TrnMainObj.AdditionalObj.NONTAXABLE=this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALNONTAXABLE}adjustDifferenceInDeclareVatAndActualVat(){const i=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.map(f=>f.VAT).reduce((f,Q)=>f+Q,0),n=Number((i-this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT).toFixed(2));let s=0,_=0;for(let f of this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)1==f.VAT&&(_=s),s++;if(Math.abs(n)>0){const Q=this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[_];Q.VAT=Number(n<0?(Q.VAT+Math.abs(n)).toFixed(2):(Q.VAT-n).toFixed(2))}}removeInvalidRowFromImportDetils(i){return i.filter(n=>null!=n.ITEMNAME&&null!=n.ITEMNAME)}saveImportDetails(){if("VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.length>0&&this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList[0].ITEMNAME){if(""===this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return void this.alertservice.info("Please enter import document no.");if((""===this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC||null==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC)&&1===this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport)return void this.alertservice.info("Please select VAT Credit A/C");if(this._trnMainService.TrnMainObj.IMPORTDETAILS.TOTALVAT!=this._trnMainService.TrnMainObj.IMPORTDETAILS.DECLAREVAT)return void this.alertservice.info("Declare vat and Total Vat amount is  not equall")}this.spinnerService.show("Saving import details....."),this._trnMainService.TrnMainObj.IMPORTDETAILS.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,this.masterservice.saveImportDetail(this._trnMainService.TrnMainObj.IMPORTDETAILS).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.alertservice.success("Import details saved Successfully !"),setTimeout(()=>{this.hide()},1200)):(this.spinnerService.hide(),this.alertservice.error(i.result))},i=>{this.spinnerService.hide(),this.alertservice.error(i)})}AccountEnterCommand(i){this.genericGridCreditAccountSetting={title:"Accounts",apiEndpoints:"/getAccountPagedListByMapId/Master/default",defaultFilterIndex:1,columns:[{key:"ACCODE",title:"AC CODE",hidden:!1,noSearch:!1},{key:"ACNAME",title:"A/C NAME",hidden:!1,noSearch:!1}]},this.genericGridCreditAccount.show()}onAccountSelect(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNAC=i.ACID,this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME=i.ACNAME}calculationForLoadFromAdditionalCost(i){this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=[],this.spinnerService.hide();for(const n of i){let s={};s.ITEMNAME=n.ITEMDESC,s.QUANTITY=n.Quantity,s.NETAMOUNT=n.NETAMOUNT,s.VAT=n.VAT,s.ISVAT=n.ISVAT,s.NONTAXABLE=0,1==n.ISVAT&&(s.TAXABLE=n.TAXABLE),0==n.ISVAT&&(s.NONTAXABLE=n.AMOUNT-n.DISCOUNT),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList.push(s),this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList=this.removeInvalidRowFromImportDetils(this._trnMainService.TrnMainObj.IMPORTDETAILS.prodList)}this._trnMainService.calculateImportProdTotalValue(),this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport=1}loadAdditionalCost(){this.spinnerService.show("Loading Data, Please Wait...."),this.importPurchaseService.loadAdditionalCostDetailsInImportPI(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{i&&(this.loadFromAdditionalCost=!0,this.loadFromAdditionalCostResponse=i,this.calculationForLoadFromAdditionalCost(i))},i=>{this.spinnerService.hide(),this.alertservice.error(i.error)})}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(N.p),e.Y36(B.V),e.Y36(Y.c),e.Y36(je.e),e.Y36(Kt))},M.\u0275cmp=e.Xpm({type:M,selectors:[["import-purchase-details"]],viewQuery:function(i,n){if(1&i&&e.Gf(Zt,5),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridCreditAccount=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(_){return n.handleKeyDownboardEvent(_)},!1,e.evT)},inputs:{tranMode:"tranMode"},decls:3,vars:2,consts:[["class","importdetail_container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridCreditAccount",""],[1,"importdetail_container"],[1,"card"],[1,"card-header",2,"background","#cbcbcb"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"disabled","keydown.F6","click",4,"ngIf"],["type","button","title","reset",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click","keydown.F3"],["title","SaveImportDetails","type","button","class","btn btn-info","style","margin-right:2px",3,"disabled","click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-horizontal",2,"margin-top","15px"],[1,"row"],[1,"col-md-6","pd0"],[1,"form-group","row",2,"align-items","center"],[1,"col-sm-4","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7"],["id","documentno","type","text","placeholder","Import Document No","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],["DocumentNo",""],[2,"width","89%","border-radius","3px"],[1,"legend-class",2,"font-size","14px","width","45%"],["type","checkbox","id","vatAmountAccounting",2,"margin-right","3%",3,"ngModel","disabled","ngModelChange","change"],[1,"col-sm-3","form-control-label","font",2,"margin-left","-12px"],[1,"col-sm-7",2,"margin-left","50px"],["type","text","autocomplete","off","placeholder","Press Enter to Select Account",1,"form-control",2,"width","113%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[1,"col-md-6"],[1,"col-sm-2","form-control-label","font",2,"margin-left","-12px"],["type","text","placeholder","L/C No.","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange"],[1,"col-sm-3"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.Enter","click"],["type","number","placeholder","Enter VAT amount","autocomplete","off",1,"form-control",3,"ngModel","disabled","ngModelChange","keydown.enter","input"],[1,"form-control-label",2,"font-weight","bold","border-bottom","1px solid #e2e2e2","width","130px !important"],[1,"col-md-12","pd0",2,"height","40vh","margin-bottom","1rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","5%"],[2,"background-color","aliceblue"],["style","height: 28px;",3,"click","keydown.Shift.delete",4,"ngFor","ngForOf"],[2,"line-height","1.2rem"],["width","11%",2,"background","rgb(172 172 172)","border","2px white solid"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["title","SaveImportDetails","type","button",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","click"],[2,"height","28px",3,"click","keydown.Shift.delete"],[2,"width","1%"],[2,"width","10%"],["type","text","list","product","autocomplete","off",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","focus"],["id","product"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.Enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","keydown.tab"],[3,"value"]],template:function(i,n){1&i&&(e.YNc(0,qe,89,23,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(_){return n.onAccountSelect(_)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.genericGridCreditAccountSetting))},dependencies:[j.sg,j.O5,E.YN,E.Kr,E.Fj,E.wV,E.Wl,E.JJ,E.On,K.Zl],styles:[".importdetail_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:80%;top:20.5%;left:14%}.font[_ngcontent-%COMP%]{font-size:12px;line-height:12px}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem;padding:0 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 4px 5px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}"]}),M})();function Jt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"Reverse Entry Confirmation"),e.qZA(),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(7,"SAVE"),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(9,"CANCEL"),e.qZA()()(),e.TgZ(10,"div",8)(11,"div",9)(12,"label",10),e._uU(13,"Invoice No :"),e.qZA(),e.TgZ(14,"div",11)(15,"input",12),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.AdditionalObj.CREFBILL=s)}),e.qZA()()(),e.TgZ(16,"div",13)(17,"label",14),e._uU(18,"Remarks of Reverse Entry:"),e.qZA(),e.TgZ(19,"div",11)(20,"textarea",15),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_._trnMainService.TrnMainObj.AdditionalObj.CREMARKS=s)}),e.qZA()()()()()()}if(2&M){const i=e.oxw();e.xp6(15),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREFBILL),e.xp6(5),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.CREMARKS)}}let qt=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.isActive=!1,this.onClickReverse=new e.vpe}ngOnInit(){}submit(){null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL?null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&""!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS&&null!=this._trnMainService.TrnMainObj.AdditionalObj.CREMARKS?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL.toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO?this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL==this._trnMainService.TrnMainObj.VCHRNO?(this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.AdditionalObj.CREFBILL,this.onClickReverse.emit()):this.alertService.warning(`Character case of ${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed  should also \n      match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning(`${this._trnMainService.TrnMainObj.VoucherAbbName} No. that is to be reversed should match with the loaded Voucher No. before it can be reversed.`):this.alertService.warning("Enter reverse entry confirmation remarks"):this.alertService.warning("Enter Voucher no.")}closeDialog(){this.isActive=!1}show(i){console.log("SHOWNN",i),this.vchrno=i,this.isActive=!0}hide(){this.isActive=!1}onclear(){}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["reverse-entry-dialog"]],outputs:{onClickReverse:"onClickReverse"},decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label"],[1,"col-md-7"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label"],[1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&e.YNc(0,Jt,21,2,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.O5,E.Fj,E.JJ,E.On],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:57%;top:29.5%;left:26%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}"]}),M})();var Wt=A(27389);function $t(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"button",3),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(3,"span",4),e._uU(4,"\xd7"),e.qZA()(),e._UZ(5,"qrcode",5)(6,"label",6)(7,"label",7),e.TgZ(8,"label",8)(9,"input",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.traceIdStatus=s)})("change",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onChangeInput(s))}),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(5),e.Q6J("qrdata",i.qrString)("errorCorrectionLevel","M"),e.xp6(4),e.Q6J("ngModel",i.traceIdStatus)}}let zt=(()=>{class M{constructor(i,n,s,_,f){this._trnMainService=i,this.fb=n,this.masterService=s,this.spinnerService=_,this.alertService=f,this.onRefreshClick=new e.vpe,this.onDialogClosed=new e.vpe,this.onPaymentSuccess=new e.vpe,this.isPaymentSuccess=!1}ngOnInit(){}openSocket(i){i.onopen=function(n){console.log("[open] Connection established"),console.log("Sending to server...")},i.onmessage=function(n){console.log("[message] Data received from server",n.data),this.socketResponseData=JSON.parse(n.data),this.transactionStatus=JSON.parse(this.socketResponseData.transactionStatus),this.transactionStatus.qrVerified?(console.log("enter at tran message"),document.getElementById("qr_response_message").innerHTML="QR Code Verified"):this.transactionStatus.paymentSuccess&&(document.getElementById("qr_response_message").innerHTML="Payment Confirmed",console.log("PAYMENT SUCCESS TRACE ID",this.transactionStatus.traceId),document.getElementById("qr_traceId").innerHTML=this.transactionStatus.traceId)},i.onclose=function(n){console.log("SOCKET CLOSED",n),n.wasClean?console.log(`[close] Connection closed cleanly, code=${n.code} reason=${n.reason}`):console.log("[close] Connection died")},i.onerror=function(n){console.log(`[error] ${n}`)}}messageReceive(i){}show(i,n){let s=new WebSocket(n);this.openSocket(s),this.isActive=!0,this.qrString=i,this.SktURL=n,console.log("response bata k k catch huncha",this.qrString,this.SktURL)}cancelPopup(){this.isActive=!1}closeDialog(){this.isActive=!1,console.log("socket reposnce data",document.getElementById("qr_traceId").innerHTML);let i=document.getElementById("qr_traceId").innerHTML;this.onDialogClosed.emit(i)}refreshClick(){this.masterService.refreshForQRCode=!0,this.onRefreshClick.emit(this.masterService.refreshForQRCode)}onChangeInput(i){"Success"==i.target.defaultValue?(this.isActive=!1,this.isPaymentSuccess=!0,this.closeDialog(),this.onPaymentSuccess.emit(this.isPaymentSuccess)):(this.isActive=!0,this.isPaymentSuccess=!1)}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(N.p),e.Y36(E.qu),e.Y36(O.P),e.Y36(B.V),e.Y36(Y.c))},M.\u0275cmp=e.Xpm({type:M,selectors:[["fonepay-QR-popup"]],outputs:{onRefreshClick:"onRefreshClick",onDialogClosed:"onDialogClosed",onPaymentSuccess:"onPaymentSuccess"},decls:1,vars:1,consts:[["class","fonepatQR_container","role","document","style","max-width: 23%; max-height: 500px; margin-left: 31%;",4,"ngIf"],["role","document",1,"fonepatQR_container",2,"max-width","23%","max-height","500px","margin-left","31%"],[1,"card",2,"height","80vh"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px",3,"click"],["aria-hidden","true"],[2,"text-align","center","margin-top","14%","position","inherit",3,"qrdata","errorCorrectionLevel"],["id","qr_response_message"],["id","qr_traceId",2,"color","white"],["id","qr_success",2,"color","white"],["type","text","id","inputTraceSuccess","name","inputTraceSuccess","hidden","",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&e.YNc(0,$t,10,3,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.O5,E.Fj,E.JJ,E.On,Wt.V],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:2px;height:30px;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:14px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 1rem;\n    }\n  \n    .fonepatQR_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      top: 17%;\n      left: 16%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n    }\n\n    .card[_ngcontent-%COMP%]{\n        background-image: url('assets/fonepay-bg.jpg');\n        background-size: cover;\n        width: 100%;\n        height: 100%;\n    }\n\n    label[_ngcontent-%COMP%]{\n      \n      font-size: 14px;\n      margin-left: 5rem;\n      margin-top: 10px;\n    }\n\n    #qr_response_message[_ngcontent-%COMP%]{\n      margin-top: 40%; \n      margin-left: 0;\n      color: seagreen;\n      width: 100%;\n      text-align: center;\n      font-weight: 500;\n      font-size: large;\n    }"]}),M})();function Xt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",15)(1,"button",16),e.NdJ("click",function(){const _=e.CHM(i).$implicit,f=e.oxw(2);return e.KtG(f.showQR(_))}),e.qZA()()}if(2&M){const i=I.$implicit,n=e.oxw(2);e.xp6(1),e.Udp("background-image","url(assets/Images/"+i+".png)"),e.Q6J("disabled",n.isButtonDisabled)("value",i)}}function ei(M,I){if(1&M&&e._UZ(0,"img",21),2&M){const i=e.oxw(3);e.Q6J("src",i.qrString,e.LSH)}}function ti(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",17)(1,"button",18),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.closeDialogQR())}),e.TgZ(2,"span",19),e._uU(3,"\xd7"),e.qZA()(),e.YNc(4,ei,1,1,"img",20),e.qZA()}if(2&M){const i=e.oxw(2);e.xp6(4),e.Q6J("ngIf",i.qrString)}}function ii(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(4,"span",8),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",9)(7,"h3",10),e._uU(8,"Please Select The Payment Method:"),e.qZA()(),e.YNc(9,Xt,2,4,"div",11),e.TgZ(10,"div",12),e._UZ(11,"label",13),e.qZA()(),e.YNc(12,ti,5,1,"div",14),e.qZA()}if(2&M){const i=e.oxw();e.xp6(9),e.Q6J("ngForOf",i.mocoChannels),e.xp6(3),e.Q6J("ngIf",i.isActiveQR)}}let ni=(()=>{class M{constructor(i){this.masterService=i,this.onDialogClosed=new e.vpe,this.isButtonDisabled=!1}ngOnInit(){}showdata(i,n,s,_){this.isActiveShowChannel=!0,this.mocoChannels=i,this.selectedValue=this.mocoChannels[0],this.TenderAmt=n,this.CompanyId=s,this.trnmode=_}closeDialog(){this.isActiveShowChannel=!1,this.isActiveQR=!1}showQR(i){this.guid=u(),this.selectedValue=i,this.isButtonDisabled=!0,document.getElementById("qr_response_message").innerHTML="FetchingQR<br>Please wait...",this.masterService.getPaymentGateWayForMoco(this.TenderAmt,this.guid,this.CompanyId,this.trnmode,this.selectedValue).subscribe(n=>{if(this.isButtonDisabled=!1,"ok"==n.status&&n.result){document.getElementById("qr_response_message").innerHTML="pending",this.qrString=n.result,this.isActiveQR=!0;const s=this.qrString.split("/");this.token=s[s.length-2],this.rrn=n.result2,this.check()}else document.getElementById("qr_response_message").innerHTML="Please try again"},n=>{this.isButtonDisabled=!1,document.getElementById("qr_response_message").innerHTML="Please try again"})}check(){1==this.isActiveQR&&this.masterService.mococheck(this.token,this.selectedValue,this.rrn).subscribe(i=>{if("ok"==i.status)if(this.result=i.result,"Pending"==this.result)setTimeout(()=>{console.log("pending"),this.check()},5e3);else if("Approved"==this.result)console.log(i.result),this.onDialogClosed.emit(this.rrn),document.getElementById("qr_response_message").innerHTML=" Payment<br>Confirmed",setTimeout(()=>{this.isActiveQR=!1},1e3);else{if("Rejected"!=this.result)return void console.log(i.result);console.log(i.result)}})}closeDialogQR(){this.isActiveShowChannel=!0,this.isActiveQR=!1}handleKeyDownboardEvent(i){"Escape"==i.code&&(i.preventDefault(),this.closeDialog())}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-moco"]],hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(_){return n.handleKeyDownboardEvent(_)},!1,e.evT)},outputs:{onDialogClosed:"onDialogClosed"},decls:8,vars:1,consts:[["lang","en"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["class","mocoBody",4,"ngIf"],[1,"mocoBody"],[1,"MocoChannel_container"],[1,"close"],["aria-label","Close",2,"background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","20px"],[1,"div1"],[1,"heading"],["class","div2",4,"ngFor","ngForOf"],[1,"div3"],["id","qr_response_message"],["class","MOCOQR_container","role","document",4,"ngIf"],[1,"div2"],["type","button",1,"icon",3,"disabled","value","click"],["role","document",1,"MOCOQR_container"],["aria-label","Close",1,"close",2,"text-align","right","padding-right","10px","background-color","#333333",3,"click"],["aria-hidden","true",2,"font-size","30px"],["alt","QR Code",3,"src",4,"ngIf"],["alt","QR Code",3,"src"]],template:function(i,n){1&i&&(e.TgZ(0,"html",0)(1,"head"),e._UZ(2,"meta",1)(3,"meta",2),e.TgZ(4,"title"),e._uU(5,"Fonepay QR Container"),e.qZA()(),e.TgZ(6,"body"),e.YNc(7,ii,13,2,"div",3),e.qZA()()),2&i&&(e.xp6(7),e.Q6J("ngIf",n.isActiveShowChannel))},dependencies:[j.sg,j.O5],styles:["body[_ngcontent-%COMP%] {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 0;\n    }\n\n    .mocoBody[_ngcontent-%COMP%] {\n      position: fixed;\n      z-index: 999999;\n      width: 100%;\n      height: 100%;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-between;\n      max-width: 400px;\n      max-height: 90vh;\n      background: #fffdfd;\n      border: 3px solid lightgray;\n      border-radius: 20px;\n      z-index: 99999;\n      padding-top: 20px;\n      padding-bottom: 20px\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      padding: 0;\n      font-size: 20px;\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n      width: 200px;\n      margin-left: 5rem;\n      margin-top: 47px;\n      font-size: 14px;\n      padding: 5px;\n      height: auto;\n      padding-left: 68px;\n    }\n\n    .heading[_ngcontent-%COMP%] {\n      font-size: 20px;\n      font-weight: bold;\n      margin-bottom: 10px;\n      display: inline;\n\n    }\n\n\n    #qr_response_message[_ngcontent-%COMP%] {\n      margin-top: 11%;\n      color: seagreen;\n      text-align: center;\n      font-weight: 600;\n      font-size: large;\n      display: inline;\n    }\n\n    \n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div1[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-left: 37px;\n      width: 318px;\n      height: 23px;\n      left: 0px;\n      top: 45px;\n      position: absolute;\n      color: #1B62A3;\n      font-size: 16px;\n      font-family: Plus Jakarta Sans;\n      font-weight: 500;\n      word-wrap: break-word\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n\n      margin-left: 37px;\n      margin-top: -116px;\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div2[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      display: contents;\n      padding-bottom: 50px;\n\n\n    }\n\n    .MocoChannel_container[_ngcontent-%COMP%]   .div3[_ngcontent-%COMP%] {\n      background: #fffdfd;\n      margin-top: -46px;\n      align-self: center;\n      top: 346px;\n      position: absolute;\n      color: #0a0a0a;\n      font-size: 20px;\n      font-family: Plus Jakarta Sans;\n      font-weight: bold;\n      word-wrap: break-word\n    }\n\n\n\n\n    button[_ngcontent-%COMP%] {\n      margin-top: 117px;\n      padding: 6px 14px;\n      background-color: #007bff;\n      color: #ffffff;\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      font-size: 10px;\n      margin-left: 344px;\n      height: 26;\n    }\n\n    button.close[_ngcontent-%COMP%] {\n      color: #000;\n      background-color: transparent;\n\n    }\n\n    button[_ngcontent-%COMP%]:hover {\n      background-color: #0056b3;\n    }\n\n    .icon[_ngcontent-%COMP%] {\n      height: 60px;\n      width: 120px;\n      margin-left: 36px;\n      margin-right: 35px;\n      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\n\n      transition: border-color 0.2s;\n      margin-top: 65px;\n      margin-bottom: 0px;\n    }\n\n    .icon[_ngcontent-%COMP%]:hover {\n\n      background-color: #da3434;\n      transform: scale(1.1);\n      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);\n    }\n\n    .MOCOQR_container[_ngcontent-%COMP%] {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      -webkit-transform: translate(-50%, -50%);\n      transform: translate(-50%, -50%);\n      background: #ffffff;\n      z-index: 99999;\n      width: 65%;\n      max-height: 0;\n      top: -1%;\n      left: 22%;\n      border: 1px solid lightgray;\n      border-radius: 5px;\n      max-width: 23%;\n      margin-left: 31%;\n    }"]}),M})();var We=A(89952);const ri=["genericGridAccount"],oi=["fonePay"],si=["moco"],ai=["genericGridSalesReturnVoucher"];function ci(M,I){1&M&&e._UZ(0,"div",9)}function li(M,I){if(1&M&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&M){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.PAYMENTMODENAME)}}function hi(M,I){if(1&M&&(e.TgZ(0,"span",80),e._uU(1),e.qZA()),2&M){const i=e.oxw().$implicit;e.xp6(1),e.hij("[",i.character,"] ")}}function di(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",76)(1,"div",39)(2,"button",77),e.NdJ("click",function(){const _=e.CHM(i).$implicit,f=e.oxw(2);return e.KtG(f.onClickTrnMode(_))}),e.TgZ(3,"span"),e._UZ(4,"img"),e.qZA(),e.YNc(5,li,2,1,"span",78),e.YNc(6,hi,2,1,"span",79),e.qZA()()()}if(2&M){const i=I.$implicit,n=e.oxw(2);e.xp6(2),e.Udp("background-image",n.logoURL(i.PAYMENTMODENAME)),e.ekj("clickedbutton",n.trnmode===i.PAYMENTMODENAME),e.Q6J("ngClass",n.noHoverEffect(i.PAYMENTMODENAME)?"nohovereffect":"payment-button"),e.xp6(3),e.Q6J("ngIf",n.displayTextInButton(i.PAYMENTMODENAME)),e.xp6(1),e.Q6J("ngIf",n.displayTextInButton(i.PAYMENTMODENAME))}}function nt(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",81)(1,"div",35)(2,"label",82),e._uU(3,"Account:"),e.qZA()(),e.TgZ(4,"div",36)(5,"input",83),e.NdJ("keydown.enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.showAccountList())}),e.qZA()()()}}function ui(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",81)(1,"div",35)(2,"label",82),e._uU(3,"CN No:"),e.qZA()(),e.TgZ(4,"div",36)(5,"input",84),e.NdJ("keydown.enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.showCreditNoteList())}),e.qZA()()()}}function Ti(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td",85),e._uU(2),e.qZA(),e.TgZ(3,"td",86),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",87),e._uU(7),e.qZA(),e.TgZ(8,"td",88)(9,"button",89),e.NdJ("click",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.deletePayDetails(_))}),e._uU(10,"Remove"),e.qZA()()()}if(2&M){const i=I.$implicit;e.xp6(2),e.Oqu(i.TRNMODE),e.xp6(2),e.Oqu(e.xi3(5,3,i.ACTUALAMOUNT,"1.2-2")),e.xp6(3),e.Oqu(i.REMARKS)}}function _i(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"h5"),e._uU(5,"BILL TENDER"),e.qZA(),e.TgZ(6,"h6",14),e._uU(7),e.qZA(),e.TgZ(8,"div",15)(9,"button",16),e.NdJ("keydown.F6",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit(s.form.value))})("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(10,"SAVE [End]"),e.qZA(),e.TgZ(11,"button",17),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(12,"CANCEL [Esc]"),e.qZA()()()(),e.TgZ(13,"div")(14,"form",18)(15,"div",19)(16,"div",20)(17,"div",21)(18,"ul",22)(19,"li",23)(20,"a",24),e._uU(21,"Payment Info"),e.qZA()()(),e.TgZ(22,"div",25)(23,"div",26)(24,"div",27)(25,"div",28)(26,"div",29),e.YNc(27,di,7,7,"div",30),e.qZA()(),e.TgZ(28,"div",31)(29,"div",32),e.YNc(30,nt,6,0,"div",33),e.YNc(31,ui,6,0,"div",33),e.TgZ(32,"div",34)(33,"div",35)(34,"label"),e._uU(35,"Amount:"),e.qZA()(),e.TgZ(36,"div",36)(37,"input",37),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.changeAmount(s))})("keydown.enter",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.AmountOnEnter(s))})("keyup",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.rateChange(s))})("focusout",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.rateFocusOut(s))}),e.ALo(38,"twoDigitNumber"),e.qZA()()(),e.TgZ(39,"div",38)(40,"div",39)(41,"button",40),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.BalanceAmount())}),e._uU(42,"Balance Amount"),e.qZA()(),e.TgZ(43,"div",41)(44,"button",42),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.AddPayment())}),e._uU(45,"Add"),e.qZA()()(),e.TgZ(46,"div",43)(47,"div",44)(48,"div",39)(49,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("1"))}),e._uU(50,"1"),e.qZA()(),e.TgZ(51,"div",39)(52,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("2"))}),e._uU(53,"2"),e.qZA()(),e.TgZ(54,"div",39)(55,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("3"))}),e._uU(56,"3"),e.qZA()()(),e.TgZ(57,"div",44)(58,"div",39)(59,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("4"))}),e._uU(60,"4"),e.qZA()(),e.TgZ(61,"div",39)(62,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("5"))}),e._uU(63,"5"),e.qZA()(),e.TgZ(64,"div",39)(65,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("6"))}),e._uU(66,"6"),e.qZA()()(),e.TgZ(67,"div",44)(68,"div",39)(69,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("7"))}),e._uU(70,"7"),e.qZA()(),e.TgZ(71,"div",39)(72,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("8"))}),e._uU(73,"8"),e.qZA()(),e.TgZ(74,"div",39)(75,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("9"))}),e._uU(76,"9"),e.qZA()()(),e.TgZ(77,"div",44)(78,"div",39)(79,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("."))}),e._uU(80,"."),e.qZA()(),e.TgZ(81,"div",39)(82,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.pressKey("0"))}),e._uU(83,"0"),e.qZA()(),e.TgZ(84,"div",39)(85,"button",45),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(86,"Back"),e.qZA()()(),e.TgZ(87,"div",38)(88,"div",39)(89,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.clearEntries())}),e._uU(90,"Clear"),e.qZA()()(),e.TgZ(91,"div",38)(92,"div",39)(93,"button",46),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.AddPayment())}),e._uU(94,"Enter"),e.qZA()()()()()(),e.TgZ(95,"div",47)(96,"fieldset",48)(97,"div")(98,"table",49)(99,"thead",50)(100,"tr",51)(101,"th",52),e._uU(102,"Mode"),e.qZA(),e.TgZ(103,"th",53),e._uU(104,"Amount"),e.qZA(),e.TgZ(105,"th",54),e._uU(106,"Remarks"),e.qZA(),e._UZ(107,"th",55),e.qZA()(),e.TgZ(108,"tbody",56),e.YNc(109,Ti,11,6,"tr",57),e.qZA()()(),e.TgZ(110,"table",58)(111,"tbody",59)(112,"tr")(113,"td"),e._uU(114,"Tender Amount :"),e.qZA(),e.TgZ(115,"td",60),e._uU(116),e.ALo(117,"number"),e.qZA()(),e.TgZ(118,"tr")(119,"td"),e._uU(120,"Bill Amount :"),e.qZA(),e.TgZ(121,"td",60),e._uU(122),e.ALo(123,"number"),e.qZA()(),e.TgZ(124,"tr")(125,"td"),e._uU(126,"Due Amount :"),e.qZA(),e.TgZ(127,"td",60),e._uU(128),e.ALo(129,"number"),e.qZA()(),e.TgZ(130,"tr")(131,"td"),e._uU(132,"Change Amount :"),e.qZA(),e.TgZ(133,"td",60),e._uU(134),e.ALo(135,"number"),e.qZA()()()()()()()()()()(),e.TgZ(136,"div",61)(137,"fieldset",62)(138,"div",63)(139,"div",64)(140,"label",65),e._uU(141,"Gross:"),e.qZA()(),e.TgZ(142,"div",66)(143,"label",67),e._uU(144),e.ALo(145,"number"),e.qZA()()(),e.TgZ(146,"div",63)(147,"div",64)(148,"label",65),e._uU(149,"Discount:"),e.qZA()(),e.TgZ(150,"div",66)(151,"label",67),e._uU(152),e.ALo(153,"number"),e.qZA()()(),e.TgZ(154,"div",63)(155,"div",64)(156,"label",68),e._uU(157,"Taxable Amount:"),e.qZA()(),e.TgZ(158,"div",66)(159,"label",67),e._uU(160),e.ALo(161,"number"),e.qZA()()(),e.TgZ(162,"div",63)(163,"div",64)(164,"label",69),e._uU(165,"Non-Taxable Amount:"),e.qZA()(),e.TgZ(166,"div",66)(167,"label",67),e._uU(168),e.ALo(169,"number"),e.qZA()()(),e.TgZ(170,"div",63)(171,"div",64)(172,"label",65),e._uU(173,"VAT:"),e.qZA()(),e.TgZ(174,"div",66)(175,"label",67),e._uU(176),e.ALo(177,"number"),e.qZA()()(),e.TgZ(178,"div",63)(179,"div",64)(180,"label",65),e._uU(181,"Net Amount:"),e.qZA()(),e.TgZ(182,"div",66)(183,"label",67),e._uU(184),e.ALo(185,"number"),e.qZA()()(),e.TgZ(186,"div",70)(187,"div",71)(188,"label",72),e._uU(189,"Due Amount:"),e.qZA()(),e.TgZ(190,"div",73)(191,"label",74),e._uU(192),e.ALo(193,"number"),e.qZA()()(),e.TgZ(194,"div",75)(195,"div",71)(196,"label",72),e._uU(197,"Change Amount:"),e.qZA()(),e.TgZ(198,"div",73)(199,"label",74),e._uU(200),e.ALo(201,"number"),e.qZA()()()()()()()()()()}if(2&M){const i=e.oxw();e.xp6(7),e.hij(" : ",i.trnmode," "),e.xp6(2),e.Q6J("disabled",i.form.invalid),e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(13),e.Q6J("ngForOf",i.paymentmodelist),e.xp6(3),e.Q6J("ngIf","Credit Card"==i.form.get("TRNMODE").value||"Credit"==i.form.get("TRNMODE").value||"Cash on Delivery"==i.form.get("TRNMODE").value&&"LIST"==i.modeType),e.xp6(1),e.Q6J("ngIf","Sales Return Voucher"==i.form.get("TRNMODE").value),e.xp6(6),e.Q6J("value",i.applyPipeInRate?e.lcZ(38,22,i.form.get("INPUTAMOUNT").value):i.form.get("INPUTAMOUNT").value)("readonly","Sales Return Voucher"==i.trnmode),e.xp6(4),e.Q6J("disabled","Sales Return Voucher"==i.trnmode),e.xp6(68),e.Q6J("ngForOf",i.paymentinfoList),e.xp6(7),e.Oqu(e.xi3(117,24,i.TENDERAMOUNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(123,27,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(129,30,i.DUEAMOUNT,"1.2-2")),e.xp6(6),e.Oqu(e.xi3(135,33,i.CHANGEAMOUNT,"1.2-2")),e.xp6(10),e.Oqu(e.xi3(145,36,i._trnMainService.TrnMainObj.GROSSAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(153,39,i._trnMainService.TrnMainObj.TOTALDISCOUNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(161,42,i._trnMainService.TrnMainObj.TAXABLE,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(169,45,i._trnMainService.TrnMainObj.NONTAXABLE,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(177,48,i._trnMainService.TrnMainObj.VATAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(185,51,i._trnMainService.TrnMainObj.NETAMNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(193,54,i.DUEAMOUNT,"1.2-2")),e.xp6(8),e.Oqu(e.xi3(201,57,i.CHANGEAMOUNT,"1.2-2"))}}let Mi=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.okClicked=new e.vpe,this.isSubmitting=!1,this.isSubmitted=!1,this.onSave=new e.vpe,this.isActive=!1,this.mode="add",this.paymentinfoList=[],this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.gridPopupSettingsForAccount=new K.im,this.gridPopupSettingsForSalesReturn=new K.im,this.applyPipeInRate=!0,this.modeType="",this.TenderMode="",this.mainText="",this.forminit(),this.AppMode=w.N.appMode}get isTenderFormDisabled(){return this.moco.isActiveShowChannel||this.fonePay.isActive}ngOnInit(){}forminit(){this.form=this.fb.group({INPUTAMOUNT:[""],TRNMODE:[""],BANKNAME:[""],ACID:[""]}),this.masterService.masterGetmethod("/gettransactionmodes").subscribe(i=>{"ok"==i.status&&(this.paymentmodelist=i.result.filter(n=>"Cash"==n.PAYMENTMODENAME||"Credit Card"==n.PAYMENTMODENAME||"Credit"==n.PAYMENTMODENAME||"Cash on Delivery"==n.PAYMENTMODENAME||"FonePay"==n.PAYMENTMODENAME||"CellPay"==n.PAYMENTMODENAME||"Khalti"==n.PAYMENTMODENAME||"Smart QR"==n.PAYMENTMODENAME||"NepalPay"==n.PAYMENTMODENAME||"Sales Return Voucher"==n.PAYMENTMODENAME||"MOCO"==n.PAYMENTMODENAME||"ESEWA"==n.PAYMENTMODENAME),this.paymentmodelist.forEach(n=>{n.character=n.ShortCutKey}))},i=>{})}logoURL(i){return`url('assets/Images/${i}.png')`}displayTextInButton(i){return"Cash"==i||"Credit"==i||"Credit Card"==i||"Sales Return Voucher"==i||"ESEWA"==i||"Cash on Delivery"==i}noHoverEffect(i){return"FonePay"==i||"NepalPay"==i||"Smart QR"==i||"Khalti"==i||"CellPay"==i||"MOCO"==i}submit(){this.DUEAMOUNT>0?this.alertService.warning("Bill amount is due ! Cannot save.."):this.paymentinfoList.filter(i=>"FONEPAY"==i.TRNMODE?.toUpperCase()&&"EPAYMENT"==i.MODE?.toUpperCase())[0]&&!this.validateFonepayTransaction()||this.paymentinfoList.filter(i=>"MOCO"==i.TRNMODE?.toUpperCase())[0]&&!this.validateMocoTransaction()||(this.isSubmitting=!0,this.okClicked.emit(this.paymentinfoList))}validateFonepayTransaction(){let i=this.paymentinfoList.filter(n=>"FONEPAY"==n.TRNMODE?.toUpperCase())[0];if(i)return null!=i.TRANSACTIONID&&null!=i.TRANSACTIONID&&""!=i.TRANSACTIONID||(this.alertService.warning("Transaction ID for FonePay not received yet. Cannot Save"),!1)}validateMocoTransaction(){let i=this.paymentinfoList.filter(n=>"MOCO"==n.TRNMODE?.toUpperCase())[0];if(i)return!!i.TRANSACTIONID||(console.log(i.TRANSACTIONID),this.alertService.warning("Payment is Not Completed"),!1)}onclear(){this.form.reset(),this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentinfoList=[],this.payDetails={}}closeDialog(){this.onclear(),this.isActive=!1}refreshClickHit(i){this.refreshHitValue=i,this.refreshHitValue&&this.AddPayment()}keyPress(i){const s=String.fromCharCode(i.charCode);/[0-9]/.test(s)||i.preventDefault()}show(){this.isActive=!0;let i=this.paymentmodelist.filter(n=>"Cash"===n.PAYMENTMODENAME)[0];this.onClickTrnMode(i),this.form.get("INPUTAMOUNT").enable(),this.payDetails.ACID=this.paymentmodelist.filter(n=>"CASH"===n.PAYMENTMODENAME?.toUpperCase())[0]?.ACID,setTimeout(()=>{document.getElementById("amountField").focus()},1e3)}hide(){this.onclear(),this.isActive=!1}AddPayment(){if(this.payDetails.TRNMODE=this.form.get("TRNMODE").value,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),"Credit Card"==this.payDetails.TRNMODE||"Credit"==this.payDetails.TRNMODE||"Cash on Delivery"==this.payDetails.TRNMODE&&"LIST"==this.modeType)this.payDetails.ACID=this.paymentAccountList.filter(i=>i.ACNAME?.toUpperCase()===this.form.get("BANKNAME").value?.toUpperCase())[0].ACID;else if("Sales Return Voucher"==this.payDetails.TRNMODE)this.payDetails.ACID=this.form.get("ACID").value;else if("FonePay"==this.payDetails.TRNMODE)this.payDetails.ACID=this.paymentmodelist.filter(i=>"FONEPAY"===i.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),this.payDetails.REMARKS="FonePay","EPAYMENT"==this.TenderMode?.toUpperCase()&&(this.guid=u(),this.masterService.getPaymentGateWayInfo(this.payDetails.TENDERAMT,this.guid,this.masterService.userProfile.CompanyInfo.COMPANYID,this.payDetails.TRNMODE).subscribe(i=>{"ok"==i.status&&(this.fonePayQRCode=i.result,this.scoketURL=i.result2,this.fonePay.show(this.fonePayQRCode,this.scoketURL))}));else if("MOCO"==this.payDetails.TRNMODE.toUpperCase()){if(this.payDetails.ACID=this.paymentmodelist.filter(_=>"MOCO"===_.PAYMENTMODENAME?.toUpperCase())[0].ACID,this.payDetails.TENDERAMT=Number(this.form.get("INPUTAMOUNT").value),0==this.payDetails.TENDERAMT)return void this.alertService.info("Please Enter Tender Amount!");let i,n=this.payDetails.TENDERAMT,s=this.payDetails.TRNMODE;this.masterService.getMocoChannel().subscribe(_=>{"ok"==_.status?(i=_.result,console.log("moco",this.moco),this.moco.showdata(i,n,this.masterService.userProfile.CompanyInfo.COMPANYID,s)):console.log("failed")})}else this.payDetails.ACID=this.masterService.userSetting.CASHINHAND_AC;0!=this._trnMainService.nullToZeroConverter(this.payDetails.TENDERAMT)&&(this.payDetails.REMARKS="Cash"==this.payDetails.TRNMODE?"":"FonePay"==this.payDetails.TRNMODE?"FonePay":"MOCO"==this.payDetails.TRNMODE?"MOCO":this.form.get("BANKNAME").value,this.PaymentValidation(),this.payDetails={},this.form.patchValue({INPUTAMOUNT:null,BANKNAME:null}))}BalanceAmount(){this.form.patchValue({INPUTAMOUNT:this.DUEAMOUNT}),this.masterService.focusAnyControl("amountField")}AmountOnEnter(i){i.preventDefault();let n=i.target.value;0==n||null==n||null==n||""==n?this.BalanceAmount():this.AddPayment()}deletePayDetails(i){this.paymentinfoList.splice(i,1),this.totalCalculations(),console.log("trnmode",this.form.controls.TRNMODE.value),"Credit Card"==this.form.controls.TRNMODE.value||"Credit"==this.form.controls.TRNMODE.value?setTimeout(()=>{this.masterService.focusAnyControl("accountfield")},500):"Sales Return Voucher"==this.form.controls.TRNMODE.value?setTimeout(()=>{this.masterService.focusAnyControl("cnnofield")},500):setTimeout(()=>{this.masterService.focusAnyControl("amountField")},500)}onClickTrnMode(i){if(i){let n=i.PAYMENTMODENAME;this.modeType=i.MODETYPE,this.TenderMode=i.MODE,this.form.patchValue({TRNMODE:n,INPUTAMOUNT:null,BANKNAME:null}),this.trnmode=n,"Credit"==n||"Credit Card"==n||"Cash on Delivery"==n||"CellPay"===n?(this.onpaymentmodechange(n),setTimeout(()=>{document.getElementById("accountfield").focus()},500)):"Cash"==n?(this.form.get("INPUTAMOUNT").enable(),setTimeout(()=>{document.getElementById("amountField").focus()},500)):"Sales Return Voucher"==n&&(this.onpaymentmodechange(n),setTimeout(()=>{document.getElementById("cnnofield").focus()},500))}}totalCalculations(){this.TENDERAMOUNT=0,this.paymentinfoList?.length&&this.paymentinfoList.forEach(i=>this.TENDERAMOUNT+=i.AMOUNT),this.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT<0?0:this._trnMainService.TrnMainObj.NETAMNT-this.TENDERAMOUNT,this.CHANGEAMOUNT=this.TENDERAMOUNT>this._trnMainService.TrnMainObj.NETAMNT?this.TENDERAMOUNT-this._trnMainService.TrnMainObj.NETAMNT:0}changeAmount(i){(null==i||null==i||0==i)&&(this.mainText="")}applyamount(i){}clearEntries(){this.mainText="",this.form.patchValue({INPUTAMOUNT:null})}pressKey(i){this.mainText+=i,this.form.patchValue({INPUTAMOUNT:this.mainText})}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0}onpaymentmodechange(i){if(this.paymentAccountList=[],null==this.paymentmodelist||0==this.paymentmodelist.length)return;var n=this.paymentmodelist.filter(_=>(_.PAYMENTMODENAME??"").toUpperCase()==i.toUpperCase())[0];if(null==n)return;let s=n.MODETYPE;this._trnMainService.TrnMainObj.TRNAC=null!=n.ACID&&""!=n.ACID?n.ACID:"",null!=s&&"LIST"==s.toUpperCase()&&this.masterService.masterGetmethod("/getpaymentmodelist/"+i).subscribe(_=>{"ok"==_.status?this.paymentAccountList=JSON.parse(_.result):alert(_.result)},_=>{alert(_)})}AddTender(i,n,s){console.log("Add tender",i);let _=0,f={};if(f.TRNMODE=i.TRNMODE,f.VCHRNO=this.TrnmainObj.VCHRNO,f.DIVISION=this.TrnmainObj.DIVISION,f.REMARKS=i.REMARKS,f.AMOUNT=n,f.ACTUALAMOUNT=n,f.ACCOUNT=i.ACID,f.CARDNO=i.CARDNO,f.APPROVALCODE=i.APPROVALCODE,f.CARDHOLDERNAME=i.CARDHOLDERNAME,f.CHANGE=0,f.MODE=s,"CASH"===i.TRNMODE.toUpperCase()){this._trnMainService.userProfile.CASH_AC&&this._trnMainService.userProfile.CASH_AC_NAME&&(f.ACCOUNT=this._trnMainService.userProfile.CASH_AC,f.REMARKS=this._trnMainService.userProfile.CASH_AC_NAME);let Q=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.filter(ee=>"CASH"!==ee.TRNMODE.toUpperCase()).map(ee=>ee.AMOUNT).reduce((ee,ne)=>ee+ne,0);console.log("balance",Q),_=n<Q?n:this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.filter(ee=>"CASH"!==ee.TRNMODE.toUpperCase()).map(ee=>ee.AMOUNT).reduce((ee,ne)=>ee+ne,0),f.ACTUALAMOUNT=_,f.CHANGE=n-f.ACTUALAMOUNT}this.paymentinfoList.push(f),console.log("Payment info list ",this.paymentinfoList),this.totalCalculations()}PaymentValidation(){if("CASH"==this.payDetails.TRNMODE.toUpperCase()){var i=this.paymentinfoList.filter(n=>"Cash"==n.TRNMODE)[0];if(i){let n=0,s=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.map(_=>_.AMOUNT).reduce((_,f)=>_+f,0);return n=this.payDetails.TENDERAMT<s?this.payDetails.TENDERAMT:this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)-this.paymentinfoList.map(_=>_.AMOUNT).reduce((_,f)=>_+f,0),console.log("add cassh valid",n,s),i.AMOUNT+=this.payDetails.TENDERAMT,i.ACTUALAMOUNT+=n,void this.totalCalculations()}}else if("CREDIT"==this.payDetails.TRNMODE.toUpperCase()||"CREDIT CARD"==this.payDetails.TRNMODE.toUpperCase()){if(this.paymentinfoList.length&&this.paymentinfoList.filter(n=>"CREDIT"==n.TRNMODE.toUpperCase()||"CREDIT CARD"==n.TRNMODE.toUpperCase()).length>0&&this.paymentinfoList.filter(n=>n.REMARKS==this.payDetails.REMARKS).length>0){let n="";return"CREDIT CARD"==this.payDetails.TRNMODE.toUpperCase()?n="Cannot add amount from same bank":"CREDIT"==this.payDetails.TRNMODE.toUpperCase()&&(n="Cannot add amount from party account"),void this.alertService.info(n)}if(this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return this.alertService.info("Tender amount should not be greater than Due B/L Amount."),void this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{this.masterService.focusAnyControl("amountField")},0)});if(this.payDetails.TENDERAMT>this._trnMainService.TrnMainObj.NETAMNT)return void this.alertService.info("Tender Amount is Greater Than Net Amount")}else if("SALES RETURN VOUCHER"==this.payDetails.TRNMODE.toUpperCase()&&this.DUEAMOUNT>0&&this.payDetails.TENDERAMT>this.DUEAMOUNT)return this.alertService.info("Total amount of the Voucher: "+this.payDetails.REMARKS+" ,should not be greater than Due B/L Amount."),void this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{this.masterService.focusAnyControl("amountField")},0)});this.AddTender(this.payDetails,this.payDetails.TENDERAMT,this.TenderMode)}checkBankName(i){console.log("select bank",i),""==this.form.get("BANKNAME").value||null==this.form.get("BANKNAME").value||null==this.form.get("BANKNAME").value?this.form.get("INPUTAMOUNT").disable():this.form.get("INPUTAMOUNT").enable()}handleKeyDownboardEvent(i){if(!0===this.isActive){console.log("$event.code",i.code),"Escape"==i.code?this.isTenderFormDisabled||(i.preventDefault(),this.closeDialog()):"End"==i.code&&(i.preventDefault(),1==this.isActive&&0!=this._trnMainService.nullToZeroConverter(this.TENDERAMOUNT)&&(console.log("save payment"),this.paymentinfoList?.length>0&&this.submit()));let s=this.paymentmodelist.filter(_=>_.ShortCutKey==i.code)[0];if(console.log("payment mode defiende",s,this.paymentmodelist),null!=s)i.preventDefault(),1==this.isActive&&this.onClickTrnMode(s);else if("PageUp"==i.code){if(1==this.isActive){let _=this.paymentmodelist.lastIndexOf(this.paymentmodelist.filter(Q=>Q.PAYMENTMODENAME==this.form.get("TRNMODE").value)[0]);console.log("index",_),this.onClickTrnMode(0==_?this.paymentmodelist[0]:this.paymentmodelist[_-1])}}else if("PageDown"==i.code&&1==this.isActive){let _=this.paymentmodelist.lastIndexOf(this.paymentmodelist.filter(Q=>Q.PAYMENTMODENAME==this.form.get("TRNMODE").value)[0]);this.onClickTrnMode(_==this.paymentmodelist.length-1?this.paymentmodelist[this.paymentmodelist.length-1]:this.paymentmodelist[_+1])}}}showAccountList(){this.gridPopupSettingsForAccount={title:"Account List",apiEndpoints:`/getpaymentmodepagedlist/${this.trnmode}`,defaultFilterIndex:1,columns:[{key:"ACID",title:"Account ID",hidden:!1,noSearch:!1},{key:"ACNAME",title:"Account Name",hidden:!1,noSearch:!1},{key:"VATNO",title:"VatNo",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"Address",hidden:!1,noSearch:!1},{key:"MOBILE",title:"Mobile",hidden:!1,noSearch:!1}]},this.genericGridAccount.show()}showCreditNoteList(){this.gridPopupSettingsForSalesReturn={title:"Credit Note List",apiEndpoints:`/getpaymentmodepagedlist/${this.trnmode}`,defaultFilterIndex:1,columns:[{key:"VCHRNO",title:"Voucher no.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Net amount",hidden:!1,noSearch:!1,pipe:!0,alignment:"right"}]},this.genericGridSalesReturnVoucher.show()}onAccountSelected(i){this._trnMainService.TrnMainObj.CREDITLIMIT=i.CRLIMIT,this.trnmode&&"Credit"==this.trnmode&&this.replacePreviousCustomerWithTenderModeCustomer(this._trnMainService.TrnMainObj,i),this.masterService.getCustomerwiseCreditLimit(i.ACID,this._trnMainService.TrnMainObj.TRNDATE).subscribe(n=>{this._trnMainService.TrnMainObj.BLAMOUNT=n.BL}),this.form.patchValue({BANKNAME:i.ACNAME}),setTimeout(()=>{document.getElementById("amountField").focus()},500)}replacePreviousCustomerWithTenderModeCustomer(i,n){i.RECEIVEBY=n.ACID,i.PARAC=n.ACID,i.BILLTO=n.ACNAME,i.BILLTOADD=n.ADDRESS,i.BILLTOTEL=n.VATNO}onQrDialogClosed(i){console.log("on payment dialog closed",i),console.log("paymen tlist",this.paymentinfoList),this.paymentinfoList.find(s=>"FonePay"==s.TRNMODE).TRANSACTIONID=i}tenderPopupClose(i){}onDialogClosedMoco(i){this.paymentinfoList.find(s=>"MOCO"==s.TRNMODE).TRANSACTIONID=i}onSalesReturnVoucherSelect(i){this.form.patchValue({BANKNAME:i.VCHRNO,INPUTAMOUNT:i.NETAMNT,ACID:i.TRNAC})}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["payment-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(e.Gf(ri,5),e.Gf(oi,5),e.Gf(si,5),e.Gf(ai,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridAccount=s.first),e.iGM(s=e.CRH())&&(n.fonePay=s.first),e.iGM(s=e.CRH())&&(n.moco=s.first),e.iGM(s=e.CRH())&&(n.genericGridSalesReturnVoucher=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(_){return n.handleKeyDownboardEvent(_)},!1,e.evT)},outputs:{okClicked:"okClicked",onSave:"onSave"},decls:10,vars:4,consts:[["class","backdrop",4,"ngIf"],["class","payment-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridAccount",""],["genericGridSalesReturnVoucher",""],[3,"onRefreshClick","onDialogClosed","onPaymentSuccess"],["fonePay",""],[3,"onDialogClosed"],["moco",""],[1,"backdrop"],[1,"payment-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[2,"position","relative","top","3px"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"disabled","keydown.F6","click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"form-horizontal",2,"margin-top","15px",3,"formGroup"],[1,"row","col-sm-12"],[1,"col-sm-10",2,"margin-top","-15px","margin-left","-15px"],[1,"tabbable",2,"margin-left","-15px"],[1,"nav","nav-tabs",2,"background-color","#138496"],[1,"nav-item"],["href","#payment-info","data-toggle","tab",1,"nav-link","active"],[1,"tab-content"],["id","payment-info",1,"tab-pane","active"],[1,"row","col-sm-12",2,"margin-top","5px"],[1,"col-sm-1",2,"position","relative","top","6px","left","-15px"],[1,"payment-mode-container",2,"max-height","400px","width","fit-content","overflow-y","auto","overflow-x","hidden","padding","2px"],["class","form-group row","style","margin-bottom: 10px !important;",4,"ngFor","ngForOf"],[1,"col-sm-5"],[1,"col-sm-12",2,"background-color","#f7f7f7","margin-left","29px","border","solid 2px #999999","height","25rem","padding","5px 0px 0px"],["class","form-group row","style","margin-bottom: 0px !important;",4,"ngIf"],[1,"form-group","row","col-md-12","pd0",2,"margin-bottom","0px !important"],[1,"col-md-3"],[1,"col-sm-9"],["id","amountField","type","number","formControlName","INPUTAMOUNT",1,"form-control",2,"font-size","13px !important","font-weight","500","text-align","center",3,"value","readonly","ngModelChange","keydown.enter","keyup","focusout"],[1,"form-group","row",2,"margin-bottom","5px !important"],[1,"col"],["type","button",1,"btn","btn-info",2,"width","10rem",3,"disabled","click"],[1,"col",2,"margin-left","21px"],["type","button",1,"btn","btn-info",2,"width","5rem",3,"click"],[2,"position","relative","top","1rem"],[1,"form-group","row",2,"margin-bottom","5px !important","width","22rem"],["type","button",1,"btn","number-button",3,"click"],["type","button",1,"btn","large-button",3,"click"],[1,"col-sm-6",2,"position","relative","left","12px","padding","0px 8px"],[2,"height","25rem","border","2px solid #999999"],[1,"table-striped"],[2,"background-color","#63bbb2"],[2,"position","sticky","top","0","line-height","1.5rem"],["scope","col",2,"width","7%","padding-left","6px"],["scope","col",2,"width","10%","text-align","right","padding-right","1rem"],["scope","col",2,"width","14%"],["scope","col",2,"width","4%"],[1,"bodytable"],[4,"ngFor","ngForOf"],[1,"table-striped",2,"width","100%","position","relative","top","1rem","border","1.5px solid #c3c3c3"],[1,"total"],[2,"text-align","right"],[1,"col-sm-2"],[1,"fieldset-class"],[1,"row",2,"margin-left","0px"],[1,"col-sm-6","pd0"],[1,"totalLabel"],[1,"col-sm-6"],[1,"totalValue"],[1,"totalLabel",2,"width","6rem"],[1,"totalLabel",2,"width","7rem","font-size","11px"],[1,"row",2,"position","relative","top","5rem"],[1,"col-md-6","pd0"],[1,"amountLabel"],[1,"col-md-6","pd0",2,"text-align","left"],[1,"amountValue"],[1,"row",2,"position","relative","top","6rem"],[1,"form-group","row",2,"margin-bottom","10px !important"],["type","button",1,"btn",3,"ngClass","click"],[4,"ngIf"],["style","font-size: 12px;",4,"ngIf"],[2,"font-size","12px"],[1,"form-group","row",2,"margin-bottom","0px !important"],[2,"padding-top","5px"],["id","accountfield","formControlName","BANKNAME","placeholder","Press Enter to Select Account","autocomplete","off","readonly","",1,"form-control",2,"width","100%","padding","0px 5px",3,"keydown.enter"],["id","cnnofield","type","text","formControlName","BANKNAME","placeholder","Press Enter to Select Credit note voucher","autocomplete","off","readonly","",1,"form-control",2,"font-size","12px !important",3,"keydown.enter"],[2,"width","7%","padding-left","6px"],[2,"width","10%","text-align","right","padding-right","1rem"],[2,"width","14%","font-size","11px"],[2,"width","4%"],[1,"btn","btn-danger",2,"font-size","10px","padding","1px","line-height","15px",3,"click"]],template:function(i,n){1&i&&(e.YNc(0,ci,1,0,"div",0),e.YNc(1,_i,202,60,"div",1),e.TgZ(2,"generic-popup-grid",2,3),e.NdJ("onItemDoubleClick",function(_){return n.onAccountSelected(_)}),e.qZA(),e.TgZ(4,"generic-popup-grid",2,4),e.NdJ("onItemDoubleClick",function(_){return n.onSalesReturnVoucherSelect(_)}),e.qZA(),e.TgZ(6,"fonepay-QR-popup",5,6),e.NdJ("onRefreshClick",function(_){return n.refreshClickHit(_)})("onDialogClosed",function(_){return n.onQrDialogClosed(_)})("onPaymentSuccess",function(_){return n.tenderPopupClose(_)}),e.qZA(),e.TgZ(8,"app-moco",7,8),e.NdJ("onDialogClosed",function(_){return n.onDialogClosedMoco(_)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForAccount),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForSalesReturn))},dependencies:[j.mk,j.sg,j.O5,E._Y,E.Fj,E.wV,E.JJ,E.JL,E.sg,E.u,K.Zl,zt,ni,j.JJ,We.g],styles:[".payment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:32rem;border:2px solid lightslategrey}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:13px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover{background-color:#138496;border-color:#117a8b;color:#fff;transform:scale(1.04)}.clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.btn[_ngcontent-%COMP%]{background-size:contain;background-repeat:no-repeat;background-position:center}.nohovereffect[_ngcontent-%COMP%]{width:-webkit-fill-available;margin-left:-15px;margin-right:5px;background-color:#fff;border-color:#117a8b;font-size:14px;color:#138496;transition-duration:.3s}.nohovereffect[_ngcontent-%COMP%]:hover{border-color:#117a8b;transform:scale(1.04)}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}.backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3d3c3c80;z-index:9999}"]}),M})();const pi=["genericGridSupplier"],vi=["genericGridRecurringItem"];function Si(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.saveRecurringLog())}),e._uU(1,"SAVE [End]"),e.qZA()}}function mi(M,I){1&M&&(e.TgZ(0,"th",24),e._uU(1,"Discontinue"),e.qZA())}function $e(M,I){if(1&M&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.Q6J("value",i.category),e.xp6(1),e.Oqu(i.category)}}function Oi(M,I){if(1&M&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.Q6J("value",i.MONTH),e.xp6(1),e.Oqu(i.NAME)}}function gi(M,I){1&M&&e._UZ(0,"option",36),2&M&&e.Q6J("value",I.$implicit.COST_CENTER)}function fi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"td",38)(1,"input",47),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.STATUS=s)}),e.qZA()()}if(2&M){const i=e.oxw(),n=i.index,s=i.$implicit;e.xp6(1),e.MGl("id","recurStatus",n,""),e.Q6J("ngModel",s.STATUS)}}function bi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr",30),e.NdJ("click",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.recurringRowClick(_))}),e.TgZ(1,"td",31),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e.TgZ(5,"td",32)(6,"input",33),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.PARENT_NAME=s)})("keydown.enter",function(s){e.CHM(i);const _=e.oxw(3);return e.KtG(_.recurringItemEnter(s))})("focus",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.recurringRowClick(_))}),e.qZA()(),e.TgZ(7,"td",34)(8,"select",35),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.CATEGORY=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("recurAmount"+_))}),e._UZ(9,"option",36),e.YNc(10,$e,2,2,"option",37),e.qZA()(),e.TgZ(11,"td",38)(12,"input",39),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.AMOUNT=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("recurMonth"+_))}),e.qZA()(),e.TgZ(13,"td",34),e._uU(14),e.ALo(15,"date"),e.qZA(),e.TgZ(16,"td",34)(17,"select",40),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.RECURRING_MONTH=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("recurDate"+_))})("change",function(){const s=e.CHM(i),_=s.$implicit,f=s.index,Q=e.oxw(3);return e.KtG(Q.addRecurringMonth(_,f))}),e._UZ(18,"option",36),e.YNc(19,Oi,2,2,"option",37),e.qZA()(),e.TgZ(20,"td",41)(21,"input",42),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.RECURRING_DATE=s)})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("recurVendor"+_))}),e.qZA()(),e.TgZ(22,"td",34)(23,"input",43),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.COST_CENTER=s)}),e.qZA(),e.TgZ(24,"datalist",44),e.YNc(25,gi,1,1,"option",37),e.qZA()(),e.TgZ(26,"td",34)(27,"input",45),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.REMARKS=s)})("keydown.enter",function(s){e.CHM(i);const _=e.oxw(3);return e.KtG(_.remarksEnter(s))}),e.qZA()(),e.YNc(28,fi,2,2,"td",46),e.qZA()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.NAME),e.xp6(2),e.MGl("id","recurItemName",n,""),e.Q6J("disabled","view"==s.mode)("ngModel",i.PARENT_NAME),e.xp6(2),e.MGl("id","recurCategory",n,""),e.Q6J("ngModel",i.CATEGORY)("disabled","view"==s.mode),e.xp6(2),e.Q6J("ngForOf",s.recurringItemCategory),e.xp6(2),e.MGl("id","recurAmount",n,""),e.Q6J("ngModel",i.AMOUNT)("disabled","view"==s.mode),e.xp6(2),e.hij(" ",e.xi3(15,29,i.LAST_RECUR_DATE,"mm-DD-yyy")," "),e.xp6(3),e.MGl("id","recurMonth",n,""),e.Q6J("ngModel",i.RECURRING_MONTH)("disabled","view"==s.mode),e.xp6(1),e.Q6J("value",0),e.xp6(1),e.Q6J("ngForOf",s.recurringmodelist),e.xp6(2),e.MGl("id","recurDate",n,""),e.Q6J("ngModel",i.RECURRING_DATE)("disabled","view"==s.mode),e.xp6(2),e.MGl("id","recurVendor",n,""),e.Q6J("ngModel",i.COST_CENTER)("disabled","view"==s.mode),e.xp6(2),e.Q6J("ngForOf",s.costcenterlist),e.xp6(2),e.MGl("id","recurRemarks",n,""),e.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),e.xp6(1),e.Q6J("ngIf","edit"==s.mode)}}function Ci(M,I){if(1&M&&(e.TgZ(0,"div",17)(1,"div",7)(2,"h6"),e._uU(3,"Recurring Item Info: "),e.qZA()(),e.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",21),e._uU(9,"Sn."),e.qZA(),e.TgZ(10,"th",22),e._uU(11,"Item Name"),e.qZA(),e.TgZ(12,"th",22),e._uU(13,"Recurring Item Name"),e.qZA(),e.TgZ(14,"th",23),e._uU(15,"Category"),e.qZA(),e.TgZ(16,"th",24),e._uU(17,"Amount"),e.qZA(),e.TgZ(18,"th",23),e._uU(19,"Last Recurr Date "),e.qZA(),e.TgZ(20,"th",25),e._uU(21,"Recurring Mode"),e.qZA(),e.TgZ(22,"th",26),e._uU(23,"Recurring Date"),e.qZA(),e.TgZ(24,"th",23),e._uU(25,"Cost Center"),e.qZA(),e.TgZ(26,"th",23),e._uU(27,"Remarks"),e.qZA(),e.YNc(28,mi,2,0,"th",27),e.qZA()(),e.TgZ(29,"tbody",28),e.YNc(30,bi,29,32,"tr",29),e.qZA()()()()),2&M){const i=e.oxw(2);e.xp6(28),e.Q6J("ngIf","edit"==i.mode),e.xp6(2),e.Q6J("ngForOf",i.recurringItemList)}}function Ei(M,I){1&M&&(e.TgZ(0,"th",24),e._uU(1,"Discontinue"),e.qZA())}function Ii(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"td",38)(1,"input",47),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.STATUS=s.target.checked?1:0)})("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.STATUS=s)}),e.qZA()()}if(2&M){const i=e.oxw(),n=i.index,s=i.$implicit;e.xp6(1),e.MGl("id","recurStatus",n,""),e.Q6J("ngModel",s.STATUS)}}function Ai(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr",30),e.NdJ("click",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.commissionRowClick(_))}),e.TgZ(1,"td",50),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",51),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"td",52)(11,"input",45),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.COMMISSION_PERCENTAGE=s)})("ngModelChange",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.commssionrateEnter(_))})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("commissionamount"+_))}),e.qZA()(),e.TgZ(12,"td",52)(13,"input",45),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).index,Q=e.oxw(3);return e.KtG(Q.commissionamountChange(s,f))})("keydown.enter",function(){const _=e.CHM(i).index,f=e.oxw(3);return e.KtG(f.masterService.focusAnyControl("commissionRemarks"+_))}),e.ALo(14,"number"),e.qZA()(),e.TgZ(15,"td",34)(16,"input",45),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.REMARKS=s)})("keydown.enter",function(s){e.CHM(i);const _=e.oxw(3);return e.KtG(_.remarksEnterPress(s))}),e.qZA()(),e.YNc(17,Ii,2,2,"td",46),e.qZA()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.NAME),e.xp6(2),e.hij(" ",i.SALESMANNAME,""),e.xp6(2),e.hij(" ",e.xi3(9,14,i.DEAL_AMOUNT,"1.2-2")," "),e.xp6(3),e.MGl("id","commissionrate",n,""),e.Q6J("ngModel",i.COMMISSION_PERCENTAGE)("disabled","view"==s.mode),e.xp6(2),e.MGl("id","commissionamount",n,""),e.Q6J("ngModel",e.xi3(14,17,i.COMMISSION_AMOUNT,"1.2-2"))("disabled","view"==s.mode),e.xp6(3),e.MGl("id","commissionRemarks",n,""),e.Q6J("ngModel",i.REMARKS)("disabled","view"==s.mode),e.xp6(1),e.Q6J("ngIf","edit"==s.mode)}}function Pi(M,I){if(1&M&&(e.TgZ(0,"div",17)(1,"div",7)(2,"h6"),e._uU(3,"Commission Chargeable Item Info: "),e.qZA()(),e.TgZ(4,"div",18)(5,"table",19)(6,"thead")(7,"tr",20)(8,"th",48),e._uU(9,"Sn."),e.qZA(),e.TgZ(10,"th",22),e._uU(11,"Item Name"),e.qZA(),e.TgZ(12,"th",22),e._uU(13,"Salesman"),e.qZA(),e.TgZ(14,"th",23),e._uU(15,"Deal Amount"),e.qZA(),e.TgZ(16,"th",24),e._uU(17,"Comission %"),e.qZA(),e.TgZ(18,"th",49),e._uU(19,"Comission Amount"),e.qZA(),e.TgZ(20,"th",23),e._uU(21,"Remarks"),e.qZA(),e.YNc(22,Ei,2,0,"th",27),e.qZA()(),e.TgZ(23,"tbody",28),e.YNc(24,Ai,18,20,"tr",29),e.qZA()()()()),2&M){const i=e.oxw(2);e.xp6(22),e.Q6J("ngIf","edit"==i.mode),e.xp6(2),e.Q6J("ngForOf",i.comissionItemList)}}function yi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h5"),e._uU(5,"Recurring Item Details Info:"),e.qZA(),e.TgZ(6,"div",8),e.YNc(7,Si,2,0,"button",9),e.TgZ(8,"button",10),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(9,"CANCEL [Esc]"),e.qZA()()(),e.TgZ(10,"div",7)(11,"h6"),e._uU(12,"Recurring Log No. :"),e.qZA(),e.TgZ(13,"label",11),e._uU(14),e.qZA(),e.TgZ(15,"h6"),e._uU(16," Customer Name: "),e.qZA(),e.TgZ(17,"label",12),e._uU(18),e.qZA()()(),e.TgZ(19,"div",13)(20,"div",14),e.YNc(21,Ci,31,2,"div",15),e.YNc(22,Pi,25,2,"div",15),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(7),e.Q6J("ngIf","view"!=i.mode),e.xp6(7),e.Oqu(i.recurringLogID),e.xp6(4),e.Oqu(i.customerName),e.xp6(3),e.Q6J("ngIf",i.recurringItemList.length>0),e.xp6(1),e.Q6J("ngIf",i.comissionItemList.length>0)}}let xi=(()=>{class M{constructor(i,n,s,_){this.masterService=i,this._trnMainService=n,this.alertService=s,this.spinnerService=_,this.recurringlogsaved=new e.vpe,this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],this.gridPopupSettingsForSupplier=new W.sG,this.gridPopupSettingsForRecurringItems=new K.im,this.recurringrowIndex=0,this.commissionrowIndex=0}ngOnInit(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&(this.masterService.getRecurringCategoryList().subscribe(i=>{this.recurringItemCategory=i&&i||[]},i=>{this.recurringItemCategory=[]}),this.getRecurringModeList())}ngOnChanges(i){(i.RecurringItems||i.CommissionItems)&&this.LoadItemsIntoLog(),(i.RecurringItemsForEdit||i.CommissionItemsForEdit)&&this.LoadItemsForEdit()}LoadItemsIntoLog(){this.RecurringItems.length>0?(this.spinnerService.show("Loading items, please wait.."),this.RecurringItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,this.spinnerService.hide(),this.recurringItemList.push(n)}),console.log("items loadded",this.recurringItemList,"mian recur id",this.mainRecurringID,"ref id",this.proformaRefBill),""!==this.mainRecurringID&&""!==this.proformaRefBill&&this.loadDetailsFromProforma()):this.recurringItemList=[],this.CommissionItems.length>0?this.CommissionItems.forEach(i=>{let n={};n.MCODE=i.MCODE,n.NAME=i.ITEMDESC,n.DEAL_AMOUNT=i.NETAMOUNT-i.VAT,n.SALESMANNAME=this._trnMainService.TrnMainObj.SALESMAN,n.SALESMAN=this._trnMainService.TrnMainObj.SALESMANID,this.comissionItemList.push(n)}):this.comissionItemList=[]}loadDetailsFromProforma(){console.log("HHHHHHHH");let i={};i.MCODE=this.recurringItemList[0].MCODE,i.ENTRYNO=this.proformaRefBill,this.masterService.getRecurringItemDetails(i).subscribe(n=>{if(console.log("YOOOO",n),"ok"==n.status){this.recurringItemList[0].PARENT_MCODE=n.result.PARENT_MCODE,this.recurringItemList[0].PARENT_NAME=n.result.PARENT_NAME,this.recurringItemList[0].CATEGORY=n.result.CATEGORY,this.recurringItemList[0].AMOUNT=n.result.AMOUNT,this.recurringItemList[0].LAST_RECUR_DATE=n.result.LAST_RECUR_DATE?n.result.LAST_RECUR_DATE.toString().substring(0,10):"",this.recurringItemList[0].COST_CENTER=n.result.COST_CENTER,this.recurringItemList[0].REMARKS=n.result.REMARKS,this.recurringItemList[0].RECURRING_MONTH=n.result.RECURRING_MONTH,this.recurringItemList[0].MAIN_RECURRING_ID=this.mainRecurringID;let s=new Date(this.recurringItemList[0].LAST_RECUR_DATE);s.setMonth(s.getMonth()+Number(this.recurringItemList[0].RECURRING_MONTH)),this.recurringItemList[0].RECURRING_DATE=(0,j.p6)(s,"yyyy-MM-dd","en-US")}})}LoadItemsForEdit(){this.RecurringItemsForEdit.forEach(i=>{i.LAST_RECUR_DATE=i.LAST_RECUR_DATE?i.LAST_RECUR_DATE.toString().substring(0,10):"",i.RECURRING_DATE=i.RECURRING_DATE?i.RECURRING_DATE.toString().substring(0,10):""}),this.recurringItemList=this.RecurringItemsForEdit,this.comissionItemList=this.CommissionItemsForEdit,this.recurringLogID=this.RecurringItemsForEdit[0]?.ENTRYNO,this.customerName=this.RecurringItemsForEdit[0]?.VENDOR_NAME}recurringRowClick(i){this.recurringrowIndex=i}commissionRowClick(i){this.commissionrowIndex=i}closeDialog(){this.isActive=!1,this.recurringItemList=[],this.comissionItemList=[],"view"!=this.mode&&"edit"!=this.mode&&(this.RecurringItemsForEdit=[],this.CommissionItemsForEdit=[]),this.recurringLogID="",this.customerName="",this.mainRecurringID="",this.proformaRefBill=""}saveRecurringLog(){if(this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter recurring item for item: ${this.recurringItemList.filter(s=>(""==s.PARENT_NAME||null==s.PARENT_NAME)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return this.alertService.warning(`Please enter category for item: ${this.recurringItemList.filter(s=>(""==s.CATEGORY||null==s.CATEGORY)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`),void console.log("category empty",this.recurringItemList);if(this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0])return void this.alertService.warning(`Please make sure Recurring date is set for item: ${this.recurringItemList.filter(s=>(""==s.RECURRING_DATE||null==s.RECURRING_DATE)&&null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)[0].NAME}`);let i=this.recurringItemList.length;if(this.recurringItemList.filter(s=>null==s.AMOUNT||null==s.AMOUNT||0==s.AMOUNT).length>=i)this.alertService.info("Please enter amount for atleast 1 recurring item in Recurring item info !");else{if(this.recurringItemList.filter(s=>null==s.AMOUNT||0==s.AMOUNT||null==s.AMOUNT).length>0&&"ADD"==this.mode.toUpperCase()){if(!confirm("Amount for some recurring items are missing. Are you sure you want to save items with amount only ?"))return;this.recurringItemList=this.recurringItemList.filter(s=>null!=s.AMOUNT&&0!=s.AMOUNT&&null!=s.AMOUNT)}console.log("recurring list",this.recurringItemList,"commsion list",this.comissionItemList),this.recurringlogsaved.emit({recurringItemList:this.recurringItemList,commissionItemList:this.comissionItemList})}}show(i="add",n="",s=""){console.log("mode",this.mode),console.log("local mode",i,"main recur id",n,"proforma ref bil",s),this.isActive=!0,setTimeout(()=>{document.getElementById("recurItemName0").focus()},500),this.getCostCenterList(),"ADD"==i.toUpperCase()&&(this.customerName=this._trnMainService.TrnMainObj.BILLTO,this.masterService.getVoucherNo({VoucherPrefix:"RL",DIVISION:this.masterService.userProfile.userDivision,PhiscalID:this.masterService.userProfile.PhiscalYearInfo.PhiscalID}).subscribe(_=>{console.log("voucer num recieved",_),"ok"==_.status?this.recurringLogID=_.result.VCHRNO:alert("Failed to retrieve voucherno")})),console.log("load entry details",n,s),this.mainRecurringID=n,this.proformaRefBill=s}getRecurringModeList(){this.masterService.getRecurringModeList().subscribe(i=>{"ok"==i.status?(this.recurringmodelist=i.result?i.result:[],console.log("recurring mode list",this.recurringmodelist)):this.recurringmodelist=[]},i=>{this.recurringmodelist=[]})}getCostCenterList(){this.masterService.getRecurringCostcenterList(this._trnMainService.TrnMainObj.PARAC).subscribe(i=>{this.costcenterlist=i&&i||[]},i=>{this.costcenterlist=[]})}supplierEnterCommand(i){this.getSupplierList(),this.genericGridSupplier.show()}getSupplierList(){this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V",defaultFilterIndex:0,useDefinefilterValue:null,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ACCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"VATNO",title:"VATNO",hidden:!1,noSearch:!1}]}}onSupplierSelected(i){console.log("sppulier select",i),this.recurringItemList[this.recurringrowIndex].VENDOR=i.ACID,this.recurringItemList[this.recurringrowIndex].VENDOR_NAME=i.ACNAME,setTimeout(()=>{document.getElementById("recurRemarks"+this.recurringrowIndex).focus()},500)}recurringItemEnter(i){this.gridPopupSettingsForRecurringItems={title:"Recurring Items",apiEndpoints:"/getRecurringItemPagesList",defaultFilterIndex:0,columns:[{key:"MENUCODE",title:"MENUCODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"ITEM NAME",hidden:!1,noSearch:!1}]},this.genericGridRecurringItem.show()}onRecurringItemSelected(i){console.log("item selecteted",i),this.recurringItemList[this.recurringrowIndex].PARENT_MCODE=i.MCODE,this.recurringItemList[this.recurringrowIndex].PARENT_NAME=i.DESCA,setTimeout(()=>{document.getElementById("recurCategory"+this.recurringrowIndex).focus()},500)}addRecurringMonth(i,n){let s;s=""==i.LAST_RECUR_DATE||null==i.LAST_RECUR_DATE?new Date(this._trnMainService.TrnMainObj.TRNDATE):new Date(i.LAST_RECUR_DATE),s.setMonth(s.getMonth()+Number(i.RECURRING_MONTH));let _=(0,j.p6)(s,"yyyy-MM-dd","en-US");this.recurringItemList[n].RECURRING_DATE=_}commssionrateEnter(i){let n=this.comissionItemList[i];if(console.log("commsission rate enter",n.COMMISSION_PERCENTAGE),n.COMMISSION_PERCENTAGE>100)return this.alertService.warning("Commission % should be limited to 100%"),this.comissionItemList[i].COMMISSION_PERCENTAGE=0,void(this.comissionItemList[i].COMMISSION_AMOUNT=0);n.COMMISSION_AMOUNT=n.DEAL_AMOUNT*(n.COMMISSION_PERCENTAGE/100)}remarksEnter(i){i.preventDefault();let n=this.recurringrowIndex+1;null!=document.getElementById("recurItemName"+n)&&setTimeout(()=>{document.getElementById("recurItemName"+n).focus()},500)}commissionamountChange(i,n){let s=this.comissionItemList[n];s.COMMISSION_AMOUNT=i,s.COMMISSION_PERCENTAGE=s.COMMISSION_AMOUNT/s.DEAL_AMOUNT*100}remarksEnterPress(i){i.preventDefault();let n=this.commissionrowIndex+1;null!=document.getElementById("commissionrate"+n)&&setTimeout(()=>{document.getElementById("commissionrate"+n).focus()},500)}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["recurringlog-popup"]],viewQuery:function(i,n){if(1&i&&(e.Gf(pi,5),e.Gf(vi,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridSupplier=s.first),e.iGM(s=e.CRH())&&(n.genericGridRecurringItem=s.first)}},inputs:{RecurringItems:"RecurringItems",CommissionItems:"CommissionItems",RecurringItemsForEdit:"RecurringItemsForEdit",CommissionItemsForEdit:"CommissionItemsForEdit",mode:"mode"},outputs:{recurringlogsaved:"recurringlogsaved"},features:[e.TTD],decls:5,vars:3,consts:[["class","recurring-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridSupplier",""],["genericGridRecurringItem",""],[1,"recurring-container"],[1,"card"],[1,"card-header"],[1,"row"],[2,"margin-left","60rem"],["title","Save","type","submit","class","btn btn-info","style","margin-right:2px",3,"click",4,"ngIf"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"width","8rem"],[2,"width","14rem"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],["style","width: 100%;",4,"ngIf"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],[2,"width","100%"],[1,"col-md-12",2,"height","20vh","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","1%"],["scope","col",2,"width","10%"],["scope","col",2,"width","6%"],["scope","col",2,"width","5%"],["scopr","col",2,"width","6%"],["scope","col",2,"width","0%"],["scope","col","style","width: 5%;",4,"ngIf"],[2,"background-color","aliceblue"],["style"," height:28px;",3,"click",4,"ngFor","ngForOf"],[2,"height","28px",3,"click"],[2,"width","1%"],[2,"width","10%"],["type","text","placeholder","Press Enter to select Item","autocomplete","off",3,"disabled","id","ngModel","ngModelChange","keydown.enter","focus"],[2,"width","6%"],[3,"id","ngModel","disabled","ngModelChange","keydown.enter"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[2,"width","5%"],["type","number",2,"text-align","right",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","number",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change"],[2,"width","0%"],["type","date",2,"width","130px",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["type","text","list","costcenter","autocomplete","off",3,"id","ngModel","disabled","ngModelChange"],["id","costcenter"],["type","text",3,"id","ngModel","disabled","ngModelChange","keydown.enter"],["style","width: 5%;",4,"ngIf"],["type","checkbox",2,"height","20px",3,"id","ngModel","change","ngModelChange"],["scope","col",2,"width","2%"],["scope","col",2,"width","8%"],[2,"width","2%"],[2,"width","5%","text-align","right"],[2,"width","8%"]],template:function(i,n){1&i&&(e.YNc(0,yi,23,5,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(_){return n.onSupplierSelected(_)}),e.qZA(),e.TgZ(3,"generic-popup-grid",1,3),e.NdJ("onItemDoubleClick",function(_){return n.onRecurringItemSelected(_)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForSupplier),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForRecurringItems))},dependencies:[j.sg,j.O5,E.YN,E.Kr,E.Fj,E.wV,E.Wl,E.EJ,E.JJ,E.On,K.Zl,j.JJ,j.uU],styles:[".recurring-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:23%;left:5%}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:2px 3px 2px 4px!important}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e6e6e6;padding-left:2px}th[_ngcontent-%COMP%]{font-size:13px;padding-left:2px}td[_ngcontent-%COMP%]{font-size:13px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px}.card-header[_ngcontent-%COMP%]{background-color:silver}label[_ngcontent-%COMP%]{font-size:14px}"]}),M})();var Li=A(94619),R=A(6603);const q=["genericGridSupplier"],a=["genericGridRecurringItem"];function d(M,I){if(1&M&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.s9C("value",i.NAME),e.xp6(1),e.Oqu(i.NAME)}}function h(M,I){if(1&M&&(e.TgZ(0,"option",28),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.s9C("value",i.BATCH),e.xp6(1),e.Oqu(i.BATCH)}}function p(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),e._uU(5,"Stock Variance Adjustment"),e.qZA()()(),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"fieldset")(10,"legend",8),e._uU(11,"Warehouse Selection:"),e.qZA(),e.TgZ(12,"select",9),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.warehouse=s)}),e.YNc(13,d,2,2,"option",10),e.qZA()(),e.TgZ(14,"fieldset")(15,"legend",8),e._uU(16,"Batch Selection:"),e.qZA(),e.TgZ(17,"select",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.Batch=s)})("change",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.batchSelctionForDate(s.target.value))}),e._UZ(18,"option",12),e.YNc(19,h,2,2,"option",10),e.qZA()(),e.TgZ(20,"fieldset")(21,"legend",8),e._uU(22,"Batch Date:"),e.qZA(),e.TgZ(23,"input",13),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.Date=s)}),e.qZA()()(),e.TgZ(24,"div",7)(25,"fieldset")(26,"legend",8),e._uU(27,"Stock Variance Mode Selection:"),e.qZA(),e.TgZ(28,"div",14)(29,"div",15)(30,"div",16)(31,"input",17),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(32,"div",18)(33,"label",19),e._uU(34,"Excess Stock Adjustment"),e.qZA()()(),e.TgZ(35,"div",15)(36,"div",16)(37,"input",20),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(38,"div",18)(39,"label",21),e._uU(40,"Shortage Stock Adjustment"),e.qZA()()(),e.TgZ(41,"div",15)(42,"div",16)(43,"input",22),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(44,"div",18)(45,"label",21),e._uU(46,"Item than not comes in counting adjustment"),e.qZA()()(),e.TgZ(47,"div",15)(48,"div",16)(49,"input",23),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.stockAdjustObj.reportmode=s)}),e.qZA()(),e.TgZ(50,"div",18)(51,"label",21),e._uU(52,"Item counted but not in C-stock Adjustment"),e.qZA()()()()()()()(),e.TgZ(53,"div",24)(54,"div",25)(55,"button",26),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.run())}),e._uU(56,"Run"),e.qZA(),e.TgZ(57,"button",27),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(58,"Close"),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(12),e.Q6J("ngModel",i.stockAdjustObj.warehouse),e.xp6(1),e.Q6J("ngForOf",i.warehouseList),e.xp6(4),e.Q6J("ngModel",i.stockAdjustObj.Batch),e.xp6(2),e.Q6J("ngForOf",i.BatchSelectionList),e.xp6(4),e.Q6J("ngModel",i.stockAdjustObj.Date),e.xp6(8),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode),e.xp6(6),e.Q6J("ngModel",i.stockAdjustObj.reportmode)}}let P=(()=>{class M{constructor(i,n,s,_,f,Q){this.masterService=i,this._trnMainService=n,this.alertService=s,this.adjustmentService=_,this.loadingService=f,this.router=Q,this.isActive=!1,this.warehouseList=[],this.BatchSelectionList=[],this.stockAdjustmentLoaded=new e.vpe,this.gridPopupSettingsForSupplier=new W.sG,this.gridPopupSettingsForRecurringItems=new K.im,this.stockAdjustObj={}}ngOnInit(){this.getWarehouseList()}getWarehouseList(){this.adjustmentService.getWarehouses().subscribe(i=>{this.warehouseList=i})}getBatchList(){this.adjustmentService.getBatchSelectionList().subscribe(i=>{this.BatchSelectionList=i,console.log(this.BatchSelectionList)})}batchSelctionForDate(i){let n;n=this.BatchSelectionList.find(s=>s.BATCH==i),this.stockAdjustObj.Date=n.TRNDATE.substring(0,10),console.log(n)}show(){this.isActive=!0,this.getBatchList()}closeDialog(){this.isActive=!1,this.stockAdjustObj={}}run(){this.stockAdjustmentLoaded.emit(this.stockAdjustObj);let i={BATCH:this.stockAdjustObj.Batch,DATE:this.stockAdjustObj.Date,WARE:this.stockAdjustObj.warehouse,DIVISION:"%",VARIANCEMODE:this.stockAdjustObj.reportmode};this.loadingService.show("Loading data, please wait.."),this.adjustmentService.runBatches(i).subscribe(n=>{console.log("result on save",n),"ok"==n.status?(this.loadingService.hide(),this._trnMainService.TrnMainObj.ProdList=n.result,this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1):(this.loadingService.hide(),this.alertService.info(n.result.error))},n=>{this.loadingService.hide(),this.alertService.info(n)})}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(R.z),e.Y36(B.V),e.Y36(Le.F0))},M.\u0275cmp=e.Xpm({type:M,selectors:[["stockadjustment-popup"]],viewQuery:function(i,n){if(1&i&&(e.Gf(q,5),e.Gf(a,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGridSupplier=s.first),e.iGM(s=e.CRH())&&(n.genericGridRecurringItem=s.first)}},outputs:{stockAdjustmentLoaded:"stockAdjustmentLoaded"},decls:1,vars:1,consts:[["class","stockadjustment-container",4,"ngIf"],[1,"stockadjustment-container"],[1,"card"],[1,"card-header"],[1,"row"],[1,"row",2,"margin-top","5px","margin-bottom","10px","height","auto"],[1,"col-md-12","row"],[1,"col-md-6"],[1,"legend-class"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"form-control","input-text",2,"padding","0px 5px",3,"ngModel","ngModelChange","change"],["value",""],["type","date",1,"form-control",3,"ngModel","ngModelChange"],[2,"margin-top","4px"],[1,"row",2,"margin-bottom","-3%"],[1,"col-md-1","pd0"],["type","radio","name","reportOption","value","2",1,"radio",3,"ngModel","ngModelChange"],["calss","col"],[1,"variance-font",2,"width","100%"],["type","radio","name","reportOption","value","3",1,"radio",3,"ngModel","ngModelChange"],[2,"width","100%"],["type","radio","name","reportOption","value","5",1,"radio",3,"ngModel","ngModelChange"],["type","radio","name","reportOption","value","4",1,"radio",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"row","pull-right"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[3,"value"]],template:function(i,n){1&i&&e.YNc(0,p,59,9,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.YN,E.Kr,E.Fj,E.EJ,E._,E.JJ,E.On],styles:[".stockadjustment-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:23%;left:50%}.card-header[_ngcontent-%COMP%]{background:#bcbebe}.button-group[_ngcontent-%COMP%]{position:relative;left:63%;top:3%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:95%;margin-left:2px;height:25px;font-size:12px}fieldset[_ngcontent-%COMP%]{border:1.6px solid #bcbebe}legend[_ngcontent-%COMP%]{font-weight:700;font-size:13px;width:auto;margin-bottom:2px}.radio[_ngcontent-%COMP%]{margin-top:-1px;height:14px}.card-footer[_ngcontent-%COMP%]{padding:5px}"]}),M})(),X=(()=>{class M{transform(i,n){if(i)return""!=n&&null!=n?i.filter(s=>{const _=n.replace(/[^A-Z0-9]/gi,"").toLowerCase();if(-1!==(s.DESCA?s.DESCA.replace(/[^A-Z0-9]/gi,"").toLowerCase():"").indexOf(_))return s}):i}}return M.\u0275fac=function(i){return new(i||M)},M.\u0275pipe=e.Yjl({name:"searchData",type:M,pure:!1}),M})();function oe(M,I){1&M&&(e.TgZ(0,"th",21),e._uU(1,"BatchId"),e.qZA())}function Me(M,I){if(1&M&&(e.TgZ(0,"td",34),e._uU(1),e.qZA()),2&M){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.BATCHID)}}function Ae(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td",26)(2,"input",27),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.CHECKED=s)}),e.qZA()(),e.TgZ(3,"td",28),e._uU(4),e.qZA(),e.TgZ(5,"td",29),e._uU(6),e.qZA(),e.TgZ(7,"td",30),e._uU(8),e.qZA(),e.YNc(9,Me,2,1,"td",31),e.TgZ(10,"td",32),e._uU(11),e.qZA(),e.TgZ(12,"td",33),e._uU(13),e.qZA()()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(2);e.xp6(2),e.Q6J("ngModel",i.CHECKED),e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.DESCA),e.xp6(1),e.Q6J("ngIf",1==s._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(2),e.Oqu(i.BATCH),e.xp6(2),e.Oqu(i.totalNegativeQty)}}function Se(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"h5",4),e._uU(4,"Negative Stock Item List "),e.qZA(),e.TgZ(5,"div",5)(6,"button",6),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e.TgZ(7,"span",7),e._uU(8,"\xd7"),e.qZA()()()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"input",11),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.filter=s)}),e.qZA()()()(),e.TgZ(13,"div",12)(14,"table",13)(15,"thead")(16,"tr",14)(17,"th",15)(18,"input",16),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.selectAll(s.target.checked))}),e.qZA()(),e.TgZ(19,"th",17),e._uU(20,"Sn."),e.qZA(),e.TgZ(21,"th",18),e._uU(22,"Item Code"),e.qZA(),e.TgZ(23,"th",19),e._uU(24,"Item Name"),e.qZA(),e.YNc(25,oe,2,0,"th",20),e.TgZ(26,"th",21),e._uU(27,"Batch"),e.qZA(),e.TgZ(28,"th",22),e._uU(29,"Negative Stock"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,Ae,14,7,"tr",23),e.ALo(32,"searchData"),e.qZA()()(),e.TgZ(33,"div",24)(34,"button",25),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.applyClicked())}),e._uU(35,"Apply"),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(12),e.Q6J("ngModel",i.filter),e.xp6(13),e.Q6J("ngIf",1==i._trnMainService.userSetting.EnableBatchIdInAdjustment),e.xp6(6),e.Q6J("ngForOf",e.xi3(32,3,i.negativeItemStockList,i.filter))}}let me=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterservice=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.isActive=!1,this.filter=""}ngOnInit(){}selectAll(i){this.negativeItemStockList.forEach(n=>n.CHECKED=i)}showDialog(i){console.log("negative item.",i),this.negativeItemStockList=i,this.isActive=!0}closeDialog(){this.isActive=!1}applyClicked(){let i;i=this.negativeItemStockList.filter(s=>1==s.CHECKED).map(s=>s.MCODE);let n=[...new Set(i)];this._trnMainService.AutoLoadNegativeStock(n).subscribe(s=>{console.log("auto load neg stock",s),"ok"==s.status?(this._trnMainService.TrnMainObj.ProdList=s.result,this._trnMainService.TrnMainObj.ProdList.forEach(_=>_.isDisabled=!0),this._trnMainService.calculateBatchAdjustmentVariance()):this.alertService.error("Failed to save..."),this.isActive=!1})}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["autoadjustment-popup"]],decls:1,vars:1,consts:[["class","customer_container",4,"ngIf"],[1,"customer_container"],[1,"card"],[1,"card-header"],[1,"page-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-md-12","row",2,"margin-top","3px","margin-bottom","-2px"],[1,"col-md-6",2,"margin","2px 0px","display","flex","padding-left","0px","margin-left","-8px"],["type","search","name","filter","autocomplete","off","placeholder","Enter item name to search",1,"form-control",2,"width","100%",3,"ngModel","ngModelChange"],[1,"card-body"],[1,"table","table-striped"],[2,"border-bottom","2px solid #E6e6e6","height","25px","background","#9ccae4"],["scope","col",2,"width","4%"],["type","checkbox",2,"width","16px",3,"change"],["scope","col",2,"width","3%"],["scope","col",2,"width","6%"],["scope","col",2,"width","20%"],["scope","col","style","width: 10%;",4,"ngIf"],["scope","col",2,"width","10%"],["scope","col",2,"width","8%"],[4,"ngFor","ngForOf"],[1,"card-footer"],["type","button",1,"btn","btn-info",3,"click"],["scope","col",2,"width","5%"],["type","checkbox",2,"position","relative","height","20px","width","16px","margin-left","4px",3,"ngModel","ngModelChange"],[2,"width","3%"],[2,"width","6%"],[2,"width","20%"],["style","width: 13%;",4,"ngIf"],[2,"width","10%"],[2,"width","8%","text-align","center"],[2,"width","13%"]],template:function(i,n){1&i&&e.YNc(0,Se,36,6,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.Fj,E.Wl,E.JJ,E.On,X],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:50%;top:25%;left:52%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:3.7vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.8rem;padding:5px}.card-header[_ngcontent-%COMP%]{padding:5px 3px;background:silver}.card-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:43vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px 2px;vertical-align:middle}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:13px}"]}),M})();var Ve=A(19773),Ue=A(74417);let Ri=(()=>{class M{transform(i,n){if(i)return n?i.filter(s=>{const _=n.replace(/[^A-Z0-9]/gi,"").toLowerCase(),f=s.MENUCODE?s.MENUCODE.replace(/[^A-Z0-9]/gi,"").toLowerCase():"",Q=s.ITEMDESC?s.ITEMDESC.replace(/[^A-Z0-9]/gi,"").toLowerCase():"";if(-1!==f.indexOf(_)||-1!==Q.indexOf(_))return s}):i}}return M.\u0275fac=function(i){return new(i||M)},M.\u0275pipe=e.Yjl({name:"searchId",type:M,pure:!0}),M})();function ze(M,I){1&M&&(e.TgZ(0,"th",15),e._uU(1,"Edit Checkbox"),e.qZA())}function Te(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"td")(1,"input",28),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw().$implicit,f=e.oxw(2);return e.KtG(f.checkBoxEvent(s,_))}),e.qZA()()}if(2&M){const i=e.oxw().$implicit;e.xp6(1),e.Q6J("checked",i.checked)}}function rt(M,I){1&M&&e.GkF(0)}const Xe=function(){return{updateOn:"blur"}};function pe(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit,f=e.oxw(2);return e.KtG(f.amountChange(s,_))}),e.qZA()}if(2&M){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ALTERNATEQUANTIY)("disabled",!(null!=i&&i.checked))("ngModelOptions",e.DdM(3,Xe))}}function ot(M,I){if(1&M&&e._uU(0),2&M){const i=e.oxw().$implicit;e.hij(" ",i.ALTERNATEQUANTIY,"1 ")}}function Be(M,I){1&M&&e.GkF(0)}function et(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit,f=e.oxw(2);return e.KtG(f.rateChange(s,_))}),e.qZA()}if(2&M){const i=e.oxw().$implicit;e.Q6J("ngModel",i.ALTRATE)("disabled",!(null!=i&&i.checked))("ngModelOptions",e.DdM(3,Xe))}}function Ni(M,I){if(1&M&&e._uU(0),2&M){const i=e.oxw().$implicit;e.hij(" ",i.ALTRATE," ")}}function ji(M,I){if(1&M&&(e.TgZ(0,"tr",19),e.YNc(1,Te,2,1,"td",20),e.TgZ(2,"td",19),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td",19),e._uU(7),e.qZA(),e.TgZ(8,"td",19),e._uU(9),e.qZA(),e.TgZ(10,"td",21),e.YNc(11,rt,1,0,"ng-container",22),e.YNc(12,pe,1,4,"ng-template",null,23,e.W1O),e.YNc(14,ot,1,1,"ng-template",null,24,e.W1O),e.qZA(),e.TgZ(16,"td",25),e.YNc(17,Be,1,0,"ng-container",22),e.YNc(18,et,1,4,"ng-template",null,26,e.W1O),e.YNc(20,Ni,1,1,"ng-template",null,27,e.W1O),e.qZA(),e.TgZ(22,"td",19),e._uU(23),e.ALo(24,"number"),e.qZA(),e.TgZ(25,"td",19),e._uU(26),e.ALo(27,"number"),e.qZA(),e.TgZ(28,"td",19),e._uU(29),e.ALo(30,"number"),e.qZA(),e.TgZ(31,"td",19),e._uU(32),e.ALo(33,"number"),e.qZA(),e.TgZ(34,"td",19),e._uU(35),e.ALo(36,"number"),e.qZA(),e.TgZ(37,"td",19),e._uU(38),e.qZA(),e.TgZ(39,"td",19),e._uU(40),e.qZA()()),2&M){const i=I.$implicit,n=I.index,s=e.MAs(13),_=e.MAs(15),f=e.MAs(19),Q=e.MAs(21),ee=e.oxw(2);e.xp6(1),e.Q6J("ngIf",ee.editLargeEntry),e.xp6(2),e.hij(" ",n+1," "),e.xp6(2),e.Oqu(i.MENUCODE),e.xp6(2),e.Oqu(i.ITEMDESC),e.xp6(2),e.Oqu(i.ALTUNIT),e.xp6(2),e.Q6J("ngIf",ee.editLargeEntry)("ngIfThen",s)("ngIfElse",_),e.xp6(6),e.Q6J("ngIf",ee.editLargeEntry)("ngIfThen",f)("ngIfElse",Q),e.xp6(6),e.hij(" ",e.xi3(24,18,i.AMOUNT,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(27,21,i.SELLRATEBEFORETAX,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(30,24,i.MRP,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(33,27,i.W_SELLRATEBEFORETAX,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(36,30,i.W_MRP,"1.2-2")," "),e.xp6(3),e.Oqu(i.MFGDATE),e.xp6(2),e.Oqu(i.EXPDATE)}}function wi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h5",8),e._uU(8,"Previous Fiscal Year"),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",9)(12,"input",10),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.searchbyid=s)}),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.hide())}),e._uU(14," \xd7 "),e.qZA()()()()(),e._UZ(15,"hr"),e.qZA(),e.TgZ(16,"cdk-virtual-scroll-viewport",12)(17,"table")(18,"thead")(19,"tr",13),e.YNc(20,ze,2,0,"th",14),e.TgZ(21,"th",15),e._uU(22,"S.No."),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Code"),e.qZA(),e.TgZ(25,"th",16),e._uU(26,"Description"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"Unit"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"Quantity"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"Rate"),e.qZA(),e.TgZ(33,"th"),e._uU(34,"Amt"),e.qZA(),e.TgZ(35,"th"),e._uU(36,"Sales Price"),e.qZA(),e.TgZ(37,"th"),e._uU(38,"Sales Price(W/V)"),e.qZA(),e.TgZ(39,"th"),e._uU(40,"WSP"),e.qZA(),e.TgZ(41,"th"),e._uU(42,"WSP(W/V)"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Mfg Date"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"Exp Date"),e.qZA()()(),e.TgZ(47,"tbody",17),e.YNc(48,ji,41,33,"tr",18),e.ALo(49,"searchId"),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(10),e.hij("[",i.OpeningList[0].VCHRNO,"]"),e.xp6(2),e.Q6J("ngModel",i.searchbyid),e.xp6(4),e.Q6J("itemSize",20),e.xp6(4),e.Q6J("ngIf",i.editLargeEntry),e.xp6(28),e.Q6J("cdkVirtualForOf",e.xi3(49,5,i.OpeningList,i.searchbyid))}}let tt=(()=>{class M{constructor(i,n,s,_){this._transactionService=i,this.productHelper=n,this.alert=s,this.spinnerService=_,this.isActive=!1,this.OpeningList=[],this.editLargeEntry=!1,this.dataToBeSent=[],this.total=0}ngOnInit(){this._transactionService.TrnMainObj.largeDataEntryEdit=!1,this.subscription=this.productHelper.saveButtonClickedSubject$.pipe((0,Ve.zg)(i=>(this.total=0,0===this.dataToBeSent.length?(this.alert.warning("No product is selected, First select a product and then only you can proceed"),(0,ge.of)("end")):(this.OpeningList.forEach(s=>{this.total+=s.AMOUNT}),this.productHelper.saveEditDataOfUpdateOpeningFromCarryFarward({data:{ProdList:this.dataToBeSent,VCHRNO:this._transactionService.TrnMainObj.VCHRNO,DIVISION:this._transactionService.TrnMainObj.DIVISION,PhiscalID:this._transactionService.TrnMainObj.PhiscalID,guid:this.largeEntryGuid,MWAREHOUSE:this._transactionService.TrnMainObj.MWAREHOUSE,REMARKS:this._transactionService.TrnMainObj.REMARKS,TOTAMNT:this.total,NETAMNT:this.total}}).pipe((0,te.K)(s=>(this.alert.error(s.error),(0,ge.of)("Error")))))))).subscribe({next:i=>{"end"!==i&&"Error"!==i&&(this.spinnerService.hide(),this.dataToBeSent=[],this.hide(),this.alert.success(i.result))}})}show(i,n,s){"largeDataEntryEdit"===n?(this.editLargeEntry=!0,this.largeEntryGuid=s):"noLargeDataEntryEdit"===n&&(this.editLargeEntry=!1),this.isActive=!0,this.OpeningList=i;let _=0,f=0;this.OpeningList?.length>0&&(this.OpeningList.forEach(Q=>{Q.checked=void 0,_+=Q.ALTERNATEQUANTIY,f+=Q.AMOUNT}),this._transactionService.TrnMainObj.TOTALQTY=_,this._transactionService.TrnMainObj.GROSSAMNT=f),this._transactionService.TrnMainObj.largeDataEntryEdit="largeDataEntryEdit"===n}hide(){this.dataToBeSent=[],this.isActive=!1,this._transactionService.TrnMainObj.largeDataEntryEdit=!1}checkBoxEvent(i,n){i.target.checked?(this.dataToBeSent.push(n),n.checked=!0):(n.checked=void 0,this.dataToBeSent=this.dataToBeSent.filter(s=>s?.MCODE!==n.MCODE))}amountChange(i,n){let s;s=i<0||null===i?0:i,n.ALTERNATEQUANTIY=new Number(s),n.ALTQTY_IN=s,n.REALQTY_IN=s,n.QUANTITY=s,n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}rateChange(i,n){let s;s=i<0||null===i?0:i,n.ALTRATE=new Number(s),n.AMOUNT=n.ALTERNATEQUANTIY*n.ALTRATE}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this._transactionService.TrnMainObj.largeDataEntryEdit=!1}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(N.p),e.Y36(ke.h),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-opening-from-previous-year"]],decls:1,vars:1,consts:[["class","opening-container",4,"ngIf"],[1,"opening-container"],[1,"row",2,"width","100%"],[1,"col-12","col-md-12"],[2,"background-color","#ffffff"],[1,"row"],[1,"modal-header","col-md-12",2,"border","0px"],[1,"col-md-6",2,"display","flex","align-items","baseline"],[1,"modal-title"],[1,"col-md-6"],["type","text","placeholder","Search by Menu code or Description","name","searchbyid",1,"container-input","ms-2",3,"ngModel","ngModelChange"],["type","button","data-dismiss","modal","aria-hidden","true",1,"close",3,"click"],[1,"mb-4",3,"itemSize"],[2,"background","#eeeeee","color","black"],["scope","col",4,"ngIf"],["scope","col"],[2,"width","20%"],[2,"border","1px"],["style","border: 1px solid #e6e6e6",4,"cdkVirtualFor","cdkVirtualForOf"],[2,"border","1px solid #e6e6e6"],[4,"ngIf"],[2,"border","1px solid #e6e6e6","width","10px"],[4,"ngIf","ngIfThen","ngIfElse"],["inputQuantity",""],["quantity",""],[2,"border","1px solid #e6e6e6","width","10%"],["inputAltRate",""],["altRate",""],["type","checkbox",3,"checked","change"],["type","number",3,"ngModel","disabled","ngModelOptions","ngModelChange"]],template:function(i,n){1&i&&e.YNc(0,wi,50,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.O5,Ue.xd,Ue.x0,Ue.N7,E.Fj,E.wV,E.JJ,E.On,j.JJ,Ri],styles:[".opening-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:98.4%;top:30%;left:4%;box-shadow:#3c40434d 0 1px 2px,#3c404326 0 2px 6px 2px}.opening-container[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{margin-left:0}.opening-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:0}@media (min-width: 768px) and (max-width: 1024px){.opening-container[_ngcontent-%COMP%]{left:5.6%}}.close[_ngcontent-%COMP%]{padding:2px;right:26px;position:absolute;margin:2px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem .3rem}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.3rem}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{height:27rem;border:1px solid #D1D6D8;width:96%;margin-left:auto;margin-right:auto}tbody[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}hr[_ngcontent-%COMP%]{margin-top:.2rem;margin-bottom:.5rem}.container-input[_ngcontent-%COMP%]{margin-top:7px;right:65px;width:35%;position:absolute}"]}),M})();const $i=["Division"];function zi(M,I){if(1&M&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.Q6J("value",i.INITIAL),e.xp6(1),e.hij(" ",i.NAME," ")}}function Xi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),e._uU(5,"Opening From Previous Fiscal Year"),e.qZA()(),e.TgZ(6,"div",6)(7,"button",7),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelPopup())}),e._uU(8,"Cancel"),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.savePopup())}),e._uU(10," Save "),e.qZA()()(),e.TgZ(11,"div",9)(12,"div",10)(13,"div")(14,"div",11)(15,"div",12)(16,"label",13),e._uU(17,"DIVISION:"),e.qZA()(),e.TgZ(18,"div",14)(19,"select",15,16),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.DIV=s)}),e._UZ(21,"option",17),e.YNc(22,zi,2,2,"option",18),e.qZA()()()()()()()()}if(2&M){const i=e.oxw();e.xp6(19),e.Q6J("ngModel",i.DIV),e.xp6(3),e.Q6J("ngForOf",i.divisionLists)}}let en=(()=>{class M{constructor(i,n,s,_){this.masterService=i,this.alertService=n,this._trnMainService=s,this.spinnerService=_,this.DIV="",this.onSaveParty=new e.vpe,this.loggedinUserDetail={},this.divisionLists=[],this.masterService.getAllDivisions().subscribe(f=>{this.divisionLists=f})}ngOnInit(){}resetPopup(){}savePopup(){this.spinnerService.show("Data Procesing Please Wait... "),this.DIV&&this.masterService.saveFiscalYear(2,0,this.DIV).subscribe(i=>{"ok"==i.status?this.alertService.success(i.result):this.alertService.info(i.result.error),this.isActive=!1,this.spinnerService.hide()})}cancelPopup(){this.isActive=!1,this.resetPopup()}show(){this.isActive=!0,setTimeout(()=>{this.Division.nativeElement.focus()},10)}hide(){this.isActive=!1}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(O.P),e.Y36(Y.c),e.Y36(N.p),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["previous-year-opening"]],viewQuery:function(i,n){if(1&i&&e.Gf($i,5),2&i){let s;e.iGM(s=e.CRH())&&(n.Division=s.first)}},outputs:{onSaveParty:"onSaveParty"},decls:1,vars:1,consts:[["class","party_container","role","document",4,"ngIf"],["role","document",1,"party_container"],[1,"modal-content",2,"padding","14px 16px 10px 16px","margin","0","width","42vw","height","24vh"],[1,"modal-header","row"],[1,"col-md-7"],[1,"modal-title","pull-right",2,"font-weight","600"],[1,"col-md-5"],["type","button",1,"btn","btn-info","pull-right",2,"width","80px",3,"click"],["type","button","title","onSave",1,"btn","btn-info","pull-right",2,"margin-right","10px","width","80px","margin-top","15px",3,"click"],[1,"row"],[1,"col-md-8"],[1,"form-group","row",2,"margin-left","4px"],[1,"col-md-4"],[1,"pull-right",2,"font-weight","bold","text-align","right","margin-top","24px"],[1,"col-md-8",2,"width","65%","margin-top","20px"],["id","partygroup",1,"form-control",2,"padding","0px 8px",3,"ngModel","ngModelChange"],["Division",""],["value","%"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,n){1&i&&e.YNc(0,Xi,23,2,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.YN,E.Kr,E.EJ,E.JJ,E.On],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:23px;color:#000}","td[_ngcontent-%COMP%] {\n      border: 1px solid #e6e6e6;\n    }\n  \n    input[_ngcontent-%COMP%] {\n      padding: 8px;\n    }\n  \n    .form-group[_ngcontent-%COMP%] {\n      margin-bottom: 0rem;\n    }\n  \n    .party_container[_ngcontent-%COMP%] {\n      position: fixed !important;\n      transform: translate(0px, -35px);\n      background: #ffffff;\n      z-index: 99999;\n      top: 30%;\n      left: 29%;\n    }"]}),M})();const tn=["genericGrid"],nn=["genericGridTerms"];function rn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td",25),e._uU(2),e.qZA(),e.TgZ(3,"td",26),e._uU(4),e.qZA(),e.TgZ(5,"td",27),e._uU(6),e.qZA(),e.TgZ(7,"td",28)(8,"div",29)(9,"button",30),e.NdJ("click",function(){const _=e.CHM(i).index,f=e.oxw(2);return e.KtG(f.deleteRow(_))}),e._UZ(10,"img",31),e.qZA()()()()}if(2&M){const i=I.$implicit,n=I.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(i.label),e.xp6(2),e.Oqu(i.termConditions)}}function on(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"h5"),e._uU(5,"Apply Terms and Conditions"),e.qZA(),e.TgZ(6,"div",7)(7,"button",8),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(8,"APPLY"),e.qZA(),e.TgZ(9,"button",9),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(10,"CANCEL"),e.qZA()()()(),e.TgZ(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",6)(15,"div",13)(16,"label",14),e._uU(17,"Terms and Conditions Label: "),e.qZA(),e.TgZ(18,"input",15),e.NdJ("keydown.enter",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.customerEnterCommand(s))})("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.selectedTermsObject.label=s)}),e.qZA(),e.TgZ(19,"button",16),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onAddTerms())}),e._uU(20,"ADD"),e.qZA()()()(),e.TgZ(21,"table",17)(22,"thead",18)(23,"tr",19)(24,"th",20),e._uU(25,"S.N"),e.qZA(),e.TgZ(26,"th",21),e._uU(27,"Label"),e.qZA(),e.TgZ(28,"th",22),e._uU(29,"TermsAndConditions"),e.qZA()()(),e.TgZ(30,"tbody",23),e.YNc(31,rn,11,3,"tr",24),e.qZA()()()()()()}if(2&M){const i=e.oxw();e.xp6(18),e.Q6J("ngModel",i.selectedTermsObject.label),e.xp6(13),e.Q6J("ngForOf",i.valuesList)}}let sn=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.okClicked=new e.vpe,this.gridPopupSettings=new K.im,this.gridPopupSettingsForTerms=new W.sG,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.termConditionList=[],this.termsandconditionArray=[],this.termsCondSearched=new E.NI,this.selectTermsJSON="",this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}ngOnInit(){this.getTermsandConditionsList()}valueChange(i){this._trnMainService.searchedTermsandCondition=i.TermsAndConditions,this.termsSearchedId=i.ID,this.selectTermsJSON=JSON.stringify(i)}getTermsandConditionsList(){this.masterService.getPOTermsAndConditions().subscribe(i=>{"ok"==i.status&&(this.termConditionList=i.result)})}submit(){this.isSubmitting=!0,this.spinnerService.show("Applying Scheme wait....");let i=this.valuesList.map(n=>n.id).toString();this.okClicked.emit(i),this.spinnerService.hide(),this.closeDialog(),this.getTermsandConditionsList()}closeDialog(){this.isActive=!1}show(i,n){this._trnMainService.TrnMainObj.BILLTO||(this.selectedTermsObject.label="",this.valuesList=[]),this.isActive=!0,i&&i.length>0&&(this.valuesList=i),this.mode=n}hide(){this.isActive=!1}customerEnterCommand(i){this.getTermList(),this.genericGridTerms.show()}getTermList(){this.gridPopupSettingsForTerms={title:"Terms and Condition",apiEndpoints:"/getPOTermsAndConditionsPagedList",defaultFilterIndex:0,useDefinefilterValue:this._trnMainService.TrnMainObj.BILLTO,columns:[{key:"ID",title:"ID",hidden:!1,noSearch:!1},{key:"Label",title:"NAME",hidden:!1,noSearch:!1}]}}onCustomerSelected(i){this.selectedTermsObject.id=i.ID,this.selectedTermsObject.label=i.Label,this.selectedTermsObject.termConditions=i.TermsAndConditions}onAddTerms(){if(""!=this.selectedTermsObject.id){if(this.valuesList&&this.valuesList.length>0&&this.valuesList?.find(n=>n.id==this.selectedTermsObject.id))return void this.alertService.info("Can not add duplicate terms and condition");this.valuesList.push(Object.assign({},this.selectedTermsObject))}}clearTermsAndCondition(){this.valuesList=[],this.selectedTermsObject={id:"",label:"",termConditions:""}}deleteRow(i){this.valuesList.splice(i,1)}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["termsncondition-popup-dialog"]],viewQuery:function(i,n){if(1&i&&(e.Gf(tn,5),e.Gf(nn,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.genericGrid=s.first),e.iGM(s=e.CRH())&&(n.genericGridTerms=s.first)}},outputs:{okClicked:"okClicked"},decls:3,vars:2,consts:[["class","terms-container",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridTerms",""],[1,"terms-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body",2,"overflow","auto"],[1,"col-md-12",2,"margin-top","1rem"],[1,"col-md-8"],[1,"d-flex","align-items-center","custom-gap"],[2,"width","50%"],["type","text","id","customerselectid","placeholder","Press ENTER to Select","readonly","",3,"ngModel","keydown.enter","ngModelChange"],["type","button","title","Cancel",1,"btn","btn-info","ml-5",3,"click"],["id","BlueHeaderResizableTable",1,"table","table-striped","mt-3"],[1,"stickHead"],[2,"line-height","2rem"],[1,"fontsize",2,"width","5%","font-weight","bold"],[1,"fontsize",2,"width","15%","font-weight","bold"],[1,"fontsize",2,"width","20%","font-weight","bold"],[2,"scrollbar-3dlight-color","#FFFFFF","scrollbar-arrow-color","#000000","scrollbar-base-color","#FF9999","scrollbar-darkshadow-color","#000000","scrollbar-face-color","#000000","scrollbar-highlight-color","#000000","scrollbar-shadow-color","#0033CC"],[4,"ngFor","ngForOf"],[2,"width","5%"],[2,"width","15%"],[2,"width","20%"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"]],template:function(i,n){1&i&&(e.YNc(0,on,32,2,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(_){return n.onCustomerSelected(_)}),e.qZA()),2&i&&(e.Q6J("ngIf",n.isActive),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForTerms))},dependencies:[j.sg,j.O5,E.Fj,E.JJ,E.On,K.Zl],styles:[".terms-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:30rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}.custom-gap[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:25px}",".closeTooltip[_ngcontent-%COMP%] {\n  \n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}"]}),M})();function an(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h6",5),e._uU(5,"Confirmation Popup"),e.qZA()()(),e.TgZ(6,"div",6)(7,"div",7)(8,"p",8),e._uU(9," Member has redeemable points remaining. Do you want to redeem points as discount? "),e.qZA(),e._UZ(10,"hr",9),e.TgZ(11,"p",8),e._uU(12," Total Points to be Redeemed: "),e.TgZ(13,"span",10),e._uU(14),e.ALo(15,"number"),e.qZA()(),e.TgZ(16,"p",8),e._uU(17," Discount to be applied on Points Redeemed: "),e.TgZ(18,"span",10),e._uU(19),e.ALo(20,"number"),e.qZA()()()()(),e.TgZ(21,"div",11)(22,"div",12)(23,"button",13),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.submit())}),e._uU(24,"OK"),e.qZA(),e.TgZ(25,"button",14),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(26,"CANCEL"),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(14),e.Oqu(e.xi3(15,2,i.redeemPoint,"1.2-2")),e.xp6(5),e.hij("Rs. ",e.xi3(20,5,i.discountOnRedeem,"1.2-2"),"")}}let cn=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.okClicked=new e.vpe,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.TrnMainObj={}}ngOnInit(){}submit(){this.isActive=!1,this.okClicked.emit(!0)}closeDialog(){this.isActive=!1,this.okClicked.emit(!1)}show(){this.isActive=!0,this._trnMainService.pointRedeem().subscribe(i=>{this.redeemPoint=i,this.discountOnRedeem=this._trnMainService.TrnMainObj.MEMBERSHIPDISCOUNT}),console.log("redeem ko log",this.redeemPoint)}hide(){this.isActive=!1}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["member-point-confirm-popup"]],outputs:{okClicked:"okClicked"},decls:1,vars:1,consts:[["class","confirmation-container",4,"ngIf"],[1,"confirmation-container"],[1,"card"],[1,"card-header",2,"background-color","lightsteelblue","padding","0.5rem 1.25rem"],[1,"row"],[2,"font-size","1.1rem"],[1,"row",2,"margin-top","1rem"],[1,"mx-4"],[2,"font-size","15px","font-weight","500"],[2,"margin-top","4px","margin-bottom","2px"],[2,"color","green"],[1,"col-md-12",2,"display","flex","align-items","flex-end","justify-content","center"],[1,"button-group","my-2"],["type","button",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",2,"margin-right","2px","width","75px","font-size","12px",3,"click"]],template:function(i,n){1&i&&e.YNc(0,an,27,8,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.O5,j.JJ],styles:[".confirmation-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:33%;top:33%;left:37%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute}.card[_ngcontent-%COMP%]{height:15rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),M})();function ln(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr",24)(1,"td",25),e._uU(2),e.qZA(),e.TgZ(3,"td",26)(4,"input",27),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ITEMDESC=s)}),e.qZA()(),e.TgZ(5,"td",28)(6,"input",27),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.MANUFACTURER=s)}),e.qZA()(),e.TgZ(7,"td",29)(8,"input",30),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ALTUNIT=s)}),e.qZA()(),e.TgZ(9,"td",31)(10,"input",32),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ALTERNATEQUANTIY=s)}),e.qZA()(),e.TgZ(11,"td",33),e._UZ(12,"input",34),e.ALo(13,"twoDigitNumber"),e.qZA(),e.TgZ(14,"td",29)(15,"input",35),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.INDDISCOUNTRATE=s)}),e.qZA()(),e.TgZ(16,"td",33),e._UZ(17,"input",36),e.ALo(18,"twoDigitNumber"),e.qZA(),e.TgZ(19,"td",37),e._UZ(20,"input",38),e.qZA(),e.TgZ(21,"td",39),e._uU(22),e.ALo(23,"twoDigitNumber"),e.qZA(),e.TgZ(24,"td",39),e._uU(25),e.ALo(26,"twoDigitNumber"),e.qZA(),e.TgZ(27,"td",39),e._uU(28),e.ALo(29,"twoDigitNumber"),e.qZA()()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(2);e.xp6(1),e.MGl("id","sno",n,""),e.xp6(1),e.hij(" ",n+1," "),e.xp6(2),e.MGl("id","mixeddesc",n,""),e.Q6J("ngModel",i.ITEMDESC),e.xp6(2),e.MGl("id","account",n,""),e.Q6J("ngModel",i.MANUFACTURER),e.xp6(2),e.MGl("id","mixedunit",n,""),e.Q6J("ngModel",i.ALTUNIT),e.xp6(2),e.MGl("id","mixedquantity",n,""),e.Q6J("ngModel",i.ALTERNATEQUANTIY),e.xp6(2),e.MGl("id","mixedrate",n,""),e.Q6J("ngModel",s.applyPipeInRate?e.lcZ(13,26,i.ALTRATE):i.ALTRATE),e.xp6(3),e.MGl("id","mixeddiscount",n,""),e.Q6J("ngModel",i.INDDISCOUNTRATE),e.xp6(2),e.MGl("id","mixeddiscountAmt",n,""),e.Q6J("ngModel",e.lcZ(18,28,s._trnMainService.nullToZeroConverter(i.INDDISCOUNT))),e.xp6(2),e.MGl("id","mixedmrp",n,""),e.xp6(1),e.Q6J("ngModel",i.CRATE)("disabled",1==s._trnMainService.disableAllFieldinPurchase)("readonly",!0),e.xp6(1),e.MGl("id","mixedamntId",n,""),e.xp6(1),e.hij(" ",e.lcZ(23,30,s._trnMainService.nullToZeroConverter(i.AMOUNT))," "),e.xp6(2),e.MGl("id","mixedvatvalue",n,""),e.xp6(1),e.hij(" ",e.lcZ(26,32,s._trnMainService.nullToZeroConverter(i.VAT))," "),e.xp6(2),e.MGl("id","mixednetamount",n,""),e.xp6(1),e.hij(" ",e.lcZ(29,34,s._trnMainService.nullToZeroConverter(i.NETAMOUNT))," ")}}function hn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5"),e._uU(5,"Preview Bill"),e.qZA(),e.TgZ(6,"div",5)(7,"button",6),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeDialog())}),e._uU(8,"Close"),e.qZA()()()(),e.TgZ(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"table",11)(14,"thead")(15,"tr",12)(16,"th",13),e._uU(17,"Sn."),e.qZA(),e.TgZ(18,"th",14),e._uU(19,"Description"),e.qZA(),e.TgZ(20,"th",15),e._uU(21,"Account"),e.qZA(),e.TgZ(22,"th",16),e._uU(23,"Unit"),e.qZA(),e.TgZ(24,"th",17),e._uU(25,"Quantity"),e.qZA(),e.TgZ(26,"th",18),e._uU(27,"P.Rate"),e.qZA(),e.TgZ(28,"th",16),e._uU(29,"Dis%"),e.qZA(),e.TgZ(30,"th",18),e._uU(31,"Dis Amt"),e.qZA(),e.TgZ(32,"th",18),e._uU(33,"Net Rate"),e.qZA(),e.TgZ(34,"th",18),e._uU(35,"Amt"),e.qZA(),e.TgZ(36,"th",18),e._uU(37,"VAT"),e.qZA(),e.TgZ(38,"th",18),e._uU(39,"Net Amt"),e.qZA()()(),e.TgZ(40,"tbody",19),e.YNc(41,ln,30,36,"tr",20),e.qZA()()()()()(),e.TgZ(42,"div",21)(43,"table",11)(44,"tr",22)(45,"th",23),e._uU(46),e.qZA(),e.TgZ(47,"th",23),e._uU(48),e.qZA(),e.TgZ(49,"th",23),e._uU(50),e.qZA(),e.TgZ(51,"th",23),e._uU(52),e.qZA(),e.TgZ(53,"th",23),e._uU(54),e.qZA(),e.TgZ(55,"th",23),e._uU(56),e.qZA()()()()()()}if(2&M){const i=e.oxw();e.xp6(41),e.Q6J("ngForOf",i.mergedProductList),e.xp6(5),e.hij("TOTAL QTY: ",i._trnMainService.TrnMainObj.TOTALQTY," "),e.xp6(2),e.hij("GROSS: ",i._trnMainService.TrnMainObj.GROSSAMNT," "),e.xp6(2),e.hij("TAXABLE: ",i._trnMainService.TrnMainObj.TAXABLE," "),e.xp6(2),e.hij("NON TAXABLE: ",i._trnMainService.TrnMainObj.NONTAXABLE,""),e.xp6(2),e.hij("VAT: ",i._trnMainService.TrnMainObj.VATAMNT,""),e.xp6(2),e.hij("NET AMNT: ",i._trnMainService.TrnMainObj.NETAMNT,"")}}let dn=(()=>{class M{constructor(i,n,s,_,f){this.fb=i,this.masterService=n,this._trnMainService=s,this.alertService=_,this.spinnerService=f,this.isActive=!1,this.mode="",this.isSubmitting=!1,this.payDetails={},this.paymentmodelist=[],this.TENDERAMOUNT=0,this.DUEAMOUNT=0,this.CHANGEAMOUNT=0,this.paymentAccountList=[],this.TrnmainObj={},this.tenderObj={},this.modeType="",this.mergedProductList=[]}ngOnInit(){}closeDialog(){this.isActive=!1}show(i){this.mergedProductList=i,this.isActive=!0}hide(){this.isActive=!1}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(E.qu),e.Y36(O.P),e.Y36(N.p),e.Y36(Y.c),e.Y36(B.V))},M.\u0275cmp=e.Xpm({type:M,selectors:[["preview-bill-popup-dialog"]],decls:1,vars:1,consts:[["class","previewbill-container",4,"ngIf"],[1,"previewbill-container"],[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[2,"overflow-y","scroll","overflow-x","hidden"],[2,"width","104%","margin-left","-25px"],[1,"row","col-md-12"],[1,"col-md-12"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","height","25px","background","#9ccae4","width","100%"],["scope","col",2,"width","2%"],["scope","col",2,"width","9%","text-align","center"],["scope","col",2,"width","10%","text-align","center"],["scope","col",2,"width","3%","text-align","center"],["scope","col",2,"width","4%","text-align","center"],["scope","col",2,"width","5%","text-align","center"],[2,"background-color","aliceblue"],["style","height: 28px;",4,"ngFor","ngForOf"],[1,"row",2,"margin-top","auto","width","100%","margin-bottom","-15px"],[2,"line-height","1.2rem"],["width","5%",2,"background","rgb(172 172 172)","border","2px white solid"],[2,"height","28px"],[2,"border","1px solid #e6e6e6","width","2%",3,"id"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","9%"],["type","text","autocomplete","off","readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","10%"],[2,"height","23px","border","1px solid #e6e6e6","width","3%"],["readonly","",2,"width","100%",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],["type","number","readonly","",2,"width","100%","text-align","right",3,"id","ngModel"],["type","number","decimalPlacesRestriction","2","min","0","max","100","readonly","",2,"width","100%","text-align","right",3,"id","ngModel","ngModelChange"],["type","number","decimalPlacesRestriction","2","step","0.01","readonly","",2,"width","98%","text-align","right",3,"id","ngModel"],[2,"height","23px","border","1px solid #e6e6e6","width","5%",3,"id"],["type","text","readonly","",2,"width","98%","text-align","right",3,"ngModel","disabled","readonly"],[2,"height","23px","border","1px solid #e6e6e6","width","5%","text-align","right",3,"id"]],template:function(i,n){1&i&&e.YNc(0,hn,57,7,"div",0),2&i&&e.Q6J("ngIf",n.isActive)},dependencies:[j.sg,j.O5,E.Fj,E.wV,E.JJ,E.qQ,E.Fd,E.On,We.g],styles:[".previewbill-container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:97%;top:20%;left:5%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:83vh;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}"]}),M})();var un=A(11728),Tn=A(7838);const _n=["digitalSignUpload"],Mn=["genericGrid"],pn=["genericTender"],vn=["genericGridHoldBill"],Sn=["Transport"],mn=["genericGridIntend"],On=["printSetupModal"],gn=["genericGridReverseView"],fn=["genericGridPerformaView"],bn=["genericGridForRecurring"],Cn=["genericGridforPreviousOpening"],En=["deliverySelectPopup"],In=["requisitionSelectPopup"],An=["genericGridExpList"],Hi=["genericGridForTaxCancel"],Pn=["ImportPurchaseDetail"],yn=["reverseEntryConfirm"],xn=["authenticationPopup"],Ln=["itemInfo"],Rn=["itemSearchPopup"],Nn=["genericGridForLargeDataEntry"],jn=["genericGridTransferOut"],wn=["rateValidatoin"],Dn=["PaymentPopup"],kn=["RecurringLog"],Vn=["StockAdjustment"],Un=["CreateCustomerPopup"],Bn=["AutoAdjustment"],Kn=["OpeningFromPreviousYear"],Zn=["TermConditionPopup"],Fn=["PrevYearOpening"],Qn=["MemberPointConfirmationPopup"],Hn=["BillPreviewPopup"],Gn=["multiselectGenericGrid"];function Yn(M,I){1&M&&(e.TgZ(0,"span",76),e._uU(1,"Post By :"),e.qZA())}function Jn(M,I){if(1&M&&(e.TgZ(0,"span",77),e._uU(1),e.qZA()),2&M){const i=e.oxw();e.xp6(1),e.hij("",i._trnMainService.TrnMainObj.TRNUSER,"\n")}}function qn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",78),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportPurchaseInvoice())}),e._uU(1," IMPORT PO F2\n"),e.qZA()}}function Wn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",78),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportPurchaseInvoice())}),e._uU(1," IMPORT PI F2\n"),e.qZA()}}function v(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",79),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseClick())}),e._uU(1," FORCE CLOSE\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode&&(1==i._trnMainService.TrnMainObj.STATUS||10==i._trnMainService.TrnMainObj.STATUS&&20!=i._trnMainService.TrnMainObj.VoucherType))}}function k(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",78),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseClick())}),e._uU(1," APPROVAL REJECTION\n"),e.qZA()}}function r(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",78),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.showBillTender())}),e._uU(1," Tender List\n"),e.qZA()}}function l(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",80),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPrintClicked())}),e._uU(1," PRINT F8\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function c(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",81),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPrintVoucher())}),e._uU(1,"\nPRINT VOUCHER\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function T(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",82),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.stockSettlementApprovalLoad())}),e._uU(1," UNAPPROVED LIST\n"),e.qZA()}}function b(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Proforma Cancel\n"),e.qZA()}}function z(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Reverse Chalan\n"),e.qZA()}}function ie(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",84),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPerformaViewRequest())}),e._uU(1," View Canceled Proforma\n"),e.qZA()}}function fe(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",84),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onPerformaViewRequest())}),e._uU(1," View Reverse Delivery Chalan\n"),e.qZA()}}function we(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.rejectPerformInvoice())}),e._uU(1," Reject\n"),e.qZA()}}function be(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.approvePerformInvoice())}),e._uU(1," Approve\n"),e.qZA()}}function Ee(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",85),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadSalesCancel())}),e._uU(1," Cancel SC\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function $n(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",86),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onShowImportSO())}),e._uU(1," IMPORT SO\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function zn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",87),e.NdJ("click",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.onShowExpiredSO(s))}),e._uU(1," Expired Order List\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",1!=i.checkstatus)}}function Xn(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",88),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onReverseEntry())}),e._uU(1," Reverse Entry\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",i._trnMainService.disableReverseEntryForLatePost)}}function er(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewCarrryForwardClicked())}),e._uU(1," View Carry Forward Voucher\n"),e.qZA()}}function tr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onEditLargeEntryClicked())}),e._uU(1,"\nEdit Large Entry\n"),e.qZA()}}function ir(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.carryForwardPreviousFiscalYearVoucher())}),e._uU(1," Opening From Previous Fiscal Year\n"),e.qZA()}}function Gi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forRequisition())}),e._uU(1," From Requisition\n"),e.qZA()}}function ve(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forStockAdjustment())}),e._uU(1," Stock Adjusment\n"),e.qZA()}}function Yi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewClicked())}),e._uU(1," VIEW F4\n"),e.qZA()}}function Ji(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewSignatureClicked())}),e._uU(1," VIEW SIGNATURE\n"),e.qZA()}}function Oe(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onViewReverseClick())}),e._uU(1," View Reverse\n"),e.qZA()}}function qi(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",88),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onEditClicked())}),e._uU(1," EDIT F7\n"),e.qZA()}if(2&M){const i=e.oxw();e.Q6J("disabled",14==i._trnMainService.TrnMainObj.VoucherType&&"self-billing"==i.activeurlpath)}}function Qe(M,I){1&M&&(e.ynx(0),e._uU(1," POST [End]\n"),e.BQk())}function Di(M,I){1&M&&e._uU(0," SAVE [End]\n")}function nr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",88),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onSaveClicked())}),e.YNc(1,Qe,2,0,"ng-container",89),e.YNc(2,Di,1,0,"ng-template",null,90,e.W1O),e.qZA()}if(2&M){const i=e.MAs(3),n=e.oxw(),s=e.MAs(114);e.Q6J("disabled",1==n._trnMainService.disableAllFieldinSales||19===n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode||n.disableSaveBtnINCaseOfSingleBatch()||"VIEW"==n._trnMainService.TrnMainObj.Mode||n.validateBeforeSave()||"StockSettlementEntry"==n.activeurlpath&&"VIEW"==n._trnMainService.buttonMode||s.isActive),e.xp6(1),e.Q6J("ngIf",71==n._trnMainService.TrnMainObj.VoucherType)("ngIfElse",i)}}function rr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyTC())}),e._uU(1),e.qZA()}if(2&M){const i=e.oxw();e.xp6(1),e.hij(" ",i.TermsButtonTag,"\n")}}function or(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onNewClick())}),e._uU(1," RESET F3\n"),e.qZA()}}function ki(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onRefershRateClicked())}),e._uU(1," REFRESH RATE\n"),e.qZA()}}function cr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",91),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onRecurringClick())}),e._uU(1," From Recurring Log\n"),e.qZA()}}function lr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onSyncClicked())}),e._uU(1," SYNC\n"),e.qZA()}}function hr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadFromPerformaInvoice())}),e._uU(1," FROM PROFORMA\n"),e.qZA()}}function dr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onLoadFromDeliveryChalan())}),e._uU(1," FROM DELIVERY CHALAN\n"),e.qZA()}}function ur(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.viewRecurringDetails())}),e._uU(1," View Recurring Info\n"),e.qZA()}}function Tr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.newSalesman())}),e._uU(1," SALESMAN F2\n"),e.qZA()}}function _r(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onCancelClick())}),e._uU(1," VOID\n"),e.qZA()}}function Mr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",92),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onImportDetailsClick())}),e._uU(1," IMPORT DETAILS\n"),e.qZA()}}function pr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",92),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onExportClick())}),e._uU(1," EXPORT NEGATIVE STOCK\n"),e.qZA()}}function vr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"button",92),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.OnBatchAdjustmentClick())}),e._uU(1," AUTO ADJUSTMENT\n"),e.qZA()}}function Sr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"generic-popup-Tender",33,93),e.NdJ("okClicked",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.okClicked(s))}),e.qZA()}}function mr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"Transport-Popup",33,94),e.NdJ("okClicked",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.TenderOkClick(s))}),e.qZA()}}function Or(M,I){if(1&M&&(e.ynx(0),e._UZ(1,"input",101),e._uU(2,"3mm POS Printer"),e._UZ(3,"br"),e.BQk()),2&M){const i=e.oxw(2);e.xp6(1),e.Q6J("formControl",i.printControl)}}function gr(M,I){if(1&M&&(e.ynx(0),e._UZ(1,"input",102,103),e._uU(3,"A4 Printer"),e._UZ(4,"br"),e.BQk()),2&M){const i=e.oxw(2);e.xp6(1),e.Q6J("formControl",i.printControl)}}function fr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",95)(1,"div",96)(2,"div",54)(3,"h4",97),e._uU(4,"Printing Device"),e.qZA()(),e.TgZ(5,"div",57)(6,"form"),e.YNc(7,Or,4,1,"ng-container",47),e.YNc(8,gr,5,1,"ng-container",47),e.qZA()(),e.TgZ(9,"div",98)(10,"button",99),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelprint())}),e._uU(11," Cancel "),e.qZA(),e.TgZ(12,"button",100),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.setPrinterAndprint())}),e._uU(13," Print "),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(7),e.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||1==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==i._trnMainService.TrnMainObj.VoucherType||15==i._trnMainService.TrnMainObj.VoucherType||57==i._trnMainService.TrnMainObj.VoucherType||3==i._trnMainService.TrnMainObj.VoucherType||16==i._trnMainService.TrnMainObj.VoucherType)}}function br(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tr")(1,"td",112)(2,"input",113),e.NdJ("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.ischecked=s)}),e.qZA()(),e.TgZ(3,"td",112),e._uU(4),e.qZA(),e.TgZ(5,"td",112),e._uU(6),e.qZA(),e.TgZ(7,"td",112),e._uU(8),e.qZA(),e.TgZ(9,"td",112),e._uU(10),e.qZA(),e.TgZ(11,"td",112),e._uU(12),e.qZA(),e.TgZ(13,"td",112),e._uU(14),e.qZA(),e.TgZ(15,"td",112),e._uU(16),e.qZA(),e.TgZ(17,"td",112),e._uU(18),e.qZA(),e.TgZ(19,"td",112),e._uU(20),e.qZA(),e.TgZ(21,"td",112),e._uU(22),e.qZA(),e.TgZ(23,"td",112),e._uU(24),e.qZA()()}if(2&M){const i=I.$implicit;e.xp6(2),e.Q6J("ngModel",i.ischecked),e.xp6(2),e.Oqu(i.schemeno),e.xp6(2),e.Oqu(i.schemetype),e.xp6(2),e.Oqu(i.budget),e.xp6(2),e.Oqu(i.prorata),e.xp6(2),e.Oqu(i.qps),e.xp6(2),e.Oqu(i.areabudget),e.xp6(2),e.Oqu(i.aboveqty),e.xp6(2),e.Oqu(i.unit),e.xp6(2),e.Oqu(i.value),e.xp6(2),e.Oqu(i.valuetype),e.xp6(2),e.Oqu(i.discountamount)}}function Cr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",104)(1,"div",96)(2,"div",54)(3,"h4",97),e._uU(4,"Available Schemes"),e.qZA()(),e.TgZ(5,"div",57)(6,"div",105)(7,"table",106)(8,"thead")(9,"tr",107)(10,"th")(11,"span",108),e._uU(12,"SCHEME APPLY"),e.qZA()(),e.TgZ(13,"th")(14,"span",108),e._uU(15,"SCHEME NO"),e.qZA()(),e.TgZ(16,"th")(17,"span",108),e._uU(18,"SCHEMETYPE"),e.qZA()(),e.TgZ(19,"th")(20,"span",108),e._uU(21,"BUDGET"),e.qZA()(),e.TgZ(22,"th")(23,"span",108),e._uU(24,"PRORATA"),e.qZA()(),e.TgZ(25,"th")(26,"span",108),e._uU(27,"QPS"),e.qZA()(),e.TgZ(28,"th")(29,"span",108),e._uU(30,"AREABUDGET"),e.qZA()(),e.TgZ(31,"th")(32,"span",108),e._uU(33,"ABOVEQTY"),e.qZA()(),e.TgZ(34,"th")(35,"span",108),e._uU(36,"UNIT"),e.qZA()(),e.TgZ(37,"th")(38,"span",108),e._uU(39,"VALUE"),e.qZA()(),e.TgZ(40,"th")(41,"span",108),e._uU(42,"VALUETYPE"),e.qZA()(),e.TgZ(43,"th")(44,"span",108),e._uU(45,"DISCOUNTAMOUNT"),e.qZA()()()(),e.TgZ(46,"tbody",109),e.YNc(47,br,25,12,"tr",110),e.qZA()()()(),e.TgZ(48,"div",98)(49,"button",111),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.OkSchemeCommand())}),e._uU(50," Apply "),e.qZA(),e.TgZ(51,"button",111),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.CancelSchemeCommand())}),e._uU(52," Cancel "),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(47),e.Q6J("ngForOf",i.schemeFilterList)}}function Er(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",114)(1,"div",115)(2,"div",54)(3,"h4",97),e._uU(4,"Print Preview"),e.qZA()(),e.TgZ(5,"div",116)(6,"pre"),e._uU(7),e.qZA()(),e.TgZ(8,"div",98)(9,"button",99),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.cancelprint())}),e._uU(10," Close "),e.qZA(),e.TgZ(11,"button",100),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.printPosBill())}),e._uU(12," Print "),e.qZA()()()()}if(2&M){const i=e.oxw();e.xp6(7),e.hij("        ",i.TrnMainObj.printStringForPos,"\n      ")}}function Ir(M,I){1&M&&(e.TgZ(0,"label",126),e._uU(1,"Requisition From :"),e.qZA())}function Ar(M,I){if(1&M&&(e.TgZ(0,"option",127),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.Q6J("ngValue",i.INITIAL),e.xp6(1),e.hij(" ",i.NAME," ")}}function Pr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",58),e.YNc(1,Ir,2,0,"label",123),e.TgZ(2,"select",124),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),e.YNc(3,Ar,2,2,"option",125),e.qZA()()}if(2&M){const i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),e.xp6(1),e.Q6J("ngForOf",i.divisionList)}}function yr(M,I){if(1&M&&(e.TgZ(0,"option",127),e._uU(1),e.qZA()),2&M){const i=I.$implicit;e.Q6J("ngValue",i.NAME),e.xp6(1),e.hij(" ",i.NAME," ")}}function xr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",58)(1,"label",126),e._uU(2,"From Warehouse:"),e.qZA(),e.TgZ(3,"select",124),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_._trnMainService.TrnMainObj.AdditionalObj.REFORDID=s)}),e.YNc(4,yr,2,2,"option",125),e.qZA()()}if(2&M){const i=e.oxw(2);e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.AdditionalObj.REFORDID),e.xp6(1),e.Q6J("ngForOf",i.warehouseList)}}function Lr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",58)(1,"label",126),e._uU(2,"Requisition No :"),e.qZA(),e.TgZ(3,"input",128),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_._trnMainService.TrnMainObj.REFORDBILL=s)})("keydown.Enter",function(){e.CHM(i);const s=e.oxw(2);return e.KtG(s.fromTransferOut())}),e.qZA()()}if(2&M){const i=e.oxw(2);e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.REFORDBILL)}}function Rr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div")(1,"label",129),e._uU(2,"Load Full Requisition Details :"),e.qZA(),e.TgZ(3,"input",130),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_._trnMainService.TrnMainObj.DOFULLRETURN=s.target.checked?1:0)})("ngModelChange",function(s){e.CHM(i);const _=e.oxw(2);return e.KtG(_._trnMainService.TrnMainObj.DOFULLRETURN=s)}),e.qZA()()}if(2&M){const i=e.oxw(2);e.xp6(3),e.Q6J("ngModel",i._trnMainService.TrnMainObj.DOFULLRETURN)("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode)}}function Nr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div")(1,"div",117)(2,"div",118)(3,"div",119)(4,"h5",120),e._uU(5,"From Requisition"),e.qZA(),e.TgZ(6,"button",55),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeReqModal())}),e.TgZ(7,"span",56),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",57),e.YNc(10,Pr,4,3,"div",121),e.YNc(11,xr,5,2,"div",121),e.YNc(12,Lr,4,1,"div",121),e.YNc(13,Rr,4,2,"div",47),e.qZA(),e.TgZ(14,"div",98)(15,"button",122),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.saveRequisition())}),e._uU(16," Save "),e.qZA(),e.TgZ(17,"button",122),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.resetRequisition())}),e._uU(18," Reset "),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(10),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",5==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",8==i._trnMainService.TrnMainObj.VoucherType||5==i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",8===i._trnMainService.TrnMainObj.VoucherType||19==i._trnMainService.TrnMainObj.VoucherType||5==i._trnMainService.TrnMainObj.VoucherType)}}function jr(M,I){1&M&&(e.TgZ(0,"th",143),e._uU(1," NEW WS-PRICE "),e.qZA())}function wr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"td",151)(1,"input",152),e.NdJ("change",function(s){e.CHM(i);const _=e.oxw().index,f=e.oxw(2);return e.KtG(f.onChangePurchasePrice(_,s))})("ngModelChange",function(s){e.CHM(i);const _=e.oxw().$implicit;return e.KtG(_.WNRATE_A=s)})("keydown.enter",function(s){e.CHM(i);const _=e.oxw().index,f=e.oxw(2);return e.KtG(f.onChangePurchasePrice(_,s))})("keydown.Tab",function(s){e.CHM(i);const _=e.oxw().index,f=e.oxw(2);return e.KtG(f.onChangePurchasePrice(_,s))}),e.qZA()()}if(2&M){const i=e.oxw(),n=i.index,s=i.$implicit,_=e.oxw(2);e.xp6(1),e.MGl("id","newWholeSellingPrice",n,""),e.Q6J("ngModel",s.WNRATE_A)("disabled","VIEW"==s.rowMode||s.isPurchaseOrderItem||_._trnMainService.TrnMainObj.ProdList[_.activeindex].BASEUNIT!=s.UNIT)}}function Dr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"tbody")(1,"tr",150)(2,"td",151),e._uU(3),e.qZA(),e.TgZ(4,"td",151),e._uU(5),e.ALo(6,"twoDigitNumber"),e.qZA(),e.TgZ(7,"td",151)(8,"input",152),e.NdJ("change",function(s){const f=e.CHM(i).index,Q=e.oxw(2);return e.KtG(Q.onChangePurchasePrice(f,s))})("ngModelChange",function(s){const f=e.CHM(i).$implicit;return e.KtG(f.NRATE_A=s)})("keydown.enter",function(s){const f=e.CHM(i).index,Q=e.oxw(2);return e.KtG(Q.onChangePurchasePrice(f,s))})("keydown.Tab",function(s){const f=e.CHM(i).index,Q=e.oxw(2);return e.KtG(Q.onChangePurchasePrice(f,s))}),e.qZA()(),e.YNc(9,wr,2,3,"td",153),e.qZA()()}if(2&M){const i=I.$implicit,n=I.index,s=e.oxw(2);e.xp6(3),e.hij(" ",i.UNIT," "),e.xp6(2),e.hij(" ",e.lcZ(6,6,i.CRATE_A)," "),e.xp6(3),e.MGl("id","newSellingPrice",n,""),e.Q6J("ngModel",i.NRATE_A)("disabled","VIEW"==i.rowMode||i.isPurchaseOrderItem||s._trnMainService.TrnMainObj.ProdList[s.activeindex].BASEUNIT!=i.UNIT),e.xp6(1),e.Q6J("ngIf",1==s.userSetting.ENABLEWSALESRATEBILLING)}}function kr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",131)(1,"div",132)(2,"div",133)(3,"h4",134),e._uU(4," Selling Price Setting "),e.qZA()(),e.TgZ(5,"div",135)(6,"div")(7,"h5",134),e._uU(8," Cost Price has been changed.Please reset your new Selling Price "),e.qZA(),e._UZ(9,"hr",136),e.qZA(),e.TgZ(10,"fieldset")(11,"legend",137),e._uU(12," New Selling Price Setting "),e.qZA(),e.TgZ(13,"div",138)(14,"table",139)(15,"thead")(16,"tr",140)(17,"th",141),e._uU(18,"UOM"),e.qZA(),e.TgZ(19,"th",142),e._uU(20,"CURRENT S-PRICE"),e.qZA(),e.TgZ(21,"th",143),e._uU(22,"NEW S-PRICE"),e.qZA(),e.YNc(23,jr,2,0,"th",144),e.qZA()(),e.YNc(24,Dr,10,8,"tbody",110),e.qZA()(),e.TgZ(25,"div",58)(26,"div",145)(27,"h6"),e._uU(28),e.qZA()(),e.TgZ(29,"div",146)(30,"div",147)(31,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyOldPriceClick())}),e._uU(32," APPLY OLD S-PRICE "),e.qZA()()()()(),e.TgZ(33,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onApplyClickNewPrice())}),e._uU(34," APPLY "),e.qZA(),e.TgZ(35,"button",83),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onCloseClick())}),e._uU(36," CLOSE "),e.qZA(),e.TgZ(37,"div",58)(38,"label",148),e._uU(39,"ITEM:"),e.qZA(),e.TgZ(40,"label",149),e._uU(41),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(23),e.Q6J("ngIf",1==i.userSetting.ENABLEWSALESRATEBILLING),e.xp6(1),e.Q6J("ngForOf",i._trnMainService.priceChangeList),e.xp6(4),e.hij(" Recommended Margin: ",i._trnMainService.selectedProdcutRecMargin,"% "),e.xp6(13),e.hij(" ",i._trnMainService.TrnMainObj.ProdList[i.activeindex].ITEMDESC,"")}}function Vr(M,I){1&M&&(e.TgZ(0,"h5",169),e._uU(1," Force Close Confirmation "),e.qZA())}function Ur(M,I){1&M&&(e.TgZ(0,"h5",169),e._uU(1," Approval Rejection Confirmation "),e.qZA())}function Br(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div",154)(1,"div",155)(2,"div",156),e.YNc(3,Vr,2,0,"h5",157),e.YNc(4,Ur,2,0,"h5",157),e.TgZ(5,"div",158)(6,"button",159),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.forceCloseSubmit())}),e._uU(7," SUBMIT "),e.qZA(),e.TgZ(8,"button",160),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeForceClose())}),e._uU(9," CANCEL "),e.qZA()()(),e.TgZ(10,"div",161)(11,"div",162)(12,"label",163),e._uU(13,"Invoice No :"),e.qZA(),e.TgZ(14,"div",164)(15,"input",165),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.forceCloseObj.VCHRNO=s)}),e.qZA()()(),e.TgZ(16,"div",166)(17,"label",167),e._uU(18),e.qZA(),e.TgZ(19,"div",164)(20,"textarea",168),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.forceCloseObj.REMARKS=s)}),e.qZA()()()()()()}if(2&M){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",90!=i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",90==i._trnMainService.TrnMainObj.VoucherType),e.xp6(11),e.Q6J("ngModel",i.forceCloseObj.VCHRNO),e.xp6(3),e.hij("Remarks for ",i.displayNameForceClose,":"),e.xp6(2),e.Q6J("ngModel",i.forceCloseObj.REMARKS)}}function Kr(M,I){if(1&M&&(e.TgZ(0,"tr")(1,"td",179),e._uU(2),e.qZA(),e.TgZ(3,"td",180),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td",181),e._uU(7),e.qZA()()),2&M){const i=I.$implicit;e.xp6(2),e.Oqu(i.TRNMODE),e.xp6(2),e.hij(" ",e.xi3(5,3,i.AMOUNT,"1.2-2")," "),e.xp6(3),e.Oqu(i.REMARKS)}}function Zr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div")(1,"div",170)(2,"div",171)(3,"div",119)(4,"h6",120),e._uU(5,"Bill tender list"),e.qZA(),e.TgZ(6,"button",55),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeTenderList())}),e.TgZ(7,"span",56),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",57)(10,"table",172)(11,"thead")(12,"tr",173)(13,"th",174),e._uU(14,"Trn Mode"),e.qZA(),e.TgZ(15,"th",175),e._uU(16,"Amount"),e.qZA(),e.TgZ(17,"th",142),e._uU(18,"Remarks"),e.qZA()()(),e.TgZ(19,"tbody",176),e.YNc(20,Kr,8,6,"tr",110),e.qZA()()(),e.TgZ(21,"div",177)(22,"button",178),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeTenderList())}),e._uU(23," Close "),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(20),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.TenderList)}}function Fr(M,I){if(1&M){const i=e.EpF();e.TgZ(0,"div")(1,"div",182)(2,"div",118)(3,"div",119)(4,"h5",120),e._uU(5," Reverse Entry authorization "),e.qZA(),e.TgZ(6,"button",55),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.closeReverseEntryAuthPopup())}),e.TgZ(7,"span",56),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",57)(10,"div",183)(11,"label",184),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",185)(14,"input",186),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.reverseEntryAuthObj.username=s)}),e.qZA()()(),e.TgZ(15,"div",183)(16,"label",184),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",185)(19,"input",187),e.NdJ("ngModelChange",function(s){e.CHM(i);const _=e.oxw();return e.KtG(_.reverseEntryAuthObj.password=s)}),e.qZA()()()(),e.TgZ(20,"div",98)(21,"button",122),e.NdJ("click",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.reverseEntryAuthConfirm())}),e._uU(22," Confirm "),e.qZA()()()()()}if(2&M){const i=e.oxw();e.xp6(14),e.Q6J("ngModel",i.reverseEntryAuthObj.username),e.xp6(5),e.Q6J("ngModel",i.reverseEntryAuthObj.password)}}const Qr=function(){return{backdrop:"static"}};let Hr=(()=>{class M{constructor(i,n,s,_,f,Q,ee,ne,he,se,Ne,Pe,ye,xe,ae,ce,ue){this._trnMainService=i,this.setting=n,this.dialog=s,this.router=_,this.arouter=f,this.alertService=Q,this.spinnerService=ee,this.authService=ne,this.loadingService=he,this.invoicePrint=se,this.notificationService=Ne,this.notificationsService=Pe,this.validationService=ye,this.masterService=xe,this.onSaveClickValidationService=ae,this.productHelperSerivce=ce,this.PrintHelperService=ue,this.buttonShow=!0,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.forceCloseObj={},this.additionalcostEmit=new e.vpe,this.deliveryChalanEmit=new e.vpe,this.onViewClickEmit=new e.vpe,this.onLoadFromSOClickEmit=new e.vpe,this.onLoadFromPOClickEmit=new e.vpe,this.onLoadFromHOPerformaInvoiceClickEmit=new e.vpe,this.onLoadFromPerformaInvoiceClickEmit=new e.vpe,this.onLoadFromReverseEntryEmit=new e.vpe,this.onLoadFromHoTaxInvoiceClickEmit=new e.vpe,this.onLoadFromSAPFTPClickEmit=new e.vpe,this.onShowFileUploadPopupEmit=new e.vpe,this.onLoadFromStockSettlementApproval=new e.vpe,this.onSettlementStockApprove=new e.vpe,this.onApproveStockSettlementList=new e.vpe,this.onFileUploadPopupEmit=new e.vpe,this.onSaveINVAllocation=new e.vpe,this.onSaveSelfBilling=new e.vpe,this.onclickOnResetPopupEmit=new e.vpe,this.onLoadCancelSalesEmit=new e.vpe,this.gridPopupSettingForPreviousOpening=new K.im,this.gridPopupSettingsForExpList=new W.sG,this.onAddNewCustomerClickEmit=new e.vpe,this.onClickCustomer=new e.vpe,this.onClickSalesMan=new e.vpe,this.gridPopupSettingsForTaxCancel=new K.im,this.itemInfoPopupSettings=new D,this.gridPopupSettingForLargeEntry=new K.im,this.checkstatus=!0,this.viewSubscription=new m.w,this.gridPopupSettings=new K.im,this.gridPopupSettingsForReverse=new K.im,this.gridPopupSettingsForViewPerforma=new K.im,this.gridPopupSettingsForRecurring=new K.im,this.gridPopupSettingsForHoldBill=new K.im,this.trialUrl=!1,this.showUnApprove=!1,this.gridPopupSettingsForIntend=new K.im,this.showschemePopup=!1,this.editClicked=!1,this.viewClicked=!1,this.RouteList=[],this.CustomerList=[],this.hideButton=!1,this.addForRequisition=!1,this.divisionList=[],this.warehouseList=[],this.showReverseEntryAuth=!1,this.reverseEntryAuthObj={username:"",password:""},this.multiselectPopupSettings=new Z.oe,this.genericGridTransferOutSetting=new K.im,this.showEdit=!1,this.showPriceChangeDetail=!1,this.showPriceChangeDetailINDisc=!1,this.recurringItems=[],this.commissionChargeable=[],this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this.showForceClose=!1,this.showTenderList=!1,this.recurringLogMode="add",this.displayNameForceClose="Force Close",this.TermsButtonTag="APPLY T&C",this.NegativeBillAuthObj={username:"",password:"",remarks:""},this.termnConditionMode="",this.promptPrintDevice=!1,this.printControl=new E.NI(0),this.ConsumptionArray=[],this.reportData=[],this.menudata=[],this.reportHeaders=["ProductCode","ProductName","BatchNumber","MfgDate","ExpDate","Case","Each","Rate","Vat","NetAmount"],this.reportBody=["MCODE","ITEMDESC","BATCH","MFGDATE","EXPDATE","AltQty","BASEQUANTITY","ALTRATE","VAT","NETAMOUNT"],this.schemeFilterList=[],this._trnMainService.TrnMainObj.IsWholesale=!1,this.appType=this.masterService.appType,this.TrnMainObj=i.TrnMainObj,this.masterService.ShowMore=!1,this.AppSettings=this.setting.appSetting,this.userProfile=ne.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.showSecondaryButtons=!1,"VIEW"==this._trnMainService.TrnMainObj.Mode&&(this.showSecondaryButtons=!0),this.masterService.refreshTransactionList(),this.orgtype=this._trnMainService.userProfile.CompanyInfo.ORG_TYPE,this.userSetting=ne.getSetting(),(this.TrnMainObj.VoucherType==S.Km.CreditNote||this.TrnMainObj.VoucherType==S.Km.SalesReturn)&&(this.transactionType="creditnote"),this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&1==this.userSetting.PODELIVERYMODE&&(this.TermsButtonTag="VIEW T&C"),this.gridPopupSettings="add-creditnote-itembase-approval"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSALESRETURN"):"add-stock-issue-approval"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("APPROVEDSTOCKTRANSFER"):"export-sales-invoice"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"EXPORT_SALES"):"purchase-import"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE"):"add-membership-sales-invoice"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"MembershipSalesInvoice"):"transfer-out-approval"==f.snapshot.url[0]?.path||"stock-issue-approval"==f.snapshot.url[0]?.path?this.getPopUpSettingForApproval():"purchase-import-order"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"IMPORT_PURCHASE_ORDER"):"asset-purchase-invoice"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix,"ASSET_PURCHASE"):"assets-openingstockentry"==f.snapshot.url[0]?.path?this.masterService.getGenericGridPopUpSettings("OP_ASSET","ASSET_OPENING"):this.masterService.getGenericGridPopUpSettings("shortage-adjustment"==f.snapshot.url[0]?.path?"CENTRAL_SHORTAGE_ADJUSTMENT":"excess-adjustment"==f.snapshot.url[0]?.path?"EXCESS_ADJUSTMENT":this.TrnMainObj.VoucherPrefix),"DL"==this.TrnMainObj.VoucherPrefix&&this.addCustomerfilterforDeliveryViewPopup(),this.gridPopupSettingsForHoldBill=this.masterService.getGenericGridPopUpSettings("HOLDBILLLIST"),this.gridPopupSettingsForIntend=this.masterService.getGenericGridPopUpSettings("INTENDLIST"),this.activeurlpath=f.snapshot.url[0].path,this.itemInfoPopupSettings={title:"Item Info"}}addCustomerfilterforDeliveryViewPopup(){this.gridPopupSettings.columns.splice(1,0,{key:"BILLTO",title:"Customer Name",hidden:!1,noSearch:!1})}ngOnInit(){console.log("voucher master action",this.arouter.snapshot),this.arouter.queryParams.subscribe(i=>{if("DRILL"==i.mode&&i.returnUrl)this.returnUrl="/pages/reports/"+i.returnUrl;else{if(this.returnUrl="/pages/dashboard/dashboard",this._trnMainService.TrnMainObj.Mode="NEW",this.viewClicked=!1,this.editClicked=!1,this.hideButton=!0,this.masterService.headerMode="(NEW)",this.arouter.snapshot.params.returnUrl&&(this.returnUrl=this.arouter.snapshot.params.returnUrl),"StockSettlementEntryApproval"==this.activeurlpath)return this.trialUrl=!0;if("StockSettlementEntry"==this.activeurlpath)return this.showUnApprove=!0}}),90===this._trnMainService.TrnMainObj.VoucherType&&(this.displayNameForceClose="Rejection")}filterloginDivision(){(this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||"add-branch-out"==this._trnMainService.activeurlpath)&&(this.divisionList=this.divisionList.filter(i=>i.INITIAL!=this.userProfile.userDivision))}ngAfterViewInit(){(8===this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType)&&(this.masterService.getNotLoginDivisionList().subscribe(i=>{this.divisionList=i,8===this._trnMainService.TrnMainObj.VoucherType&&this.filterloginDivision()}),this.masterService.getWarehouseList().subscribe(i=>{this.warehouseList=i}))}ngOnDestroy(){try{this.subscriptions.forEach(i=>{i.unsubscribe()})}catch{}}editButtonCheck(){return 1!==this._trnMainService.TrnMainObj.VoucherType&&14!==this._trnMainService.TrnMainObj.VoucherType&&(3===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||19===this._trnMainService.TrnMainObj.VoucherType||64===this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType||31===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryReturn||24===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry||82===this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&0==this.userSetting.INVBASEPROFORMA)}checkUserRights(i){const n=this.userProfile.menuRights.find(s=>s.menu==this.activeurlpath);if(n){let _,s=n.right,f=!0;switch(i){case"add":_=s.find(Q=>"add"==Q),null==_&&(f=!1);break;case"edit":_=s.find(Q=>"edit"==Q),null==_&&(f=!1);break;case"delete":_=s.find(Q=>"delete"==Q),null==_&&(f=!1);break;case"print":_=s.find(Q=>"print"==Q),null==_&&(f=!1),("add-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"add-creditnote-itembase"==this.activeurlpath)&&(f=!0);break;case"view":_=s.find(Q=>"view"==Q),null==_&&(f=!1)}return console.log("allowedd?",f),!!f||(this.alertService.warning("Current user has no rights to "+i),!1)}return this.alertService.warning("Cannot find any user rights."),!1}stockSettlementApprovalLoad(){this.onLoadFromStockSettlementApproval.emit(!0)}stockSettlementOnApproveList(){this.onApproveStockSettlementList.emit(!0)}productionConsumptionList(){let i="";"production-entry"==this.activeurlpath||"newproduction-entry"==this.activeurlpath?i="production":"consumption-entry"==this.activeurlpath&&(i="consumption"),this.gridPopupSettings={title:"Vouchers",apiEndpoints:`/getProductionConsumptionPagedList/${i}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"VCHRNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}stockSettlement(){var i=this._trnMainService.TrnMainObj.Mode="NEW";this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.IsApproveStockSettlement),(null==this._trnMainService.TrnMainObj.ProdList||null==this.TrnMainObj.ProdList)&&this.alertService.info("Product List is empty"),this.masterService.saveTransaction(i,this._trnMainService.TrnMainObj).subscribe(n=>{"ok"==n.status&&this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)})}onLoadFromSalesOrder(){this.onLoadFromSOClickEmit.emit(!0)}onLoadSalesCancel(){this.onLoadCancelSalesEmit.emit(!0)}onLoadFromPurchaseOrder(){this.onLoadFromPOClickEmit.emit(!0)}onLoadFromHOPerformaInvoiceClick(){this.onLoadFromHOPerformaInvoiceClickEmit.emit(!0)}onLoadFromHoTaxInvoiceClick(){this.onLoadFromHoTaxInvoiceClickEmit.emit(!0)}onLoadFromSAPFTPClick(){this.onLoadFromSAPFTPClickEmit.emit(!0)}onCloseClicked(){this.router.navigate(["/pages/dashboard"])}onEditClicked(){this.checkUserRights("edit")&&(this.onViewClicked("EDIT"),this.editClicked=!0,this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)",this._trnMainService.disableNepaliDate=24===this._trnMainService.TrnMainObj.VoucherType)}onSyncClicked(){if("VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase())return this.alertService.warning("Please load voucher to sycn"),!1;this.loadingService.show("Syncing data, please wait"),this.masterService.syncBranchTransferOut(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.alertService.success(i.result),this.onReset()):"error"==i.status&&(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}onViewClicked(i=""){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.billFormatsForPrint=null,this.viewClicked=!0,"canceladdsientry"==this.activeurlpath?(this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.Mode="VIEW",this.onViewTaxCancel(),this.genericGrid.show()):"StockSettlementEntry"==this.activeurlpath?(this.stockSettlementOnApproveList(),this.viewClicked=!0,this._trnMainService.viewModeForStockSettle=!0):"PD"==this.TrnMainObj.VoucherPrefix?(this.productionConsumptionList(),this.genericGrid.show()):"PP"==this.TrnMainObj.VoucherPrefix?(this.gridPopupSettings.apiEndpoints="EDIT"==i?"/getTrnMainPagedList/PP/EDIT":"/getTrnMainPagedList/PP/tag",this.genericGrid.show()):"ER"==this.TrnMainObj.VoucherPrefix?("excess-goods-acknowledgement"==this.activeurlpath?this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreceive":"excess-goods-return"==this.activeurlpath&&(this.gridPopupSettings.apiEndpoints="/getTrnMainPagedList/ER/goodsreturn"),this.genericGrid.show()):this.genericGrid.show(),this.clearQtyRate()}gridPopupDataforPreviousOpening(){this.gridPopupSettingForPreviousOpening={title:"Vouchers",apiEndpoints:"/getCarryForwardOpeningVouchers",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}gridPopupDataforLargeDataEntry(){this.gridPopupSettingForLargeEntry={title:"Vouchers",apiEndpoints:"/getTrnMainPagedList/OP/tag",defaultFilterIndex:0,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onViewCarrryForwardClicked(){this.gridPopupDataforPreviousOpening(),this.genericGridforPreviousOpening.show()}onEditLargeEntryClicked(){this.gridPopupDataforLargeDataEntry(),this.genericGridForLargeDataEntry.show()}onRecurringClick(){this.gridPopupSettingsForRecurring={title:"Recurring Log List",apiEndpoints:"/getRecurringItemList",defaultFilterIndex:3,columns:[{key:"ACNAME",title:"Customer Name",hidden:!1,noSearch:!1},{key:"RECURRING_DATE",title:"Recurring Date",hidden:!1,noSearch:!1,format:!0},{key:"DESCA",title:"Recurring Item",hidden:!1,noSearch:!1},{key:"AMOUNT",title:"Amount",hidden:!1,noSearch:!1},{key:"ENTRYNO",title:"Entry No",hidden:!1,noSearch:!1}]},this.genericGridForRecurring.show()}promptPrinterDevice(){this.promptPrintDevice=!0,setTimeout(()=>{console.log("nativelem",this.printSetupModal),null!=this.printSetupModal&&this.printSetupModal.nativeElement.focus()},500)}printPosBill(){var i;this.showPosPrinterPreview=!1,(i=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function s(_){},!1),i.addEventListener("open",function n(_){i.onopen=()=>i.send(_)}(this.TrnMainObj.printStringForPos),!1),this._trnMainService.TrnMainObj.VoucherType=61==this._trnMainService.TrnMainObj.VoucherType?14:this._trnMainService.TrnMainObj.VoucherType}setPrinterAndprint(){if(this.promptPrintDevice=!1,this.userProfile.PrintMode=this.printControl.value,this._trnMainService.printModeForInvoice=this.userProfile.PrintMode,this.modeis=this._trnMainService.TrnMainObj.Mode,0==this.masterService.userSetting.DISPLAY&&(this.userProfile.PrintMode=99),"add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales&&(this.userProfile.PrintMode=0),"export-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableExportTaxInvoice&&(this.userProfile.PrintMode=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&(this.userProfile.PrintMode=1==this.userSetting.DEFAULTA4PRINTINABBVSALES?1:0),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&1==this.userSetting.showLaserPintInTi&&0==this.printControl.value&&(this.userProfile.PrintMode=0),console.log("voucher type in print mode",this._trnMainService.TrnMainObj.VoucherType),(this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseTaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote)&&(this.userProfile.PrintMode=1),0!=this.userProfile.PrintMode){this.loadingService.show("please wait. Getting invoice data ready for printing.");try{if(this.parac=this._trnMainService.TrnMainObj.PARAC,"VIEW"==this._trnMainService.TrnMainObj.Mode||"EDIT"==this._trnMainService.TrnMainObj.Mode){this.billFormatsForPrint=null,1!=this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),1==this._trnMainService.inputCode&&this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS});try{this.voucher=this._trnMainService.TrnMainObj.VCHRNO,this.masterService.savePrintLog(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseCreditNote?this.masterService.getPrintTitleAsCopy(this.voucher,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleVIEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?this.masterService.getBillFormat(this.voucher).subscribe(s=>{"ok"==s.status&&(this.resvalues=s.result?s.result[0].BILLFORMATS:"FULL",this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,this.resvalues),this.loadingService.hide())}):(this.pdfDesingerPrintFormat(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucher,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}1==this.userSetting.EnableBillFormatInBilling&&this.masterService.getBillUnits(this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{"ok"==i.status&&(this._trnMainService.qtyCheckForPrint="CASE"==i.result)})}else if("NEW"==this.modeis)try{this.masterService.savePrintLog(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this.phiscalid,this.trnuser).subscribe(i=>{if("ok"==i.status){if("add-sales-invoice"==this.activeurlpath||"add-sales-invoice-wholesale"==this.activeurlpath||"self-billing"==this.activeurlpath||"performa-invoice"==this.activeurlpath||"delivery-chalan"==this.activeurlpath||"delivery-chalan-return"==this.activeurlpath||"add-membership-sales-invoice"==this.activeurlpath||"abbreviated-sales-invoice"==this.activeurlpath||"export-sales-invoice"==this.activeurlpath||"quotation"==this.activeurlpath)try{this.masterService.getPrintTitle(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(this.titleNEW=n.result,this.caption=n.result2,1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)})}catch(n){this.alertService.info(n)}if(14!=this._trnMainService.TrnMainObj.VoucherType||"canceladdsientry"==this.activeurlpath)try{this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReversePurchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.ReverseDebitNote?this.masterService.getPrintTitleAsCopy(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER).subscribe(n=>{"ok"==n.status&&(console.log("PRINT-TITLE-as copy",n.result),this.titleNEW=n.result,this.caption="",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,this.billFormatsForPrint),this.loadingService.hide()):(this.pdfDesingerPrintFormat(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleNEW,this.caption,"FULL"),this.loadingService.hide()))},n=>{this.alertService.info(n)}):this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry?(this.pdfDesingerPrintFormatForTransferIn(this.voucherno,this._trnMainService.TrnMainObj.PhiscalID,this.titleVIEW,this.caption,"FULL"),this.loadingService.hide()):this.loadingService.hide()}catch(n){this.alertService.info(n)}}},i=>{this.alertService.info(i)})}catch(i){this.alertService.info(i)}}catch(i){this.alertService.info(i)}setTimeout(()=>{this._trnMainService.TrnMainObj.VoucherType=this._trnMainService.ReturnVoucherType(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)},100)}else try{"NEW"==this.modeis?this.masterService.getReprintData(this.voucherno,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)}):this.masterService.getReprintData(this._trnMainService.TrnMainObj.VCHRNO,this._trnMainService.TrnMainObj.DIVISION,this._trnMainService.TrnMainObj.PhiscalID,this._trnMainService.TrnMainObj.TRNUSER,1).subscribe(i=>(this.TrnMainObj.printStringForPos=i.result,this.authService.setSessionVariable("USER_PROFILE",this.userProfile),this.AppSettings.ShowPrintPreview?void(this.showPosPrinterPreview=!0):void this.printPosBill()),i=>{this.alertService.info(i._body)})}catch(i){return void this.alertService.info(i)}}onPrintClicked(){this.modeForPrint=(0,G.cloneDeep)(this._trnMainService.TrnMainObj.Mode),this.checkUserRights("print")&&(1==this.masterService.userSetting.DISPLAY||1==this.userSetting.EnablePanBill&&this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales&&0==this.userSetting.DEFAULTA4PRINTINABBVSALES||"add-membership-sales-invoice"==this.activeurlpath&&1==this.userSetting.EnableMembershipSales||(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote)&&1==this.userSetting.showLaserPintInTi?this.promptPrinterDevice():this.setPrinterAndprint())}print(i){var n;(n=new WebSocket("ws://127.0.0.1:1660")).addEventListener("message",function _(){},!1),n.addEventListener("open",function s(f){n.onopen=()=>n.send(f)}(i),!1)}onApplyTC(){"EDIT"==this._trnMainService.buttonMode||"VIEW T&C"==this.TermsButtonTag?(this.getTermsAndConditionForViewMode(this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID).subscribe(s=>{this.showTermConditionPopUp(s)}),"VIEW T&C"==this.TermsButtonTag&&(this.termnConditionMode="VIEW")):("add-purchase-order"==this.activeurlpath&&this._trnMainService.TrnMainObj.BILLTO&&(this.TermnCondId=null),this.termnConditionMode="",this.showTermConditionPopUp())}showTermConditionPopUp(i=[]){this.TermConditionPopup.show(i,this.termnConditionMode)}getTermsAndConditionForViewMode(i){return this.masterService.getMultipleTermsAndCondition(i)}onSaveClicked(){if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance||5!=this._trnMainService.TrnMainObj.CNDN_MODE||this.validationService.validateEmptyACName(this._trnMainService.TrnMainObj.AssetsProdList)&&this.validationService.validateEmptySubLedger(this._trnMainService.TrnMainObj.AssetsProdList)){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&this._trnMainService.TrnMainObj.REFBILL?.trim().toUpperCase()==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.info("Refno and Bill No cannot be same");if(this.validationService.validateVariantProduct(this._trnMainService.TrnMainObj)){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return void this.productHelperSerivce.saveButtonClicked();if(this._trnMainService.TrnMainObj.VoucherType in S.lK&&1==this._trnMainService.showFlatDiscOption)return void this.alertService.info("Please apply the inserted Flat discount before saving");if("add-branch-in"==this._trnMainService.activeurlpath&&null==this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please Select the Warehouse.");if(this.checkUserRights("add")){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&1==this.userSetting.GblEnableMixedTenderMode&&"B2C"==this.userSetting.CompanyType)return 1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTMEMPOINTS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)?void this.MemberPointConfirmationPopup.show():(this.NETAMNTWITHROUNDOFF=this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.calculateAvailableScheme(),this._trnMainService.assignNetAmntWithRoundOff(this.NETAMNTWITHROUNDOFF),void this.paymentClick());if((this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&"self-billing"!==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this._trnMainService.TrnMainObj.ProdList.filter(n=>n.SchemeList?.length>0).length>0&&confirm("Do you want to apply scheme before saving ?")&&this._trnMainService.calculateAvailableScheme(),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&1===this.userSetting.EnableDigitalSignature)return this.clearSignature(),void this.digitalSignUpload.show();if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)this.masterService.getAssetDepreciationDoneMonths().subscribe(i=>{const n=this._trnMainService.TrnMainObj.BSDATE.split("/")[1];for(const s of i.result)if(s.MONTHNO===n)return void this.alertService.info(`Depreciation cancellation is required to proceed for this month(${s.MONTHNAME.toLowerCase()})`);this.onSaveTransactionClicked(),this.clearQtyRate()});else{if("delivery-chalan"===this.activeurlpath){const i=this.TrnMainObj?.ProdList?.find(n=>0===n.RATE);if(i)return void this.alertService.info(`Please enter rate for ${i.ITEMDESC}!`)}this.onSaveTransactionClicked(),this.clearQtyRate()}}}}}doAutoRoundingInSales(){1==this.userSetting.EnableRoundoff&&(14==this._trnMainService.TrnMainObj.VoucherType||57==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.VoucherType)&&this._trnMainService.rounding()}clearSignature(){return(0,t.Z)(function*(){const{SigCapture:i}=yield Promise.resolve().then(A.bind(A,46241)),{SessionControl:n}=yield Promise.resolve().then(A.bind(A,5881));null!=i.HTMLTagIds?.imageBox?.firstChild&&(i.HTMLTagIds.imageBox.removeChild(i.HTMLTagIds.imageBox.firstChild),n.actionWhenRestarted())})()}validationInImportDocumentDetails(){if("purchase-import"===this.activeurlpath){if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.DOCUMENTNO)return this.alertService.info("Please enter Import Document No!"),!0;if(!this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.LCNUM)return this.alertService.info("Please enter L/C No!"),!0;if(1==this._trnMainService.TrnMainObj.IMPORTDETAILS.DoVatAmtAccountForImport&&(!this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME||""==this._trnMainService.TrnMainObj.IMPORTDETAILS.TRNACNAME))return this.alertService.info("Please select VAT Credit A/C!"),!0}return!1}confirmationOkClicked(i){i?(this._trnMainService.calculatePointRedemptionDiscount(),this.paymentClick()):(this._trnMainService.TrnMainObj.ProdList.forEach(n=>n.LOYALTY=0),this._trnMainService.TrnMainObj.MEMREDEEMPOINT=0,this._trnMainService.ReCalculateBillWithNormal(),this.paymentClick())}checkRedeemablePoint(){1==this.userSetting.EnableRedeemPointAsDiscount&&this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)>=this._trnMainService.nullToZeroConverter(this.userSetting.MinRedeemablePoint)&&confirm("Member has redeemable points remaining. Do you want to redeem points as discount?")&&(this._trnMainService.TrnMainObj.TOTALLOYALTY=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.EARNPOINS)*this._trnMainService.nullToZeroConverter(this.userSetting.PointConversionRate),console.log("TOTALLOYALTY value",this._trnMainService.TrnMainObj.TOTALLOYALTY,this._trnMainService.TrnMainObj.NETAMNT))}showNotificationCount(){this.connection=(new V.su).withUrl(`${w.N.apiUrl}/notificationConnection`,{transport:V.n4.WebSockets}).withAutomaticReconnect().build();var i=this;this.connection.start().then(()=>{console.log("start"),this.connection.invoke("GetConnectionId").then(function(n){console.log(n),i.socketId=n,i.connection.on("ReceiveMessage",s=>{console.log("connected"),this.notificationsService.info("Report Status",s.message),console.log(s.message)})})}).catch(n=>{})}onNewProductionEntrySave(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ConsumptionList.forEach(n=>{n.MasterMCode=i.MCODE,this.ConsumptionArray.push(n)})}),this._trnMainService.TrnMainObj.ConsumptionProdList=this.ConsumptionArray,this.ConsumptionArray=[]}onSaveTransactionClicked(){if("performa-invoice"==this.activeurlpath&&null==this._trnMainService.TrnMainObj.BILLTO)return this.alertService.warning("Please select customer first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("customerselectid").focus()},100)});if(2==this.userSetting.enablesalesman&&!this._trnMainService.TrnMainObj.SALESMAN&&(this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.Quotation))return this.alertService.warning("Please select salesman first"),void this.alertService.emitShowHideSubject.subscribe(n=>{this.masterService.ShowMore=!0,setTimeout(()=>{document.getElementById("salesmanselect").focus()},100)});if("RQ"!=this._trnMainService.TrnMainObj.VoucherPrefix||"EDIT"!=this._trnMainService.TrnMainObj.Mode||10!=this._trnMainService.TrnMainObj.STATUS)if(this.TrnMainObj.VoucherType==S.Km.RequisitionEntry&&this.showNotificationCount(),"newproduction-entry"===this.activeurlpath&&this.onNewProductionEntrySave(),this.TrnMainObj.VoucherType==S.Km.OpeningStockBalance||1!=this.userSetting.EnableRefno||""!=this._trnMainService.TrnMainObj.CHALANNO&&""!=this._trnMainService.TrnMainObj.CHALANNOPREFIX)if(this._trnMainService.saveButton=!0,this._trnMainService.TrnMainObj.VoucherType!=S.Km.Repack||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.OpeningStockBalance&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"QuantityExceed"!=this._trnMainService.quantityExceedCheck||"edit"!=this._trnMainService.TrnMainObj.Mode?.toLocaleLowerCase())if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.BranchTransferOut&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssueReturn||"QuantityExceed"!=this._trnMainService.quantityExceedCheck)if(this._trnMainService.TrnMainObj.AdditionalObj&&(this.billformat=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS),"GreaterQuantity"!=this._trnMainService.QuantityMsg)if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoiceCancel||null!=this._trnMainService.TrnMainObj.REMARKS&&""!=this._trnMainService.TrnMainObj.REMARKS&&null!=this._trnMainService.TrnMainObj.REMARKS){if((this._trnMainService.TrnMainObj.VoucherType!=S.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.Sales||0!=this.userSetting.EnableCreditLimitInSO||"credit"!=this._trnMainService.TrnMainObj.TRNMODE||this.checkCreditLimitForTransaction())&&(this._trnMainService.TrnMainObj.VoucherType!=S.Km.SalesOrder||1!=this.userSetting.EnableCreditLimitInSO||this.checkCreditLimitForTransaction())){if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder){let n="";if(this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder?(this._trnMainService.TrnMainObj.PARAC||(this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC),n="Supplier"):this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.TrnMainObj.PARAC||(this._trnMainService.TrnMainObj.PARAC=this._trnMainService.TrnMainObj.TRNAC),n="Customer"),null==this._trnMainService.TrnMainObj.PARAC||""==this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Please Choose "+n+" to proceed...")}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this._trnMainService.salesmanID=this._trnMainService.TrnMainObj.SALESMANID,this._trnMainService.salesmanName=this._trnMainService.TrnMainObj.SALESMAN,this._trnMainService.routeCode=this._trnMainService.TrnMainObj.ROUTE,"add-sales-invoice-wholesale"===this.activeurlpath&&(this._trnMainService.TrnMainObj.IsWholesale=!0)),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase-approval"==this.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.isApproved)),this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote){if(1==this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry){if(this._trnMainService.TrnMainObj.TRNDATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Entry date cannot be set before of Sales Invoice date!!!");if(this._trnMainService.TrnMainObj.TRN_DATE<this._trnMainService.TrnMainObj.DateLimitForCreditNote)return void this.alertService.info("Credit Note's Invoice date cannot be set before of Sales Invoice date!!!")}if("DN"==this._trnMainService.TrnMainObj.REFORDBILL?.substring(0,2)&&!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty");if(!this._trnMainService.TrnMainObj.REMARKS)return void this.alertService.info("Remarks cannot be empty");if(!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if("salesreturn"==this._trnMainService.TrnMainObj.TRNMODE&&"error"==this._trnMainService.TrnMainObj.TRNACName&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.warning("Default Sales return voucher AC' on database not set. Cannot save !")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&"purchase-import"==this.activeurlpath){this.removeInvalidRowsFromprod();let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.INVRATE||null==s.INVRATE)[0];if(null!=n)return void this.alertService.info(`Rate cannot be 0 for item ${n.ITEMDESC} !!!`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&!this._trnMainService.TrnMainObj.TRNACName)return void this.alertService.info("Account cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice){if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Payment Terms cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account  not be empty");if("export-sales-invoice"===this.activeurlpath){if(!this._trnMainService.TrnMainObj.COUNTRY)return void this.alertService.info("Country cannot be empty");if(!this._trnMainService.TrnMainObj.PRAGYAPANPATRA)return void this.alertService.info("PP No. cannot be empty");if(!this._trnMainService.TrnMainObj.PPDATE)return void this.alertService.info("PP Date cannot be empty")}if(!this._trnMainService.TrnMainObj.BILLTO)return this.alertService.info("Customer cannot be empty"),void("add-membership-sales-invoice"==this.activeurlpath&&this.alertService.info("Member cannot be empty"));if("add-membership-sales-invoice"==this.activeurlpath){let n=U()(new Date(this.masterService.userSetting.MEMBERITEMSPERIODS)).format("YYYY-MM-DD");if(this._trnMainService.TrnMainObj.TRNDATE>n)return void this.alertService.info("Transaction cannot be done...Exceeds item period")}}if(!(this._trnMainService.TrnMainObj.VoucherType!==S.Km.Sales||"cash"!=this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()||"B2B"!=this.userSetting.CompanyType||this._trnMainService.TrnMainObj.BILLTO&&this._trnMainService.TrnMainObj.PARAC))return void this.alertService.info("Customer cannot be empty. Select Customer Party to proceed");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Return Mode cannot be empty");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Reference Bill No cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder&&!this._trnMainService.TrnMainObj.COSTCENTER&&1==this.userSetting.enabledistributedpurchase)return void this.alertService.info("Cost Center cannot be empty");if((this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase)&&""==this._trnMainService.TrnMainObj.COSTCENTER&&1==this.userSetting.EnableCompulsoryCostCenter)return void this.alertService.info("Cost Center cannot be empty");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived){if(!this._trnMainService.TrnMainObj.PARAC)return void this.alertService.info("Supplier cannot be empty");if(!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.info("Please Enter the Invoice Number");if(!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.info("Account cannot be empty");if(!this._trnMainService.TrnMainObj.TRNMODE)return void this.alertService.info("Payment Terms  not be empty");if("purchase-import"!=this.activeurlpath&&!this._trnMainService.TrnMainObj.BILLTOTEL&&0==this._trnMainService.TrnMainObj.VATBILL)return void this.alertService.info("Supplier VATNO cannot be empty");if("cheque"==this._trnMainService.TrnMainObj.TRNMODE){if(!this._trnMainService.TrnMainObj.CHEQUENO)return void this.alertService.info("Cheque No cannot be null");if(!this._trnMainService.TrnMainObj.CHEQUEDATE)return void this.alertService.info("Cheque Date cannot be null")}}if("add-purchase-invoice"==this.activeurlpath||"add-debitnote-itembase"==this.activeurlpath){if(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT)>0&&!this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME)return void this.alertService.info("Please press F10 and select the TDS Account to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.TDSACCOUNTNAME){if(0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.AdditionalObj.TDSAMOUNT))return void this.alertService.info("Please press F10 and enter the TDS Amount to proceed!!!");if(this._trnMainService.TrnMainObj.AdditionalObj.SubLedgerValidation)return void this.alertService.info("Please press F10 and select the TDS Sub Ledger Account to proceed!!!")}}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Production warehouse cannot be empty");if(!this._trnMainService.TrnMainObj.BILLTOADD&&1==this.userSetting.EnableCompulsaryConsumption)return void this.alertService.warning("Consumption warehouse cannot be empty");this.assignWarehouseInProduction()}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>new Date(s.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=s.MCODE&&1==s.REQEXPDATE)[0];if(console.log("expdate1",n),null!=n&&null!=n&&this._trnMainService.TrnMainObj.ProdList.some(s=>6!==s.PTYPE))return void this.alertService.info("Expired Item Detected : "+n.ITEMDESC+"..Please Review the list...")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferIn){if(0===this.userSetting.centralizeddbmode&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userDivision),!this._trnMainService.TrnMainObj.REFBILL)return void this.alertService.warning("Ref No. cannot be empty.");if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("Transfer from field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry){let n=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>new Date(s.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=s.MCODE&&1==s.REQEXPDATE)[0];if(console.log("expdta",n),null!=n&&this._trnMainService.TrnMainObj.ConsumptionProdList.some(s=>6!==s.PTYPE))return void this.alertService.info("Expired Item Detected : "+n.ITEMDESC+"..Please Review the list...")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("To Warehouse field cannot be empty")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry){if("TransferOut"==this._trnMainService.TrnMainObj.INVOICETYPE&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision),""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Requisition To field cannot be empty");if(""==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD||null==this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTOADD==this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.warning("From Warehouse and To warehouse cannot be same")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut){if(!this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Transfer to field cannot be empty");if(this._trnMainService.TrnMainObj.BILLTO===this._trnMainService.TrnMainObj.BILLTOADD)return void this.alertService.warning("Same Division is detected");var i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList,function(n){return[n.MCODE,n.BATCH,n.ALTUNIT,n.ALTRATE,n.BC]});for(const n of i)if(n.length>1)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&"self-billing"!=this.activeurlpath&&0==this.userSetting.ENABLESINGLEBATCHMODE||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn){i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ProdList.filter(s=>0==s.ISUNKNOWN),function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const s of i)if(s.length>1&&1!=this._trnMainService.TrnMainObj.isDeliveryOrder)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&1==this.userSetting.EnableOnetoOneProduction){i=this.masterService.groupBy(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(s=>0==s.ISUNKNOWN),function(s){return[s.MCODE,s.BATCH,s.RATE,s.BC]});for(const s of i)if(s.length>1)return this.alertService.warning("Cannot save same item with same rate"),!1}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&2==this.userSetting.EnableOnetoOneProduction){let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>0==this._trnMainService.nullToZeroConverter(s.AMOUNT))[0];if(n)return void this.alertService.info(`Amount can not be empty for item ${n.ITEMDESC}`)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&!this._trnMainService.TrnMainObj.TRNAC)return void this.alertService.warning("Please select customer to save !");if(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase&&0!=this.userSetting.PODELIVERYMODE&&this._trnMainService.TrnMainObj.REFORDBILL&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag&&"VIEW"!=this._trnMainService.buttonMode&&1===this.userSetting.ShowPriceChangePopup){let n=this._trnMainService.TrnMainObj.ProdList.lastIndexOf(this._trnMainService.TrnMainObj.ProdList.filter(s=>s.PREV_PRATE!==s.ALTRATE&&!s.HasSellingPriceChange)[0]);if(this.activeindex=n,n>=0)return this._trnMainService.getAllSelingPriceOfItem(n),void(this.showPriceChangeDetail=!0)}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation&&(this.recurringItems=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.ISRECURRING),this.commissionChargeable=this._trnMainService.TrnMainObj.ProdList.filter(n=>1==n.HASCOMMISSIONCHARGE),this.recurringItems?.length>0||this.commissionChargeable?.length>0))return this.commissionChargeable.length>0&&(null==this._trnMainService.TrnMainObj.SALESMANID||""==this._trnMainService.TrnMainObj.SALESMANID)?(this.alertService.warning("Please select salesman for entering commission chargeable item details !"),this.commissionChargeable=[],void(this.recurringItems=[])):(this.recurringLogMode="add",void this.RecurringLog.show("add",this._trnMainService.TrnMainObj.MAIN_RECURRING_ID,this._trnMainService.TrnMainObj.RECURREFBILL));if(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.EnableRecurringItem&&1==this.userSetting.EnableCommissionCalculation){let n=this._trnMainService.TrnMainObj.ProdList,s=this._trnMainService.TrnMainObj.RecurringItemList,f=this._trnMainService.TrnMainObj.CommissionItemList?.filter(Q=>n.find(ee=>ee.MCODE==Q.MCODE));if(this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],s?.length>0&&(this.recurringItemsForEdit=s),f?.length>0&&(this.commissionItemsForEdit=f),this.recurringItemsForEdit?.length>0||this.commissionItemsForEdit?.length>0)return this.recurringLogMode="edit",void this.RecurringLog.show("edit")}if(this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&0===this.userSetting.DisableCostPriceValidationInSO){let n=this.checkForUserRigths("AllowSalesBelowCRate");if(n&&0==n?.value&&!this.checkSalesRateBeforeCrate()||!this.checkSODiscountLimit())return}if((this._trnMainService.TrnMainObj.VoucherType!==S.Km.TaxInvoice&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.Sales||this.checkGblDiscountLimit())&&(this._trnMainService.TrnMainObj.VoucherType!==S.Km.StockIssue&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.BranchTransferOut||this.checkExpItem())){if((this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&"asset-purchase-invoice"!=this.activeurlpath&&"NONTRADING"==this._trnMainService.TrnMainObj.INVOICETYPE&&1==this.userSetting.EnableSubLedger){let n=this._trnMainService.TrnMainObj.AdditionProdList.filter(s=>1==s.HASSUBLEDGER).find(s=>null==s.SL_ACNAME);if(n)return void this.alertService.warning(`Subledger field cannot be left empty for the item: ${n.ITEMDESC}!!!`)}!this.transactionValidator()||this.onSubmit()}}}else this.alertService.info("Remarks is required...");else this.alertService.info("Quantity exceed the transaction stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Quantity exced the available stock");else this.alertService.info("Refno or Prefix cannot be empty");else this.alertService.info(`Cannot save ${this._trnMainService.TrnMainObj.VCHRNO} voucher no as it is already forced closed.`)}onBarCodeClicked(){this._trnMainService.showBarCodePopUPinViewMode=!0,this._trnMainService.showBarCodePopUPSubject.next()}assignWarehouseInProduction(){for(const i of this._trnMainService.TrnMainObj.ProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTO;for(const i of this._trnMainService.TrnMainObj.ConsumptionProdList)i.WAREHOUSE=this._trnMainService.TrnMainObj.BILLTOADD}onPerformaViewRequest(){this._trnMainService.buttonMode="VIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice?i="PQ":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan&&(i="CD"),this.gridPopupSettingsForViewPerforma=this.masterService.getGenericGridPopUpSettings(i),this.genericGridPerformaView.show()}checkCreditLimitForTransaction(){return!(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.CREDITLIMIT)>0&&this.validationService.validateCreditLimit(this._trnMainService.TrnMainObj.NETAMNT,this._trnMainService.TrnMainObj.BLAMOUNT,this._trnMainService.TrnMainObj.CREDITLIMIT)&&!this.checkCreditLimitRights())}onViewReverseClick(){this._trnMainService.disableNepaliDate=!0,this._trnMainService.buttonMode="VIEW",this.billFormatsForPrint=null,this._trnMainService.reverseViewTag="REVERSEVIEW";let i="";this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&(i="PX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&(i="RR"),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(i="DX"),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(i="RE"),this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry?i="PE":this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn&&(i="RX"),this.gridPopupSettingsForReverse=this.masterService.getGenericGridPopUpSettings(i),console.log("modevalue",this._trnMainService.TrnMainObj),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&5==this._trnMainService.TrnMainObj.CNDN_MODE&&this.prepareApiUrlforAssetPurchaseReverseView(this.gridPopupSettingsForReverse),this.genericGridReverseView.show()}prepareApiUrlforAssetPurchaseReverseView(i){i.apiEndpoints="/getTrnMainPagedList/PX/assetPurchaseReverse"}checkItemIsSelectedINProduction(){return!!this._trnMainService.TrnMainObj.ProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)>0)||(this.alertService.warning("Please enter Production Quantity."),!1)}checkItemIsSelectedINConsumption(){return!(this._trnMainService.TrnMainObj.ConsumptionProdList.filter(n=>null==n.MCODE||""==n.MCODE)?.length>0&&(this.alertService.info("Items are not selected for consumption"),1))}checkInvalidQtyINConsumption(){let i=this._trnMainService.TrnMainObj.ConsumptionProdList.find(n=>this._trnMainService.nullToZeroConverter(n.ALTERNATEQUANTIY)<=0);return!i||(this.alertService.info(`Invalid Quantity is found in item: ${i.ITEMDESC}`),!1)}checkInvalidityInAdditionalPurchase(){if(!this._trnMainService.TrnMainObj.AdditionProdList.length)return!0;for(const i of this._trnMainService.TrnMainObj.AdditionProdList){if(this._trnMainService.nullToZeroConverter(i.ALTERNATEQUANTIY)<=0)return this.alertService.info(`Invalid Quantity is found in Account: ${i.MANUFACTURER}`),!1;if(!i.ITEMDESC)return this.alertService.info(`Description cannot be empty: ${i.ITEMDESC}`),!1;if(this._trnMainService.nullToZeroConverter(i.NETAMOUNT)<=0)return this.alertService.info(`NetAmount is Invalid: ${i.NETAMOUNT}`),!1}return!0}transactionValidator(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.ProductionEntry&&(this._trnMainService.TrnMainObj?.ConsumptionProdList?.length>1&&this.removeInvalidRowsFromConsumptionprod(),!(this.checkItemIsSelectedINProduction()&&(0==this.userSetting.EnableCompulsaryConsumption&&this.removeInvalidRowsFromConsumptionprod(),1!=this.userSetting.EnableCompulsaryConsumption||this.checkItemIsSelectedINConsumption()&&this.checkInvalidQtyINConsumption())))||(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&this._trnMainService.TrnMainObj.AdditionProdList?.length>0&&(this._trnMainService.removeInvalidRowsFromAdditionalprod(),!this.checkInvalidityInAdditionalPurchase()))return!1;if(this._trnMainService.TrnMainObj.ProdList.length>1&&this.removeInvalidRowsFromprod(),this._trnMainService.TrnMainObj.ProdList.length>1&&this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&this.removeRejectedQtyFromprod(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue)&&0==this.userSetting.ENABLESINGLEBATCHMODE){let n=this.findDuplicates(this._trnMainService.TrnMainObj.ProdList.map(s=>s.MCODE));if(n&&n.length>0){let s="";for(const _ of n){const f=this._trnMainService.TrnMainObj.ProdList.filter(Q=>Q.MCODE==_)?.find(Q=>!Q.BATCH);f&&(s=s+" "+f.ITEMDESC)}if(""!=s)return this.alertService.info(` following items ${s} have empty batch. Please check the entered items list`),!1}}if(!this._trnMainService.checkTransactionValidation())return null!=this.genericTender&&this.genericTender.hide(),!1;if(this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&!this._trnMainService.checkBatchWisePriceSelectedorNot())return!1;let i=this._trnMainService.TrnMainObj.ProdList.filter(n=>1===n.HASVARIANT);if(i&&i?.length>0)for(const n of i)if(null==n.BC||""==n.BC)return this.alertService.info(`Variant Details is not selected for Item:${n.ITEMDESC}`),!1;return!!this._trnMainService.setDefaultValueInTransaction()}findDuplicates(i){const n=new Map,s=[];return i.forEach(_=>{n.has(_)?n.set(_,n.get(_)+1):n.set(_,1)}),n.forEach((_,f)=>{_>1&&s.push(f)}),s}disableSaveBtnINCaseOfSingleBatch(){if(1==this.userSetting.ENABLESINGLEBATCHMODE&&((this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&2==this.userSetting.ALLOWMINUSTOCK_TRANSFEROUT||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&2==this.userSetting.ALLOWMINUSTOCK_STOCKISSUE||this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&2==this.userSetting.ALLOWMINUSTOCK_SALES||this._trnMainService.TrnMainObj.VoucherType==S.Km.ProductionEntry&&2==this.userSetting.ALLOWMINUSTOCK_CONSUMPTION||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&2==this.userSetting.ALLOWMINUSTOCK_DEBITNOTE)&&(this._trnMainService.showNegativeBilling||this._trnMainService.showNegativeBillingAuthForMain)||this._trnMainService.TrnMainObj.VoucherType==S.Km.Repack&&2==this.userSetting.ALLOWMINUSTOCK_REPACK&&this._trnMainService.showNegativeBillingInConsumption))return!0}checkZeroRate(i){return i.filter(n=>!n.ALTRATE).length>0}onSubmit(){if(this.doAutoRoundingInSales(),("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.AssetsProdList=this._trnMainService.TrnMainObj.AssetsProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)),this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales){let i=this._trnMainService.TrnMainObj.PARAC;if(0==this.userSetting.EnablePanBill&&this._trnMainService.TrnMainObj.NETAMNT>this.userSetting.ABBlimit)return this.masterService.TempTrnMainObj=this._trnMainService.TrnMainObj,void(confirm(`Net amount is greater than ${this.userSetting.ABBlimit}, Bill cannot proceed. Do want to change to tax invoice ?`)&&(console.log("pac",i),this.router.navigate(["/pages/transaction/sales/add-sales-invoice"],{queryParams:{mode:"FROMSI",ID:i}})))}if(this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&"Damage Warehouse"==this._trnMainService.TrnMainObj.MWAREHOUSE&&"add-creditnote-itembase"==this.activeurlpath)this.saveSalesReturnDamageValueToTMP();else if("transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath)this.saveTransactionApproval();else if("add-stock-issue-approval"==this.activeurlpath)this.saveApproveStockTransfer();else if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Stockadjustment)this.saveStockSettlement();else{if(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(null!=this._trnMainService.TrnMainObj.TransporterEway&&(this._trnMainService.TrnMainObj.TransporterEway.TOTALWEIGHT=this._trnMainService.TrnMainObj.TOTALWEIGHT),this.memberID=this._trnMainService.TrnMainObj.MEMBERNO,this.memberName=this._trnMainService.TrnMainObj.MEMBERNAME,this.schemeID=this._trnMainService.TrnMainObj.SCHEMENAME),"VIEW"==this._trnMainService.TrnMainObj.Mode&&this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoiceCancel&&(this._trnMainService.TrnMainObj.Mode="NEW"),this.modeis=this._trnMainService.TrnMainObj.Mode,"NEW"==this.modeis?this._trnMainService.TrnMainObj.AdditionalObj&&(this.billFormatsForPrint=this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this.billFormatsForPrint=null,this._trnMainService.TrnMainObj.PCL="pc002",1==this.userSetting.ENABLEMULTISPRINTFORMAT?(14==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType)&&this.masterService.updateBillFormats(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS):this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS="FULL"),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&(this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.TrnMainObj.BILLTO),"requisition-entry"==this.activeurlpath&&1==this.userSetting.EnableRQLogInRQEntry){let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.checkInRQentry);if(0==n?.length)return void this.alertService.info("Please recheck the list and tick at least one of items to be requisite before saving.");this._trnMainService.TrnMainObj.ProdList=n,this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.UNIT==s.ALTUNIT&&(s.SPRICE=s.ALTRATE,s.ALTRATE=0,s.RATE=0),s.ALTQTY_IN=s.ALTERNATEQUANTIY,s.REALQTY_IN=s.ALTERNATEQUANTIY*s.ALTCONFACTOR})}if(80==this._trnMainService.TrnMainObj.VoucherType&&1==this.userSetting.EnableRQLogInRQEntry&&this._trnMainService.TrnMainObj.ProdList.forEach(n=>{n.BASEQUANTITY=n.ALTERNATEQUANTIY*n.ALTCONFACTOR,n.Quantity=n.BASEQUANTITY}),95==this._trnMainService.TrnMainObj.VoucherType||"shortage-adjustment"==this.activeurlpath){let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.checkInExcessAdj);if(0==n?.length)return void this.alertService.info("Please recheck the list and tick atleast one of the items to be adjusted before saving.");this._trnMainService.TrnMainObj.ProdList=n}if(82==this._trnMainService.TrnMainObj.VoucherType){if(this.assignRateAndQtyForAllocation(),this.mergeBranchList(),0==this._trnMainService.TrnMainObj.ProdList.filter(s=>s.TotalDispatch>0)?.length)return void this.alertService.info("No Product to Dispatch!");this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.TotalDispatch>0)}71==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.DIVISION=this._trnMainService.TrnMainObj.AdditionalObj.DIVISION),this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionApproval&&"supplier"==this._trnMainService.TrnMainObj.filterByInReqApproval&&(this._trnMainService.TrnMainObj.INVOICETYPE="supplier",this.assignQtyInReqApp(),this.mergeBranchList()),this.ExcessAndShortageAdjustment(),"add-purchase-order"===this.activeurlpath&&(this._trnMainService.TrnMainObj.AdditionProdList=[]),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"FROMNOTIFICATION"==this._trnMainService.TrnMainObj.CHALANNOPREFIX&&(this._trnMainService.TrnMainObj.CHALANNOPREFIX="");let i="asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath?this._trnMainService.TrnMainObj.AssetsProdList.find(n=>!n.ALTUNIT):this._trnMainService.TrnMainObj.ProdList.find(n=>!n.ALTUNIT);if(this.validationService.checkEmptyUnit(i)||this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice&&this.checkZeroRate(this._trnMainService.TrnMainObj.ProdList)&&!confirm("Zero rate item detected. Continue?"))return;if("asset-purchase-invoice"===this.activeurlpath&&!this._trnMainService.TrnMainObj.MWAREHOUSE)return void this.alertService.warning("Please enter Location!");if("assets-openingstockentry"===this.activeurlpath)for(const n of this._trnMainService.TrnMainObj.AssetsProdList){if(!n.ACNAME)return void this.alertService.warning("Account cannot be empty");if(!n.PurchaseDate)return void this.alertService.warning("Please enter purchase date!");if(!n.LocID)return void this.alertService.warning("Please enter Location!");if(!n.BOOKVALUE||n.BOOKVALUE<0)return void this.alertService.warning("Please enter valid Bookvalue! Cannot be negative and empty");if(1===n.HASSUBLEDGER&&!n.SL_ACNAME)return void this.alertService.warning("Please enter Subledger")}if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return this._trnMainService.TrnMainObj.CNDN_MODE=5,this.spinnerService.show("Saving data..."),void this.masterService.saveAssetsTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(n=>{"ok"==n.status&&(this.spinnerService.hide(),this.alertService.success(n.result),this._trnMainService.TrnMainObj.AssetsProdList=[],this.onReset(),this._trnMainService.TrnMainObj.CNDN_MODE=5)},n=>{this.spinnerService.hide()});this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(n=>{if("ok"==n.status){let s=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=s.CompanyInfo.PhiscalID,this.voucherno=n.savedvchrno?n.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj?.AdditionalObj?.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableCalculateButton=!0,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.disableOnCreditSelect=!1,this._trnMainService.callPipe=!this._trnMainService.callPipe,this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.requisitionFromNotification=!1,0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.productHelperSerivce.clearBarcodeGrid(),this.onReset(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),null==this._trnMainService.TrnMainObj.ProdList)return void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryChalan||this._trnMainService.TrnMainObj.VoucherType==S.Km.DeliveryReturn||"quotation"==this.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&confirm("Do you want to print bill ?")&&this.onPrintClicked(),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=n.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=n.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=n.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(_=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=_.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=_.BILLUNITS}),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==n.status&&this.alertService.info(n.result.error)},n=>{this.alertService.info(n)})}}mergeProdAndAdditionProdList(){console.log("AdditionalProdList",this._trnMainService.TrnMainObj.AdditionProdList),this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.AdditionProdList.forEach(n=>{i.ITEMDESC==n.ITEMDESC&&(i.RealQty+=n.RealQty,n.BranchWiseDistributionList.forEach(s=>{i.BranchWiseDistributionList.push(s)}))})}),console.log("ProdList123",this._trnMainService.TrnMainObj.ProdList)}assignRateAndQtyForAllocation(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.TotalDispatch,i.Quantity=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.AMOUNT=0,i.NETAMOUNT=0})}ExcessAndShortageAdjustment(){"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReceive",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.WAREHOUSE=this.userProfile.userWarehouse,i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"excess-goods-return"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="GoodsReturn"),"shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="central",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.REALQTY_IN=i.RealQty,i.ALTQTY_IN=i.AltQty,i.RealQty=0,i.AltQty=0})),"close-requisition-approval"==this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.Quantity=i.REALQTY_IN=i.ALTERNATEQUANTIY*i.ALTCONFACTOR,i.ALTQTY_IN=i.ALTERNATEQUANTIY}),"branch-shortage-adjustment"==this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="branch",this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.RealQty=i.REALQTY_IN,i.AltQty=i.ALTQTY_IN,i.REALQTY_IN=0,i.ALTQTY_IN=0}))}assignQtyInReqApp(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.ALTERNATEQUANTIY=i.AltQty=i.Quantity=i.RealQty,i.AMOUNT=0,i.NETAMOUNT=0})}mergeBranchList(){this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BranchWiseDistributionList=[],i.BranchWiseDistributionList=i.BranchWiseDistributionList.concat(i.BranchWiseDistributionList1,i.BranchWiseDistributionList2)})}saveStockSettlement(){this.spinnerService.show("Saving data Please wait a moment..."),this.masterService.saveStockSettlement(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{if("ok"==i.status){this.spinnerService.hide();let n=this.authService.getUserProfile();if(this._trnMainService.TrnMainObj.PhiscalID=n.CompanyInfo.PhiscalID,this.voucherno=i.savedvchrno?i.savedvchrno:this._trnMainService.TrnMainObj.VCHRNO,this.unit=this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS,this.phiscalid=this._trnMainService.TrnMainObj.PhiscalID,this.trnuser=this._trnMainService.TrnMainObj.TRNUSER,this.paracNEW=this._trnMainService.TrnMainObj.PARAC,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableAllFieldinSales=!1,this.masterService.TempTrnMainObj={},this._trnMainService.barCodes={},this._trnMainService.disablePaymentTerms=!1,this._trnMainService.loadFromRequisitionLog=0,0!=this._trnMainService.fromNotification&&this.markAsReadNotifications(),this.reverseEntryConfirm.hide(),this.onReset(),this._trnMainService.currentIndexProductDetails=[],(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote)&&(1==this.PaymentPopup.isActive&&this.PaymentPopup.closeDialog(),1==this.RecurringLog.isActive&&this.RecurringLog.closeDialog()),null==this._trnMainService.TrnMainObj.ProdList)return console.log("message error!!!"),void this.alertService.info("Product List cannot be empty");"self-billing"===this.activeurlpath&&this.onSaveSelfBilling.emit(),"inventory-allocation"===this.activeurlpath&&this.onSaveINVAllocation.emit(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales||this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote||"quotation"==this.activeurlpath)&&1==this.userSetting.ENABLEOFFLINEPRINT&&(this._trnMainService.hideProductDescriptionPopUp=!1,console.log("showprint"),this.onPrintClicked()),this._trnMainService.TrnMainObj.VoucherType==S.Km.CreditNote&&1==this.userSetting.ENABLEMULTISPRINTFORMAT&&this.onPrintClicked(),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation="",this.onPrintClicked()),"excess-goods-return"==this.activeurlpath?this._trnMainService.pageHeading="EXCESS GOODS RETURN":"excess-goods-acknowledgement"==this.activeurlpath&&(this._trnMainService.pageHeading="EXCESS GOODS ACKNOWLEDGEMENT;"),(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote)&&(console.log("after purchase save"),confirm("Do you want to print bill ?")&&this.onPrintClicked()),14==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.MEMBERNAME=this.memberName,this._trnMainService.TrnMainObj.SCHEMENAME=this.schemeID,this._trnMainService.TrnMainObj.MEMBERNO=this.memberID,null!=i.result2&&(this._trnMainService.TrnMainObj.EARNPOINS=i.result2.pointsGained,this._trnMainService.TrnMainObj.NETAMNT=i.result2.billamnt),this.masterService.focusAnyControl("customerselectid")),this.masterService.loadCompany().subscribe(s=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=s.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=s.BILLUNITS}),57==this._trnMainService.TrnMainObj.VoucherType&&(this.menudata=this.TrnMainObj.ProdList),"canceladdsientry"==this.activeurlpath&&(this._trnMainService.TrnMainObj.VoucherType=61),this._trnMainService.itemselectevent=!1}"error"==i.status&&(this.spinnerService.hide(),this.alertService.info(i.result.error))},i=>{this.spinnerService.hide(),this.alertService.info(i)})}excelDownloadFromHtml_manualTable(){try{this.reportData=this.menudata;let Q='<table style="border: thin solid black;">  <thead>   <tr>';for(let ee of this.reportHeaders)Q+='<th style="border: thin solid black;">'+ee+"</th>";Q+="</tr> </thead>",Q+="<tbody>";for(let ee of this.reportData){Q+="<tr>";for(let ne of this.reportBody){var i=ee[ne];null==i&&(i=""),Q+='<td style="border: thin solid black;">'+i+"</td>"}}Q+="</tbody></table>";var s=new Blob([Q],{type:"application/vnd.ms-excel"}),_=URL.createObjectURL(s),f=document.createElement("a");f.href=_,f.download=this.excelReportNameProvide()+".xls",document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(Q){alert(Q)}}excelReportNameProvide(){return"Proforma - "+this.TrnMainObj.BILLTO}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeRejectedQtyFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(i=>this._trnMainService.nullToZeroConverter(i.APPROVEDALTQTY)>0)}removeInvalidRowsFromConsumptionprod(){this._trnMainService.TrnMainObj.ConsumptionProdList=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(i=>null!=i.MCODE&&""!=i.MCODE)}removeInvaldRowsFromAdditionProd(){this._trnMainService.TrnMainObj.AdditionProdList=this._trnMainService.TrnMainObj.AdditionProdList.filter(i=>{})}nullToZeroConverter(i){return null==i||null==i||""==i?0:parseFloat(i)}viewVoucerForAssets(i){if("EDIT"===this._trnMainService.buttonMode){const n=this.masterService.checkAssetDepreciation(i.VCHRNO).pipe((0,te.K)(s=>(0,ge.of)("blocked-becauseOfAssetDepreciation")),(0,de.b)(s=>"blocked-becauseOfAssetDepreciation"===s?(0,ge.of)("blocked-becauseOfAssetDepreciation"):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).pipe((0,de.b)(_=>(0,$.s)(()=>"ok"===_.status,(0,ge.of)("ok"),(0,ge.of)("blocked-becauseOfReverseEntry")))))).subscribe(s=>{"blocked-becauseOfAssetDepreciation"!==s?"blocked-becauseOfReverseEntry"!==s?this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID):this.alertService.info("Cannot edit because reverse entry of this voucher is already done"):this.alertService.info("Depreciation cancellation is required for edit command.")});this.subscriptions.push(n)}else this._trnMainService.loadVoucherForAssets(i.VCHRNO,i.DIVISION,i.PhiscalID)}onItemDoubleClick(i){if("asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath)return void this.viewVoucerForAssets(i);let n=this.masterService.userProfile.userRights.find(s=>"L_EDIT"==s.right);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&1==i.POST&&"VIEW"==this._trnMainService.buttonMode&&0==n?.value&&(this._trnMainService.disableReverseEntryForLatePost=!0),this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase||"EDIT"!=this._trnMainService.buttonMode||0==i.POST||0!=n?.value){if("StockSettlementEntry"!=this.activeurlpath&&null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.length>0){let s=this._trnMainService.TrnMainObj.ProdList[0];if(null!=s&&null!=s.MCODE)return confirm("You are about to load the bill.Do you want to continue?")?void this.loadVoucher(i):void 0}this.loadVoucher(i)}else this.alertService.info(`Voucher Approval for ${i.VCHRNO} is already done!. You are not authorized to edit this voucher.`)}onPerformaDoubleClick(i){this.loadVoucher(i)}onRecurringDoubleClick(i){this.onReset(),this.loadingService.show("Getting Details, Please Wait..."),this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=i.VATNO,this._trnMainService.TrnMainObj.REFBILL=i.ENTRYNO,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNACName=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this.getProdListData(i),this._trnMainService.getAllUnitsOfItem(0),this.focusAfterSelectItem(),this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}getProdListData(i){let n=this._trnMainService.TrnMainObj.ProdList[0];n.PTYPE=i.PTYPE,n.ECSRATE=i.ECSRATE,n.HASECSCHARGE=i.HASECSCHARGE,n.NATURETYPE=i.NATURETYPE,n.ENABLEITEMWISEBATCH=i.ENABLEITEMWISEBATCH,n.ITEMDESC=i.DESCA,n.ALTRATE=i.RATE,n.RATE=i.RATE,n.BASERATE=i.RATE,n.MENUCODE=i.MENUCODE,n.MCODE=i.PARENT_MCODE,n.PRATE=i.PRATE,n.HASVARIANT=i.HASVARIANT,n.ISRECURRING=i.ISRECURRING,n.ISVAT=i.ISVAT,n.MRP=i.MRP,n.ALTCONFACTOR=i.CONFACTOR,n.WARRANTY=i.WARRANTY,n.Mcat=i.MCAT,n.UNIT=i.BASEUNIT,n.HASCOMMISSIONCHARGE=i.HASCOMMISSIONCHARGE,n.DISMODE=i.DISMODE,n.WSRATE_DISCOUNT=i.WSRATE_DISCOUNT,n.ROWARN=i.ROWARN,n.MINWARN=i.MINWARN,n.PWEIGHT=i.GWEIGHT,n.ALTERNATEQUANTIY=1,n.Quantity=1}focusAfterSelectItem(){2==this.userSetting.EnableBatch?null!=document.getElementById("batch0")&&setTimeout(()=>{document.getElementById("batch0").focus()},20):null!=document.getElementById("alternateunit0")&&setTimeout(()=>{document.getElementById("alternateunit0").focus()},20)}onLoadFromPerformaInvoice(){this.onLoadFromPerformaInvoiceClickEmit.emit(!0)}onLoadFromDeliveryChalan(){this._trnMainService.TrnMainObj.TRNAC?this.deliverySelectPopup.show():this.alertService.info("Please select account first!")}onMultiItemSelected(i){let n=[];i.forEach(s=>{n.push(s.VCHRNO)}),i.every(s=>s.TRNAC===i[0].TRNAC)&&(this._trnMainService.TrnMainObj.TRNAC=i[0].TRNAC,this._trnMainService.TrnMainObj.BILLTO=i[0].BILLTO,this._trnMainService.TrnMainObj.BILLTOADD=i[0].BILLTOADD,this._trnMainService.TrnMainObj.BILLTOTEL=i[0].VATNO),this._trnMainService.TrnMainObj.DELIVERYREF="",this._trnMainService.TrnMainObj.DELIVERYREF=n.join(","),this.multiselectGenericGrid.hide(),1==this.userSetting.EnablePartialDCInTI?this.deliveryChalanEmit.emit(n):this._trnMainService.getDeliveryChalanProdDetails(n)}getChalanList(){this.multiselectPopupSettings=this.masterService.getGenericGridPopUpSettings("DeliveryInTI",this._trnMainService.TrnMainObj.TRNAC)}onShowImport(){this.onShowFileUploadPopupEmit.emit(!0)}onImportPurchaseInvoice(){this.onFileUploadPopupEmit.emit(!0)}onShowImportSO(){this.onFileUploadPopupEmit.emit(!0)}getExpList(){this.gridPopupSettingsForExpList={title:"Expired Order List",apiEndpoints:"/getExpiredOrderVouchersList",defaultFilterIndex:0,useDefinefilterValue:"",columns:[{key:"VCHRNO",title:"SONO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1}]}}onShowExpiredSO(i){this.getExpList(),this.genericGridExpList.show()}onListSelected(i){i&&(this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this.masterService.getExpiredOrderVouchersProdList(i.VCHRNO).subscribe(n=>{n&&(this._trnMainService.TrnMainObj.ProdList=n)}))}loadVoucher(i){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.GoodsReceived&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DeliveryChalan||10!=i.STATUS||"EDIT"!==this._trnMainService.buttonMode){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI){if(1==i.STATUS&&"EDIT"===this._trnMainService.buttonMode)return void this.alertService.info("Cannot edit this voucher!");(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation||this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&1==this.userSetting.ENABLE_GRN_IN_PI)&&"EDIT"===this._trnMainService.buttonMode?(this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.enableRefreshRateInSO=!0),this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result&&"PARTIAL-EXISTED"!=n.result?this._trnMainService.TrnMainObj.VoucherType!==S.Km.SalesOrder&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.PurchaseOrder&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.RequisitionEntry||10!=i.STATUS?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i.VCHRNO}).subscribe(s=>{"FORCECLOSED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("This Voucher is force closed, cannot edit")}):this.alertService.info("Transaction already exist under selected voucher no")})):(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.enableRefreshRateInSO=!1)}else this._trnMainService.TrnMainObj.VoucherType!==S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote&&this._trnMainService.TrnMainObj.VoucherType!==S.Km.ProductionEntry||"EDIT"!==this._trnMainService.buttonMode?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.masterService.checkDuplicateReverseEntry(i.VCHRNO).subscribe(n=>{"ok"==n.status?(0,$.s)(()=>this._trnMainService.TrnMainObj.VoucherType!==S.Km.DebitNote,(0,F.P)(()=>this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:i.VCHRNO})),(0,ge.of)("dummy")).subscribe(s=>{"EXISTED"!=s.result?(this._trnMainService.loadData(i.VCHRNO,i.DIVISION,i.PhiscalID),this._trnMainService.showPerformaApproveReject=!1):this.alertService.info("Transfer out has been done with reference to this voucher. Cannot edit.")}):this.alertService.info(n.result.error)},n=>{this.alertService.info(n)});"VIEW"==this._trnMainService.buttonMode&&(this.TermsButtonTag="VIEW T&C")}else this.alertService.info(this._trnMainService.TrnMainObj.VoucherType===S.Km.DeliveryChalan?`Voucher No. ${i.VCHRNO} is Already Reversed/Billed. Cannot Edit!`:"Cannot edit this voucher!")}onNewClick(){confirm("Are you sure to Reset the transaction? ")&&(this._trnMainService.buttonMode="",this.masterService.disableQtyInStockIssueReturn=!1,this._trnMainService.saveButton=!1,this._trnMainService.disableConsumption=!1,this._trnMainService.itemselectevent=!1,this._trnMainService.currentIndexProductDetails=[],this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.disableTranferToFromReq=!1,this._trnMainService.afterAutoloadCheck=!1,this._trnMainService.barCodes={},this._trnMainService.barCodes.Quantity=1,this._trnMainService.disableNepaliDate=!0,this._trnMainService.enableRefreshRateInSO=!1,this._trnMainService.disbaleReqFrom=!1,this._trnMainService.viewModeForStockSettle=!1,this._trnMainService.disableCalculateButton=!0,this._trnMainService.disableOnCreditSelect=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this._trnMainService.callPipe=!this._trnMainService.callPipe,this.multiselectGenericGrid.selectedItems=[],this._trnMainService.disableOnDCselect=!1,this._trnMainService.disableAccountInputField=!1,this._trnMainService.requisitionFromNotification=!1,this._trnMainService.disableNepaliDate=(24===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&("add-sales-invoice"!=this.activeurlpath&&"add-sales-invoice-wholesale"!=this.activeurlpath&&"abbreviated-sales-invoice"!=this.activeurlpath&&"add-creditnote-itembase"!=this.activeurlpath||1!=this._trnMainService.userProfile.CompanyInfo.AllowBackDateSalesEntry),"canceladdsientry"==this.activeurlpath&&(this.viewClicked=!1),this._trnMainService.urlpath=this.arouter.snapshot.url[0].path,this._trnMainService.TrnMainObj.VoucherType===S.Km.ReversePurchase&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.Purchase),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseCreditNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.CreditNote),this._trnMainService.TrnMainObj.VoucherType===S.Km.CancelProforma&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.PerformaSalesInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryChalan&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryChalan),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseTaxInvoice&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoice),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseProductionEntry&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.ProductionEntry),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDeliveryReturn&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DeliveryReturn),this._trnMainService.TrnMainObj.VoucherType===S.Km.ReverseDebitNote&&(this._trnMainService.TrnMainObj.VoucherType=S.Km.DebitNote),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableAllFieldinPurchase=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.disableAllFieldinSales=!1,this._trnMainService.disableOnGRNload=!1,this._trnMainService.disableCostCenterForCargo=!1,this._trnMainService.disablePaymentTerms=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),"add-membership-sales-invoice"===this.activeurlpath&&(this._trnMainService.TrnMainObj.INVOICETYPE="MembershipSalesInvoice",this._trnMainService.TrnMainObj.AdditionalObj.tag="MembershipSalesInvoice",this._trnMainService.TrnMainObj.BILLMODE="new"),this.userSetting.enableCostCenter>0&&1==this.userSetting.EnableCostCenterWiseAccounting&&("add-creditnote-itembase"==this.activeurlpath||"add-sales-invoice"==this.activeurlpath)&&(this._trnMainService.TrnMainObj.COSTCENTER=this._trnMainService.accountWiseCostCenter),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this._trnMainService.shippingAddress=[],this._trnMainService.TrnMainObj.ShippingLocation=""),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(0!=this.userSetting.PODELIVERYMODE||0!=this.userSetting.ENABLE_QUOTATTION_INSO)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse)),"self-billing"==this.activeurlpath&&this.onclickOnResetPopupEmit.emit(),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),this._trnMainService.hideProductDescriptionPopUp=!1,this.masterService.loadCompany().subscribe(i=>{this._trnMainService.TrnMainObj.AdditionalObj.BILLFORMATS=i.BILLFORMATS,this._trnMainService.TrnMainObj.AdditionalObj.BILLUNITS=i.BILLUNITS}),14==this._trnMainService.TrnMainObj.VoucherType&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.TRNMODE=1==this.userSetting.GblEnableMixedTenderMode?"cash":"credit",this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput"),0!=this.userSetting.ENABLE_SOINTI&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1)),1==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.LOADFULLFROMQT=1),(this._trnMainService.TrnMainObj.VoucherType===S.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesReturn)&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),80===this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.TrnMainObj.INVOICETYPE="TransferOut"),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1==this.userSetting.REFBILLCOMPULSORINDNOTE?1:0,setTimeout(()=>{this.masterService.focusAnyControl("refbill")},500)),(this._trnMainService.TrnMainObj.VoucherType===S.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this.masterService.ShowMore=!0,(0!=this.userSetting.IMPORTBILLPO&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||0!=this.userSetting.PODELIVERYMODE&&"IMPORT_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("invoiceNO")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.SalesOrder&&(this.masterService.ShowMore=!0,0!=this.userSetting.ENABLE_QUOTATTION_INSO&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,0!=this.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.Quotation&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.PerformaSalesInvoice&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("refnoInput")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(this.masterService.ShowMore=!0,setTimeout(()=>{this.masterService.focusAnyControl("stockissueFromWH")},500)),this._trnMainService.TrnMainObj.VoucherType===S.Km.GoodsReceived&&(this.masterService.ShowMore=!0,0!=this.userSetting.PODELIVERYMODE&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),setTimeout(()=>{this.masterService.focusAnyControl("entryDateAD")})),this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssueReturn&&(this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales&&(this.masterService.ShowMore=!0,setTimeout(()=>{1==this.userSetting.GblEnableMixedTenderMode?document.getElementById("itemDesc0").focus():document.getElementById("paymentTerms").focus()},200)),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath,"self-billing"==this.activeurlpath&&(this._trnMainService.TrnMainObj.TRNMODE="credit"),this.clearQtyRate(),this.TermConditionPopup.clearTermsAndCondition(),(this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==S.Km.Sales)&&this.userProfile.CASH_AC&&this.userProfile.CASH_AC_NAME&&"cash"==this._trnMainService.TrnMainObj.TRNMODE?.toLowerCase()&&(this._trnMainService.TrnMainObj.TRNAC=this.userProfile.CASH_AC,this._trnMainService.TrnMainObj.TRNACName=this.userProfile.CASH_AC_NAME),this._trnMainService.TrnMainObj.VoucherType===S.Km.DebitNote&&1==this.userSetting.enabledistributedpurchase&&(this._trnMainService.TrnMainObj.COSTCENTER=this.userProfile.costCenter)}onReset(){this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType),this._trnMainService.showPerformaApproveReject=!1,this._trnMainService.disableRateOnPOselect=!1,this._trnMainService.disableSupplierInfo=!1,this._trnMainService.disableCustomerInfo=!1,this._trnMainService.disableOnPerFormaSelect=!1,this._trnMainService.disableRateOnGRNload=!1,this._trnMainService.enableRefreshRateInSO=!1,this.TermsButtonTag="APPLY T&C",this._trnMainService.searchedTermsandCondition="",this._trnMainService.termsnConditionLabel="",this._trnMainService.allowDescriptionEdit=!1,this._trnMainService.disableReverseEntryForLatePost=!1,this._trnMainService.showModesForCC=!0,this._trnMainService.showCertainModes=!0,this._trnMainService.disableAccountInputField=!1,this._trnMainService.fromRequistionToTransferOut=!1,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&(this.masterService.ShowMore=!0,this.masterService.focusAnyControl(1==this.userSetting.PrefixForRefNoInVEntry?"refno":"refnoInput"),this._trnMainService.TrnMainObj.IsWholesale="add-sales-invoice-wholesale"===this.activeurlpath),this._trnMainService.TrnMainObj.VoucherType==S.Km.Purchase&&"IMPOR_PURCHASE"!==this._trnMainService.TrnMainObj.AdditionalObj.tag&&(0!==this.userSetting.PODELIVERYMODE||0!==this.userSetting.ENABLE_GRN_IN_PI)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),"goods-received-note"===this.activeurlpath&&(1==this.userSetting.PODELIVERYMODE||2==this.userSetting.PODELIVERYMODE)&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),this._trnMainService.TrnMainObj.VoucherType==S.Km.DebitNote&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1),1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse)}onRefershRateClicked(){let i;i=this._trnMainService.TrnMainObj.ProdList.filter(n=>null!=n.MCODE).map(n=>n.MCODE),this.loadingService.show("Refreshing.Please Wait..."),this.masterService.getMultipleItemPriceInSO(i).subscribe(n=>{if("ok"==n.status){for(let s=0;s<n.result.length;s++)console.log("index here",s),this._trnMainService.TrnMainObj.ProdList[s].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[s].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A):(this._trnMainService.TrnMainObj.ProdList[s].RATE=n.result[s].RATE_A,this._trnMainService.TrnMainObj.ProdList[s].ALTRATE=n.result[s].RATE_A*this._trnMainService.TrnMainObj.ProdList[s].ALTCONFACTOR);this._trnMainService.ReCalculateBillWithNormal(),this.loadingService.hide()}})}okClicked(i){this._trnMainService.TrnMainObj.TenderList=i;let n=this._trnMainService.TrnMainObj.TenderList[0];null!=n?(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this.transactionValidator()&&(this.onSubmit(),this.genericTender.hide())):this.alertService.info("Tender Amount not detected")}approvePerformInvoice(){this.masterService.approvePerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully approved")},n=>{this.alertService.info(n)})}rejectPerformInvoice(){this.masterService.rejectPerformaInvoice(this._trnMainService.TrnMainObj.VCHRNO).subscribe(()=>{this.alertService.success("Pro Forma invoice successfully rejected")},n=>{this.alertService.info(n)})}okAddNewClicked(i){let n=i;n.PRICELEVEL=i.GEO,n.TYPE="A",n.PARENT="PA",n.PType="C",n.COMPANYID=this._trnMainService.userProfile.CompanyInfo.COMPANYID}onRecallClick(){this.genericGridHoldBill.show()}onHoldClick(){null!=this._trnMainService.TrnMainObj.ProdList.filter(i=>null!=i.MCODE&&null!=i.BATCH)[0]?this.masterService.masterPostmethod("/saveholdbill",this.HoldBillPreparationForSave()).subscribe(i=>{"ok"==i.status&&this._trnMainService.initialFormLoad(S.Km.TaxInvoice)},i=>{alert(i)}):this.alertService.info("No Valid Products entries Detect...")}HoldBillPreparationForSave(){let i={},n=[];for(let s of this._trnMainService.TrnMainObj.ProdList)null!=s.MCODE&&null!=s.BATCH&&n.push({MCODE:s.MCODE,UNIT:s.ALTUNIT,Quantity:s.Quantity,BATCH:s.BATCH,BC:s.BC,REMARKS:s.REMARKS,INVDISRATE:s.INDDISCOUNTRATE,INVDISAMOUNT:s.INDDISCOUNT,CONFACTOR:s.CONFACTOR});return i={PARAC:this._trnMainService.TrnMainObj.PARAC,REMARKS:this._trnMainService.TrnMainObj.REMARKS,DATE:this._trnMainService.TrnMainObj.TRNDATE,NETAMNT:this._trnMainService.TrnMainObj.NETAMNT,FLATDISRATE:this._trnMainService.TrnMainObj.DCRATE,FLATDISAMOUNT:this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT,INVOICETYPE:"retailinvoice",PAYMENTSTATUS:"Hold",holdBillProdList:n,SNO:this._trnMainService.TrnMainObj.HOLDBILLID},i}onHoldBillDoubleClick(i){this.loadingService.show("Recalling Bill.Please Wait..."),this.masterService.masterPostmethod("/recallholdbill",i).subscribe(n=>{"ok"==n.status?(this._trnMainService.initialFormLoad(S.Km.TaxInvoice),this.convertingRecallBillToMainBill(JSON.parse(n.result)),this._trnMainService.TrnMainObj.HOLDBILLID=i.SNO,this.loadingService.hide()):(this.loadingService.hide(),this.alertService.info(n.result._body))},n=>{alert(n)})}convertingRecallBillToMainBill(i){this._trnMainService.TrnMainObj.TRNAC=this._trnMainService.TrnMainObj.PARAC=i.PARAC,null!=i.customer&&(this._trnMainService.TrnMainObj.BILLTO=i.customer.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=i.customer.ADDRESS,this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=i.customer.PSTYPE,this._trnMainService.TrnMainObj.TRNMODE=i.customer.PMODE,this._trnMainService.TrnMainObj.PARTY_ORG_TYPE=i.customer.ORG_TYPE),this._trnMainService.TrnMainObj.REMARKS=i.REMARKS,this._trnMainService.TrnMainObj.INVOICETYPE=i.INVOICETYPE,this._trnMainService.TrnMainObj.DiscRate=this._trnMainService.nullToZeroConverter(i.FLATDISRATE),this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this._trnMainService.nullToZeroConverter(i.FLATDISAMOUNT),this._trnMainService.TrnMainObj.ProdList=[];let n=0;for(let _ of i.holdBillProdList)if(null!=_.MCODE&&null!=_.BATCH){var s={};s.MCODE=_.MCODE,s.SELECTEDITEM=_.SELECTEDITEM,s.BC=_.BC,s.ISVAT=_.SELECTEDITEM.ISVAT,s.MENUCODE=_.SELECTEDITEM.MENUCODE,s.ITEMDESC=_.SELECTEDITEM.DESCA,s.MCODE=_.SELECTEDITEM.MCODE,s.GSTRATE_ONLYFORSHOWING=_.SELECTEDITEM.GST,s.GSTRATE=_.SELECTEDITEM.GST,s.WEIGHT=_.SELECTEDITEM.GWEIGHT,s.Mcat=_.SELECTEDITEM.MCAT,s.MRP=_.SELECTEDBATCH.MRP,s.BATCH=_.BATCH,s.MFGDATE=null==_.SELECTEDBATCH.MFGDATE?"":_.SELECTEDBATCH.MFGDATE.toString().substring(0,10),s.EXPDATE=null==_.SELECTEDBATCH.EXPIRY?"":_.SELECTEDBATCH.EXPIRY.toString().substring(0,10),s.UNIT=_.SELECTEDBATCH.UNIT,s.STOCK=_.SELECTEDBATCH.STOCK,s.WAREHOUSE=_.SELECTEDBATCH.WAREHOUSE,s.BATCHSCHEME=_.SELECTEDBATCH.SCHEMENAME,s.Quantity=this._trnMainService.nullToZeroConverter(_.Quantity),s.INDDISCOUNTRATE=this._trnMainService.nullToZeroConverter(_.INVDISRATE),s.INDDISCOUNT=this._trnMainService.nullToZeroConverter(_.INVDISAMOUNT),s.inputMode=!1,s.Product={},s.Product.MCODE=_.MCODE,s.Product.AlternateUnits=_.ALTUNITLIST,s.ALTUNITObj=s.Product.AlternateUnits.filter(f=>f.ALTUNIT==_.UNIT)[0],this._trnMainService.TrnMainObj.ProdList.push(s),this._trnMainService.AssignSellingPriceAndDiscounts(_.PClist,n),this._trnMainService.RealQuantitySet(n,_.CONFACTOR),n++}this._trnMainService.ReCalculateBillWithNormal()}onTransportClick(){this.Transport.show()}handleKeyDownboardEvent(i){if(0==this.PaymentPopup.isActive)if("ControlLeft"==i.code||"ControlRight"==i.code)i.preventDefault(),this.showSecondaryButtons=!this.showSecondaryButtons;else if("F3"==i.code)i.preventDefault(),this.onNewClick();else if("F12"==i.code)i.preventDefault(),this.showItemSearchPopup();else if("End"==i.code)i.preventDefault(),"VIEW"!=this._trnMainService.TrnMainObj.Mode&&!this.masterService.customerpopup&&(this._trnMainService.showPerformaApproveReject||this.onSaveClicked());else if("F4"==i.code)i.preventDefault(),!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&this.onViewClicked();else if("F7"==i.code){i.preventDefault();let n=this._trnMainService.TrnMainObj.VoucherType;!this._trnMainService.showPerformaApproveReject&&58!=this._trnMainService.TrnMainObj.VoucherType&&!(n in S.$V)&&7!=n&&5!=n&&10!==this._trnMainService.TrnMainObj.VoucherType&&(this.onViewClicked(),this._trnMainService.buttonMode="EDIT",this.masterService.headerMode="(EDIT)")}else"F8"==i.code?(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||57==this._trnMainService.TrnMainObj.VoucherType||83==this._trnMainService.TrnMainObj.VoucherType||21==this._trnMainService.TrnMainObj.VoucherType||3==this._trnMainService.TrnMainObj.VoucherType||16==this._trnMainService.TrnMainObj.VoucherType||15==this._trnMainService.TrnMainObj.VoucherType||61==this._trnMainService.TrnMainObj.VoucherType||5==this._trnMainService.TrnMainObj.VoucherType)&&this.onPrintClicked()):"F2"==i.code?(i.preventDefault(),(3==this._trnMainService.TrnMainObj.VoucherType||8===this._trnMainService.TrnMainObj.VoucherType||19==this._trnMainService.TrnMainObj.VoucherType||5===this._trnMainService.TrnMainObj.VoucherType||16===this._trnMainService.TrnMainObj.VoucherType||20===this._trnMainService.TrnMainObj.VoucherType||89===this._trnMainService.TrnMainObj.VoucherType||88===this._trnMainService.TrnMainObj.VoucherType||15===this._trnMainService.TrnMainObj.VoucherType||14===this._trnMainService.TrnMainObj.VoucherType)&&this.onImportPurchaseInvoice()):"F11"==i.code&&(i.preventDefault(),(14==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==this._trnMainService.TrnMainObj.Mode&&1==this.userSetting.GblEnableMixedTenderMode&&this.showBillTender())}showItemSearchPopup(){this.itemSearchPopup.show()}cancelprint(){this.promptPrintDevice=!1,this.showPosPrinterPreview=!1}onSchemeClick(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(s=>null!=s.MCODE&&""!=s.MCODE);let i=[];if(this._trnMainService.TrnMainObj.ProdList.length>0){for(var n of this._trnMainService.TrnMainObj.ProdList)i.push({mcode:n.MCODE,qty:n.Quantity,retailer:this._trnMainService.TrnMainObj.PARAC,rate:n.RATE});this.masterService.masterPostmethod("/dmsScheme/searchscheme",{data:i}).subscribe(s=>{if("ok"==s.status)if(null==s.result)this.alertService.info("No Scheme Found ...");else{for(let _ of s.result)_.ischecked=!0;this._trnMainService.availableSchemes=s.result,(null!=this._trnMainService.availableSchemes||this._trnMainService.availableSchemes?.length>0)&&(this.schemeFilterList=this._trnMainService.availableSchemes.filter((_,f,Q)=>Q.findIndex(ee=>ee.schemeno===_.schemeno)===f)),this.showschemePopup=!0}else this.alertService.info("Error on getting scheme.Error Details:"+s.result)})}else this.alertService.warning("No Valid product entered for scheme"),this._trnMainService.initialFormLoad(this._trnMainService.TrnMainObj.VoucherType)}OkSchemeCommand(){if(null==this._trnMainService.availableSchemes||this._trnMainService.availableSchemes)return;this.showschemePopup=!1;let i=[];for(var n in this.schemeFilterList.filter(_=>_.ischecked)){this._trnMainService.availableSchemes[n].SchemeAmount=this._trnMainService.availableSchemes[n].discountamount;for(let _ in this._trnMainService.TrnMainObj.ProdList)if(this._trnMainService.TrnMainObj.ProdList[_].MCODE==this._trnMainService.availableSchemes[n].mcode){var s=this._trnMainService.availableSchemes.filter(f=>f.schemeno==this._trnMainService.availableSchemes[n].schemeno).length;if(s<1)return;this._trnMainService.TrnMainObj.ProdList[_].BaseSecondaryDiscount=this._trnMainService.availableSchemes[n].discountamount/s,i.push(this._trnMainService.availableSchemes[n])}}this._trnMainService.TrnMainObj.DmsSchemesApplied=i,this._trnMainService.ReCalculateBillWithNormal()}CancelSchemeCommand(){this.showschemePopup=!1}markAsReadNotifications(){this.notificationService.markAsReadAfterSave().subscribe(i=>{"ok"==i.status&&(this._trnMainService.fromNotification=!1)})}newSalesman(){confirm("Are you sure to choose new salesman?")&&this.onClickSalesMan.emit()}onCustomerSelected(i){this._trnMainService.customerDoubleClick=!0,this._trnMainService.billunitevent=!0,this._trnMainService.TrnMainObj.BILLTO=i.ACNAME,this._trnMainService.TrnMainObj.TRNAC=i.ACID,this._trnMainService.TrnMainObj.PARAC=i.ACID,this._trnMainService.TrnMainObj.TRNMODE=null==i.PMODE||""==i.PMODE?"credit":i.PMODE,this.masterService.focusAnyControl("unit")}createCustomer(){this.router.navigate(["./pages/masters/PartyLedger/CustomerList"])}onCancelClick(){if(this._trnMainService.TrnMainObj.VoucherType=S.Km.TaxInvoiceCancel,this._trnMainService.TrnMainObj.VoucherPrefix="SC",this._trnMainService.TrnMainObj.VoucherAbbName="SC",this._trnMainService.TrnMainObj.guid=u(),this.viewClicked)this.alertService.info("cannot save in View Mode.");else{if(this._trnMainService.TrnMainObj.ProdList.filter(n=>{}).length>0)return void this.alertService.info("Product list is empty");this.onSaveClicked()}}onLoadClick(){this._trnMainService.TrnMainObj.Mode="NEW",this.genericGridForTaxCancel.show(),this.viewClicked=!1}onViewTaxCancel(){this.TrnMainObj.VoucherPrefix="SC",this.gridPopupSettings=this.masterService.getGenericGridPopUpSettings(this.TrnMainObj.VoucherPrefix)}onClickReverseSave(){this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE="REVERSE",this.onSaveTransactionClicked()}saveSalesReturnDamageValueToTMP(){this.spinnerService.show("Data is Saving..."),this.masterService.saveDamageSalesReturnToTMP(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))})}saveTransactionApproval(){this.spinnerService.show("Data is Saving..."),this.masterService.saveApprovalTmptoActual(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}saveApproveStockTransfer(){this.spinnerService.show("Data is Saving..."),this.masterService.SaveApprovedStockTransfer(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(i=>{"ok"==i.status?(this._trnMainService.pageHeading="Stock Transfer Approval",this.spinnerService.hide(),this.onReset(),this.alertService.info(i.result)):(this.spinnerService.hide(),this.alertService.info("Error",i.result))},i=>{this.spinnerService.hide()})}onDeleteClick(){confirm("Permanently delete this Voucher. Do you want to continue?")&&(this.editClicked=!1,this.viewClicked=!1,this.onclickDeleteYes())}onclickDeleteYes(){this._trnMainService.TrnMainObj.Mode="New",this._trnMainService.TrnMainObj.VoucherType=73,this._trnMainService.TrnMainObj.VoucherPrefix="CP",this._trnMainService.TrnMainObj.REFBILL=this._trnMainService.TrnMainObj.VCHRNO;const i=A(67816);this._trnMainService.TrnMainObj.guid=i(),this.masterService.saveTransaction(this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj).subscribe(s=>{"ok"==s.status&&(this.alertService.success("Deleted Succesfully"),this._trnMainService.initialFormLoad(this.TrnMainObj.VoucherType),this._trnMainService.TrnMainObj.VoucherType=57,this._trnMainService.TrnMainObj.VoucherPrefix="PP")},s=>{})}onDeleteTransactionClick(){this.checkUserRights("delete")&&1==this.userSetting.EnableAmdinSB&&this.deleteTransaction()}deleteTransaction(){if(this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(i=>{if("EXISTED"!=i.result){this.spinnerService.show("Please Wait..");let n={};n.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,n.DIVISION=this._trnMainService.TrnMainObj.DIVISION,n.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:n,mode:this._trnMainService.buttonMode}).subscribe(_=>{"ok"==_.status?(this.spinnerService.hide(),this.alertService.info(_.result),this.onReset()):(this.alertService.info(_.result),this.spinnerService.hide())},_=>{this.spinnerService.hide()})}else this.alertService.info("Transaction exist under selected voucher no")});else{this.spinnerService.show("Please Wait..");let i={};i.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,i.DIVISION=this._trnMainService.TrnMainObj.DIVISION,i.PHISCALID=this._trnMainService.TrnMainObj.PhiscalID,this.masterService.deleteTransaction({data:i,mode:this._trnMainService.buttonMode}).subscribe(s=>{"ok"==s.status?(this.spinnerService.hide(),this.alertService.info(s.result),this.onReset()):(this.alertService.info(s.result),this.spinnerService.hide())},s=>{this.spinnerService.hide()})}}onProformaEditClick(){this.masterService.headerMode="(EDIT)",this._trnMainService.TrnMainObj.Mode="EDIT",this.editClicked=!0,this.viewClicked=!1,this.genericGrid.show()}assigngMode(){this.TrnMainObj.VoucherType==S.Km.PerformaSalesInvoice&&("(VIEW)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="VIEW"),"(EDIT)"==this.masterService.headerMode&&(this._trnMainService.TrnMainObj.Mode="EDIT"))}pdfDesingerPrintFormat(i,n,s,_,f){(null==f||null==f)&&(f="FULL");let Q=i.substring(0,2);"purchase-import"==this.activeurlpath&&(Q="IMPORTPURCHASE"),"export-sales-invoice"==this.activeurlpath&&(Q="EXPORTSI"),"asset-purchase-invoice"==this.activeurlpath&&(Q="ASSETPURCHASE"),"assets-openingstockentry"==this.activeurlpath&&(Q="ASSETOPENING");let ee=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,ne=ee?.split("");this.masterService.getPrintFileName(Q,this.userProfile.CompanyInfo.COMPANYID,f).subscribe(he=>{if("ok"==he.status){this.filename=he.result?he.result[0].FileName:"",this.rownumber=he.result?he.result[0].RowsNumber:0;let se=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL;this.masterService.getNumberToWords(i,se,n,this.userProfile.CompanyInfo.COMPANYID).subscribe(Ne=>{if("ok"==Ne.status){this.numtowords=Ne.result?Ne.result[0].NUMTOWORDS:"";let Pe=this.userProfile.CompanyInfo.ADDRESS,ye=this.userProfile.CompanyInfo.NAME,xe=this.userProfile.CompanyInfo.TELA,ae=this.userProfile.CompanyInfo.TELB,ce=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(se).subscribe(ue=>{if("ok"==ue.status){ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].COMADD&&(Pe=ue.result[0].COMADD),(null==Pe||""===Pe)&&(Pe=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].COMNAME&&(ye=ue.result[0].COMNAME),(null==ye||""===ye)&&(ye=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].TELA&&(xe=ue.result[0].TELA),(null==xe||""===xe)&&(xe=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].TELB&&(ae=ue.result[0].TELB),(null==ae||""===ae)&&(ae=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),ue.result&&ue.result.length>0&&ue.result[0]&&ue.result[0].EMAIL&&(ce=ue.result[0].EMAIL),(null==ce||""===ce)&&(ce=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let st,le={};le.filename=this.filename,le.rownumber=this.rownumber,le.VCHRNO=i,le.NAME=ye||this.userProfile.CompanyInfo.NAME,le.ADDRESS=Pe||" ",le.INITIAL=se||this.userProfile.CompanyInfo.INITIAL,le.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,le.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,le.phone1=xe||" ",le.phone2=ae||" ",le.EMAIL=ce||" ",le.numtowords=this.numtowords?this.numtowords:" ",le.panno1=ne[0]?ne[0]:" ",le.panno2=ne[1]?ne[1]:" ",le.panno3=ne[2]?ne[2]:" ",le.panno4=ne[3]?ne[3]:" ",le.panno5=ne[4]?ne[4]:" ",le.panno6=ne[5]?ne[5]:" ",le.panno7=ne[6]?ne[6]:" ",le.panno8=ne[7]?ne[7]:" ",le.panno9=ne[8]?ne[8]:" ",le.title=s||" ",le.caption=_||" ",le.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,le.PRINTBY=this.userProfile.username?this.userProfile.username:" ",le.COMPANYVAT=ee||this.userProfile.CompanyInfo.VAT,this.masterService.getAllInvoiceData(le).subscribe(De=>{st=new Blob([De],{type:"application/pdf"});const sr=URL.createObjectURL(st),Wi=document.createElement("iframe");Wi.style.display="none",Wi.src=sr,document.body.appendChild(Wi),Wi.contentWindow.print()},De=>{console.log("error",De,JSON.parse(this.blobToString(De.error)));let sr=JSON.parse(this.blobToString(De.error));this.alertService.error(sr.result)}),2==this.userSetting.SendInvoiceEmail&&(this._trnMainService.TrnMainObj.VoucherType===S.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===S.Km.Sales)&&"NEW"==this.modeForPrint&&(le.title="Invoice",le.caption="Copy of Original (1)",this.masterService.TaxinvoiceEmail(le,this._trnMainService.CUSEMAIL).subscribe(De=>{console.log("result after print",De)}))}})}})}})}blobToString(i){const n=URL.createObjectURL(i);let s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(),URL.revokeObjectURL(n),s.responseText}cancel(){try{this.router.navigate([this.returnUrl])}catch(i){console.log(i),this.alertService.info(i)}}onImportDetailsClick(){this.ImportPurchaseDetail.show(),this.masterService.allowAddNextRow=!0}onExportClick(){this.spinnerService.show("Downloading file, Please wait..."),this.masterService.getExcelFileForBA().subscribe(s=>{this.spinnerService.hide();let _=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});H.saveAs(_,"Negative Stock Report.xlsx")},s=>{this.spinnerService.hide()})}clearQtyRate(){this._trnMainService.purchaseOrderQty=null,this._trnMainService.purchaseOrderRate=null,this._trnMainService.produstWiseOrderUnit=null}pdfDesingerPrintFormatForTransferIn(i,n,s,_,f){(null==f||null==f)&&(f="FULL");let ee=(1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT).split("");this.masterService.getPrintFileName(this._trnMainService.TrnMainObj.VoucherPrefix,this.userProfile.CompanyInfo.COMPANYID,f).subscribe(ne=>{if("ok"==ne.status){this.filename=ne.result?ne.result[0].FileName:"",this.rownumber=ne.result?ne.result[0].RowsNumber:0,this.numtowords="";let he=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,se=this.userProfile.CompanyInfo.ADDRESS,Ne=this.userProfile.CompanyInfo.NAME,Pe=this.userProfile.CompanyInfo.TELA,ye=this.userProfile.CompanyInfo.TELB,xe=this.userProfile.CompanyInfo.EMAIL;this.masterService.getDetailsByUserDivision(he).subscribe(ae=>{if("ok"==ae.status){ae.result&&ae.result.length>0&&ae.result[0]&&ae.result[0].COMADD&&(se=ae.result[0].COMADD),(null==se||""===se)&&(se=this.userProfile.CompanyInfo.ADDRESS?this.userProfile.CompanyInfo.ADDRESS:" "),ae.result&&ae.result.length>0&&ae.result[0]&&ae.result[0].COMNAME&&(Ne=ae.result[0].COMNAME),(null==Ne||""===Ne)&&(Ne=this.userProfile.CompanyInfo.NAME?this.userProfile.CompanyInfo.NAME:" "),ae.result&&ae.result.length>0&&ae.result[0]&&ae.result[0].TELA&&(Pe=ae.result[0].TELA),(null==Pe||""===Pe)&&(Pe=this.userProfile.CompanyInfo.TELA?this.userProfile.CompanyInfo.TELA:" "),ae.result&&ae.result.length>0&&ae.result[0]&&ae.result[0].TELB&&(ye=ae.result[0].TELB),(null==ye||""===ye)&&(ye=this.userProfile.CompanyInfo.TELB?this.userProfile.CompanyInfo.TELB:" "),ae.result&&ae.result.length>0&&ae.result[0]&&ae.result[0].EMAIL&&(xe=ae.result[0].EMAIL),(null==xe||""===xe)&&(xe=this.userProfile.CompanyInfo.EMAIL?this.userProfile.CompanyInfo.EMAIL:" ");let ue,ce={};ce.filename=this.filename,ce.rownumber=this.rownumber,ce.VCHRNO=i,ce.NAME=Ne||this.userProfile.CompanyInfo.NAME,ce.ADDRESS=se||" ",ce.INITIAL=he||this.userProfile.CompanyInfo.INITIAL,ce.PhiscalID=n||this.userProfile.CompanyInfo.PhiscalID,ce.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,ce.phone1=Pe||" ",ce.phone2=ye||" ",ce.EMAIL=xe||" ",ce.numtowords=this.numtowords?this.numtowords:" ",ce.panno1=ee[0]?ee[0]:" ",ce.panno2=ee[1]?ee[1]:" ",ce.panno3=ee[2]?ee[2]:" ",ce.panno4=ee[3]?ee[3]:" ",ce.panno5=ee[4]?ee[4]:" ",ce.panno6=ee[5]?ee[5]:" ",ce.panno7=ee[6]?ee[6]:" ",ce.panno8=ee[7]?ee[7]:" ",ce.panno9=ee[8]?ee[8]:" ",ce.title=s||" ",ce.caption=_||" ",ce.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,ce.PRINTBY=this.userProfile.username?this.userProfile.username:" ",this.masterService.getAllInvoiceData(ce).subscribe(le=>{ue=new Blob([le],{type:"application/pdf"});const st=URL.createObjectURL(ue),De=document.createElement("iframe");De.style.display="none",De.src=st,document.body.appendChild(De),De.contentWindow.print()},le=>{let st=JSON.parse(this.blobToString(le.error));this.alertService.error(st.result)})}})}})}onReverseEntry(){let i=this.masterService.userProfile.userRights.find(n=>"AllowReverseEntry"==n.right);0!=i?.value?1==i?.value&&(this._trnMainService.reverseEntry(this.TrnMainObj.VoucherType),(0,$.s)(()=>"asset-purchase-invoice"===this.activeurlpath||"assets-openingstockentry"===this.activeurlpath,this.masterService.checkAssetDepreciation(this._trnMainService.TrnMainObj.VCHRNO),(0,ge.of)("notAssets")).pipe((0,te.K)(()=>{throw"checkAssetDepreciation"}),(0,Ce.w)(n=>this.masterService.checkDuplicateReverseEntry(this._trnMainService.TrnMainObj.VCHRNO).pipe((0,te.K)(s=>(0,ge.of)(s))))).subscribe(n=>{"ok"==n.status?this.showReverseEntryAuth=!0:this.alertService.info(n.result.error)},n=>{this.alertService.info("checkAssetDepreciation"===n?"Depreciation cancellation is required for reverse entry command.":n)})):this.alertService.info("No rights for Reverse Entry!!!")}openReverseEntry(){this.reverseEntryConfirm.show(this._trnMainService.TrnMainObj.VCHRNO)}closeReverseEntryAuthPopup(){this.showReverseEntryAuth=!1}reverseEntryAuthConfirm(){this.spinnerService.show("Authorizing Please wait..."),this.masterService.reverseEntryAutorisation(this.reverseEntryAuthObj).subscribe(i=>{this.spinnerService.hide(),"ok"==i.status&&(this.alertService.success("Authorization Sucessfull"),this.closeReverseEntryAuthPopup(),this.openReverseEntry())}),this.spinnerService.hide()}forRequisition(){this.addForRequisition=!0,this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this._trnMainService.TrnMainObj.DOFULLRETURN=1}forStockAdjustment(){this.StockAdjustment.show()}carreiedOnPreviousFiscalYearOpening(i){this.spinnerService.show("Opening stock is saving please wait.."),this.masterService.saveFiscalYear(i,0).subscribe(n=>{"ok"==n.status?(console.log("RESULT",n),this.alertService.success("Year Data Saved Successfully"),this.authService.showfiscalPopup=!1,this.spinnerService.hide()):(this.spinnerService.hide(),console.log("data",n),this.alertService.info("Error in Saving Data:"+n.result.error))},n=>{this.alertService.info(n)})}closeReqModal(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}fromTransferOut(){let i="";i=this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder?this._trnMainService.TrnMainObj.AdditionalObj.REFORDID:this._trnMainService.TrnMainObj.BILLTO;let n=`/getTransferOutPagedList/${i}/${this._trnMainService.TrnMainObj.VoucherPrefix}`;this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue&&(n=`/getRequisitionListForStockIssue/${i}`),this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&(n=`/getTransferOutForRequisionPagedList/${i}`),this.genericGridTransferOutSetting={title:"Requisition List",apiEndpoints:n,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Requisition From",hidden:5==this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1},{key:"BILLTO",title:"From Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1},{key:"BILLTOADD",title:"To Warehouse",hidden:5!=this._trnMainService.TrnMainObj.VoucherType,noSearch:!1}]},this.genericGridTransferOut.show(),this._trnMainService.fromRequistionToTransferOut=!1}dblClickLoadTransferOutData(i){this._trnMainService.fromRequistionToTransferOut=!0,(this._trnMainService.TrnMainObj.VoucherType===S.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===S.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===S.Km.PurchaseOrder)&&(this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,1===this._trnMainService.TrnMainObj.DOFULLRETURN?(this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&this.loadFullRequesitoninTo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.PurchaseOrder&&this.loadFullRequesitoninPo(i),this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadFullRequisitioninIS(i),this.closeReqModal()):(this._trnMainService.TrnMainObj.VoucherType==S.Km.StockIssue&&this.loadPartialRequisitioninIS(i),this.closeReqModal())),this.loadPartialRequisitionVoucher(i)}loadPartialRequisitionVoucher(i){0===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.TrnMainObj.VoucherType==S.Km.BranchTransferOut&&(this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.addRow(),this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.BILLTOADD=i.BILLTO)}loadFullRequesitoninTo(i){this._trnMainService.loadFullRequesitoninTo(i,!1)}loadFullRequesitoninPo(i){let n=this._trnMainService.TrnMainObj.MWAREHOUSE;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForPurchaseOrder(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMTO").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const _=A(67816);this._trnMainService.TrnMainObj=s.result,this._trnMainService.TrnMainObj.guid=_(),this._trnMainService.TrnMainObj.VoucherType=19,this._trnMainService.TrnMainObj.VoucherPrefix="PO",this._trnMainService.TrnMainObj.VoucherAbbName="PO",this._trnMainService.TrnMainObj.COMPANYID=this.masterService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.DIVISION=this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.masterService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const f of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(f.ALTCONFACTOR)&&(f.ALTCONFACTOR=1),f.BASEUNIT===f.ALTUNIT&&(f.RATE=f.ALTRATE);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD="",this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=n}},s=>{this.loadingService.hide(),this.alertService.info(s._body)})}loadFullRequisitioninIS(i){let n=this._trnMainService.TrnMainObj.MWAREHOUSE;this.loadingService.show("Please wait while loading requisition details"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMTO").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const _=A(67816);this._trnMainService.TrnMainObj=s.result;let f=this._trnMainService.TrnMainObj.BILLTOADD,Q=this._trnMainService.TrnMainObj.BILLTO;this._trnMainService.TrnMainObj.guid=_(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=i.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMREQUESITION",this._trnMainService.TrnMainObj.PhiscalID=this.userProfile.PhiscalYearInfo.PhiscalID,this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.userProfile.userWarehouse,this._trnMainService.TrnMainObj.STOCKMESSAGE&&this.alertService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE);for(const ee of this._trnMainService.TrnMainObj.ProdList)0==this._trnMainService.nullToZeroConverter(ee.ALTCONFACTOR)&&(ee.ALTCONFACTOR=1),ee.BASEUNIT===ee.ALTUNIT&&(ee.RATE=ee.ALTRATE);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=i.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=i.DIVISION,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTOADD=Q,this._trnMainService.TrnMainObj.BILLTO=f,this._trnMainService.TrnMainObj.MWAREHOUSE=n}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}loadPartialRequisitioninIS(i){let n=this._trnMainService.TrnMainObj.MWAREHOUSE;this.loadingService.show("Loading requisition details. Please wait!"),this.masterService.LoadRequisitionForStockIssue(i.VCHRNO,i.DIVISION,i.PhiscalID,n,"FROMTO").subscribe(s=>{if("ok"==s.status){this.loadingService.hide();const _=A(67816);let f=s.result.BILLTOADD,Q=s.result.BILLTO;this._trnMainService.TrnMainObj.guid=_(),this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.BILLTOADD=f,this._trnMainService.TrnMainObj.BILLTO=Q,this._trnMainService.TrnMainObj.MWAREHOUSE=n}},s=>{this.loadingService.hide(),this.alertService.info(s.error)})}saveRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this.addForRequisition=!1}resetRequisition(){this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID="",this._trnMainService.TrnMainObj.REFORDBILL="",this.addForRequisition=!1}getPopUpSettingForApproval(){return{title:"Vouchers",apiEndpoints:`/getApprovedPagedListForView/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:1,columns:[{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"CHALANNO",title:"VOUCHER NO.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"AMOUNT",hidden:!1,noSearch:!1},{key:"REMARKS",title:"REMARKS",hidden:!1,noSearch:!1}]}}onChangePurchasePrice(i,n){let s=0,_=0,f=0,Q=this._trnMainService.priceChangeList[i];if(null!=Q)if(Q.UNIT==this._trnMainService.TrnMainObj.ProdList[this.activeindex].BASEUNIT)if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activeindex].ISVAT){let ee=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE)*this.userSetting.VATRate;Q.NRATE_A<ee&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)&&(f=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE)+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE)*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100),Q.NRATE_A<f+f*this._trnMainService.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()))}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)?(f=this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100),Q.NRATE_A<f&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())):Q.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE ",this.rateValidation.show());else s=this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)&&(s=this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE+this._trnMainService.TrnMainObj.ProdList[this.activeindex].RATE*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100)),Q.NRATE_A<s&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show());else if(0==this.userSetting.VatExcludingRate)if(1==this._trnMainService.TrnMainObj.ProdList[this.activeindex].ISVAT){let ee=this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTRATE;if(_=ee+ee*this.userSetting.VATRate,Q.NRATE_A<_&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT",this.rateValidation.show()),0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)){let ne=ee+ee*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100);Q.NRATE_A<ne+ne*this.userSetting.VATRate&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show())}}else 0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)?Q.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTRATE+this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTRATE*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):Q.NRATE_A<this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTRATE&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW COST PRICE.PROCEED OR NOT ",this.rateValidation.show());else s=this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTRATE/this._trnMainService.TrnMainObj.ProdList[this.activeindex].ALTCONFACTOR,0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE)?Q.NRATE_A<s+s*(this._trnMainService.TrnMainObj.ProdList[this.activeindex].RECRATE/100)&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT ",this.rateValidation.show()):Q.NRATE_A<s&&(this.rateValidationDisplayMessage="NEW SELLING PRICE IS BELOW RECOMMENDED MARGIN. PROCEED OR NOT1 ",this.rateValidation.show());this.changeSellingPrice(i),this._trnMainService.TrnMainObj.ProdList[this.activeindex].SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activeindex].ISVAT?this._trnMainService.priceChangeList[i].NRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[i].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activeindex].W_SELLRATEBEFORETAX=1===this._trnMainService.TrnMainObj.ProdList[this.activeindex].ISVAT?this._trnMainService.priceChangeList[i].WNRATE_A/this.userSetting.VatConRate:this._trnMainService.priceChangeList[i].WNRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activeindex].MRP=this._trnMainService.priceChangeList[i].NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activeindex].W_MRP=this._trnMainService.priceChangeList[i].WNRATE_A,this.masterService.is_PurchaseOrder&&(this._trnMainService.TrnMainObj.PODetailList[i].SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].NRATE_A,this._trnMainService.TrnMainObj.PODetailList[i].W_SELLRATEBEFORETAX=this._trnMainService.priceChangeList[i].WNRATE_A)}changeSellingPrice(i){for(const n of this._trnMainService.priceChangeList)n.SNO>1&&(n.NRATE_A=n.CONFACTOR*this._trnMainService.priceChangeList[i].NRATE_A,n.WNRATE_A=n.CONFACTOR*this._trnMainService.priceChangeList[i].WNRATE_A)}onApplyOldPriceClick(){let i={};1==this.userSetting.EnableBatchWisePrice&&(console.log(this._trnMainService.priceChangeList),i=this._trnMainService.priceChangeList.filter(n=>0==this._trnMainService.nullToZeroConverter(n.CRATE_A))[0],i)?this.alertService.warning(`selling price for this item with UOM: ${i.UNIT} cannot be 0, Please enter valid selling rate`):(this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0,this.showPriceChangeDetail=!1)}onApplyClickNewPrice(){for(let i of this._trnMainService.priceChangeList)this.masterService.is_PurchaseOrder||(this._trnMainService.TrnMainObj.ProdList[this.activeindex].Product.AltSellingPrices.find(n=>n.UNIT==i.UNIT).NRATE_A=i.NRATE_A,this._trnMainService.TrnMainObj.ProdList[this.activeindex].HasSellingPriceChange=!0);this.showPriceChangeDetail=!1}onCloseClick(){this.showPriceChangeDetail=!1}onClickYes(){this.rateValidation.hide()}onClickNo(){this.rateValidation.hide()}onLoadFromReverseEntry(){this.onLoadFromReverseEntryEmit.emit(!0)}viewRecurringDetails(){this.recurringLogMode="view",this.recurringItemsForEdit=[],this.commissionItemsForEdit=[],this._trnMainService.TrnMainObj.RecurringItemList.length>0&&(this.recurringItemsForEdit=this._trnMainService.TrnMainObj.RecurringItemList),this._trnMainService.TrnMainObj.CommissionItemList.length>0&&(this.commissionItemsForEdit=this._trnMainService.TrnMainObj.CommissionItemList),(this.recurringItemsForEdit.length>0||this.commissionItemsForEdit.length>0)&&this.RecurringLog.show("view")}carryForwardPreviousFiscalYearVoucher(){confirm("Previous Fiscal Year Opening Stock is already carried on, Do you want Re-Carried on Opening Stock?")&&(console.log("popup ya lyaune"),this.PrevYearOpening.show())}paymentClick(){this.doAutoRoundingInSales(),this.PaymentPopup.show(),this.PaymentPopup.DUEAMOUNT=this._trnMainService.TrnMainObj.NETAMNT?this._trnMainService.TrnMainObj.NETAMNT:0}onSavePayment(i){if(i?.length){if(i?.length>1){this._trnMainService.TrnMainObj.TRNMODE="mixed";let n=i.filter(f=>"Credit"==f.TRNMODE)[0],s=i.filter(f=>"Cash"==f.TRNMODE)[0],_=i.filter(f=>"Credit Card"==f.TRNMODE)[0];n?(this._trnMainService.TrnMainObj.TRNAC=n.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=n.REMARKS,this._trnMainService.TrnMainObj.PARAC=n.ACCOUNT,this._trnMainService.TrnMainObj.BILLTO=n.REMARKS,this.masterService.getCustomerIDFromCProfile(i[0].ACCOUNT).subscribe(f=>{f.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=f[0].CUSTID)})):s?(this._trnMainService.TrnMainObj.TRNAC=s.ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=s.REMARKS):_&&(this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS)}else 1==i.length&&("Cash"==i[0].TRNMODE?(this._trnMainService.TrnMainObj.TRNMODE="cash",14==this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.VoucherType?(this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS):(this._trnMainService.TrnMainObj.TRNAC=this.masterService.userSetting.CASHINHAND_AC?this.masterService.userSetting.CASHINHAND_AC:null,this._trnMainService.TrnMainObj.TRNACName="CASH IN HAND A/C")):"Credit Card"==i[0].TRNMODE?(this._trnMainService.TrnMainObj.TRNMODE="creditcard",this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS):"Cash on Delivery"==i[0].TRNMODE?(this._trnMainService.TrnMainObj.TRNMODE="Cash on Delivery",this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS):"FonePay"==i[0].TRNMODE?(this._trnMainService.TrnMainObj.TRNMODE="FonePay",this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS):"Credit"==i[0].TRNMODE?(this._trnMainService.TrnMainObj.TRNMODE="credit",this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.TRNACName=i[0].REMARKS,this._trnMainService.TrnMainObj.PARAC=i[0].ACCOUNT,this._trnMainService.TrnMainObj.BILLTO=i[0].REMARKS,this.masterService.getCustomerIDFromCProfile(i[0].ACCOUNT).subscribe(n=>{n.length>0&&(this._trnMainService.TrnMainObj.RECEIVEBY=n[0].CUSTID)})):"Sales Return Voucher"==i[0].TRNMODE&&(this._trnMainService.TrnMainObj.TRNMODE="salesreturn",this._trnMainService.TrnMainObj.TRNAC=i[0].ACCOUNT));this._trnMainService.TrnMainObj.TenderList=i,this.onSaveTransactionClicked()}}onSaveTermsnConditions(i){this._trnMainService.TrnMainObj.AdditionalObj.TermsAndConditionID=i}onSaveRecurringLog(i){this._trnMainService.TrnMainObj.RecurringItemList=i.recurringItemList,this._trnMainService.TrnMainObj.CommissionItemList=i.commissionItemList,this.transactionValidator()&&this.onSubmit()}forceCloseClick(){let i;i=this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.VCHRNO,this.masterService.masterPostmethod("/checkExistingRefVoucher",{VCHRNO:this._trnMainService.TrnMainObj.VCHRNO}).subscribe(n=>{"EXISTED"!=n.result?this.masterService.masterPostmethod("/checkForceClosedVoucher",{VCHRNO:i}).subscribe(s=>{"FORCECLOSED"!=s.result?this.showForceClose=!0:this.alertService.info("This Voucher is already closed")}):this.alertService.info(`Transaction already exist under selected voucher: ${this._trnMainService.TrnMainObj.VCHRNO} . Cannot Force Close !`)})}forceCloseSubmit(){if(""!==this.forceCloseObj.REMARKS&&null!=this.forceCloseObj.REMARKS){if(this._trnMainService.TrnMainObj.VoucherType!==S.Km.RequisitionApproval){if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.VCHRNO)return void this.alertService.warning("Invoice no. for force close confirmation should match with loaded voucher no.")}else if(this.forceCloseObj.VCHRNO!==this._trnMainService.TrnMainObj.REFORDBILL)return void this.alertService.warning("Invoice no. for rejection confirmation should match with loaded requistion no.");this.loadingService.show(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Rejecting the Requisition No."+this.forceCloseObj.VCHRNO:"Force Closing Purchase Order No."+this.forceCloseObj.VCHRNO),this.masterService.masterPostmethod("/saveForceClosedVoucher",this.forceCloseObj).subscribe(i=>{"ok"==i.status?(this.loadingService.hide(),this.showForceClose=!1,this.forceCloseObj={},this.onReset(),this.alertService.success(this._trnMainService.TrnMainObj.VoucherType===S.Km.RequisitionApproval?"Requisition rejected sucessfully.":i.result)):(this.loadingService.hide(),this.alertService.info(i.result))},i=>{this.loadingService.hide(),this.alertService.info(i)})}else this.alertService.warning("Please enter remarks !")}closeForceClose(){this.showForceClose=!1}showBillTender(){this.showTenderList=!0}showInfoPopup(){"VIEW"!=this._trnMainService.TrnMainObj.Mode&&this.itemInfo.show()}closeTenderList(){this.showTenderList=!1}checkSalesRateBeforeCrate(){return this.filterList=[],this._trnMainService.TrnMainObj.ProdList.forEach(i=>{this._trnMainService.TrnMainObj.VoucherType==S.Km.SalesOrder&&(1==i.ISVAT?(1==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE<i.PRATE||0==this.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER&&i.ALTRATE/this.userSetting.VatConRate<i.PRATE)&&this.filterList.push(i):i.ALTRATE<i.PRATE&&this.filterList.push(i)),this._trnMainService.TrnMainObj.VoucherType==S.Km.TaxInvoice&&i.RATE<i.PRATE&&this.filterList.push(i)}),!(this.filterList?.length>0&&(confirm("The sales rate for items are less than its cost rate. Ask for authorization?")&&this.authenticationPopup.show(this.filterList,"prateCheck"),1))}checkSODiscountLimit(){let i=this.masterService.userProfile.userRights.find(s=>"SODiscountLimit"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm("The discount applied to items exceed the discount limit. Ask for authorization?")&&this.authenticationPopup.show(n,"discountCheck"),1))}checkGblDiscountLimit(){let i=this.masterService.userProfile.roleRights.find(s=>"DISLIMIT"==s.right);this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)});let n=this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i?.value);return!(n&&n.length>0&&(confirm(`The discount applied to items exceed the discount limit: ${i?.value}%. Ask for authorization?`)&&this.authenticationPopup.show(n,"GblDiscountCheck"),1))}checkExpItem(){let i=[];return i=this._trnMainService.TrnMainObj.ProdList.filter(n=>new Date(n.EXPDATE)<new Date((new Date).setDate((new Date).getDate()-1))&&null!=n.MCODE&&1==n.REQEXPDATE),!(i&&i.length>0&&(confirm("Expiry Items detected. Do you want continue with transaction ?")&&this.authenticationPopup.show(i,"showExpItemList"),1))}onUserRightReceived(i){if("ALLOW"==i){if(!this.checkSODiscountLimit()||!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to do sales below Cost rate of respective items");this.authenticationPopup.closeDialog()}onCreditLimitReceived(i){if("ALLOW"==i){if(this._trnMainService.TrnMainObj.isAuthorized=!0,!this.transactionValidator())return;this.onSubmit()}else this.alertService.warning("The user has no rights to save Bill exceeding the credit limit of the selected Credit Account");this.authenticationPopup.closeDialog()}allowExpiredItemforSave(i){if(console.log("save garda ya aaucha ta",i),"ALLOWSAVE"==i){if(!this.transactionValidator())return;this.onSubmit()}this.authenticationPopup.closeDialog()}onDiscountLimitReceived(i){if(this._trnMainService.TrnMainObj.ProdList.forEach(s=>{s.discountratecheck=this._trnMainService.nullToZeroConverter(100*s.INDDISCOUNT/s.AMOUNT)}),this._trnMainService.TrnMainObj.ProdList.filter(s=>s.discountratecheck>i).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+i+"%)");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}onRoleRightsReceived(i){let s=JSON.parse(i).find(f=>"DISLIMIT"==f.right);if(this._trnMainService.TrnMainObj.ProdList.filter(f=>f.INDDISCOUNTRATE>s.value).length>0)this.alertService.warning("The items exceeded this user's discount limit as well. ("+s.value+")");else{if(!this.transactionValidator())return;this.onSubmit(),this.authenticationPopup.closeDialog()}}stockAdjustmentLoaded(i){this._trnMainService.TrnMainObj.TRNDATE=i.Date;var n=A(10484),s=i.Date.replace("-","/").replace("-","/"),_=n.ad2bs(s);this._trnMainService.TrnMainObj.BSDATE=("1"==_.en.day||"2"==_.en.day||"3"==_.en.day||"4"==_.en.day||"5"==_.en.day||"6"==_.en.day||"7"==_.en.day||"8"==_.en.day||"9"==_.en.day?"0"+_.en.day:_.en.day)+"/"+("1"==_.en.month||"2"==_.en.month||"3"==_.en.month||"4"==_.en.month||"5"==_.en.month||"6"==_.en.month||"7"==_.en.month||"8"==_.en.month||"9"==_.en.month?"0"+_.en.month:_.en.month)+"/"+_.en.year}OnBatchAdjustmentClick(){this._trnMainService.BatchAdjustment().subscribe(i=>{"ok"==i.status?this.AutoAdjustment.showDialog(i.result):this.alertService.warning("Negatice Stock list not found")})}checkForUserRigths(i){if(i)return this.masterService.userProfile.userRights.find(n=>n.right==i)}checkCreditLimitRights(){let i=this.checkForUserRigths("AuthorizeCreditLimit");return i&&1==i?.value?!!confirm(`Credit Limit has Exceeded for the selected customer.. Credit Limit : ${this._trnMainService.TrnMainObj.CREDITLIMIT}, Credit Amount : ${this._trnMainService.TrnMainObj.BLAMOUNT} and bill amount : ${this._trnMainService.TrnMainObj.NETAMNT}. Save anyway ? `):(confirm("Credit limit is Exceed. Ask For Authorization?")&&this.authenticationPopup.show(this.filterList,"AuthorizeCreditLimitCheck"),!1)}onItemDoubleClickForOpening(i){this.spinnerService.show("Getting data, please wait..."),this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","VIEW").subscribe(n=>{n&&(this.spinnerService.hide(),this.OpeningFromPreviousYear.show(n.result.ProdList,"noLargeDataEntryEdit"))})}onItemDoubleClickForLargeDataEntry(i){this.spinnerService.show("Getting data, please wait...");const n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.TRNDATE;this._trnMainService.TrnMainObj.VCHRNO=i.VCHRNO,this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.toString().substring(0,10),this.masterService.LoadTransaction(i.VCHRNO,i.DIVISION,i.PhiscalID,"","","","EDIT").subscribe({next:_=>{if(console.log(_),"ok"===_.status){this.spinnerService.hide();const{guid:f}=_.result;this.OpeningFromPreviousYear.show(_.result.ProdList,"largeDataEntryEdit",f)}else this._trnMainService.TrnMainObj.VCHRNO=n,this._trnMainService.TrnMainObj.TRNDATE=s,this.spinnerService.hide(),this.alertService.info(_.result.error)}})}validateBeforeSave(){if(this._trnMainService?.TrnMainObj?.largeDataEntryEdit)return!1;if("asset-purchase-invoice"==this.activeurlpath||"assets-openingstockentry"==this.activeurlpath)return!(this._trnMainService.TrnMainObj?.AssetsProdList[0]?.MCODE&&this._trnMainService.TrnMainObj.NETAMNT);if(this._trnMainService.TrnMainObj.VoucherType==S.Km.BatchAdjustment)return!1;if(this._trnMainService.TrnMainObj.VoucherType!=S.Km.Purchase&&this._trnMainService.TrnMainObj.VoucherType!=S.Km.DebitNote||"NONTRADING"!=this._trnMainService.TrnMainObj.INVOICETYPE){if(null==this._trnMainService.TrnMainObj.ProdList[0]?.MCODE||null==this._trnMainService.TrnMainObj.NETAMNT)return!0}else if(this._trnMainService.TrnMainObj?.AdditionProdList&&null==this._trnMainService.TrnMainObj?.AdditionProdList[0].TRNAC)return!0;return!1}onSaveImageCaptured(i){i?(this._trnMainService.TrnMainObj.UserSignature=i,this.onSaveTransactionClicked()):this.alertService.error("Error on Digital Signature!")}onViewSignatureClicked(){this.digitalSignUpload.show(this._trnMainService.TrnMainObj.UserSignature,this._trnMainService.TrnMainObj.Mode)}onPrintVoucher(){let n=this._trnMainService.TrnMainObj.VCHRNO,s=this._trnMainService.TrnMainObj.DIVISION,_=this._trnMainService.TrnMainObj.PhiscalID,f=this._trnMainService.TrnMainObj.TRNUSER,Q=this.userProfile.userDivision?this.userProfile.userDivision:this.userProfile.CompanyInfo.INITIAL,ee=this._trnMainService.TrnMainObj.PhiscalID,ne=1==this.userSetting.DISPLAY?this.userProfile.CompanyInfo.GSTNO:this.userProfile.CompanyInfo.VAT,he=ne.split(""),se={filename:"",rownumber:""};se.VCHRNO=this._trnMainService.TrnMainObj.VCHRNO,se.NAME=this.userProfile.CompanyInfo.NAME,se.ADDRESS=this.userProfile.CompanyInfo.ADDRESS,se.INITIAL=Q||this.userProfile.CompanyInfo.INITIAL,se.PhiscalID=ee||this.userProfile.CompanyInfo.PhiscalID,se.COMPANYID=this.userProfile.CompanyInfo.COMPANYID,se.phone1=this.userProfile.CompanyInfo.TELA,se.phone2=this.userProfile.CompanyInfo.TELB,se.EMAIL=this.userProfile.CompanyInfo.EMAIL,se.numtowords="",se.panno1=he[0]?he[0]:" ",se.panno2=he[1]?he[1]:" ",se.panno3=he[2]?he[2]:" ",se.panno4=he[3]?he[3]:" ",se.panno5=he[4]?he[4]:" ",se.panno6=he[5]?he[5]:" ",se.panno7=he[6]?he[6]:" ",se.panno8=he[7]?he[7]:" ",se.panno9=he[8]?he[8]:" ",se.title=" ",se.caption=this.caption?this.caption:" ",se.VoucherPrefix=this._trnMainService.TrnMainObj.VoucherPrefix,se.PRINTBY=this.userProfile.username?this.userProfile.username:" ",se.COMPANYVAT=ne||this.userProfile.CompanyInfo.VAT,this.PrintHelperService.printVoucher(n,s,_,f,se,"PIVOUCHER")}}return M.\u0275fac=function(i){return new(i||M)(e.Y36(N.p),e.Y36(Ie.R),e.Y36(Re.uw),e.Y36(Le.F0),e.Y36(Le.gz),e.Y36(Y.c),e.Y36(B.V),e.Y36(je.e),e.Y36(B.V),e.Y36(C.C),e.Y36(Ze.g),e.Y36(at),e.Y36(gt.R),e.Y36(O.P),e.Y36(ft.i),e.Y36(ke.h),e.Y36(bt))},M.\u0275cmp=e.Xpm({type:M,selectors:[["voucher-master-action"]],viewQuery:function(i,n){if(1&i&&(e.Gf(_n,5),e.Gf(Mn,5),e.Gf(pn,5),e.Gf(vn,5),e.Gf(Sn,5),e.Gf(mn,5),e.Gf(On,5),e.Gf(gn,5),e.Gf(fn,5),e.Gf(bn,5),e.Gf(Cn,5),e.Gf(En,5),e.Gf(In,5),e.Gf(An,5),e.Gf(Hi,5),e.Gf(Pn,5),e.Gf(yn,5),e.Gf(xn,5),e.Gf(Ln,5),e.Gf(Rn,5),e.Gf(Nn,5),e.Gf(jn,5),e.Gf(wn,5),e.Gf(Dn,5),e.Gf(kn,5),e.Gf(Vn,5),e.Gf(Un,5),e.Gf(Bn,5),e.Gf(Kn,5),e.Gf(Zn,5),e.Gf(Fn,5),e.Gf(Qn,5),e.Gf(Hn,5),e.Gf(Gn,5)),2&i){let s;e.iGM(s=e.CRH())&&(n.digitalSignUpload=s.first),e.iGM(s=e.CRH())&&(n.genericGrid=s.first),e.iGM(s=e.CRH())&&(n.genericTender=s.first),e.iGM(s=e.CRH())&&(n.genericGridHoldBill=s.first),e.iGM(s=e.CRH())&&(n.Transport=s.first),e.iGM(s=e.CRH())&&(n.genericGridIntend=s.first),e.iGM(s=e.CRH())&&(n.printSetupModal=s.first),e.iGM(s=e.CRH())&&(n.genericGridReverseView=s.first),e.iGM(s=e.CRH())&&(n.genericGridPerformaView=s.first),e.iGM(s=e.CRH())&&(n.genericGridForRecurring=s.first),e.iGM(s=e.CRH())&&(n.genericGridforPreviousOpening=s.first),e.iGM(s=e.CRH())&&(n.deliverySelectPopup=s.first),e.iGM(s=e.CRH())&&(n.requisitionSelectPopup=s.first),e.iGM(s=e.CRH())&&(n.genericGridExpList=s.first),e.iGM(s=e.CRH())&&(n.genericGridForTaxCancel=s.first),e.iGM(s=e.CRH())&&(n.ImportPurchaseDetail=s.first),e.iGM(s=e.CRH())&&(n.reverseEntryConfirm=s.first),e.iGM(s=e.CRH())&&(n.authenticationPopup=s.first),e.iGM(s=e.CRH())&&(n.itemInfo=s.first),e.iGM(s=e.CRH())&&(n.itemSearchPopup=s.first),e.iGM(s=e.CRH())&&(n.genericGridForLargeDataEntry=s.first),e.iGM(s=e.CRH())&&(n.genericGridTransferOut=s.first),e.iGM(s=e.CRH())&&(n.rateValidation=s.first),e.iGM(s=e.CRH())&&(n.PaymentPopup=s.first),e.iGM(s=e.CRH())&&(n.RecurringLog=s.first),e.iGM(s=e.CRH())&&(n.StockAdjustment=s.first),e.iGM(s=e.CRH())&&(n.CreateCustomerPopup=s.first),e.iGM(s=e.CRH())&&(n.AutoAdjustment=s.first),e.iGM(s=e.CRH())&&(n.OpeningFromPreviousYear=s.first),e.iGM(s=e.CRH())&&(n.TermConditionPopup=s.first),e.iGM(s=e.CRH())&&(n.PrevYearOpening=s.first),e.iGM(s=e.CRH())&&(n.MemberPointConfirmationPopup=s.first),e.iGM(s=e.CRH())&&(n.BillPreviewPopup=s.first),e.iGM(s=e.CRH())&&(n.multiselectGenericGrid=s.first)}},hostBindings:function(i,n){1&i&&e.NdJ("keydown",function(_){return n.handleKeyDownboardEvent(_)},!1,e.evT)},inputs:{isSales:"isSales",buttonShow:"buttonShow",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit",deliveryChalanEmit:"deliveryChalanEmit",onViewClickEmit:"onViewClickEmit",onLoadFromSOClickEmit:"onLoadFromSOClickEmit",onLoadFromPOClickEmit:"onLoadFromPOClickEmit",onLoadFromHOPerformaInvoiceClickEmit:"onLoadFromHOPerformaInvoiceClickEmit",onLoadFromPerformaInvoiceClickEmit:"onLoadFromPerformaInvoiceClickEmit",onLoadFromReverseEntryEmit:"onLoadFromReverseEntryEmit",onLoadFromHoTaxInvoiceClickEmit:"onLoadFromHoTaxInvoiceClickEmit",onLoadFromSAPFTPClickEmit:"onLoadFromSAPFTPClickEmit",onShowFileUploadPopupEmit:"onShowFileUploadPopupEmit",onLoadFromStockSettlementApproval:"onLoadFromStockSettlementApproval",onSettlementStockApprove:"onSettlementStockApprove",onApproveStockSettlementList:"onApproveStockSettlementList",onFileUploadPopupEmit:"onFileUploadPopupEmit",onSaveINVAllocation:"onSaveINVAllocation",onSaveSelfBilling:"onSaveSelfBilling",onclickOnResetPopupEmit:"onclickOnResetPopupEmit",onLoadCancelSalesEmit:"onLoadCancelSalesEmit",onAddNewCustomerClickEmit:"onAddNewCustomerClickEmit",onClickCustomer:"onClickCustomer",onClickSalesMan:"onClickSalesMan"},features:[e._Bn([C.C])],decls:129,vars:74,consts:[["class","wp-hdr-login",4,"ngIf"],["class","wp-hdr-login-txt",4,"ngIf"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","import","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","voucher","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","J","style","margin: 0px 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","data-toggle","modal","style","margin: 0pcx 4px",3,"click",4,"ngIf"],["style","margin: 0px 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal","data-target","#InvoiceNewPrint",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","C","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["class","btn btn-info pull-right","id","expiredSO","style","margin: 0px 4px","data-toggle","modal",3,"disabled","click",4,"ngIf"],["style","margin: 0px 4px","class","btn btn-info pull-right",3,"disabled","click",4,"ngIf"],["data-toggle","modal","style","margin: 0pcx 4px","style","margin: 0px 4px","class","btn btn-info pull-right",3,"click",4,"ngIf"],["class","btn btn-info pull-right",3,"click",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["itemSearchPopup",""],["genericGridforPreviousOpening",""],["genericGridForLargeDataEntry",""],["genericGridForRecurring",""],["genericGridReverseView",""],["genericGridPerformaView",""],["genericGridHoldBill",""],[3,"okClicked",4,"ngIf"],[3,"popupsettings"],["genericGridIntend",""],[3,"tranMode"],["ImportPurchaseDetail",""],[3,"onClickReverse"],["reverseEntryConfirm",""],[3,"okClicked"],["PaymentPopup",""],[3,"onUserRightReceived","onDiscountLimitReceived","onRoleRightsReceived","onCreditLimitReceived","allowExpiredItemforSave"],["authenticationPopup",""],[3,"RecurringItems","CommissionItems","RecurringItemsForEdit","CommissionItemsForEdit","mode","recurringlogsaved"],["RecurringLog",""],[3,"itemInfopopupsettings"],["itemInfo",""],[3,"stockAdjustmentLoaded"],["StockAdjustment",""],["AutoAdjustment",""],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 65%;\n    top: 5px;\n    width: 50%;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 500px;\n    position: absolute;\n    right: 15%;\n    top: 5px;\n    width: 1100px;\n    z-index: 9999999;\n  ",4,"ngIf"],["class","print-modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: auto;\n    position: absolute;\n    right: 30vw;\n    width: 30vw;\n    z-index: 9999999;\n  ",4,"ngIf"],[4,"ngIf"],["genericGridTransferOut",""],["class","modal-sticky","style","\n    display: block;\n    padding: 0px;\n    margin-bottom: 25px;\n    height: 330px;\n    position: absolute;\n    right: 20%;\n    top: 5px;\n    width: 100%;\n    z-index: 9999999;\n  ",4,"ngIf"],["bsModal","","tabindex","0","role","dialog","aria-labelledby","mySmallModalLabel","aria-hidden","true",1,"modal","fade",2,"height","460px","z-index","9999999",3,"config"],["rateValidatoin","bs-modal"],[1,"modal-dialog","modal-sm"],[1,"modal-content",2,"width","420px"],[1,"modal-header"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-md-12",2,"margin-top","-10px","margin-bottom","12px"],[1,"col-md-12"],[1,"btn","btn-danger",2,"margin-right","4px",3,"click"],["type","button ",1,"btn","btn-warning",3,"click"],["class","forceClose_container",4,"ngIf"],["OpeningFromPreviousYear",""],["PrevYearOpening",""],["TermConditionPopup",""],["genericGridExpList",""],["MemberPointConfirmationPopup",""],["BillPreviewPopup",""],[3,"onSaveImageCaptured"],["digitalSignUpload",""],[3,"popupsettings","onItemsSelected"],["multiselectGenericGrid",""],["deliverySelectPopup",""],["requisitionSelectPopup",""],[1,"wp-hdr-login"],[1,"wp-hdr-login-txt"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["id","import","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","voucher","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","J",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0pcx 4px",3,"click"],["id","C","data-toggle","modal","data-target","#InvoiceNewPrint",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","C","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],["id","expiredSO","data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"disabled","click"],[4,"ngIf","ngIfElse"],["save",""],["data-toggle","modal",1,"btn","btn-info","pull-right",2,"margin","0px 4px",3,"click"],[1,"btn","btn-info","pull-right",3,"click"],["genericTender",""],["Transport",""],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","65%","top","5px","width","50%","z-index","9999999"],[1,"modal-content","modal-content-main-area"],["id","myModalLabel",1,"modal-title"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","printOption","value","0",3,"formControl"],["type","radio","name","printOption","value","1","checked","",3,"formControl"],["printSetupModal",""],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","500px","position","absolute","right","15%","top","5px","width","1100px","z-index","9999999"],[1,"col-md-12",2,"height","350px","overflow-y","auto"],[1,"table",2,"margin-bottom","5px","font-size","12.5px"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","#2dacd1","color","black"],[1,"texttitle",2,"color","black"],[2,"border","1px"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary",2,"margin-top","20px",3,"click"],[2,"width","55px"],["type","checkbox",2,"width","100%",3,"ngModel","ngModelChange"],[1,"print-modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","auto","position","absolute","right","30vw","width","30vw","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"width","100%"],[1,"modal-body",2,"height","420px","overflow-y","scroll"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px","margin-right","8rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["class","row",4,"ngIf"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],["style","width: 25%",4,"ngIf"],[2,"width","63%",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"width","25%"],[3,"ngValue"],["type","text","placeholder","Press Enter For Transferred List","autocomplete","off",2,"width","63%",3,"ngModel","ngModelChange","keydown.Enter"],[2,"width","auto","font-size","12px"],["type","checkbox","checked","",2,"width","17px","height","19px","margin-left","15px","margin-top","-8px",3,"ngModel","disabled","change","ngModelChange"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px","height","330px","position","absolute","right","20%","top","5px","width","100%","z-index","9999999"],[1,"modal-content","modal-content-main-area",2,"overflow","unset"],[1,"modal-header",2,"height","40px"],["id","myModalLabel",1,"modal-title",2,"font-size","15px"],[1,"col-md-12",2,"height","300px","margin-top","3px"],[2,"margin-top","4px","margin-bottom","2px"],[2,"font-size","13px","width","30%"],[2,"height","8rem","overflow-y","scroll","overflow-x","hidden"],[1,"table"],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["scope","col",2,"width","15%"],["scope","col",2,"width","30%"],["scope","col",2,"width","25%"],["scope","col","style","width: 25%",4,"ngIf"],[1,"col-md-8",2,"padding","0px"],[1,"col-md-4"],["text-align","right"],[1,"form-control-label",2,"font-weight","bold","font-size","14px","width","auto"],[1,"form-control-label",2,"font-size","14px","width","auto"],[2,"border","1px solid #e6e6e6","max-height","25px"],[2,"border","1px solid #e6e6e6"],["type","number",2,"height","33px","width","98%","border","1px solid #e6e6e6",3,"id","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],["style","border: 1px solid #e6e6e6",4,"ngIf"],[1,"forceClose_container"],[1,"card"],[1,"card-header"],["style","text-align: center",4,"ngIf"],[2,"position","absolute","right","2%","top","5%"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-sm-3","form-control-label",2,"font-weight","bold"],[1,"col-md-7"],["type","text",1,"form-control",2,"height","4vh","font-size","12px",3,"ngModel","ngModelChange"],[1,"form-group","row"],[1,"col-md-3","form-control-label",2,"font-weight","bold"],[1,"form-control",2,"width","100%","font-size","12px",3,"ngModel","ngModelChange"],[2,"text-align","center"],[1,"modal-sticky",2,"display","block","padding","0px","height","auto","width","51%","position","fixed","bottom","24rem","right","7rem"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"table","table-striped"],[2,"position","sticky","top","0","line-height","1.5rem","font-size","12px"],["scope","col",2,"width","10%"],["scope","col",2,"width","10%","text-align","right"],[1,"tenderList"],[1,"modal-footer",2,"padding","2px"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","11px","height","25ox",3,"click"],[2,"width","10%"],[2,"width","10%","text-align","right"],[2,"width","30%"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"]],template:function(i,n){1&i&&(e.YNc(0,Yn,2,0,"span",0),e.YNc(1,Jn,2,1,"span",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return n.cancel()}),e._uU(3," BACK\n"),e.qZA(),e.YNc(4,qn,2,0,"button",3),e.YNc(5,Wn,2,0,"button",3),e.YNc(6,v,2,1,"button",4),e.YNc(7,k,2,0,"button",3),e.YNc(8,r,2,0,"button",3),e.YNc(9,l,2,1,"button",5),e.YNc(10,c,2,1,"button",6),e.YNc(11,T,2,0,"button",7),e.YNc(12,b,2,0,"button",8),e.YNc(13,z,2,0,"button",8),e.YNc(14,ie,2,0,"button",9),e.YNc(15,fe,2,0,"button",9),e.YNc(16,we,2,0,"button",8),e.YNc(17,be,2,0,"button",10),e.YNc(18,Ee,2,1,"button",11),e.YNc(19,$n,2,1,"button",12),e.YNc(20,zn,2,1,"button",13),e.YNc(21,Xn,2,1,"button",14),e.YNc(22,er,2,0,"button",8),e.YNc(23,tr,2,0,"button",8),e.YNc(24,ir,2,0,"button",8),e.YNc(25,Gi,2,0,"button",8),e.YNc(26,ve,2,0,"button",8),e.YNc(27,Yi,2,0,"button",8),e.YNc(28,Ji,2,0,"button",8),e.YNc(29,Oe,2,0,"button",8),e.YNc(30,qi,2,1,"button",14),e.YNc(31,nr,4,3,"button",14),e.YNc(32,rr,2,1,"button",8),e.YNc(33,or,2,0,"button",8),e.YNc(34,ki,2,0,"button",8),e.YNc(35,cr,2,0,"button",15),e.YNc(36,lr,2,0,"button",8),e.YNc(37,hr,2,0,"button",8),e.YNc(38,dr,2,0,"button",8),e.YNc(39,ur,2,0,"button",8),e.YNc(40,Tr,2,0,"button",8),e.YNc(41,_r,2,0,"button",8),e.YNc(42,Mr,2,0,"button",16),e.YNc(43,pr,2,0,"button",16),e.YNc(44,vr,2,0,"button",16),e.TgZ(45,"generic-popup-grid",17,18),e.NdJ("onItemDoubleClick",function(_){return n.onItemDoubleClick(_)}),e.qZA(),e._UZ(47,"app-item-search-popup",null,19),e.TgZ(49,"generic-popup-grid",17,20),e.NdJ("onItemDoubleClick",function(_){return n.onItemDoubleClickForOpening(_)}),e.qZA(),e.TgZ(51,"generic-popup-grid",17,21),e.NdJ("onItemDoubleClick",function(_){return n.onItemDoubleClickForLargeDataEntry(_)}),e.qZA(),e.TgZ(53,"generic-popup-grid",17,22),e.NdJ("onItemDoubleClick",function(_){return n.onRecurringDoubleClick(_)}),e.qZA(),e.TgZ(55,"generic-popup-grid",17,23),e.NdJ("onItemDoubleClick",function(_){return n.onItemDoubleClick(_)}),e.qZA(),e.TgZ(57,"generic-popup-grid",17,24),e.NdJ("onItemDoubleClick",function(_){return n.onPerformaDoubleClick(_)}),e.qZA(),e.TgZ(59,"generic-popup-grid",17,25),e.NdJ("onItemDoubleClick",function(_){return n.onHoldBillDoubleClick(_)}),e.qZA(),e.YNc(61,Sr,2,0,"generic-popup-Tender",26),e.YNc(62,mr,2,0,"Transport-Popup",26),e._UZ(63,"generic-popup-grid",27,28)(65,"import-purchase-details",29,30),e.TgZ(67,"reverse-entry-dialog",31,32),e.NdJ("onClickReverse",function(){return n.onClickReverseSave()}),e.qZA(),e.TgZ(69,"payment-popup-dialog",33,34),e.NdJ("okClicked",function(_){return n.onSavePayment(_)}),e.qZA(),e.TgZ(71,"authentication-entry",35,36),e.NdJ("onUserRightReceived",function(_){return n.onUserRightReceived(_)})("onDiscountLimitReceived",function(_){return n.onDiscountLimitReceived(_)})("onRoleRightsReceived",function(_){return n.onRoleRightsReceived(_)})("onCreditLimitReceived",function(_){return n.onCreditLimitReceived(_)})("allowExpiredItemforSave",function(_){return n.allowExpiredItemforSave(_)}),e.qZA(),e.TgZ(73,"recurringlog-popup",37,38),e.NdJ("recurringlogsaved",function(_){return n.onSaveRecurringLog(_)}),e.qZA(),e._UZ(75,"iteminfo-popup",39,40),e.TgZ(77,"stockadjustment-popup",41,42),e.NdJ("stockAdjustmentLoaded",function(_){return n.stockAdjustmentLoaded(_)}),e.qZA(),e._UZ(79,"autoadjustment-popup",null,43),e.YNc(81,fr,14,2,"div",44),e.YNc(82,Cr,53,1,"div",45),e.YNc(83,Er,13,1,"div",46),e.YNc(84,Nr,19,4,"div",47),e.TgZ(85,"generic-popup-grid",17,48),e.NdJ("onItemDoubleClick",function(_){return n.dblClickLoadTransferOutData(_)}),e.qZA(),e.YNc(87,kr,42,4,"div",49),e.TgZ(88,"div")(89,"div",50,51)(91,"div",52)(92,"div",53)(93,"div",54)(94,"button",55),e.NdJ("click",function(){return n.onClickNo()}),e.TgZ(95,"span",56),e._uU(96,"\xd7"),e.qZA()()(),e.TgZ(97,"div",57)(98,"div",58)(99,"div",59),e._uU(100),e.qZA(),e.TgZ(101,"div",60)(102,"button",61),e.NdJ("click",function(){return n.onClickYes()}),e._uU(103," Yes "),e.qZA(),e.TgZ(104,"button",62),e.NdJ("click",function(){return n.onClickNo()}),e._uU(105," No "),e.qZA()()()()()()()(),e.YNc(106,Br,21,5,"div",63),e.YNc(107,Zr,24,1,"div",47),e.YNc(108,Fr,23,2,"div",47),e._UZ(109,"app-opening-from-previous-year",null,64)(111,"previous-year-opening",null,65),e.TgZ(113,"termsncondition-popup-dialog",33,66),e.NdJ("okClicked",function(_){return n.onSaveTermsnConditions(_)}),e.qZA(),e.TgZ(115,"generic-popup-grid",17,67),e.NdJ("onItemDoubleClick",function(_){return n.onListSelected(_)}),e.qZA(),e.TgZ(117,"member-point-confirm-popup",33,68),e.NdJ("okClicked",function(_){return n.confirmationOkClicked(_)}),e.qZA(),e._UZ(119,"preview-bill-popup-dialog",null,69),e.TgZ(121,"digital-signature-popup",70,71),e.NdJ("onSaveImageCaptured",function(_){return n.onSaveImageCaptured(_)}),e.qZA(),e.TgZ(123,"multiselect-generic-grid",72,73),e.NdJ("onItemsSelected",function(_){return n.onMultiItemSelected(_)}),e.qZA(),e._UZ(125,"app-delivery-select-popup",null,74)(127,"app-requisition-select-popup",null,75)),2&i&&(e.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngIf","VIEW"==n._trnMainService.TrnMainObj.Mode),e.xp6(3),e.Q6J("ngIf",19==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf","add-purchase-invoice"==n.activeurlpath&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(19==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",90==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&(null!=n._trnMainService.TrnMainObj.REFORDBILL||null!=n._trnMainService.TrnMainObj.REFORDBILL)),e.xp6(1),e.Q6J("ngIf",(14==n._trnMainService.TrnMainObj.VoucherType||1==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.GblEnableMixedTenderMode&&n.showSecondaryButtons&&"lite"!=n.AppMode),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&(1==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||57==n._trnMainService.TrnMainObj.VoucherType||83==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType||20==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType||64==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||7==n._trnMainService.TrnMainObj.VoucherType||8==n._trnMainService.TrnMainObj.VoucherType||31==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType||71==n._trnMainService.TrnMainObj.VoucherType||81==n._trnMainService.TrnMainObj.VoucherType||41==n._trnMainService.TrnMainObj.VoucherType||43==n._trnMainService.TrnMainObj.VoucherType||37==n._trnMainService.TrnMainObj.VoucherType||40==n._trnMainService.TrnMainObj.VoucherType)&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&3==n._trnMainService.TrnMainObj.VoucherType&&("VIEW"==n._trnMainService.TrnMainObj.Mode||"EDIT"==n._trnMainService.TrnMainObj.Mode)&&n.hideButton),e.xp6(1),e.Q6J("ngIf","StockSettlementEntryApproval"==n.activeurlpath),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",83==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",n._trnMainService.showPerformaApproveReject&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(!n._trnMainService.showPerformaApproveReject&&57==n._trnMainService.TrnMainObj.VoucherType||14==n._trnMainService.TrnMainObj.VoucherType||61==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&"retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE),e.xp6(1),e.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(20==n._trnMainService.TrnMainObj.VoucherType||58==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&1==n.userSetting.EnableAutoSOExpiry),e.xp6(1),e.Q6J("ngIf",(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&n.hideButton&&n.showSecondaryButtons&&n.buttonShow),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",24==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||5==n._trnMainService.TrnMainObj.VoucherType||19==n._trnMainService.TrnMainObj.VoucherType&&n.userSetting.IsBBSM)&&n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",8==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&1==n._trnMainService.userSetting.ENABLESINGLEBATCHMODE),e.xp6(1),e.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf","VIEW"===n._trnMainService.TrnMainObj.Mode&&1===n.userSetting.EnableDigitalSignature&&5===n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",!n._trnMainService.showPerformaApproveReject&&(3==n._trnMainService.TrnMainObj.VoucherType||16==n._trnMainService.TrnMainObj.VoucherType||21==n._trnMainService.TrnMainObj.VoucherType||15==n._trnMainService.TrnMainObj.VoucherType||88==n._trnMainService.TrnMainObj.VoucherType)&&n.showSecondaryButtons&&n.hideButton&&"add-membership-sales-invoice"!=n.activeurlpath&&n.buttonShow),e.xp6(1),e.Q6J("ngIf",n.userSetting.IsBBSM?n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton&&80!=n._trnMainService.TrnMainObj.VoucherType&&0==n.userSetting.EnableRQLogInRQEntry:n.editButtonCheck()&&!n._trnMainService.showPerformaApproveReject&&58!=n._trnMainService.TrnMainObj.VoucherType&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf","canceladdsientry"!=n.activeurlpath&&("VIEW"!=n._trnMainService.TrnMainObj.Mode||!n._trnMainService.showPerformaApproveReject)&&!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&(19===n._trnMainService.TrnMainObj.VoucherType||64===n._trnMainService.TrnMainObj.VoucherType||3===n._trnMainService.TrnMainObj.VoucherType&&1==n.userSetting.PODELIVERYMODE)&&1==n.userSetting.ApplyTermsAndCondition),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton),e.xp6(1),e.Q6J("ngIf",!n.showSecondaryButtons&&n.hideButton&&20===n._trnMainService.TrnMainObj.VoucherType&&1==n._trnMainService.enableRefreshRateInSO&&"EDIT"==n._trnMainService.buttonMode),e.xp6(1),e.Q6J("ngIf",57==n._trnMainService.TrnMainObj.VoucherType&&n.showSecondaryButtons&&n.hideButton&&1==n.userSetting.RECURRING_TRANSACTION),e.xp6(1),e.Q6J("ngIf",(8==n._trnMainService.TrnMainObj.VoucherType||80==n._trnMainService.TrnMainObj.VoucherType)&&0==n.userSetting.centralizeddbmode&&!n.showSecondaryButtons),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&"add-sales-invoice"==n.activeurlpath&&1==n.userSetting.EnableDeliveryChalan),e.xp6(1),e.Q6J("ngIf",n.showSecondaryButtons&&14==n._trnMainService.TrnMainObj.VoucherType&&"self-billing"!=n.activeurlpath&&"add-membership-sales-invoice"!=n.activeurlpath&&"VIEW"==n._trnMainService.TrnMainObj.Mode&&1==n.userSetting.EnableRecurringItem&&1==n.userSetting.EnableCommissionCalculation),e.xp6(1),e.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&1===n.userSetting.ENABLE_SALESMAN_ROUTE&&"self-billing"!=n.activeurlpath),e.xp6(1),e.Q6J("ngIf","canceladdsientry"==n.activeurlpath),e.xp6(1),e.Q6J("ngIf",3==n._trnMainService.TrnMainObj.VoucherType&&"IMPORT_PURCHASE"==(null==n._trnMainService.TrnMainObj||null==n._trnMainService.TrnMainObj.AdditionalObj?null:n._trnMainService.TrnMainObj.AdditionalObj.tag)),e.xp6(1),e.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",89==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettings),e.xp6(4),e.Q6J("popupsettings",n.gridPopupSettingForPreviousOpening),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingForLargeEntry),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForRecurring),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForReverse),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForViewPerforma),e.xp6(2),e.Q6J("popupsettings",n.gridPopupSettingsForHoldBill),e.xp6(2),e.Q6J("ngIf","retailer"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&14==n._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",14==n._trnMainService.TrnMainObj.VoucherType&&("superdistributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"distributor"==n._trnMainService.userProfile.CompanyInfo.ORG_TYPE)),e.xp6(1),e.Q6J("popupsettings",n.gridPopupSettingsForIntend),e.xp6(2),e.Q6J("tranMode",n._trnMainService.TrnMainObj.Mode),e.xp6(8),e.Q6J("RecurringItems",n.recurringItems)("CommissionItems",n.commissionChargeable)("RecurringItemsForEdit",n.recurringItemsForEdit)("CommissionItemsForEdit",n.commissionItemsForEdit)("mode",n.recurringLogMode),e.xp6(2),e.Q6J("itemInfopopupsettings",n.itemInfoPopupSettings),e.xp6(6),e.Q6J("ngIf",n.promptPrintDevice),e.xp6(1),e.Q6J("ngIf",n.showschemePopup),e.xp6(1),e.Q6J("ngIf",n.showPosPrinterPreview),e.xp6(1),e.Q6J("ngIf",n.addForRequisition),e.xp6(1),e.Q6J("popupsettings",n.genericGridTransferOutSetting),e.xp6(2),e.Q6J("ngIf",n.showPriceChangeDetail&&1==n.userSetting.ShowPriceChangePopup),e.xp6(2),e.Q6J("config",e.DdM(73,Qr)),e.xp6(11),e.hij(" ",n.rateValidationDisplayMessage," "),e.xp6(6),e.Q6J("ngIf",n.showForceClose),e.xp6(1),e.Q6J("ngIf",n.showTenderList),e.xp6(1),e.Q6J("ngIf",n.showReverseEntryAuth),e.xp6(7),e.Q6J("popupsettings",n.gridPopupSettingsForExpList),e.xp6(8),e.Q6J("popupsettings",n.multiselectPopupSettings))},dependencies:[Ct.oB,j.sg,j.O5,E._Y,E.YN,E.Kr,E.Fj,E.wV,E.Wl,E.EJ,E._,E.JJ,E.JL,E.On,E.F,E.oH,K.Zl,Fe,Ut,Yt,qt,Mi,xi,Li.m,L,P,me,tt,en,sn,cn,dn,un.q,Z.ky,Tn.b,j.JJ,We.g],styles:["span[_ngcontent-%COMP%] {\n    font-weight: bold;\n  }\n  .modal-content[_ngcontent-%COMP%] {\n    padding: 1px;\n    margin: 0px;\n    float: right;\n  }\n\n  tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n    background-color: #f3f5f4;\n    cursor: pointer;\n  }\n\n  tr[_ngcontent-%COMP%] {\n    font-size: 11px;\n  }\n\n  .selected-row[_ngcontent-%COMP%] {\n    background-color: #ced6d3 !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%] {\n    line-height: 30px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\n    line-height: 5px !important;\n  }\n\n  .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n    text-align: left !important;\n    padding: 0px 0px 0px 11px !important;\n  }\n\n  .modal-content[_ngcontent-%COMP%] {\n    box-shadow: -10px 0px 10px 1px #aaaaaa;\n  }\n\n  .modal-content-main-area[_ngcontent-%COMP%] {\n    max-height: 100%;\n    height: 100%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .modal-content-summary-area[_ngcontent-%COMP%] {\n    max-height: 20%;\n    height: 20%;\n    overflow: auto;\n    overflow-x: hidden;\n  }\n\n  .ellipsis[_ngcontent-%COMP%] {\n    \n    white-space: nowrap;\n  }\n\n  .forceClose_container[_ngcontent-%COMP%] {\n    position: fixed !important;\n    transform: translate(-50px, -50px);\n    \n    background: #ffffff;\n    z-index: 99999;\n    width: 57%;\n    top: 29.5%;\n    left: 26%;\n  }\n\n  \n\n  .tenderList[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n    padding: 0rem 0.75rem;\n    font-size: 12px;\n  }"]}),M})()},68527:(_e,re,A)=>{A.d(re,{q:()=>Y});var t=A(93105),E=A(42326),m=A(64537),$=A(53074),F=A(87584),S=A(69389),K=A(67297),C=A(54536),u=A(7976),V=A(88692);function w(B,N){1&B&&(m.TgZ(0,"span"),m._uU(1,"Show Detail [F1]"),m.qZA())}function W(B,N){1&B&&(m.TgZ(0,"span"),m._uU(1,"Hide Detail [F1]"),m.qZA())}let Y=(()=>{class B{constructor(O,j,x,g,y,L){this.masterService=O,this._trnMainService=j,this.setting=x,this.dialog=y,this.arouter=L,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new t.EventEmitter,this.TrnMainObj=j.TrnMainObj,this.AppSettings=this.setting.appSetting,this.userProfile=g.getUserProfile(),this.voucherType=this.TrnMainObj.VoucherType,this.TrnMainObj.BRANCH=this.userProfile.userBranch,this.TrnMainObj.DIVISION=this.userProfile.userDivision,this.activeurlpath=L.snapshot.url[0].path,this.masterService.refreshTransactionList(),(this.TrnMainObj.VoucherType==E.Km.CreditNote||this.TrnMainObj.VoucherType==E.Km.SalesReturn)&&(this.transactionType="creditnote")}ngOnInit(){this.masterService.ShowMore=!0}ngOnDestroy(){try{this.subscriptions.forEach(O=>{O.unsubscribe()})}catch{}}ShowMore(){this.masterService.ShowMore=!this.masterService.ShowMore,"add-membership-sales-invoice"==this.activeurlpath&&(document.getElementById("scrollableDiv").scrollTop=0)}nullToZeroConverter(O){return null==O||null==O||""==O?0:parseFloat(O)}handleKeyDownboardEvent(O){"F1"==O.code&&(O.preventDefault(),this.ShowMore())}}return B.\u0275fac=function(O){return new(O||B)(m.Y36($.P),m.Y36(F.p),m.Y36(S.R),m.Y36(K.e),m.Y36(C.uw),m.Y36(u.gz))},B.\u0275cmp=m.Xpm({type:B,selectors:[["voucher-master-toggler"]],hostBindings:function(O,j){1&O&&m.NdJ("keydown",function(g){return j.handleKeyDownboardEvent(g)},!1,m.evT)},inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:3,vars:2,consts:[[1,"btn","btn-info",3,"click"],[4,"ngIf"]],template:function(O,j){1&O&&(m.TgZ(0,"button",0),m.NdJ("click",function(){return j.ShowMore()}),m.YNc(1,w,2,0,"span",1),m.YNc(2,W,2,0,"span",1),m.qZA()),2&O&&(m.xp6(1),m.Q6J("ngIf",!j.masterService.ShowMore),m.xp6(1),m.Q6J("ngIf",j.masterService.ShowMore))},dependencies:[V.O5],encapsulation:2}),B})()},78159:(_e,re,A)=>{A.d(re,{u:()=>x});var t=A(93105),E=A(42326),m=A(64537),$=A(53074),F=A(87584),S=A(88692),K=A(89952),C=A(79700);function u(g,y){if(1&g&&(m.TgZ(0,"div",4)(1,"h6"),m._uU(2),m.ALo(3,"twoDigitNumber"),m.qZA()()),2&g){const L=m.oxw(2);m.xp6(2),m.hij("ECS: ",m.lcZ(3,1,L._trnMainService.TrnMainObj.TOTALECS)," ")}}function V(g,y){if(1&g&&(m.TgZ(0,"div",4)(1,"h6"),m._uU(2),m.ALo(3,"twoDigitNumber"),m.qZA()()),2&g){const L=m.oxw(2);m.xp6(2),m.hij("VAT: ",m.lcZ(3,1,L._trnMainService.TrnMainObj.VATAMNT),"")}}function w(g,y){if(1&g&&(m.TgZ(0,"div",7)(1,"h6"),m._uU(2),m.ALo(3,"twoDigitNumber"),m.qZA()()),2&g){const L=m.oxw(2);m.xp6(2),m.AsE("",L._trnMainService.TrnMainObj.FCurrency," TOTAL: ",m.lcZ(3,2,L._trnMainService.TrnMainObj.fcTotal)," ")}}function W(g,y){if(1&g&&(m.TgZ(0,"div",3)(1,"div",4)(2,"h6"),m._uU(3),m.ALo(4,"twoDigitNumber"),m.qZA()(),m.TgZ(5,"div",4)(6,"h6"),m._uU(7),m.ALo(8,"twoDigitNumber"),m.qZA()(),m.YNc(9,u,4,3,"div",5),m.ALo(10,"activeColumn"),m.TgZ(11,"div",4)(12,"h6"),m._uU(13),m.ALo(14,"twoDigitNumber"),m.qZA()(),m.TgZ(15,"div",4)(16,"h6"),m._uU(17),m.ALo(18,"twoDigitNumber"),m.qZA()(),m.TgZ(19,"div",4)(20,"h6"),m._uU(21),m.ALo(22,"twoDigitNumber"),m.qZA()(),m.YNc(23,V,4,3,"div",5),m.TgZ(24,"div",4)(25,"h6"),m._uU(26),m.ALo(27,"twoDigitNumber"),m.qZA()(),m.YNc(28,w,4,4,"div",6),m.qZA()),2&g){const L=m.oxw();m.xp6(3),m.hij("TOTAL QTY: ",m.lcZ(4,9,L._trnMainService.TrnMainObj.TOTALSQTY)," "),m.xp6(4),m.hij("GROSS: ",m.lcZ(8,11,L._trnMainService.TrnMainObj.GROSSAMNT)," "),m.xp6(2),m.Q6J("ngIf",m.lcZ(10,13,"ECSAmount")),m.xp6(4),m.hij("DISCOUNT: ",m.lcZ(14,15,L._trnMainService.TrnMainObj.TOTALDISCOUNT)," "),m.xp6(4),m.hij("TAXABLE: ",m.lcZ(18,17,L._trnMainService.TrnMainObj.TAXABLE),"\xa0 "),m.xp6(4),m.hij("NON TAXABLE: ",m.lcZ(22,19,L._trnMainService.TrnMainObj.NONTAXABLE),"\xa0 "),m.xp6(2),m.Q6J("ngIf","IMPORT_PURCHASE"!=(null==L._trnMainService.TrnMainObj.AdditionalObj?null:L._trnMainService.TrnMainObj.AdditionalObj.tag)&&"IMPORT_PURCHASE_ORDER"!=(null==L._trnMainService.TrnMainObj.AdditionalObj?null:L._trnMainService.TrnMainObj.AdditionalObj.tag)),m.xp6(3),m.hij("NET AMNT: ",m.lcZ(27,21,L._trnMainService.TrnMainObj.NETAMNT)," "),m.xp6(2),m.Q6J("ngIf",10==L._trnMainService.TrnMainObj.CNDN_MODE&&3==L._trnMainService.TrnMainObj.VoucherType&&L._trnMainService.TrnMainObj.FCurrency)}}function Y(g,y){if(1&g&&(m.TgZ(0,"div",3)(1,"div",8)(2,"h6",9),m._uU(3,"TOTAL:"),m.qZA()(),m.TgZ(4,"div",10)(5,"h6",9),m._uU(6),m.ALo(7,"twoDigitNumber"),m.qZA()(),m.TgZ(8,"div",10)(9,"h6",9),m._uU(10),m.ALo(11,"twoDigitNumber"),m.qZA()()()),2&g){const L=m.oxw();m.xp6(6),m.hij("",m.lcZ(7,2,L._trnMainService.TrnMainObj.TOTALQTY)," "),m.xp6(4),m.hij("",m.lcZ(11,4,L._trnMainService.TrnMainObj.GROSSAMNT)," ")}}function B(g,y){if(1&g&&(m.TgZ(0,"div",3),m._UZ(1,"div",11),m.TgZ(2,"div",12)(3,"div",8)(4,"h6"),m._uU(5),m.ALo(6,"twoDigitNumber"),m.qZA()(),m.TgZ(7,"div",8)(8,"h6"),m._uU(9),m.ALo(10,"twoDigitNumber"),m.qZA()()()()),2&g){const L=m.oxw();m.xp6(5),m.hij("TOTAL QTY: ",m.lcZ(6,2,L._trnMainService.TrnMainObj.TOTALQTY)," "),m.xp6(4),m.hij("TOTAL AMNT: ",m.lcZ(10,4,L._trnMainService.TrnMainObj.NETAMNT),"")}}function N(g,y){if(1&g&&(m.TgZ(0,"div",3),m._UZ(1,"div",11),m.TgZ(2,"div",12)(3,"div",8)(4,"h6"),m._uU(5),m.ALo(6,"twoDigitNumber"),m.qZA()(),m.TgZ(7,"div",8)(8,"h6"),m._uU(9),m.ALo(10,"twoDigitNumber"),m.qZA()()()()),2&g){const L=m.oxw();m.xp6(5),m.hij("TOTAL QTY: ",m.lcZ(6,2,L._trnMainService.TrnMainObj.TOTALQTY)," "),m.xp6(4),m.hij("TOTAL AMNT: ",m.lcZ(10,4,L._trnMainService.TrnMainObj.GROSSAMNT),"")}}function O(g,y){if(1&g&&(m.TgZ(0,"div",3)(1,"div",13),m._UZ(2,"div",14),m.TgZ(3,"label",15),m._uU(4),m.qZA(),m._UZ(5,"div",16),m.TgZ(6,"label",15),m._uU(7),m.qZA(),m._UZ(8,"div",17),m.TgZ(9,"label",15),m._uU(10),m.qZA(),m._UZ(11,"div",18),m.TgZ(12,"label",15),m._uU(13),m.qZA()()()),2&g){const L=m.oxw();m.xp6(4),m.hij("Request is equal to ",L.qtyLabel,""),m.xp6(3),m.hij("Request is more than ",L.qtyLabel,""),m.xp6(3),m.hij("",L.qtyLabel," is more than Request"),m.xp6(3),m.hij("",L.qtyLabel," quantity is Zero")}}function j(g,y){if(1&g&&(m.TgZ(0,"div",3),m._UZ(1,"div",19),m.TgZ(2,"div",20)(3,"h6"),m._uU(4),m.ALo(5,"twoDigitNumber"),m.qZA()()()),2&g){const L=m.oxw();m.xp6(4),m.hij("TOTAL QTY: ",m.lcZ(5,1,L._trnMainService.TrnMainObj.TOTALQTY)," ")}}let x=(()=>{class g{constructor(L,D){this.masterService=L,this._trnMainService=D,this.mode="NEW",this.modeTitle="",this.TrnMainObj={},this.showOrder=!1,this.subscriptions=[],this.userProfile={},this.additionalcostEmit=new t.EventEmitter,82==this._trnMainService.TrnMainObj.VoucherType?this.qtyLabel="Dispatch":90==this._trnMainService.TrnMainObj.VoucherType&&(this.qtyLabel="Approved")}ngOnInit(){}ngOnDestroy(){try{this.subscriptions.forEach(L=>{L.unsubscribe()})}catch{}}onKeydownPreventEdit(L){L.preventDefault()}showTotalDetails(){return!(this._trnMainService.TrnMainObj.VoucherType==E.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType==E.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType==E.Km.BranchTransferIn||this._trnMainService.TrnMainObj.VoucherType==E.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==E.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType==E.Km.Repack||this._trnMainService.TrnMainObj.VoucherType==E.Km.ProductionEntry||this._trnMainService.TrnMainObj.VoucherType==E.Km.RequisitionEntry||this._trnMainService.TrnMainObj.VoucherType==E.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==E.Km.BatchAdjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.RequisitionApproval||this._trnMainService.TrnMainObj.VoucherType==E.Km.InventoryAllocation||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==E.Km.ApprovalClose)}showTotalQtyAmnt(){return(this._trnMainService.TrnMainObj.VoucherType==E.Km.StockIssueReturn||this._trnMainService.TrnMainObj.VoucherType==E.Km.Stockadjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.RequisitionApproval&&"requisition"==this._trnMainService.TrnMainObj.filterByInReqApproval)&&"requisition-log"!=this._trnMainService.activeurlpath}showTotalQty(){return this._trnMainService.TrnMainObj.VoucherType==E.Km.RequisitionEntry||"requisition-log"==this._trnMainService.activeurlpath||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessAdjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.ShortageAdjustment||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessGoods||this._trnMainService.TrnMainObj.VoucherType==E.Km.ExcessAcknowledgement||this._trnMainService.TrnMainObj.VoucherType==E.Km.ApprovalClose}showColorLabel(){return(82==this._trnMainService.TrnMainObj.VoucherType||90==this._trnMainService.TrnMainObj.VoucherType)&&"VIEW"!=this._trnMainService.TrnMainObj.Mode}}return g.\u0275fac=function(L){return new(L||g)(m.Y36($.P),m.Y36(F.p))},g.\u0275cmp=m.Xpm({type:g,selectors:[["voucher-total-area"]],inputs:{isSales:"isSales",additionCost:"additionCost"},outputs:{additionalcostEmit:"additionalcostEmit"},decls:8,vars:6,consts:[[1,"row","clearfix","footer"],[1,"col-md-12",2,"vertical-align","center"],["class","row",4,"ngIf"],[1,"row"],[2,"width","12.25%"],["style","width: 12.25%;",4,"ngIf"],["class","foreign-currency",4,"ngIf"],[1,"foreign-currency"],[1,"col-md-6"],[1,"pull-right"],[1,"col-md-2"],[1,"col-md-7"],[1,"col-md-5","row"],[1,"col-md-12",2,"display","flex","align-items","center"],[1,"green"],[1,"label-color"],[1,"yellow"],[1,"red"],[1,"brown"],[1,"col-md-9"],[1,"col-md-3","row"]],template:function(L,D){1&L&&(m.TgZ(0,"div",0)(1,"div",1),m.YNc(2,W,29,23,"div",2),m.YNc(3,Y,12,6,"div",2),m.YNc(4,B,11,6,"div",2),m.YNc(5,N,11,6,"div",2),m.YNc(6,O,14,4,"div",2),m.YNc(7,j,6,3,"div",2),m.qZA()()),2&L&&(m.xp6(2),m.Q6J("ngIf",D.showTotalDetails()),m.xp6(1),m.Q6J("ngIf",24==D._trnMainService.TrnMainObj.VoucherType||5==D._trnMainService.TrnMainObj.VoucherType||88==D._trnMainService.TrnMainObj.VoucherType||89==D._trnMainService.TrnMainObj.VoucherType),m.xp6(1),m.Q6J("ngIf",7==D._trnMainService.TrnMainObj.VoucherType||8==D._trnMainService.TrnMainObj.VoucherType||9==D._trnMainService.TrnMainObj.VoucherType||74==D._trnMainService.TrnMainObj.VoucherType),m.xp6(1),m.Q6J("ngIf",D.showTotalQtyAmnt()),m.xp6(1),m.Q6J("ngIf",D.showColorLabel()),m.xp6(1),m.Q6J("ngIf",D.showTotalQty()))},dependencies:[S.O5,K.g,C.w],styles:[".footer[_ngcontent-%COMP%] {\n    \n    \n    margin-right: 1px;\n    margin-bottom: 2.8%;\n    clear: both;\n    padding-top: 20px;\n    border-top: 1px solid #eaeaea;\n    border-left: 1px solid #eaeaea;\n    border-right: 1px solid #eaeaea;\n    background-color: #fff;\n  }\n\n  .green[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #26ef01;\n    border-radius: 50%;\n  }\n\n  .red[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #ff4141;\n    border-radius: 50%;\n  }\n\n  .yellow[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: yellow;\n    border-radius: 50%;\n  }\n\n  .brown[_ngcontent-%COMP%]{\n    height: 23px;\n    width: 23px;\n    background-color: #9602c7;\n    border-radius: 50%;\n  }\n\n  .label-color[_ngcontent-%COMP%]{\n    font-size: 14px;\n    width: 18%;\n    margin-left: 1%;\n  }\n\n\n  .foreign-currency[_ngcontent-%COMP%]{\n    width: 14.25%; \n    font-style: italic; \n    color:#021691;\n  }"]}),g})()},29242:(_e,re,A)=>{A.d(re,{$x:()=>S,LD:()=>w,LX:()=>V,_f:()=>u,_n:()=>F,gQ:()=>C,jT:()=>Y,q7:()=>K,qU:()=>$,rb:()=>W});var t=A(26215);const $=16777215,F="bmp",S=0,K=.7,C=4,u=4,V=1500,w=8e3,W="eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImV4cCI6MjE0NzQ4MzY0NywiaWF0IjoxNTYwOTUwMjcyLCJyaWdodHMiOlsiU0lHX1NES19DT1JFIiwiU0lHQ0FQVFhfQUNDRVNTIl0sImRldmljZXMiOlsiV0FDT01fQU5ZIl0sInR5cGUiOiJwcm9kIiwibGljX25hbWUiOiJTaWduYXR1cmUgU0RLIiwid2Fjb21faWQiOiI3YmM5Y2IxYWIxMGE0NmUxODI2N2E5MTJkYTA2ZTI3NiIsImxpY191aWQiOiJiODUyM2ViYi0xOGI3LTQ3OGEtYTlkZS04NDlmZTIyNmIwMDIiLCJhcHBzX3dpbmRvd3MiOltdLCJhcHBzX2lvcyI6W10sImFwcHNfYW5kcm9pZCI6W10sIm1hY2hpbmVfaWRzIjpbXX0.ONy3iYQ7lC6rQhou7rz4iJT_OJ20087gWz7GtCgYX3uNtKjmnEaNuP3QkjgxOK_vgOrTdwzD-nm-ysiTDs2GcPlOdUPErSp_bcX8kFBZVmGLyJtmeInAW6HuSp2-57ngoGFivTH_l1kkQ1KMvzDKHJbRglsPpd4nVHhx9WkvqczXyogldygvl0LRidyPOsS5H2GYmaPiyIp9In6meqeNQ1n9zkxSHo7B11mp_WXJXl0k1pek7py8XYCedCNW5qnLi4UCNlfTd6Mk9qz31arsiWsesPeR9PN121LBJtiPi023yQU8mgb9piw_a-ccciviJuNsEuRDN3sGnqONG3dMSA";class Y{constructor(){this.fullName="",this.reason="document Approval",this.date="",this.eventSubject=new t.X(""),this.imageString$=this.eventSubject.asObservable(),this.setHTMLTags()}emitValue(N){this.eventSubject.next(N)}getImageString$(){return this.eventSubject.pipe(N=>N)}setHTMLTags(){this.btnRestore=document.getElementById("restore"),this.checkBoxUseB64=document.getElementById("chkUseB64Image"),this.checkShowSigtext=document.getElementById("chkShowSigText"),this.firstName=document.getElementById("fname"),this.imageBox=document.getElementById("imageBox"),this.lastName=document.getElementById("lname"),this.textSig=document.getElementById("txtSignature"),this.txtDisplay=document.getElementById("txtDisplay"),console.log({imageid:[this.imageBox,this.btnRestore,this.checkBoxUseB64,this.firstName,this.lastName]})}}},5881:(_e,re,A)=>{A.r(re),A.d(re,{SessionControl:()=>$});var t=A(29242),e=A(46241);const E={map:{},counter:0,getJSON:function(F,S,K){var C=F+(F.indexOf("?")+1?"&":"?"),u=document.getElementsByTagName("head")[0],V=document.createElement("script"),w=[],W="",Y="json-"+this.counter;for(W in this.counter++,S.script_name=Y,S._rand=Math.random(),this.map[Y]=K,S.callback="JSONreq.success",S)w.push(W+"="+encodeURIComponent(S[W]));C+=w.join("&"),V.type="text/javascript",V.src=C,V.id=Y,u.appendChild(V)},success:function(F){var S=F.script_name;delete F.script_name,this.map[S](F);var K=document.getElementsByTagName("head")[0],C=document.getElementById(S);K.removeChild(C),delete this.map.script_name}};class m{constructor(S,K){ar(this,"_onDetectRunning"),ar(this,"service_port"),this._onDetectRunning=S,this.service_port=K,this.running=!1,this.session=null,this.service_detected=!1;let C=this;window.sdkPtr=C;var u="https://localhost:";function V(N){0==N.status?(C.session=N.session,C.running=!0,S(),setTimeout(C.keepAlive,2e3)):console.log("Signature SDK local server error: "+N.status)}function w(N){0==N.status?(C.service_detected=!0,E.getJSON((u+=N.port+"/")+"wacom.js",{CreateSession:1},V)):console.log("Signature SDK Service error: "+N.status)}function B(N){return typeof N>"u"||null==N?"":N}this.RBFlags={RenderOutputPicture:2097152,RenderOutputBase64:8192,RenderBackgroundTransparent:65536,RenderColor1BPP:131072,RenderColor24BPP:262144,RenderColor32BPP:524288,RenderColorAntiAlias:1048576,RenderEncodeData:4194304,RenderWatermark:8388608,RenderClipped:16777216,RenderRelative:33554432},this.IntegrityStatus={IntegrityOK:0,IntegrityFail:1,IntegrityMissing:2,IntegrityWrongType:3,IntegrityInsufficientData:4,IntegrityUncertain:5,IntegrityUnsupported:6},this.HashType={HashNone:0,HashMD5:1,HashSHA1:2,HashSHA224:3,HashSHA256:4,HashSHA384:5,HashSHA512:6},this.KeyType={KeyNone:0,KeyMD5:1,KeyMD5MAC:2,KeySHA1:3,KeySHA224:4,KeySHA256:5,KeySHA384:6,KeySHA512:7,KeyCAPICOM:8},this.SignedData={DataGood:0,DataNoHash:1,DataBadType:2,DataBadHash:3,DataError:4,DataUncertain:5,DataSigMoved:6},this.CaptData={CaptDigitizer:26,CaptDigitizerDriver:27,CaptMachineOS:28,CaptNetworkCard:29},this.DynamicCaptureResult={DynCaptOK:0,DynCaptCancel:1,DynCaptPadError:100,DynCaptError:101,DynCaptNotLicensed:103,DynCaptAbort:200,DynCaptIntegrityKeyInvalid:102},this.TimeZone={TimeLocal:0,TimeGMT:1,TimeUTC:1},this.DisplayMode={DspForceFit:0,DspUseZoom:1,DspBestFit:2},this.ShowText={TxtDontShow:0,TxtShowLeft:1,TxtShowCenter:2,TxtShowRight:4},this.ObjectType={ObjectText:0,ObjectButton:1,ObjectCheckbox:2,ObjectSignature:3,ObjectInput:4,ObjectInputEcho:5,ObjectHash:6,ObjectImage:7,ObjectDisplayAtShutdown:8,ObjectInking:9,ObjectRadioButton:10},this.TextOptions={TextAlignLeft:0,TextAlignRight:1,TextAlignCentre:2,TextAlignJustify:3},this.ButtonOptions={BtnAlignCentre:0,BtnAlignMiddle:0,BtnAlignLeft:1,BtnAlignRight:2,BtnAlignTop:4,BtnAlignBottom:8},this.CheckBoxOptions={CheckboxUnchecked:0,CheckboxChecked:1,CheckboxDisplayTick:2,CheckboxDisplayCross:4},this.ObjectOptionType={OBJECTOPTION_STRING:0,OBJECTOPTION_INT:1,OBJECTOPTION_BOOL:2},this.VariantType={VARIANT_EMPTY:0,VARIANT_TEXT:1,VARIANT_NUM:2,VARIANT_OBJECTOPTIONS:3,VARIANT_SIGOBJ:4,VARIANT_SIGCTL:5,VARIANT_INPUTOBJ:6,VARIANT_HASH:7,VARIANT_IMGURL:8,VARIANT_BASE64:9,VARIANT_DYNCAP:10,VARIANT_WIZCTL:11,VARIANT_FONT:12,VARIANT_KEY:13},this.PrimitiveType={PrimitiveLine:0,PrimitiveRectangle:1,PrimitiveEllipse:2},this.PrimitiveOptions={PrimitiveLineSolid:1,PrimitiveLineDashed:2,PrimitiveOutline:4,PrimitiveFill:8,PrimitiveFillXOR:16},this.EventType={EvTextClicked:0,EvButtonClicked:1,EvCheckboxChecked:2,EvCheckboxUnchecked:3,EvInputMinReached:4,EvInputMaxReached:5,EvInputExceeded:6},this.EncryptAlg={EncryptNone:0,EncryptTripleDES:1},this.ResponseStatus={OK:0,FAILED:1,INVALID_SESSION:3},this.FontWeight={FW_DONTCARE:0,FW_THIN:100,FW_EXTRALIGHT:200,FW_LIGHT:300,FW_NORMAL:400,FW_MEDIUM:500,FW_SEMIBOLD:600,FW_BOLD:700,FW_EXTRABOLD:800,FW_HEAVY:900,FW_ULTRALIGHT:200,FW_REGULAR:400,FW_DEMIBOLD:600,FW_ULTRABOLD:800,FW_BLACK:900},this.FontCharset={ANSI_CHARSET:0,DEFAULT_CHARSET:1,SYMBOL_CHARSET:2,SHIFTJIS_CHARSET:128,HANGEUL_CHARSET:129,HANGUL_CHARSET:129,GB2312_CHARSET:134,CHINESEBIG5_CHARSET:136,OEM_CHARSET:255,JOHAB_CHARSET:130,HEBREW_CHARSET:177,ARABIC_CHARSET:178,GREEK_CHARSET:161,TURKISH_CHARSET:162,VIETNAMESE_CHARSET:163,THAI_CHARSET:222,EASTEUROPE_CHARSET:238,RUSSIAN_CHARSET:204,MAC_CHARSET:77,BALTIC_CHARSET:186,FS_LATIN1:1,FS_LATIN2:2,FS_CYRILLIC:4,FS_GREEK:8,FS_TURKISH:16,FS_HEBREW:32,FS_ARABIC:64,FS_BALTIC:128,FS_VIETNAMESE:256,FS_THAI:65536,FS_JISJAPAN:131072,FS_CHINESESIMP:262144,FS_WANSUNG:524288,FS_CHINESETRAD:1048576,FS_JOHAB:2097152,FS_SYMBOL:2147483648},this.Font=function(N,O,j,x,g,y,L){this.type=C.VariantType.VARIANT_FONT,this.fontName=typeof N>"u"?"Arial":N,this.fontSize=typeof O>"u"?8:O,this.sWeight=typeof j>"u"?C.FontWeight.FW_NORMAL:j,this.sCharset=typeof x>"u"?C.FontCharset.ANSI_CHARSET:x,this.fItalic=typeof fItalic>"u"?0:fItalic,this.fUnderline=typeof y>"u"?0:fUnderline,this.fStrikethrough=typeof L>"u"?0:L},this.keepAlive=function(){E.getJSON(u+"wacom.js",{session:C.session,KeepAlive:1},function(){}),setTimeout(C.keepAlive,2e3)},window.addEventListener("unload",function(N){!function W(){if(0!=C.session){var N=u+"wacom.js?DestroySession=1&session="+C.session;if(C.session=0,null!=self.Navigator.sendBeacon)self.Navigator.sendBeacon(N);else{var O=new XMLHttpRequest;O.open("GET",N,!1),O.send(null)}}}()}),function Y(){E.getJSON(u+K+"/wacom.js",{GetPort:1},w)}(),this.getVersion=function(N){E.getJSON(u+"wacom.js",{GetVersion:1,session:C.session},function j(x){N(x.version,parseInt(x.status))})},this.Hash=function(N){var O=this;this.handle=null,this.type=C.VariantType.VARIANT_HASH,E.getJSON(u+"wacom.js",{Hash:"Constructor",session:C.session},function x(g){O.handle=g.handle,N(O,parseInt(g.status))}),this.Add=function(g,y){var L={Hash:"Add",session:C.session,handle:O.handle};g.Stringify(L,"hData"),E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.Clear=function(g){E.getJSON(u+"wacom.js",{Hash:"Clear",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.status))})},this.GetType=function(g){E.getJSON(u+"wacom.js",{Hash:"GetType",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.hashType),parseInt(D.status))})},this.PutType=function(g,y){var L={Hash:"PutType",session:C.session,handle:O.handle,type:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})}},this.Key=function(N){var O=this;this.handle=null,this.type=C.VariantType.VARIANT_KEY,E.getJSON(u+"wacom.js",{Key:"Constructor",session:C.session},function x(g){O.handle=g.handle,N(O,parseInt(g.status))}),this.GetType=function(g){E.getJSON(u+"wacom.js",{Key:"GetType",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.type),parseInt(D.status))})},this.Set=function(g,y,L){var D={Key:"Set",session:C.session,handle:O.handle,type:B(g)};y.Stringify(D,"value"),E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})}},this.Bitmap=function(){this.handle=null,this.isBase64=!1,this.mime_type=null,this.image=new Image},this.SigObj=function(){var N=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGOBJ,this.CheckIntegrity=function(O,j){var x={SigObj:"CheckIntegrity",session:C.session,handle:N.handle},g=new C.Variant;g.Set(O),g.Stringify(x,"key"),E.getJSON(u+"wacom.js",x,function y(L){j(N,parseInt(L.status))})},this.CheckSignedData=function(O,j){var x={SigObj:"CheckSignedData",session:C.session,handle:N.handle,HashHandle:B(O.handle)};E.getJSON(u+"wacom.js",x,function g(y){j(N,parseInt(y.status))})},this.Clear=function(O){E.getJSON(u+"wacom.js",{SigObj:"Clear",session:C.session,handle:N.handle},function x(g){O(N,parseInt(g.status))})},this.GetAdditionalData=function(O,j){var x={SigObj:"GetAdditionalData",session:C.session,handle:N.handle,captData:B(O)};E.getJSON(u+"wacom.js",x,function g(y){j(N,y.additionalData,parseInt(y.status))})},this.GetCrossedOut=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetCrossedOut",session:C.session,handle:N.handle},function x(g){O(N,Boolean(1==parseInt(g.crossedOut)),parseInt(g.status))})},this.GetExtraData=function(O,j){var x={SigObj:"GetExtraData",session:C.session,handle:N.handle,key:B(O)};E.getJSON(u+"wacom.js",x,function g(y){j(N,y.extraData,parseInt(y.status))})},this.GetHeight=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetHeight",session:C.session,handle:N.handle},function x(g){O(N,parseInt(g.height),parseInt(g.status))})},this.GetInk=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetInk",session:C.session,handle:N.handle},function x(g){O(N,g.ink,parseInt(g.status))})},this.GetIsCaptured=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetIsCaptured",session:C.session,handle:N.handle},function x(g){O(N,Boolean(1==parseInt(g.isCaptured)),parseInt(g.status))})},this.GetProperty=function(O,j){var x={SigObj:"GetProperty",session:C.session,handle:N.handle,key:B(O)};E.getJSON(u+"wacom.js",x,function g(y){var L=new C.Variant;L.Parse(y,"property"),j(N,L,parseInt(y.status))})},this.GetSigData=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetSigData",session:C.session,handle:N.handle},function x(g){var y=new C.Variant;y.Parse(g,"sigData"),O(N,y,parseInt(g.status))})},this.GetSigText=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetSigText",session:C.session,handle:N.handle},function x(g){O(N,g.sigText,parseInt(g.status))})},this.GetWhen=function(O,j){var x={SigObj:"GetWhen",session:C.session,handle:N.handle,timeZone:B(O)};E.getJSON(u+"wacom.js",x,function g(y){var L=new Date(parseFloat(y.year),parseFloat(y.month)-1,parseFloat(y.day),parseFloat(y.hour),parseFloat(y.minute),parseFloat(y.second));L.dayOfWeek=parseFloat(y.dayOfWeek),j(N,L,parseInt(y.status))})},this.GetWho=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetWho",session:C.session,handle:N.handle},function x(g){O(N,g.who,parseInt(g.status))})},this.GetWhy=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetWhy",session:C.session,handle:N.handle},function x(g){O(N,g.why,parseInt(g.status))})},this.GetWidth=function(O){E.getJSON(u+"wacom.js",{SigObj:"GetWidth",session:C.session,handle:N.handle},function x(g){O(N,parseInt(g.width),parseInt(g.status))})},this.PutExtraData=function(O,j,x){var g={SigObj:"PutExtraData",session:C.session,handle:N.handle,key:B(O),value:B(j)};E.getJSON(u+"wacom.js",g,function y(L){x(N,parseInt(L.status))})},this.PutInk=function(O,j){var x={SigObj:"PutInk",session:C.session,handle:N.handle,ink:B(O)};E.getJSON(u+"wacom.js",x,function g(y){j(N,parseInt(y.status))})},this.PutSigData=function(O,j){var x={SigObj:"PutSigData",session:C.session,handle:N.handle};O.Stringify(x,"sigData"),E.getJSON(u+"wacom.js",x,function g(y){j(N,parseInt(y.status))})},this.PutSigText=function(O,j){var x={SigObj:"PutSigText",session:C.session,handle:N.handle,sigText:B(O)};E.getJSON(u+"wacom.js",x,function g(y){j(N,parseInt(y.status))})},this.ReadEncodedBitmap=function(O,j){var x={SigObj:"ReadEncodedBitmap",session:C.session,handle:N.handle},g=new C.Variant;g.type=C.VariantType.VARIANT_IMGURL,g.url=O,g.Stringify(x,"bitmapURL"),E.getJSON(u+"wacom.js",x,function y(L){j(N,parseInt(L.status))})},this.RenderBitmap=function(O,j,x,g,y,L,D,J,U,H){var G={SigObj:"RenderBitmap",session:C.session,handle:N.handle,mimetype:B(O),width:B(j),height:B(x),ink_width:B(g),ink_color:B(y),bg_color:B(L),flags:B(D),paddingX:B(J),paddingY:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){var de=parseInt(te.status);if(0==de)if(D&C.RBFlags.RenderOutputPicture){var Ce=new C.Bitmap;Ce.handle=te.bitmapHandle,Ce.isBase64=1==te.isBase64,Ce.image.onload=function(){H(N,Ce,de)},Ce.image.src=Ce.isBase64?"data:image/"+O+";base64,"+te.base64:u+te.bitmapHandle+"?session="+C.session}else 1==te.isBase64&&H(N,te.base64,de);else H(N,null,de)})},this.SetProperty=function(O,j,x){var g={SigObj:"SetProperty",session:C.session,handle:N.handle,key:B(O)};j.Stringify(g,"value"),E.getJSON(u+"wacom.js",g,function y(L){x(N,parseInt(L.status))})}},this.DynamicCapture=function(N){var O=this;this.handle=null,E.getJSON(u+"wacom.js",{DynamicCapture:"Constructor",session:C.session},function x(g){O.handle=g.handle,N(O,parseInt(g.status))}),this.Capture=function(g,y,L,D,J,U){var H=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,G=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,Z=window.screenLeft?window.screenLeft:window.screenX,te=window.screenTop?window.screenTop:window.screenY,de={DynamicCapture:"Capture",session:C.session,who:B(y),why:B(L),width:B(H),height:B(G),left:B(Z),top:B(te),SigCtlHandle:B(g.handle),handle:O.handle},Ce=new C.Variant;Ce.Set(D),Ce.Stringify(de,"what");var ge=new C.Variant;ge.Set(J),ge.Stringify(de,"key"),E.getJSON(u+"wacom.js",de,function Ie(Re){var Le=new C.SigObj;Le.handle=Re.handle,U(O,Le,parseInt(Re.status))})},this.GetLicence=function(g){E.getJSON(u+"wacom.js",{DynamicCapture:"GetLicence",session:C.session,handle:O.handle},function L(D){g(O,D.licence,parseInt(D.status))})},this.GetProperty=function(g,y){var L={DynamicCapture:"GetProperty",session:C.session,handle:O.handle,key:B(g)};E.getJSON(u+"wacom.js",L,function D(J){var U=new C.Variant;U.Parse(J,"property"),y(O,U,parseInt(J.status))})},this.PutLicence=function(g,y){var L={DynamicCapture:"PutLicence",session:C.session,handle:O.handle,licence:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.SetProperty=function(g,y,L){var D={DynamicCapture:"SetProperty",session:C.session,handle:O.handle,key:B(g)};y.Stringify(D,"value"),E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})}},this.SigCtl=function(N){var O=this;this.handle=null,this.type=C.VariantType.VARIANT_SIGCTL,E.getJSON(u+"wacom.js",{SigCtl:"Constructor",session:C.session},function x(g){O.handle=g.handle,N(O,parseInt(g.status))}),this.AboutBox=function(g){var y=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,L=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,D=window.screenLeft?window.screenLeft:window.screenX,J=window.screenTop?window.screenTop:window.screenY,U={SigCtl:"AboutBox",session:C.session,width:B(y),height:B(L),left:B(D),top:B(J),handle:O.handle};E.getJSON(u+"wacom.js",U,function H(G){g(O,parseInt(G.status))})},this.GetAppData=function(g,y){var L={SigCtl:"GetAppData",session:C.session,handle:O.handle,key:B(g)};E.getJSON(u+"wacom.js",L,function D(J){var U=new C.Variant;U.Parse(J,"appData"),y(O,U,parseInt(J.status))})},this.GetInputData=function(g){E.getJSON(u+"wacom.js",{SigCtl:"GetInputData",session:C.session,handle:O.handle},function L(D){g(O,D.inputData,parseInt(D.status))})},this.GetLicence=function(g){E.getJSON(u+"wacom.js",{SigCtl:"GetLicence",session:C.session,handle:O.handle},function L(D){g(O,D.licence,parseInt(D.status))})},this.GetProperty=function(g,y){var L={SigCtl:"GetProperty",session:C.session,handle:O.handle,key:B(g)};E.getJSON(u+"wacom.js",L,function D(J){var U=new C.Variant;U.Parse(J,"property"),y(O,U,parseInt(J.status))})},this.GetSignature=function(g){E.getJSON(u+"wacom.js",{SigCtl:"GetSignature",session:C.session,handle:O.handle},function L(D){var J=new C.SigObj;J.handle=D.signatureHandle,g(O,J,parseInt(D.status))})},this.PutAppData=function(g,y,L){var D={SigCtl:"PutAppData",session:C.session,handle:O.handle,key:B(g)};y.Stringify(D,"val"),E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})},this.PutInputData=function(g,y){var L={SigCtl:"PutInputData",session:C.session,handle:O.handle,inputData:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.PutLicence=function(g,y){var L={SigCtl:"PutLicence",session:C.session,handle:O.handle,licence:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.PutProperties=function(g,y){var L={SigCtl:"PutProperties",session:C.session,handle:O.handle,properties:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.PutSignature=function(g,y){var L={SigCtl:"PutSignature",session:C.session,handle:O.handle,signatureHandle:B(g.handle)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.SetProperty=function(g,y,L){var D={SigCtl:"SetProperty",session:C.session,handle:O.handle,key:B(g)};y.Stringify(D,"value"),E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})}},this.InputObj=function(N){var O=this;this.handle=null,this.type=C.VariantType.VARIANT_INPUTOBJ,E.getJSON(u+"wacom.js",{InputObj:"Constructor",session:C.session},function x(g){O.handle=g.handle,N(O,parseInt(g.status))}),this.Clear=function(g){E.getJSON(u+"wacom.js",{InputObj:"Clear",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.status))})},this.GetData=function(g){E.getJSON(u+"wacom.js",{InputObj:"GetData",session:C.session,handle:O.handle},function L(D){g(O,D.data,parseInt(D.status))})},this.GetEncryptionType=function(g){E.getJSON(u+"wacom.js",{InputObj:"GetEncryptionType",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.encryptionType),parseInt(D.status))})},this.GetMaxLength=function(g){E.getJSON(u+"wacom.js",{InputObj:"GetMaxLength",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.maxLength),parseInt(D.status))})},this.GetMinLength=function(g){E.getJSON(u+"wacom.js",{InputObj:"GetMinLength",session:C.session,handle:O.handle},function L(D){g(O,parseInt(D.minLength),parseInt(D.status))})},this.GetProperty=function(g,y){var L={InputObj:"GetProperty",session:C.session,handle:O.handle,name:B(g)};E.getJSON(u+"wacom.js",L,function D(J){(new C.Variant).Parse(J,"property"),y(O,J.property,parseInt(J.status))})},this.GetText=function(g){E.getJSON(u+"wacom.js",{InputObj:"GetText",session:C.session,handle:O.handle},function L(D){g(O,D.text,parseInt(D.status))})},this.PutMaxLength=function(g,y){var L={InputObj:"PutMaxLength",session:C.session,handle:O.handle,maxLength:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.PutMinLength=function(g,y){var L={InputObj:"PutMinLength",session:C.session,handle:O.handle,minLength:B(g)};E.getJSON(u+"wacom.js",L,function D(J){y(O,parseInt(J.status))})},this.SetEncryption=function(g,y,L){var D={InputObj:"SetEncryption",session:C.session,handle:O.handle,type:B(g)};y.Stringify(D,"key"),E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})},this.SetProperty=function(g,y,L){var D={InputObj:"SetProperty",session:C.session,handle:O.handle,name:B(g),value:B(y)};E.getJSON(u+"wacom.js",D,function J(U){L(O,parseInt(U.status))})}},this.ObjectOptions=function(){var N=this;this.type=C.VariantType.VARIANT_OBJECTOPTIONS,this.AddOption=function(O,j){N[O]=j}},this.Variant=function(){var N=this;this.type=C.VariantType.VARIANT_EMPTY,this.Parse=function(O,j){var x=parseInt(O[j+".type"]);switch(x){case C.VariantType.VARIANT_TEXT:N.type=x,N.text=O[j+".text"];break;case C.VariantType.VARIANT_NUM:N.type=x,N.num=parseFloat(O[j+".num"]);break;case C.VariantType.VARIANT_OBJECTOPTIONS:N.type=x;break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:N.type=x,N.handle=O[j+".handle"];break;case C.VariantType.VARIANT_BASE64:N.type=x,N.base64=O[j+".base64"];break;case C.VariantType.VARIANT_IMGURL:N.type=x,N.url=O[j+".url"];break;case C.VariantType.VARIANT_FONT:N.type=x,N.fontName=O[j+".fontName"],N.fontSize=O[j+".fontSize"],N.sWeight=O[j+".sWeight"],N.sCharset=O[j+".sCharset"],N.fItalic=O[j+".fItalic"],N.fUnderline=O[j+".fUnderline"],N.fStrikethrough=O[j+".fStrikethrough"];break;default:N.type=C.VariantType.VARIANT_EMPTY}},this.Set=function(O){if("string"==typeof O)N.type=C.VariantType.VARIANT_TEXT,N.text=O;else if("number"==typeof O)N.type=C.VariantType.VARIANT_NUM,N.num=O;else if(null!=O&&"object"==typeof O&&typeof O.type<"u"&&null!=O.type)switch(O.type){case C.VariantType.VARIANT_OBJECTOPTIONS:for(o in N.type=C.VariantType.VARIANT_OBJECTOPTIONS,O)"type"!=o&&("string"==typeof O[o]?(N[o]=O[o],N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_STRING):"number"==typeof O[o]?(N[o]=O[o]>0?Math.floor(O[o]):Math.ceil(O[o]),N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_INT):"boolean"==typeof O[o]&&(N[o]=1==O[o]?1:0,N[o+".type"]=C.ObjectOptionType.OBJECTOPTION_BOOL));break;case C.VariantType.VARIANT_SIGOBJ:case C.VariantType.VARIANT_SIGCTL:case C.VariantType.VARIANT_INPUTOBJ:case C.VariantType.VARIANT_HASH:case C.VariantType.VARIANT_KEY:case C.VariantType.VARIANT_DYNCAP:case C.VariantType.VARIANT_WIZCTL:N.type=O.type,N.handle=O.handle;break;case C.VariantType.VARIANT_IMGURL:N.type=C.VariantType.VARIANT_IMGURL,N.url=O.url;break;case C.VariantType.VARIANT_BASE64:N.type=C.VariantType.VARIANT_BASE64,N.base64=O.base64;break;case C.VariantType.VARIANT_FONT:N.type=C.VariantType.VARIANT_FONT,N.fontName=O.fontName,N.fontSize=O.fontSize,N.sWeight=O.sWeight,N.sCharset=O.sCharset,N.fItalic=O.fItalic,N.fUnderline=O.fUnderline,N.fStrikethrough=O.fStrikethrough;break;case C.VariantType.VARIANT_TEXT:N.type=O.type,N.text=O.text;break;case C.VariantType.VARIANT_NUM:N.type=O.type,N.num=O.num;break;default:N.type=C.VariantType.VARIANT_EMPTY}},this.Stringify=function(O,j){for(var x in N)"string"==typeof x&&"function"!=typeof N[x]&&"symbol"!=typeof N[x]&&("object"==typeof N[x]||"string"==typeof N[x]||"number"==typeof N[x])&&(O[j+"."+x]=N[x.toString()])}},this.WizCtl=function(N){var O=this;this.handle=null;var J,j=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,x=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,g=window.screenLeft?window.screenLeft:window.screenX,y=window.screenTop?window.screenTop:window.screenY;E.getJSON(u+"wacom.js",{WizCtl:"Constructor",session:C.session,width:j,height:x,left:g,top:y},function D(U){O.handle=U.handle,N(O,parseInt(U.status))}),this.AddObject=function(U,H,G,Z,te,de,Ce){var ge={WizCtl:"AddObject",session:C.session,handle:O.handle,objType:B(U),id:B(H)},Ie=new C.Variant,Re=new C.Variant;Ie.Set(G),Re.Set(Z),Ie.Stringify(ge,"X"),Re.Stringify(ge,"Y"),te.Stringify(ge,"objData"),de.Stringify(ge,"options"),E.getJSON(u+"wacom.js",ge,function Le(je){Ce(O,parseInt(je.status))})},this.AddPrimitive=function(U,H,G,Z,te,de,Ce,ge){var Ie={WizCtl:"AddPrimitive",session:C.session,handle:O.handle,primType:B(U)},Re=new C.Variant,Le=new C.Variant,je=new C.Variant,Ze=new C.Variant;Re.Set(H),Le.Set(G),je.Set(Z),Ze.Set(te),Re.Stringify(Ie,"X1"),Le.Stringify(Ie,"Y1"),je.Stringify(Ie,"X2"),Ze.Stringify(Ie,"Y2"),de.Stringify(Ie,"primData"),Ce.Stringify(Ie,"options"),E.getJSON(u+"wacom.js",Ie,function He(Ge){ge(O,parseInt(Ge.status))})},this.Close=function(U){E.getJSON(u+"wacom.js",{WizCtl:"Close",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.status))})},this.Display=function(U){E.getJSON(u+"wacom.js",{WizCtl:"Display",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.status))})},this.FireClick=function(U,H){E.getJSON(u+"wacom.js",{WizCtl:"FireClick",session:C.session,handle:O.handle,fireClickId:U},function Z(te){H(O,parseInt(te.status))})},this.GetBackColor=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetBackColor",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.backColor),parseInt(Z.status))})},this.GetBorderColor=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetBorderColor",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.borderColor),parseInt(Z.status))})},this.GetBorderStyle=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetBorderStyle",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.borderStyle),parseInt(Z.status))})},this.GetBorderVisible=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetBorderVisible",session:C.session,handle:O.handle},function G(Z){U(O,Boolean(1==parseInt(Z.borderVisible)),parseInt(Z.status))})},this.GetBorderWidth=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetBorderWidth",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.borderWidth),parseInt(Z.status))})},this.GetEnableWizardDisplay=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetEnableWizardDisplay",session:C.session,handle:O.handle},function G(Z){U(O,Boolean(1==parseInt(Z.enableWD)),parseInt(Z.status))})},this.GetFont=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetFont",session:C.session,handle:O.handle},function G(Z){var te=new C.Variant;te.Parse(Z,"font"),U(O,te,parseInt(Z.status))})},this.GetInkingPad=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetInkingPad",session:C.session,handle:O.handle},function G(Z){U(O,Boolean(1==parseInt(Z.inkingPad)),parseInt(Z.status))})},this.GetLicence=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetLicence",session:C.session,handle:O.handle},function G(Z){U(O,Z.licence,parseInt(Z.status))})},this.GetObjectState=function(U,H){var G={WizCtl:"GetObjectState",session:C.session,handle:O.handle,objectId:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){var de=new C.Variant;de.Parse(te,"objState"),H(O,de,parseInt(te.status))})},this.GetPadHeight=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetPadHeight",session:C.session,handle:O.handle},function G(Z){U(O,parseFloat(Z.height),parseInt(Z.status))})},this.GetPadWidth=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetPadWidth",session:C.session,handle:O.handle},function G(Z){U(O,parseFloat(Z.width),parseInt(Z.status))})},this.GetProperty=function(U,H){var G={WizCtl:"GetProperty",session:C.session,handle:O.handle,key:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){var de=new C.Variant;de.Parse(te,"property"),H(O,de,parseInt(te.status))})},this.GetVisibleWindow=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetVisibleWindow",session:C.session,handle:O.handle},function G(Z){U(O,Boolean(1==parseInt(Z.visible)),parseInt(Z.status))})},this.GetZoom=function(U){E.getJSON(u+"wacom.js",{WizCtl:"GetZoom",session:C.session,handle:O.handle},function G(Z){U(O,parseFloat(Z.zoom),parseInt(Z.status))})},this.PadConnect=function(U){E.getJSON(u+"wacom.js",{WizCtl:"PadConnect",session:C.session,handle:O.handle},function G(Z){U(O,Boolean(1==parseInt(Z.padConnect)),parseInt(Z.status))})},this.PadDisconnect=function(U){E.getJSON(u+"wacom.js",{WizCtl:"PadDisconnect",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.status))})},this.PutBackColor=function(U,H){var G={WizCtl:"PutBackColor",session:C.session,handle:O.handle,backColor:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutBorderColor=function(U,H){var G={WizCtl:"PutBorderColor",session:C.session,handle:O.handle,borderColor:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutBorderStyle=function(U,H){var G={WizCtl:"PutBorderStyle",session:C.session,handle:O.handle,borderStyle:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutBorderVisible=function(U,H){var G={WizCtl:"PutBorderVisible",session:C.session,handle:O.handle,borderVisible:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutBorderWidth=function(U,H){var G={WizCtl:"PutBorderWidth",session:C.session,handle:O.handle,borderWidth:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutEnableWizardDisplay=function(U,H){var G={WizCtl:"PutEnableWizardDisplay",session:C.session,handle:O.handle,enableWD:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutFont=function(U,H){var G={WizCtl:"PutFont",session:C.session,handle:O.handle};U.Stringify(G,"font"),E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutLicence=function(U,H){var G={WizCtl:"PutLicence",session:C.session,handle:O.handle,licence:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutPadHeight=function(U,H){var G={WizCtl:"PutPadHeight",session:C.session,handle:O.handle,height:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutPadWidth=function(U,H){var G={WizCtl:"PutPadWidth",session:C.session,handle:O.handle,width:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutProperties=function(U,H){var G={WizCtl:"PutProperties",session:C.session,handle:O.handle,properties:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutRefFont=function(U,H){var G={WizCtl:"PutRefFont",session:C.session,handle:O.handle};U.Stringify(G,"font"),E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutVisibleWindow=function(U,H){var G={WizCtl:"PutVisibleWindow",session:C.session,handle:O.handle,visible:Number(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.PutZoom=function(U,H){var G={WizCtl:"PutZoom",session:C.session,handle:O.handle,zoom:B(U)};E.getJSON(u+"wacom.js",G,function Z(te){H(O,parseInt(te.status))})},this.Reset=function(U){E.getJSON(u+"wacom.js",{WizCtl:"Reset",session:C.session,handle:O.handle},function G(Z){U(O,parseInt(Z.status))})},this.SetProperty=function(U,H,G){var Z={WizCtl:"SetProperty",session:C.session,handle:O.handle,key:U};H.Stringify(Z,"value"),E.getJSON(u+"wacom.js",Z,function te(de){G(O,parseInt(de.status))})},this.SetEventHandler=function(U){J=U,E.getJSON(u+"wacom.js",{WizCtl:"SetEventHandler",session:C.session,handle:O.handle},function G(Z){var te={WizCtl:"UpdateEventHandler",session:C.session,handle:O.handle};if(0==parseInt(Z.status))E.getJSON(u+"wacom.js",te,G);else if(typeof Z.status>"u")return;setTimeout(function(){J(O.handle,Z["event-id"],parseInt(Z["event-type"]),parseInt(Z.status))},0)})}}}}class ${static actionWhenRestarted(){e.SigCapture.sigCtl=null,e.SigCapture.dynCapt=null,null!=e.SigCapture.HTMLTagIds.imageBox.firstChild&&e.SigCapture.HTMLTagIds.imageBox.removeChild(e.SigCapture.HTMLTagIds.imageBox.firstChild),this.timeout=setTimeout($.timedDetect,t.LX),console.log({msg:"Starting up WacomGSS_SignatureSDK",timeout:this.timeout}),window.JSONreq=E;let S=new m($.onDetectRunning,t.LD);window.sdkPtr=S,console.log({window})}static timedDetect(){window.sdkPtr.running?(e.SigCapture.print("Signature SDK Service detected."),$.start()):e.SigCapture.print("Signature SDK Service not detected.")}static onDetectRunning(){window.sdkPtr.running?(e.SigCapture.print("Signature SDK Service detected."),console.log({msg:"signature sdk service detected"}),e.SigCapture.print("Starting..."),$.start()):e.SigCapture.print("Signature SDK Service not detected.")}static start(){window.sdkPtr.running&&(e.SigCapture.print("Checking components ..."),e.SigCapture.sigCtl=new window.sdkPtr.SigCtl($.onSigCtlConstructor))}static onSigCtlConstructor(S,K){e.SigCapture.callbackStatusOK("SigCtl Constructor",K)&&S.PutLicence(t.rb,$.onSigCtlPutLicence)}static onDynCaptConstructor(S,K){e.SigCapture.callbackStatusOK("DynCapt Constructor",K)&&e.SigCapture.sigCtl.GetSignature($.onGetSignature)}static onSigCtlPutLicence(S,K){e.SigCapture.callbackStatusOK("SigCtl PutLicence",K)&&(e.SigCapture.dynCapt=new window.sdkPtr.DynamicCapture($.onDynCaptConstructor))}static onGetSignature(S,K,C){e.SigCapture.callbackStatusOK("SigCapt GetSignature",C)&&S.GetProperty("Component_FileVersion",$.onSigCtlGetFileVersion)}static onGetSigCaptXVersion(S,K){e.SigCapture.callbackStatusOK("SigCaptX GetVersion",K)&&(e.SigCapture.print("SigCaptX  v"+S),e.SigCapture.sigCtl.GetProperty("Component_FileVersion",$.onSigCtlGetFileVersion))}static onSigCtlGetFileVersion(S,K,C){e.SigCapture.callbackStatusOK("SigCtl GetProperty",C)&&(e.SigCapture.print("DLL: flSigCOM.dll  v"+K.text),e.SigCapture.dynCapt.GetProperty("Component_FileVersion",$.onDynCaptGetFileVersion))}static onDynCaptGetFileVersion(S,K,C){e.SigCapture.callbackStatusOK("DynCapt GetProperty",C)&&(e.SigCapture.print("DLL: flSigCapt.dll v"+K.text),e.SigCapture.print("Test application ready."),e.SigCapture.print("Press 'Capture' to capture a signature."))}}},46241:(_e,re,A)=>{A.r(re),A.d(re,{SigCapture:()=>m});var t=A(29242),e=A(5881),E=A(64537);class m{constructor(){this.reason=""}ngAfterViewInit(){m.HTMLTagIds=new t.jT}capturesig(){this.reason.length>0&&(m.HTMLTagIds.reason=this.reason),null!=m.HTMLTagIds?.imageBox?.firstChild&&m.HTMLTagIds.imageBox.removeChild(m.HTMLTagIds.imageBox.firstChild),window.sdkPtr.running?m.Capture():e.SessionControl.actionWhenRestarted()}static print(F){}static callbackStatusOK(F,S){return window.sdkPtr.ResponseStatus.OK===S||(m.print(F+" error: "+S),!1)}static Capture(){m.hash=new window.sdkPtr.Hash(m.onHashConstructor)}static onHashConstructor(F,S){window.sdkPtr.ResponseStatus.OK==S?m.GetHash(F,m.onGetInitialHash):(m.print("Hash Constructor error: "+S),window.sdkPtr.ResponseStatus.INVALID_SESSION==S&&(m.print("Error: invalid session. Restarting the session."),e.SessionControl.actionWhenRestarted()))}}m.HTMLTagIds=new t.jT,m.onGetInitialHash=()=>{m.HTMLTagIds.fullName=m.HTMLTagIds.firstName.value;var F=m.HTMLTagIds.fullName,S=m.HTMLTagIds.reason;console.log({fullName:F,reason:S}),m.dynCapt.Capture(m.sigCtl,F,S,m.hash,null,m.onDynCaptCapture)},m.onDynCaptCapture=($,F,S)=>{if(window.sdkPtr.ResponseStatus.INVALID_SESSION==S)m.print("Error: invalid session. Restarting the session."),e.SessionControl.actionWhenRestarted();else switch(S){case window.sdkPtr.DynamicCaptureResult.DynCaptOK:m.sigObj=F,m.print("Signature captured successfully");var K=window.sdkPtr.RBFlags.RenderOutputBase64|window.sdkPtr.RBFlags.RenderColor32BPP;F.RenderBitmap(t._n,m.HTMLTagIds.imageBox.clientWidth,m.HTMLTagIds.imageBox.clientHeight,t.q7,t.$x,t.qU,K,t.gQ,t._f,m.onRenderBitmap);break;case window.sdkPtr.DynamicCaptureResult.DynCaptCancel:m.print("Signature capture cancelled");break;case window.sdkPtr.DynamicCaptureResult.DynCaptPadError:m.print("No capture service available");break;case window.sdkPtr.DynamicCaptureResult.DynCaptError:m.print("Tablet Error");break;case window.sdkPtr.DynamicCaptureResult.DynCaptNotLicensed:m.print("No valid Signature Capture licence found");break;default:m.print("Capture Error "+S)}},m.onRenderBitmap=($,F,S)=>{if(m.callbackStatusOK("Signature Render Bitmap",S)){m.print("base64_image:>"+F+"<"),m.HTMLTagIds.imageData="data:image/png;base64,"+F;let K=new Image;K.src="data:image/png;base64,"+F,console.log({imgValue:"data:image/png;base64,"+F}),m.HTMLTagIds.emitValue("data:image/png;base64,"+F),null==m.HTMLTagIds.imageBox.firstChild?m.HTMLTagIds.imageBox.appendChild(K):m.HTMLTagIds.imageBox.replaceChild(K,m.HTMLTagIds.imageBox.firstChild)}},m.onGetSigText=($,F,S)=>{m.callbackStatusOK("Signature Render Bitmap",S)&&(m.HTMLTagIds.textSig.value=F,m.HTMLTagIds.imageText=F)},m.GetHash=($,F)=>{m.callbackFunc=F,m.print("Creating hash:"),$.Clear(m.onClear)},m.onClear=($,F)=>{m.callbackStatusOK("Hash Clear",F)&&$.PutType(window.sdkPtr.HashType.HashMD5,m.onPutType)},m.onPutType=($,F)=>{if(m.callbackStatusOK("Hash PutType",F)){var S=new window.sdkPtr.Variant;S.Set(m.HTMLTagIds.firstName.value),console.log({onPUtVname:S}),$.Add(S,m.onAddFname)}},m.onAddFname=($,F)=>{m.callbackStatusOK("Hash Add",F)&&m.callbackFunc()},m.onAddLname=($,F)=>{m.callbackStatusOK("Hash Add",F)&&m.callbackFunc()},m.\u0275fac=function(F){return new(F||m)},m.\u0275cmp=E.Xpm({type:m,selectors:[["btn-capture"]],inputs:{reason:"reason"},decls:1,vars:0,consts:[["type","button","value","Capture","title","Starts signature capture",2,"height","10mm","width","35mm",3,"click"]],template:function(F,S){1&F&&(E.TgZ(0,"input",0),E.NdJ("click",function(){return S.capturesig()}),E.qZA())},encapsulation:2})},98692:(_e,re,A)=>{A.d(re,{n:()=>e});var t=A(64537);let e=(()=>{class E{constructor($){this.el=$}onKeyDown($){let F=$;if(this.OnlyNumber){if(-1!==[46,8,9,27,13,110].indexOf(F.keyCode)||190==F.keyCode&&!1===F.shiftKey||65==F.keyCode&&!0===F.ctrlKey||67==F.keyCode&&!0===F.ctrlKey||88==F.keyCode&&!0===F.ctrlKey||F.keyCode>=35&&F.keyCode<=39)return;(F.shiftKey||F.keyCode<48||F.keyCode>57)&&(F.keyCode<96||F.keyCode>105)&&F.preventDefault()}}}return E.\u0275fac=function($){return new($||E)(t.Y36(t.SBq))},E.\u0275dir=t.lG2({type:E,selectors:[["","OnlyNumber",""]],hostBindings:function($,F){1&$&&t.NdJ("keydown",function(K){return F.onKeyDown(K)})},inputs:{OnlyNumber:"OnlyNumber"}}),E})()},79700:(_e,re,A)=>{A.d(re,{w:()=>$});var t=A(42326),e=A(64537),E=A(87584),m=A(7976);let $=(()=>{class F{constructor(K,C){this._trnMainService=K,this.router=C}transform(K,C){return this.ShowProductInsertTableColumns(K,C)}ShowProductInsertTableColumns(K,C){var u=this._trnMainService.TrnMainObj.VoucherType;let V={};null!=this._trnMainService.TrnMainObj.ProdList&&(V=this._trnMainService.TrnMainObj.ProdList[C]);let w=!1;switch(K){case"BATCH_HEADER":if("self-billing"==this._trnMainService.activeurlpath)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;if((u===t.Km.StockIssue||u===t.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableProperExpTracking)return!0;(u===t.Km.BranchTransferOut&&2==this._trnMainService.userSetting.EnableBatch||(u===t.Km.PerformaSalesInvoice||u==t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||u===t.Km.Purchase||u===t.Km.OpeningStockBalance||u===t.Km.ProductionEntry||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.TaxInvoice||u===t.Km.TaxInvoiceCancel||u===t.Km.CreditNote||u===t.Km.DebitNote)&&(w=!0);break;case"MENUCODE_HEADER":if(1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(u===t.Km.TaxInvoice||u===t.Km.CreditNote||u===t.Km.ReverseCreditNote||u===t.Km.Sales||u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation))return!1;(u===t.Km.Purchase||u===t.Km.ReversePurchase||u===t.Km.DebitNote||u===t.Km.OpeningStockBalance||u===t.Km.PurchaseOrder||u===t.Km.StockIssue||u===t.Km.StockIssueReturn||u===t.Km.SalesOrder||u==t.Km.BranchTransferIn||u==t.Km.BranchTransferOut||u==t.Km.GoodsReceived||u==t.Km.ProductionEntry||u==t.Km.Stockadjustment||u==t.Km.RequisitionApproval||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"BARCODE_HEADER":if("self-billing"==this._trnMainService.activeurlpath||0==this._trnMainService.userSetting.GblBarcodeWiseBilling)return!1;(u===t.Km.TaxInvoice||u===t.Km.CreditNote||u===t.Km.ReverseCreditNote||u===t.Km.ReverseTaxInvoice||u===t.Km.Sales||u===t.Km.PerformaSalesInvoice||u==t.Km.CancelProforma||u==t.Km.StockIssue||u===t.Km.StockIssueReturn||u==t.Km.BranchTransferOut||u==t.Km.BranchTransferIn||u==t.Km.ProductionEntry||u==t.Km.DebitNote||u===t.Km.StockSettlement||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"BATCH_EDITABLE":if("self-billing"==this._trnMainService.activeurlpath)return!0;if(0==this._trnMainService.userSetting.EnableBatch||1==this._trnMainService.userSetting.EnableBatch&&0===this._trnMainService.userSetting.EnableProperExpTracking||"add-membership-sales-invoice"==this._trnMainService.activeurlpath||"StockSettlementEntry"==this._trnMainService.activeurlpath)return!1;if((u===t.Km.StockIssue||u===t.Km.BranchTransferOut||u===t.Km.ProductionEntry)&&1===this._trnMainService.userSetting.EnableProperExpTracking||(((u===t.Km.StockIssue||u===t.Km.ProductionEntry||u===t.Km.BranchTransferOut)&&2==this._trnMainService.userSetting.EnableBatch||(u===t.Km.PerformaSalesInvoice||u==t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||u===t.Km.Sales||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.Purchase||u===t.Km.OpeningStockBalance||u===t.Km.DebitNote||u===t.Km.CreditNote||u===t.Km.ReverseCreditNote||u===t.Km.ReverseProductionEntry)&&(w=!0),(u===t.Km.StockIssue||u===t.Km.BranchTransferOut)&&1===this._trnMainService.userSetting.EnableProperExpTracking))return!0;((u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma)&&1==this._trnMainService.userSetting.INVBASEPROFORMA||u===t.Km.Sales||u===t.Km.StockSettlement||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.DebitNote||u===t.Km.CreditNote)&&(w=!0),"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&(w=!0);break;case"BATCH_NONEDITABLE":((u===t.Km.OpeningStockBalance||u===t.Km.PerformaSalesInvoice||u===t.Km.Purchase||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.StockIssueReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.Quotation||u===t.Km.GoodsReceived)&&!1===V.inputMode||u===t.Km.CreditNote||u===t.Km.DebitNote||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"MFGDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(u===t.Km.OpeningStockBalance||u===t.Km.Purchase||u===t.Km.DebitNote||u===t.Km.PurchaseReturn||u===t.Km.ReversePurchase||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.StockIssueReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.GoodsReceived||u===t.Km.ProductionEntry||u===t.Km.BranchTransferIn||u===t.Km.Repack||u===t.Km.BranchTransferOut||u===t.Km.ReverseCreditNote||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"MFGDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(u===t.Km.Purchase||u===t.Km.OpeningStockBalance||u===t.Km.ReversePurchase||u===t.Km.StockIssueReturn||u===t.Km.GoodsReceived||u===t.Km.ProductionEntry||u===t.Km.BranchTransferIn||u===t.Km.Repack||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"MFGDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(u===t.Km.SalesReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseReturn||u===t.Km.DebitNote||u===t.Km.BranchTransferOut||u===t.Km.StockIssue)&&(w=!0);break;case"EXPDATE_HEADER":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.DebitNote||u===t.Km.TaxInvoice||u===t.Km.ReversePurchase||u===t.Km.SalesReturn||u===t.Km.StockIssueReturn||u===t.Km.StockIssue||u===t.Km.TaxInvoiceCancel||u===t.Km.CreditNote||u===t.Km.Purchase||u===t.Km.OpeningStockBalance||u===t.Km.GoodsReceived||u===t.Km.ProductionEntry||u===t.Km.BranchTransferIn||u===t.Km.Repack||u===t.Km.BranchTransferOut||u===t.Km.ReverseCreditNote||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"EXPDATE_EDITABLE":if(0==this._trnMainService.userSetting.EnableBatch)return!1;(u===t.Km.Purchase||u===t.Km.OpeningStockBalance||u===t.Km.StockIssueReturn||u===t.Km.ReversePurchase||u===t.Km.GoodsReceived||u===t.Km.ProductionEntry||u===t.Km.BranchTransferIn||u===t.Km.Repack||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"EXPDATE_NONEDITABLE":if(0==this._trnMainService.userSetting.EnableBatch||"add-membership-sales-invoice"==this._trnMainService.activeurlpath)return!1;(u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.DebitNote||u===t.Km.StockIssue||u===t.Km.BranchTransferOut||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseReturn||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.CreditNote||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"QUANTITY_EDITABLE":(u===t.Km.OpeningStockBalance||u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.PurchaseReturn||u===t.Km.ReversePurchase||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.StockIssueReturn||u===t.Km.StockSettlement||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.PurchaseOrder||u===t.Km.SalesOrder||u===t.Km.CreditNote||u===t.Km.DebitNote||u===t.Km.Purchase||u===t.Km.BranchTransferIn||u===t.Km.BranchTransferOut||u===t.Km.Quotation||u===t.Km.Repack||u===t.Km.RequisitionEntry||u===t.Km.GoodsReceived||u==t.Km.ProductionEntry||u==t.Km.BatchAdjustment||u===t.Km.ReverseCreditNote||u==t.Km.Stockadjustment||u===t.Km.RequisitionApproval||u===t.Km.ReverseProductionEntry)&&(w=!0);break;case"QUANTITY_NONEDITABLE":(u===t.Km.OpeningStockBalance||u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Purchase||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.StockIssueReturn||u===t.Km.StockSettlement||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.PurchaseOrder||u===t.Km.SalesOrder||u===t.Km.PurchaseOrderCancel||u===t.Km.CreditNote||u===t.Km.ReverseCreditNote||u===t.Km.DebitNote||u===t.Km.Quotation||u===t.Km.GoodsReceived||this._trnMainService.showPerformaApproveReject)&&!1===V.inputMode&&(w=!0);break;case"MRP_NONEDITABLE":default:w=!0;break;case"MRP_EDITABLE":case"COSTPRICE2_EDITABLE":case"ACTUAL_TRAN_PRICE_EDITABLE":case"SELLINGPRICE2_EDITABLE":case"GST_PER_NONEDITABLE_EXCLUSIVE_FOR_RETAILER":break;case"COSTPRICE_HEADER":u===t.Km.TaxInvoice&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||u===t.Km.TaxInvoiceCancel&&("retailer"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"ak"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"ck"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase()||"pms"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE.toLowerCase())||u===t.Km.CreditNote||u===t.Km.OpeningStockBalance||u===t.Km.StockSettlement||u===t.Km.StockIssue||u===t.Km.ReverseCreditNote||u===t.Km.ReverseTaxInvoice||(w=!0);break;case"COSTPRICE2_NONEDITABLE":(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation||u===t.Km.Sales||u===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||u===t.Km.SalesReturn||u===t.Km.PurchaseOrderCancel||u===t.Km.SalesOrder)&&(w=!0);break;case"ACTUAL_TRAN_PRICE_NONEDITABLE":(u===t.Km.PurchaseOrder||u===t.Km.PurchaseOrderCancel||u===t.Km.SalesOrder||u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation||u===t.Km.Purchase||u===t.Km.PurchaseReturn||u===t.Km.DebitNote||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.GoodsReceived||u===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE))&&(w=!0);break;case"SELLINGPRICE2_NONEDITABLE":(u===t.Km.PurchaseOrder||u===t.Km.Purchase||u==t.Km.GoodsReceived)&&(w=!0);break;case"SELLING_HEADER":(u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation||u===t.Km.Purchase||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.GoodsReceived||u===t.Km.TaxInvoice&&("distributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE||"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE)||u===t.Km.PurchaseOrder||u===t.Km.SalesOrder)&&(w=!0);break;case"DISCOUNT_PER_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(w=!1);(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||u===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.PurchaseReturn||u===t.Km.ReversePurchase||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.DebitNote||u===t.Km.CreditNote||u===t.Km.GoodsReceived||u===t.Km.SalesOrder||u===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"DISCOUNT_PER_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(w=!1);(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||u===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.ReversePurchase||u===t.Km.SalesReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.DebitNote||u===t.Km.CreditNote||u===t.Km.GoodsReceived||u===t.Km.SalesOrder||u===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"DISCOUNT_AMT_HEADER":if("self-billing"===this._trnMainService.activeurlpath)return void(w=!1);(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation||u===t.Km.PurchaseReturn||u===t.Km.ReversePurchase||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.TaxInvoiceCancel||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.DebitNote||u===t.Km.CreditNote||u===t.Km.GoodsReceived||u===t.Km.SalesOrder||u===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"DISCOUNT_AMT_EDITABLE":if("self-billing"===this._trnMainService.activeurlpath)return void(w=!1);(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation||u===t.Km.PurchaseReturn||u===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u==t.Km.GoodsReceived||u===t.Km.Sales||u===t.Km.ReversePurchase||u===t.Km.SalesReturn||u===t.Km.DebitNote||u===t.Km.CreditNote||u===t.Km.SalesOrder||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"DISCOUNT_AMT_EDITABLE_VATINCLU":w=!1;break;case"SUPPLIER_HEADER":case"SUPPLIER_EDITABLE":u===t.Km.OpeningStockBalance&&(w=!0);break;case"GST_PER_HEADER":(u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation||u===t.Km.Purchase||u===t.Km.GoodsReceived||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.TaxInvoice||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseOrder||u===t.Km.PurchaseOrderCancel||u===t.Km.SalesOrder)&&(w=!0);break;case"GST_PER_NONEDITABLE":(u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation||u===t.Km.Purchase||u===t.Km.GoodsReceived||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.TaxInvoice||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseOrder||u===t.Km.SalesOrder)&&(w=!0);break;case"GST_AMT_HEADER":(u===t.Km.PerformaSalesInvoice||u===t.Km.Quotation||u===t.Km.Purchase||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.SalesReturn||u===t.Km.StockIssue||u===t.Km.TaxInvoice||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseOrder||u===t.Km.PurchaseOrderCancel||u===t.Km.SalesOrder||u===t.Km.GoodsReceived)&&(w=!0);break;case"GST_AMT_NONEDITABLE":(u===t.Km.PerformaSalesInvoice||u===t.Km.CancelProforma||u===t.Km.Quotation&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||u===t.Km.Purchase&&"IMPORT_PURCHASE"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.PurchaseReturn||u===t.Km.Sales||u===t.Km.ReversePurchase||u===t.Km.SalesReturn||u===t.Km.TaxInvoice||u===t.Km.ReverseTaxInvoice||u===t.Km.TaxInvoiceCancel||u===t.Km.PurchaseOrderCancel||u===t.Km.SalesOrder&&1==this._trnMainService.userSetting.ENABLE_VTEXCLUDINGRATE_INSORDER||u===t.Km.CreditNote||u===t.Km.DebitNote||u===t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"!=this._trnMainService.TrnMainObj.AdditionalObj.tag||u===t.Km.GoodsReceived||u===t.Km.ReverseCreditNote)&&(w=!0);break;case"UNIT_EDITABLE":w=u===t.Km.TaxInvoice||u===t.Km.Purchase||u===t.Km.GoodsReceived||u===t.Km.DebitNote||u===t.Km.Stockadjustment||u!=t.Km.Repack;break;case"UNIT_NONEDITABLE":(u===t.Km.CreditNote||u===t.Km.DebitNote||u===t.Km.ReverseCreditNote)&&(w=!0),"VIEW"===this._trnMainService.TrnMainObj.Mode&&(w=!0);break;case"CONFACTOR":this._trnMainService.userSetting.showConFactorInGrid&&(u===t.Km.BranchTransferOut||u===t.Km.BranchTransferIn||u===t.Km.RequisitionApproval&&0==this._trnMainService.userSetting.LogBasedRequisitionApproval)&&(w=!0);break;case"RATE":"superdistributor"===this._trnMainService.userProfile.CompanyInfo.ORG_TYPE&&(w=!0);break;case"DISCOUNT_IMPORTPURCHASE":(u==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||u==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag)&&(w=!0);break;case"FCRATE_HEADER":case"FCRATE_EDITABLE":(u==t.Km.Purchase&&"IMPORT_PURCHASE"==this._trnMainService.TrnMainObj.AdditionalObj.tag||u==t.Km.PurchaseOrder&&"IMPORT_PURCHASE_ORDER"==this._trnMainService.TrnMainObj.AdditionalObj.tag||u==t.Km.TaxInvoice&&"export-sales-invoice"==this._trnMainService.activeurlpath)&&(w=!0);break;case"ECSAmount":1==this._trnMainService.userSetting.ENABLE_ECS?(u===t.Km.Purchase||u===t.Km.GoodsReceived||u==t.Km.DebitNote)&&(w=!0):2==this._trnMainService.userSetting.ENABLE_ECS?(u==t.Km.TaxInvoice||u==t.Km.CreditNote)&&(w=!0):3==this._trnMainService.userSetting.ENABLE_ECS&&(u===t.Km.Purchase||u===t.Km.GoodsReceived||u===t.Km.TaxInvoice||u==t.Km.CreditNote||u==t.Km.DebitNote)&&(w=!0)}return w}}return F.\u0275fac=function(K){return new(K||F)(e.Y36(E.p,16),e.Y36(m.F0,16))},F.\u0275pipe=e.Yjl({name:"activeColumn",type:F,pure:!0}),F})()},62490:(_e,re,A)=>{A.d(re,{VO:()=>m,gB:()=>e});var t=A(64537);let e=(()=>{class ${transform(S,K,C){return null==K||null==K||""==K||null==C||null==C||""==C?S:C?S.filter(u=>null!=u[K]&&null!=u[K]&&-1!==u[K].toLowerCase().indexOf(C.toLowerCase())):S}}return $.\u0275fac=function(S){return new(S||$)},$.\u0275pipe=t.Yjl({name:"filter",type:$,pure:!1}),$})(),m=(()=>{class ${transform(S,K){let C=[];for(let u in S)C.push(u);return C}}return $.\u0275fac=function(S){return new(S||$)},$.\u0275pipe=t.Yjl({name:"keys",type:$,pure:!0}),$})()},65171:(_e,re,A)=>{A.d(re,{j:()=>N});var t=A(64537),e=A(53074),E=A(87584),m=A(88692),$=A(20092),F=A(28096);function S(O,j){1&O&&(t.TgZ(0,"th"),t._uU(1,"BATCHID"),t.qZA())}function K(O,j){1&O&&(t.TgZ(0,"th"),t._uU(1,"Barcode"),t.qZA())}function C(O,j){1&O&&(t.TgZ(0,"th",11),t._uU(1,"S-Price(Exc VAT)"),t.qZA())}function u(O,j){1&O&&(t.TgZ(0,"th",11),t._uU(1,"S-Price(Inc VAT)"),t.qZA())}function V(O,j){if(1&O&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&O){const x=t.oxw().$implicit;t.xp6(1),t.Oqu(x.BATCHID)}}function w(O,j){if(1&O&&(t.TgZ(0,"td",17),t._uU(1),t.qZA()),2&O){const x=t.oxw().$implicit;t.xp6(1),t.Oqu(x.BC)}}function W(O,j){if(1&O&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&O){const x=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,x.SELLRATEBEFORETAX,"1.2-2"))}}function Y(O,j){if(1&O&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&O){const x=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,x.MRP,"1.2-2"))}}function B(O,j){if(1&O){const x=t.EpF();t.TgZ(0,"tr",14),t.NdJ("click",function(){const L=t.CHM(x).index,D=t.oxw();return t.KtG(D.RowClickEvent(L))})("dblclick",function(){const L=t.CHM(x).$implicit,D=t.oxw();return t.KtG(D.dblClickBatchObj(L))}),t.TgZ(1,"td",15),t._uU(2),t.qZA(),t.YNc(3,V,2,1,"td",16),t.TgZ(4,"td",17),t._uU(5),t.qZA(),t.YNc(6,w,2,1,"td",16),t.TgZ(7,"td",17),t._uU(8),t.qZA(),t.TgZ(9,"td",18),t._uU(10),t.ALo(11,"number"),t.qZA(),t.YNc(12,W,3,4,"td",19),t.YNc(13,Y,3,4,"td",19),t.qZA()}if(2&O){const x=j.$implicit,g=j.index,y=t.oxw();t.ekj("selected-row",g===y.selectedRowIndex),t.xp6(2),t.Oqu(g+1),t.xp6(1),t.Q6J("ngIf",1==y._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(2),t.Oqu(x.BATCHCODE),t.xp6(1),t.Q6J("ngIf",1==y.HASVARIANT),t.xp6(2),t.Oqu(x.STOCK),t.xp6(2),t.Oqu(t.xi3(11,10,x.LANDINGCOST,"1.2-2")),t.xp6(2),t.Q6J("ngIf",89!=y._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89!=y._trnMainService.TrnMainObj.VoucherType)}}let N=(()=>{class O{constructor(x,g){this.masterRepo=x,this._trnMainService=g,this.Blist=[],this.BatchClosedEmit=new t.vpe,this.dbClickEvent=new t.vpe,this.showPopup=!1}ngOnInit(){console.log("batch popup shown",this.Blist)}RowClickEvent(x){this.selectedRowIndex=x}dblClickBatchObj(x){this.dbClickEvent.emit(x)}itemBatchClosed(){this.BatchClosedEmit.emit()}updown(x){null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===x.code?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>this.Blist.length-1&&(this.selectedRowIndex=this.Blist.length-1)):"ArrowUp"===x.code&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===x.code||"NumpadEnter"==x.code?null!=this.selectedRowIndex&&null!=this.Blist[this.selectedRowIndex]&&this.dblClickBatchObj(this.Blist[this.selectedRowIndex]):"Escape"===x.code&&this.itemBatchClosed()}}return O.\u0275fac=function(x){return new(x||O)(t.Y36(e.P),t.Y36(E.p))},O.\u0275cmp=t.Xpm({type:O,selectors:[["itemwisebatch"]],hostBindings:function(x,g){1&x&&t.NdJ("keydown",function(L){return g.updown(L)},!1,t.evT)},inputs:{Blist:"Blist",HASVARIANT:"HASVARIANT"},outputs:{BatchClosedEmit:"BatchClosedEmit",dbClickEvent:"dbClickEvent"},decls:27,vars:9,consts:[[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[2,"float","right"],["type","search","autocomplete","off","placeholder","Search..","name","filter","id","filter",2,"height","1.5rem","font-size","13px","width","755px",3,"ngModel","ngModelChange"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],[4,"ngIf"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["aria-disabled","true","class","highlight",3,"selected-row","click","dblclick",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight",3,"click","dblclick"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],["style","border-bottom: 1px solid #ddd;height: 23px;width:20%",4,"ngIf"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"],[2,"border-bottom","1px solid #ddd","height","23px","width","15%","text-align","right"],["style","border-bottom: 1px solid #ddd;height: 23px;width:15%;text-align: right;",4,"ngIf"]],template:function(x,g){1&x&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),t._uU(4,"Item Wise Batch List"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return g.itemBatchClosed()}),t.TgZ(6,"span",5),t._uU(7,"\xd7"),t.qZA()()(),t.TgZ(8,"div",6)(9,"input",7),t.NdJ("ngModelChange",function(L){return g.filter=L}),t.qZA()(),t.TgZ(10,"table",8)(11,"tr",9)(12,"th"),t._uU(13,"Sn."),t.qZA(),t.YNc(14,S,2,0,"th",10),t.TgZ(15,"th"),t._uU(16,"BATCH"),t.qZA(),t.YNc(17,K,2,0,"th",10),t.TgZ(18,"th"),t._uU(19,"STOCK"),t.qZA(),t.TgZ(20,"th",11),t._uU(21,"P-Rate"),t.qZA(),t.YNc(22,C,2,0,"th",12),t.YNc(23,u,2,0,"th",12),t.qZA(),t.TgZ(24,"tbody"),t.YNc(25,B,14,13,"tr",13),t.ALo(26,"searchData"),t.qZA()()()()),2&x&&(t.xp6(9),t.Q6J("ngModel",g.filter),t.xp6(5),t.Q6J("ngIf",1==g._trnMainService.userSetting.EnableBatchIdInAdjustment),t.xp6(3),t.Q6J("ngIf",1==g.HASVARIANT),t.xp6(5),t.Q6J("ngIf",89!=g._trnMainService.TrnMainObj.VoucherType),t.xp6(1),t.Q6J("ngIf",89!=g._trnMainService.TrnMainObj.VoucherType),t.xp6(2),t.Q6J("ngForOf",t.xi3(26,6,g.Blist,g.filter)))},dependencies:[m.sg,m.O5,$.Fj,$.JJ,$.On,m.JJ,F.C],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }\n \n   .unitLabel[_ngcontent-%COMP%]{\n     width: auto;\n     font-size: 14px;\n     margin-left: 5px;\n   }"]}),O})()},82484:(_e,re,A)=>{A.d(re,{q:()=>K});var t=A(64537),e=A(53074),E=A(87584),m=A(88692);function $(C,u){if(1&C){const V=t.EpF();t.TgZ(0,"tr",12),t.NdJ("dblclick",function(){const Y=t.CHM(V).$implicit,B=t.oxw(2);return t.KtG(B.doubleClick(Y))})("click",function(){const Y=t.CHM(V).index,B=t.oxw(2);return t.KtG(B.singleClick(Y))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()()}if(2&C){const V=u.$implicit,w=u.index,W=t.oxw(2);t.ekj("selected-row",W.selectedRowIndex==w),t.xp6(2),t.hij("",V.DESCA," "),t.xp6(2),t.hij("",V.MENUCODE," "),t.xp6(2),t.hij("",V.STOCK," "),t.xp6(2),t.hij("",V.MRP," ")}}function F(C,u){if(1&C&&(t.TgZ(0,"tbody"),t.YNc(1,$,9,6,"tr",11),t.qZA()),2&C){const V=t.oxw();t.xp6(1),t.Q6J("ngForOf",V._trnMainService.ItemsListForMultiItemBarcode)}}function S(C,u){if(1&C&&t._UZ(0,"div",13),2&C){const V=t.oxw();t.Q6J("innerHTML",V.summary,t.oJD)}}let K=(()=>{class C{constructor(V,w){this.masterService=V,this._trnMainService=w,this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){}hide(){this.masterService.PlistTitle=""}doubleClick(V){this.masterService.masterPostmethod("/getbatchWithAlternateUnitList",V).subscribe(w=>{if("ok"==w.status){let W=JSON.parse(w.result),Y=this._trnMainService.TrnMainObj.ProdList.findIndex(B=>B.MCODE==W.MCODE);if(Y<0)this._trnMainService.addRow(),this._trnMainService.assignValueToProdFromBarcode(W,this._trnMainService.TrnMainObj.ProdList.findIndex(B=>null==B.MCODE));else{let B=this._trnMainService.TrnMainObj.ProdList[Y];this._trnMainService.TrnMainObj.ProdList[Y].Quantity+=1,this._trnMainService.RealQuantitySet(Y,B.CONFACTOR),this._trnMainService.ReCalculateBillWithNormal()}this.masterService.PlistTitle="",document.getElementById("itembarcode").focus()}else alert(w.result)},()=>{})}singleClick(V){this.selectedRowIndex=V,this.summary=this._trnMainService.ItemsListForMultiItemBarcode[V].itemSummary}updown(V){"ArrowDown"==V.code&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length-1?(V.preventDefault(),this.selectedRowIndex++,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"ArrowUp"==V.code&&this.selectedRowIndex-1>-1?(V.preventDefault(),this.selectedRowIndex--,null!=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]&&(this.summary=this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex].itemSummary)):"Enter"==V.code&&this.selectedRowIndex>=0&&this.selectedRowIndex<this._trnMainService.ItemsListForMultiItemBarcode.length?(V.preventDefault(),this.doubleClick(this._trnMainService.ItemsListForMultiItemBarcode[this.selectedRowIndex]),this.hide()):"Escape"==V.code&&(V.preventDefault(),this.hide())}}return C.\u0275fac=function(V){return new(V||C)(t.Y36(e.P),t.Y36(E.p))},C.\u0275cmp=t.Xpm({type:C,selectors:[["PItemList"]],hostBindings:function(V,w){1&V&&t.NdJ("keydown",function(Y){return w.updown(Y)},!1,t.evT)},decls:24,vars:2,consts:[[1,"modal-sticky",2,"display","block","padding","0px","height","400px","margin-bottom","60px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#7ed0ff"],[4,"ngIf"],["style","margin-left: 25px ",3,"innerHTML",4,"ngIf"],["class","highlight","title","double click for detail view",3,"selected-row","dblclick","click",4,"ngFor","ngForOf"],["title","double click for detail view",1,"highlight",3,"dblclick","click"],[2,"margin-left","25px",3,"innerHTML"]],template:function(V,w){1&V&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div")(4,"div",2)(5,"button",3),t.NdJ("click",function(){return w.hide()}),t.TgZ(6,"span",4),t._uU(7,"\xd7"),t.qZA()(),t.TgZ(8,"h4",5),t._uU(9," ITEMS "),t.qZA()(),t.TgZ(10,"div",6)(11,"table",7)(12,"thead")(13,"tr",8)(14,"th"),t._uU(15," DESCRIPTION"),t.qZA(),t.TgZ(16,"th"),t._uU(17," CODE"),t.qZA(),t.TgZ(18,"th"),t._uU(19," STOCK"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"MRP"),t.qZA()()(),t.YNc(22,F,2,1,"tbody",9),t.qZA()()(),t.YNc(23,S,1,1,"div",10),t.qZA()()()),2&V&&(t.xp6(22),t.Q6J("ngIf",w._trnMainService.ItemsListForMultiItemBarcode.length),t.xp6(1),t.Q6J("ngIf",w.summary))},dependencies:[m.sg,m.O5],styles:[".modal-content[_ngcontent-%COMP%] {\n          padding: 1px;\n          margin: 0px;\n          float: right;\n        }\n        .table-scroll[_ngcontent-%COMP%] {\n          overflow-y: scroll;\n          overflow-x: hidden;\n        }\n      \n        tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]:hover {\n          background-color: #f3f5f4;\n          cursor: pointer;\n        }\n        tr[_ngcontent-%COMP%] {\n          font-size: 11px;\n        }\n        .selected-row[_ngcontent-%COMP%] {\n          background-color: #ced6d3 !important;\n        }\n      \n        .table[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > td[_ngcontent-%COMP%]:first-child {\n          text-align: left !important;\n          padding: 0px 0px 0px 11px !important;\n        } \n      \n        .modal-content[_ngcontent-%COMP%]{\n          box-shadow: -10px 0px 10px 1px #aaaaaa;\n        }\n      \n        .modal-content-main-area[_ngcontent-%COMP%] { \n          max-height: 100%;\n          height: 100%;\n          overflow: auto;\n          overflow-x: hidden;\n        } \n      \n        .modal-content-summary-area[_ngcontent-%COMP%] {\n          max-height: 20%;\n          height: 20%;\n          overflow: auto;\n          overflow-x: hidden;\n        }"]}),C})()},59963:(_e,re,A)=>{A.d(re,{H:()=>K});var t=A(64537),e=A(53074),E=A(88692),m=A(20092),$=A(62490);const F=["inputBox"];function S(C,u){if(1&C){const V=t.EpF();t.TgZ(0,"tbody",12),t.NdJ("dblclick",function(){const W=t.CHM(V),Y=W.$implicit,B=W.index,N=t.oxw();return t.KtG(N.dblClickItemList(Y,B))}),t.TgZ(1,"tr",13)(2,"td",14),t._uU(3),t.qZA(),t.TgZ(4,"td",15),t._uU(5),t.qZA(),t.TgZ(6,"td",15),t._uU(7),t.qZA(),t.TgZ(8,"td",15),t._uU(9),t.qZA()()()}if(2&C){const V=u.$implicit,w=u.index,W=t.oxw();t.ekj("highlighted",w===W.selectedRowIndex),t.xp6(3),t.Oqu(V.ACNAME),t.xp6(2),t.Oqu(V.ACCODE),t.xp6(2),t.Oqu(V.ADDRESS),t.xp6(2),t.Oqu(V.EMAIL)}}let K=(()=>{class C{constructor(V){this.masterService=V,this.dbClickEvent=new t.vpe,this.partyCloseClick=new t.vpe,this.partyList=[],this.selectedRowIndex=0}ngAfterViewInit(){}ngOnInit(){setTimeout(()=>{this.setFocus()},50)}SearchList(V){}setFocus(){this._el.nativeElement.focus()}dblClickItemList(V,w){this.selectedRowIndex=w,this.dbClickEvent.emit(V)}partyPopClosed(){this.partyCloseClick.emit()}onKeydown(V){return this.setFocus(),null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===V.key?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>9&&(this.selectedRowIndex=9)):"ArrowUp"===V.key&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===V.key?(null!=this.selectedRowIndex&&null!=this.partyList[this.selectedRowIndex]&&this.dblClickItemList(this.partyList[this.selectedRowIndex],this.selectedRowIndex),!1):"Delete"===V.key?(this.partyPopClosed(),!1):void 0}}return C.\u0275fac=function(V){return new(V||C)(t.Y36(e.P))},C.\u0275cmp=t.Xpm({type:C,selectors:[["popPartyChoose"]],viewQuery:function(V,w){if(1&V&&t.Gf(F,5),2&V){let W;t.iGM(W=t.CRH())&&(w._el=W.first)}},inputs:{partyList:"partyList"},outputs:{dbClickEvent:"dbClickEvent",partyCloseClick:"partyCloseClick"},decls:24,vars:6,consts:[[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],[1,"col-md-12"],["type","text","id","partysearchpopup","autofocus","",2,"width","100%","/* padding","1px","*/padding-left","0px","margin-left","-13px",3,"ngModel","ngModelChange","keydown"],["inputBox",""],[1,"Table1",2,"padding","0px","margin-left","-12px","margin-top","2px","width","100%"],[2,"background","#7ed0ff"],[2,"width","60%","height","26px"],[3,"highlighted","dblclick",4,"ngFor","ngForOf"],[3,"dblclick"],[1,"highlight"],[2,"padding-top","2px","border-bottom","1px solid #ddd","height","23px"],[2,"border-bottom","1px solid #ddd","height","23px"]],template:function(V,w){1&V&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"button",2),t.NdJ("click",function(){return w.partyPopClosed()}),t.TgZ(4,"span",3),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",4),t._uU(7),t.qZA()(),t.TgZ(8,"div",5)(9,"input",6,7),t.NdJ("ngModelChange",function(Y){return w.filter=Y})("keydown",function(Y){return w.onKeydown(Y)}),t.qZA()(),t.TgZ(11,"div",5)(12,"table",8)(13,"tr",9)(14,"th",10),t._uU(15,"Name"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Code"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Address"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Email"),t.qZA()(),t.YNc(22,S,10,6,"tbody",11),t.ALo(23,"filter"),t.qZA()()()()),2&V&&(t.xp6(7),t.Oqu(w.masterService.partyPopUpHeaderText),t.xp6(2),t.Q6J("ngModel",w.filter),t.xp6(13),t.Q6J("ngForOf",t.xi3(23,3,w.partyList,w.filter)))},dependencies:[E.sg,m.Fj,m.JJ,m.On,$.gB],encapsulation:2}),C})()},86857:(_e,re,A)=>{A.d(re,{l:()=>K});var t=A(64537),e=A(67311),E=A(88692),m=A(20092);function $(C,u){if(1&C){const V=t.EpF();t.TgZ(0,"tr",18),t.NdJ("click",function(){const Y=t.CHM(V).index,B=t.oxw(3);return t.KtG(B.SELECTEDINDEX=Y)}),t.TgZ(1,"th",15)(2,"input",19),t.NdJ("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.BATCH=W)}),t.qZA()(),t.TgZ(3,"th",15)(4,"input",20),t.NdJ("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.ALTUNIT=W)}),t.qZA()(),t.TgZ(5,"th",15)(6,"input",21),t.NdJ("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.INVOICEQTYA=W)}),t.qZA()(),t.TgZ(7,"th",15)(8,"input",21),t.NdJ("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.TOTALOUTWARDSTOCKA=W)}),t.qZA()(),t.TgZ(9,"th",15)(10,"input",21),t.NdJ("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.EDITABLEQTYA=W)}),t.qZA()(),t.TgZ(11,"th",15)(12,"input",22),t.NdJ("change",function(){const Y=t.CHM(V).index,B=t.oxw(3);return t.KtG(B.onChangeAdjustQty(Y))})("ngModelChange",function(W){const B=t.CHM(V).$implicit;return t.KtG(B.ADJUSTQTY=W)}),t.qZA()()()}if(2&C){const V=u.$implicit,w=u.index;t.xp6(2),t.MGl("id","batch",w,""),t.Q6J("disabled",!0)("ngModel",V.BATCH),t.xp6(2),t.MGl("id","altunit",w,""),t.Q6J("disabled",!0)("ngModel",V.ALTUNIT),t.xp6(2),t.MGl("id","invoiceqty",w,""),t.Q6J("disabled",!0)("ngModel",V.INVOICEQTYA),t.xp6(2),t.MGl("id","invoiceqty",w,""),t.Q6J("disabled",!0)("ngModel",V.TOTALOUTWARDSTOCKA),t.xp6(2),t.MGl("id","invoiceqty",w,""),t.Q6J("disabled",!0)("ngModel",V.EDITABLEQTYA),t.xp6(2),t.MGl("id","adjustQty",w,""),t.Q6J("disabled",V.isDisabled)("ngModel",V.ADJUSTQTY)}}function F(C,u){if(1&C&&(t.TgZ(0,"div",11)(1,"table",12,13)(3,"thead")(4,"tr",14)(5,"th",15),t._uU(6,"Batch"),t.qZA(),t.TgZ(7,"th",15),t._uU(8,"Unit"),t.qZA(),t.TgZ(9,"th",15),t._uU(10,"Issue Qty"),t.qZA(),t.TgZ(11,"th",15),t._uU(12,"Transaction Qty"),t.qZA(),t.TgZ(13,"th",15),t._uU(14,"Editable Qty"),t.qZA(),t.TgZ(15,"th",15),t._uU(16,"Edit Qty"),t.qZA()()(),t.TgZ(17,"tbody",16),t.YNc(18,$,13,18,"tr",17),t.qZA()()()),2&C){const V=t.oxw(2);t.xp6(18),t.Q6J("ngForOf",V.BatchWiseEditList)}}function S(C,u){if(1&C){const V=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),t.NdJ("click",function(){t.CHM(V);const W=t.oxw();return t.KtG(W.hide())}),t.TgZ(4,"span",5),t._uU(5,"\xd7"),t.qZA()(),t.TgZ(6,"h4",6),t._uU(7),t.qZA()(),t.YNc(8,F,19,1,"div",7),t.TgZ(9,"div",8)(10,"button",9),t.NdJ("click",function(){t.CHM(V);const W=t.oxw();return t.KtG(W.okClicked())}),t._uU(11,"Apply"),t.qZA(),t.TgZ(12,"button",10),t.NdJ("click",function(){t.CHM(V);const W=t.oxw();return t.KtG(W.hide())}),t._uU(13,"cancel"),t.qZA()()()()}if(2&C){const V=t.oxw();t.ekj("modal-sticky-hide",!V.isActive),t.xp6(7),t.hij(" ",V.itemname," "),t.xp6(1),t.Q6J("ngIf",V.BatchWiseEditList&&V.BatchWiseEditList.length)}}let K=(()=>{class C{constructor(V){this.alertService=V,this.itemname="",this.isActive=!1,this.keys=[],this.headerKeys=[],this.matrixItemRows=[],this.SELECTEDINDEX=0,this.onApplyClicked=new t.vpe,this.addRows=w=>{},this.onAttributeChange=(w,W)=>{let Y=this.keys.findIndex(O=>O==w),B=[];for(var N in B=Y>-1?this.keys.slice(Y+1):this.keys,B)if(document.getElementById(B[N]+W))return void setTimeout(()=>document.getElementById(B[N]+W).focus())},this.okClicked=()=>{this.validateEditedQty()&&(this.onApplyClicked.emit(this.BatchWiseEditList),this.hide())},this.show=()=>{this.isActive=!0,setTimeout(()=>{this.onAttributeChange("NONE",0)},0)},this.hide=()=>{this.isActive=!1,this.keys=[],this.matrixItemRows=[]},this.calculateUnitWiseQty()}ngOnInit(){}calculateUnitWiseQty(){console.log("new",this.BatchWiseEditList)}ngOnChanges(V){this.BatchWiseEditList=V.BatchWiseEditList.currentValue,this.BatchWiseEditList&&this.BatchWiseEditList.length&&(this.BatchWiseEditList=this.BatchWiseEditList.filter(w=>w.INVOICEQTY>0),this.BatchWiseEditList.forEach(w=>{w.INVOICEQTY-w.TOTALOUTWARDSTOCK==0&&(w.ADJUSTQTY=w.INVOICEQTY,w.isDisabled=!0)}))}onChangeAdjustQty(V){this.BatchWiseEditList[V].ADJUSTQTY<this.BatchWiseEditList[V].TOTALOUTWARDSTOCK&&this.alertService.info("Quantity Exceed the transaction stock")}validateEditedQty(){return!0}}return C.\u0275fac=function(V){return new(V||C)(t.Y36(e.c))},C.\u0275cmp=t.Xpm({type:C,selectors:[["batch-wise-item-edit"]],inputs:{itemname:"itemname",BatchWiseEditList:"BatchWiseEditList"},outputs:{onApplyClicked:"onApplyClicked"},features:[t.TTD],decls:1,vars:1,consts:[["class","modal-sticky","style","display : block; padding: 0px;  margin-bottom: 25px;",3,"modal-sticky-hide",4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","25px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#ecad79"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-title",2,"text-align","center"],["class","modal-body","style","max-height: 63vh;overflow-y: auto;",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-info","pull-right",3,"click"],[1,"btn","btn-info","pull-right",2,"margin-right","5px",3,"click"],[1,"modal-body",2,"max-height","63vh","overflow-y","auto"],["id","BlueHeaderResizableTable",1,"matrix-table",2,"font-size","12px","width","98%","overflow-x","auto"],["reportHtmlTable",""],[2,"border-bottom","2px solid #e6e6e6","border-top","2px solid #e6e6e6","height","30px","background","silver","color","black"],["width","100px"],[2,"width","fit-content"],["style","border: 1px solid #e6e6e6; max-height: 25px",3,"click",4,"ngFor","ngForOf"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click"],["type","text","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","text","name","altunit",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","ngModelChange"],["type","number","name","batch",3,"id","disabled","ngModel","change","ngModelChange"]],template:function(V,w){1&V&&t.YNc(0,S,14,4,"div",0),2&V&&t.Q6J("ngIf",w.isActive)},dependencies:[E.sg,E.O5,m.Fj,m.wV,m.JJ,m.On],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content-main-area[_ngcontent-%COMP%]{height:75vh!important}.modal-sticky[_ngcontent-%COMP%]{width:70vw im!important}tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{background-color:#f3f5f4;cursor:pointer}tr[_ngcontent-%COMP%]{font-size:11px}.selected-row[_ngcontent-%COMP%]{background-color:#ced6d3!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{line-height:30px!important}.table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{line-height:5px!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child{text-align:left!important;padding:0 0 0 11px!important}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.modal-content-main-area[_ngcontent-%COMP%]{max-height:100%;height:100%;width:100%!important}.modal-content-summary-area[_ngcontent-%COMP%]{max-height:20%;height:20%;overflow:auto;overflow-x:hidden}.ellipsis[_ngcontent-%COMP%]{white-space:nowrap}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#CED6D3;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{height:30px;border:1px solid #dbd7d7}.matrix-table[_ngcontent-%COMP%]   .borderdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15)}.matrix-table[_ngcontent-%COMP%]   .rowdiv[_ngcontent-%COMP%]{border:1px solid rgba(119,119,119,.15);text-align:center}.matrix-table[_ngcontent-%COMP%]   .smalllabeldiv[_ngcontent-%COMP%]{height:16px}.matrix-table[_ngcontent-%COMP%]   .smallHeader[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0}.matrix-table[_ngcontent-%COMP%]   .scrolldiv[_ngcontent-%COMP%]{max-height:75px;padding-right:30px;overflow:auto;scrollbar-3dlight-color:#FFFFFF;scrollbar-arrow-color:#000000;scrollbar-base-color:#FF9999;scrollbar-darkshadow-color:#000000;scrollbar-face-color:#000000;scrollbar-highlight-color:#000000;scrollbar-shadow-color:#0033CC}.matrix-table[_ngcontent-%COMP%]   .multiboxspan[_ngcontent-%COMP%]{font-size:11px;font-weight:700;position:relative;float:left;display:block;margin:2px;border:1px solid silver;border-radius:5px;background-color:#fff0f5}.matrix-table[_ngcontent-%COMP%]   .smallBoldLabel[_ngcontent-%COMP%]{font-size:11px;font-weight:700;margin:0;float:left;color:#222}.matrix-table[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:77vh}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:95%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{flex:0 0 auto;width:calc(100% - .9em)}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{flex:1 1 auto;display:block;overflow-y:scroll}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{width:99.6%}.matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;table-layout:fixed}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#deb887!important;color:#fff}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f2f2f2}.matrix-table[_ngcontent-%COMP%]   .reportTabel[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#fff}.matrix-table[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:11px;font-weight:700;color:#222;width:auto}.matrix-table[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]{margin-bottom:1%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]{margin-top:10%}.matrix-table[_ngcontent-%COMP%]   .modal-content-main-area[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:600;font-size:15px;padding:0 5px}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   .custom-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important;padding-bottom:1px!important}.matrix-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .matrix-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important;height:35px!important;border:none!important}.matrix-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{height:25px!important;padding:0 5px!important}.matrix-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{overflow:hidden}"]}),C})()},11728:(_e,re,A)=>{A.d(re,{q:()=>O});var t=A(64537),e=A(5881),E=A(92886),m=A(67311),$=A(14970),F=A(87584),S=A(53074),K=A(46241),C=A(20092);let u=(()=>{class j{clearSignature(){j.clearSignature()}static onClearSig(g,y){window.sdkPtr.ResponseStatus.OK!=y&&(K.SigCapture.print("ClearSignature() error: "+y),window.sdkPtr.ResponseStatus.INVALID_SESSION==y&&(K.SigCapture.print("Session error. Restarting the session."),e.SessionControl.actionWhenRestarted()))}}return j.clearSignature=()=>{null!=K.SigCapture.HTMLTagIds.imageBox.firstChild&&K.SigCapture.HTMLTagIds.imageBox.removeChild(K.SigCapture.HTMLTagIds.imageBox.firstChild),null!=K.SigCapture.sigObj?K.SigCapture.sigObj.Clear(j.onClearSig):e.SessionControl.actionWhenRestarted()},j.\u0275fac=function(g){return new(g||j)},j.\u0275cmp=t.Xpm({type:j,selectors:[["btn-clear"]],decls:1,vars:0,consts:[["type","button","value","Clear","title","Clears the signature",2,"height","10mm","width","35mm",3,"click"]],template:function(g,y){1&g&&(t.TgZ(0,"input",0),t.NdJ("click",function(){return y.clearSignature()}),t.qZA())},encapsulation:2}),j})();var V=A(88692);function w(j,x){1&j&&(t.TgZ(0,"td",10),t._UZ(1,"btn-capture"),t.qZA())}function W(j,x){1&j&&(t.TgZ(0,"td",10),t._UZ(1,"btn-clear"),t.qZA())}function Y(j,x){if(1&j){const g=t.EpF();t.TgZ(0,"td",10)(1,"input",11),t.NdJ("click",function(){t.CHM(g);const L=t.oxw();return t.KtG(L.onSaveClick())}),t.qZA()()}}let B=(()=>{class j{constructor(g){this._trnMainService=g,this.firstName="",this.lastName="",this.reason="Inventory Assign Approval",this.onImageCaptured=new t.vpe}ngOnChanges(){}ngAfterViewInit(){e.SessionControl.actionWhenRestarted()}onSaveClick(){e.SessionControl.actionWhenRestarted(),K.SigCapture.HTMLTagIds.getImageString$().subscribe(g=>{this.onImageCaptured.emit(g)})}}return j.\u0275fac=function(g){return new(g||j)(t.Y36(F.p))},j.\u0275cmp=t.Xpm({type:j,selectors:[["signature-pad"]],inputs:{firstName:"firstName",lastName:"lastName",reason:"reason"},outputs:{onImageCaptured:"onImageCaptured"},features:[t.TTD],decls:16,vars:5,consts:[[2,"width","100%"],[1,"col-md-12","row","pd0","mb-3","mt-3"],[1,"col-md-10","pd0"],[2,"width","25%"],["id","fname","type","text","autocomplete","off","placeholder","Enter First Name","readonly","",2,"width","50%",3,"ngModel","value","ngModelChange"],[1,"mb-4"],["rowspan","3"],["id","imageBox","ondblclick","displaySignatureDetails(sigObj)","title","Double-click a signature to display its details",1,"boxed",2,"height","45mm","width","70mm","border","1px solid #d3d3d3"],["style","padding: 10px 20px;",4,"ngIf"],["style","padding: 10px 20px",4,"ngIf"],[2,"padding","10px 20px"],["type","button","value","Save",2,"height","10mm","width","35mm",3,"click"]],template:function(g,y){1&g&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),t._uU(4,"From Warehouse :"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(D){return y.firstName=D}),t.qZA()()(),t.TgZ(6,"table",5)(7,"tr")(8,"td",6),t._UZ(9,"div",7),t.qZA(),t.YNc(10,w,2,0,"td",8),t.qZA(),t.TgZ(11,"tr"),t.YNc(12,W,2,0,"td",8),t.qZA(),t.TgZ(13,"tr"),t.YNc(14,Y,2,0,"td",9),t.qZA(),t._UZ(15,"tr"),t.qZA()()),2&g&&(t.xp6(5),t.Q6J("ngModel",y.firstName)("value",y.firstName),t.xp6(5),t.Q6J("ngIf","VIEW"!=y._trnMainService.TrnMainObj.Mode),t.xp6(2),t.Q6J("ngIf","VIEW"!=y._trnMainService.TrnMainObj.Mode),t.xp6(2),t.Q6J("ngIf","VIEW"!=y._trnMainService.TrnMainObj.Mode))},dependencies:[C.Fj,C.JJ,C.On,u,K.SigCapture,V.O5],encapsulation:2}),j})();const N=["fileSelect"];let O=(()=>{class j{constructor(g,y,L,D,J){this.digitalSignatureService=g,this.alertService=y,this.loadingService=L,this._trnMainService=D,this.masterService=J,this.selectedFileNames=[],this.isActive=!1,this.dragging=!1,this.doUploadFile=!0,this.onPopUpClose=new t.vpe,this.onSaveImageCaptured=new t.vpe}onDragOver(g){this.dragging=!0,g.preventDefault()}show(g,y){this.isActive=!0;let L=document.getElementById("imageBox");e.SessionControl.actionWhenRestarted();let D=new Image;"VIEW"==y&&g&&(D.src=g,L.appendChild(D))}hide(){this.isActive=!1}popupClose(){this.onPopUpClose.emit(),this.hide()}ngOnChanges(g){}onImageCaptured(g){g&&(this.onSaveImageCaptured.emit(g),this.hide())}}return j.\u0275fac=function(g){return new(g||j)(t.Y36(E.M),t.Y36(m.c),t.Y36($.V),t.Y36(F.p),t.Y36(S.P))},j.\u0275cmp=t.Xpm({type:j,selectors:[["digital-signature-popup"]],viewQuery:function(g,y){if(1&g&&t.Gf(N,5),2&g){let L;t.iGM(L=t.CRH())&&(y.fileSelect=L.first)}},outputs:{onPopUpClose:"onPopUpClose",onSaveImageCaptured:"onSaveImageCaptured"},features:[t.TTD],decls:11,vars:3,consts:[[1,"modal-sticky",2,"display","block","padding","0px"],[1,"modal-content","modal-content-main-area"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title",2,"text-align","center"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"upload-area","container"],["lastName","","reason","document app",3,"firstName","onImageCaptured"]],template:function(g,y){1&g&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"h5",3),t._uU(5," Digital Signature "),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return y.popupClose()}),t.TgZ(7,"span",5),t._uU(8,"\xd7"),t.qZA()()(),t.TgZ(9,"div",6)(10,"signature-pad",7),t.NdJ("onImageCaptured",function(D){return y.onImageCaptured(D)}),t.qZA()()()()()),2&g&&(t.ekj("modal-sticky-hide",!y.isActive),t.xp6(10),t.Q6J("firstName",y._trnMainService.TrnMainObj.BILLTO))},dependencies:[B],styles:[".modal-content[_ngcontent-%COMP%]{padding:1px;margin:0;float:right}.modal-content[_ngcontent-%COMP%]{box-shadow:-10px 0 10px 1px #aaa}.form-control[_ngcontent-%COMP%]{height:35px}.modal-sticky[_ngcontent-%COMP%]{position:fixed;top:330px;right:20px;width:40%;z-index:9999999}"]}),j})()},14173:(_e,re,A)=>{A.d(re,{l:()=>S});var t=A(64537),e=A(53074),E=A(87584),m=A(67311),$=A(20092),F=A(88692);let S=(()=>{class K{constructor(u,V,w){this.masterService=u,this._trnMainService=V,this.alertService=w,this.isActive=!1,this.petval={}}ngOnInit(){}show(u,V){console.log("SHOW",u,V),this.isActive=!0,this.petval.rate=u,this.indexRow=V}cancel(){this.isActive=!1,setTimeout(()=>{this.masterService.focusAnyControl("alternateQty"+this.indexRow)},50)}hide(){this.isActive=!1,console.log("INDEX",this.indexRow+1),setTimeout(()=>{this.masterService.focusAnyControl("itemDesc"+(this.indexRow+1))},50)}quant(u,V){this._trnMainService.PetrolQuant=u/V}OnSubmit(){this._trnMainService.TrnMainObj.ProdList[this.indexRow].ALTERNATEQUANTIY=this._trnMainService.PetrolQuant,this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.addRow(),this.petval.amount=null,this._trnMainService.PetrolQuant=null,this.hide()}handleKeyDown(u){u.preventDefault(),this.cancel()}}return K.\u0275fac=function(u){return new(u||K)(t.Y36(e.P),t.Y36(E.p),t.Y36(m.c))},K.\u0275cmp=t.Xpm({type:K,selectors:[["popup-petrol"]],hostBindings:function(u,V){1&u&&t.NdJ("keydown.esc",function(W){return V.handleKeyDown(W)},!1,t.Jf7)},decls:31,vars:8,consts:[[1,"modal-sticky"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"button-group"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body",2,"margin","10px"],[1,"form-group","row",2,"margin-top","1rem"],[1,"col-md-3","form-control-label"],[1,"col-md-8"],["id","modalquant","type","number",2,"width","100%",3,"ngModel","ngModelChange","keydown.enter"],["type","text",2,"width","100%",3,"ngModel"],["type","text","readonly","",2,"width","100%",3,"ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-info","TopMargin",2,"width","80px",3,"click"],["type","button",1,"btn","btn-info","TopMargin",2,"margin-right","10px",3,"click"]],template:function(u,V){1&u&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),t._uU(4,"Calculation"),t.qZA(),t.TgZ(5,"div",4)(6,"button",5),t.NdJ("click",function(){return V.hide()}),t.TgZ(7,"span",6),t._uU(8,"\xd7"),t.qZA()()()(),t.TgZ(9,"div",7)(10,"div",8)(11,"label",9),t._uU(12,"Amount:"),t.qZA(),t.TgZ(13,"div",10)(14,"input",11),t.NdJ("ngModelChange",function(W){return V.petval.amount=W})("ngModelChange",function(){return V.quant(V.petval.amount,V.petval.rate)})("keydown.enter",function(){return V.OnSubmit()}),t.qZA()()(),t.TgZ(15,"div",8)(16,"label",9),t._uU(17,"Rate:"),t.qZA(),t.TgZ(18,"div",10),t._UZ(19,"input",12),t.qZA()(),t.TgZ(20,"div",8)(21,"label",9),t._uU(22,"Quantity:"),t.qZA(),t.TgZ(23,"div",10),t._UZ(24,"input",13),t.ALo(25,"number"),t.qZA()(),t.TgZ(26,"div",14)(27,"button",15),t.NdJ("click",function(){return V.OnSubmit()}),t._uU(28,"Submit"),t.qZA(),t.TgZ(29,"button",16),t.NdJ("click",function(){return V.hide()}),t._uU(30,"Cancel"),t.qZA()()()()()),2&u&&(t.ekj("modal-sticky-hide",!V.isActive),t.xp6(14),t.Q6J("ngModel",V.petval.amount),t.xp6(5),t.Q6J("ngModel",V.petval.rate),t.xp6(5),t.Q6J("ngModel",t.xi3(25,5,V._trnMainService.PetrolQuant,"1.0-3")))},dependencies:[$.Fj,$.wV,$.JJ,$.On,F.JJ],styles:[".modal-sticky[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:20%;top:25%;left:60%;height:40%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000;margin-left:-8%}.model-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.modal-body[_ngcontent-%COMP%]{line-height:.4rem;padding:5px}.modal-header[_ngcontent-%COMP%]{padding:5px 3px;background:#7ed0ff}.modal-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:11vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}th[_ngcontent-%COMP%]{font-size:14px}td[_ngcontent-%COMP%]{font-size:13px}"]}),K})()}}]);