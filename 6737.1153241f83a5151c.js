"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[6737],{6737:(Mr,$,p)=>{p.r($),p.d($,{InventoryModule:()=>pr});var z=p(34579),y=p(82661),M=p(87584),O=p(7976),Z=p(40216),D=p(60716),d=p(42326),A=p(11192),T=p(68328),b=p(94534),P=p(91772),E=p(28698),e=p(64537),f=p(53074),I=p(67311),G=p(69389),k=p(67297),j=p(14970),m=p(88692),L=p(68527),x=p(58349),w=p(78159),ee=p(92340),ge=p(6603),F=p(48063),u=p(20092),me=p(23470);function Ce(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"div",3)(4,"h6",4),e._uU(5,"Authorization for Negative Stock Entry"),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e.TgZ(7,"span",6),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",8)(11,"label",9),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",10)(14,"input",11),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.NegativeBillAuthObj.username=n)}),e.qZA()()(),e.TgZ(15,"div",8)(16,"label",9),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",10)(19,"input",12),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.NegativeBillAuthObj.password=n)}),e.qZA()()()(),e.TgZ(20,"div",13)(21,"button",14),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.NegativeBillAuthConfirm())}),e._uU(22,"Confirm"),e.qZA(),e.TgZ(23,"button",15),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e._uU(24,"Cancel"),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(14),e.Q6J("ngModel",t.NegativeBillAuthObj.username),e.xp6(5),e.Q6J("ngModel",t.NegativeBillAuthObj.password)}}let te=(()=>{class o{constructor(t,i,n,r,s){this.fb=t,this.masterservice=i,this._trnMainService=n,this.alertService=r,this.spinnerService=s,this.isActive=!1,this.NegativeBillAuthObj={},this.onNegativeStockAuthorized=new e.vpe,this.itemList=[]}ngOnInit(){}closeModal(){this.isActive=!1,this.onNegativeStockAuthorized.emit(!1)}show(){console.log("negative auth show"),this.isActive=!0,setTimeout(()=>{document.getElementById("AuthUsername").focus()},500)}hide(){this.isActive=!1,this.onNegativeStockAuthorized.emit(!1)}NegativeBillAuthConfirm(){this.spinnerService.show("Authorizing Please wait"),this.masterservice.NegativeBillingAuth(this.NegativeBillAuthObj).subscribe(t=>{this.NegativeBillAuthObj={username:"",password:"",remarks:""},console.log("Negative stock responee",t),console.log("voucher type,",this._trnMainService.TrnMainObj.VoucherType,this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT),this.spinnerService.hide(),"ok"==t.status?"ALLOW"==t.result?(this.alertService.success("User Right Granted !"),this.isActive=!1,this.onNegativeStockAuthorized.emit(!0)):(console.log("DENIED"),this.alertService.warning("this user has no rights to do negative stock billing !"),this.isActive=!1,this.onNegativeStockAuthorized.emit(!1)):(this.alertService.warning("Authorization Failed"),this.isActive=!1,this.onNegativeStockAuthorized.emit(!1))},t=>{this.spinnerService.hide(),this.alertService.error(t)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.qu),e.Y36(f.P),e.Y36(M.p),e.Y36(I.c),e.Y36(j.V))},o.\u0275cmp=e.Xpm({type:o,selectors:[["negativestock-auth"]],outputs:{onNegativeStockAuthorized:"onNegativeStockAuthorized"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-6vh","margin-right","20vw"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","AuthUsername","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(t,i){1&t&&e.YNc(0,Ce,25,2,"div",0),2&t&&e.Q6J("ngIf",i.isActive)},dependencies:[m.O5,u.Fj,u.JJ,u.On],styles:[".customer_container[_ngcontent-%COMP%]{position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:40%;top:25%;left:60%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:4vh;color:#000}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card-body[_ngcontent-%COMP%]{line-height:.4rem;padding:5px}.card-header[_ngcontent-%COMP%]{padding:5px 3px;background:silver}.card-footer[_ngcontent-%COMP%]{padding:5px 3px}label[_ngcontent-%COMP%]{font-size:13px;font-weight:500}tbody[_ngcontent-%COMP%]{display:block;height:11vh;overflow:auto}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.4rem!important}th[_ngcontent-%COMP%]{font-size:14px}td[_ngcontent-%COMP%]{font-size:13px}table[_ngcontent-%COMP%]{width:97.5%!important}"]}),o})();var be=p(63213);const fe=["genericDivisionGrid"],Oe=["genericForERrefGrid"],Ee=["genericExcessGRGrid"],Ae=["genericGridTransferOut"],Pe=["genericGridRequesitionApproval"],Ie=["genericGridForSupplier"],ye=["genericGridApproval"],Le=["genericGridReferenceOut"],xe=["genericGridPIRef"],we=["genericGridJobCardNO"],Ne=["NegativeAuth"];function Re(o,c){if(1&o&&(e.TgZ(0,"div",21)(1,"label",22),e._uU(2),e.qZA(),e.TgZ(3,"td",23),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.billLabel),e.xp6(2),e.hij(" ",t._trnMainService.TrnMainObj.VCHRNO," ")}}function De(o,c){if(1&o&&(e.TgZ(0,"div",24)(1,"label",22),e._uU(2,"Entry No :"),e.qZA(),e.TgZ(3,"p",25),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.Q6J("hidden",89==t._trnMainService.TrnMainObj.VoucherType),e.xp6(4),e.Oqu(t._trnMainService.TrnMainObj.VCHRNO)}}function je(o,c){if(1&o&&(e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Settlement No :"),e.qZA(),e.TgZ(3,"p",25),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(4),e.Oqu(t._trnMainService.TrnMainObj.VCHRNO)}}function Ue(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Entry Date :"),e.qZA(),e.TgZ(3,"td",26)(4,"input",27),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.TRNDATE=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeEntryDate(n.target.value,"AD"))}),e.qZA()(),e.TgZ(5,"td",28)(6,"nepali-date-picker",29),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeEntryDate(n.detail.value,"BS"))})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BSDATE=n)}),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(4),e.s9C("max",t.currDate),e.s9C("min",t.date2),e.Q6J("ngModel",t._trnMainService.TrnMainObj.TRNDATE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||"transfer-out-approval"==t.activeurlpath||"stock-issue-approval"==t.activeurlpath||24==t._trnMainService.TrnMainObj.VoucherType||t.DisableFieldAfterCalc()),e.xp6(2),e.Q6J("id","EntrynepaliDateFrom")("label","From")("disable",t._trnMainService.disableNepaliDate||t.DisableFieldAfterCalc())("ngModel",t._trnMainService.TrnMainObj.BSDATE)}}function Ze(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Entry Date :"),e.qZA(),e.TgZ(3,"td",26)(4,"input",27),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.TRN_DATE=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeEntryDate(n.target.value,"AD"))}),e.qZA()(),e.TgZ(5,"td",28)(6,"nepali-date-picker",29),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeEntryDate(n.detail.value,"BS"))})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BSDATE=n)}),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(4),e.s9C("max",t.currDate),e.s9C("min",t.date2),e.Q6J("ngModel",t._trnMainService.TrnMainObj.TRN_DATE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||t.DisableFieldAfterCalc()),e.xp6(2),e.Q6J("id","EntrynepaliDateFrom")("label","From")("disable",t._trnMainService.disableNepaliDate||t.DisableFieldAfterCalc())("ngModel",t._trnMainService.TrnMainObj.BSDATE)}}function ke(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No:"),e.qZA(),e.TgZ(3,"input",30),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Be(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Job Card No."),e.qZA(),e.TgZ(3,"td",31)(4,"input",32),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.AdditionalObj.JOBCARDNO=n)})("Keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.JobCardNoEnter())})("focus",function(n){return n.target.select()}),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t._trnMainService.TrnMainObj.AdditionalObj.JOBCARDNO)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Qe(o,c){if(1&o&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.s9C("value",t.BATCH),e.xp6(1),e.Oqu(t.BATCH)}}function He(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Counting Batch :"),e.qZA(),e.TgZ(3,"select",33),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.batchSelctionForDate(n.target.value))}),e._UZ(4,"option",34),e.YNc(5,Qe,2,2,"option",35),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled",t.DisableFieldAfterCalc()),e.xp6(2),e.Q6J("ngForOf",t.BatchSelectionList)}}function Fe(o,c){if(1&o&&(e.TgZ(0,"label",38),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Oqu(e.xi3(2,1,t._trnMainService.TrnMainObj.TRNDATE,"MM/dd/yyyy"))}}function Ve(o,c){if(1&o&&(e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Batch Date :"),e.qZA(),e.YNc(3,Fe,3,4,"label",37),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",null!=t._trnMainService.TrnMainObj.REFBILL)}}function Ge(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Requisition Type :"),e.qZA(),e.TgZ(3,"select",39),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.INVOICETYPE=n)}),e.TgZ(4,"option",40),e._uU(5," Transfer Out "),e.qZA(),e.TgZ(6,"option",41),e._uU(7," Stock Issue "),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.INVOICETYPE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("selected",!0)}}function qe(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Job Card No."),e.qZA(),e.TgZ(3,"input",42),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.AdditionalObj.JOBCARDNO=n)})("Keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.JobCardNoEnter())})("focus",function(n){return n.target.select()}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.AdditionalObj.JOBCARDNO)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Ye(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No :"),e.qZA(),e.TgZ(3,"input",43),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.fromReferenceOut())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function We(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"label",22),e._uU(2,"To Division:"),e.qZA(),e.TgZ(3,"input",44),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTONAME=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onDivisionEnter())}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTONAME)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Ke(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function Je(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div")(2,"label",22),e._uU(3,"From Division:"),e.qZA(),e.TgZ(4,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTOADD=n)}),e._UZ(5,"option",46),e.YNc(6,Ke,2,2,"option",47),e.qZA()(),e.TgZ(7,"div")(8,"label",22),e._uU(9,"Excess Return Ref No.:"),e.qZA(),e.TgZ(10,"input",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onERrefClick())}),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTOADD)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngForOf",t.divisionlist),e.xp6(4),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Xe(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"label",22),e._uU(2,"Load from Excess Adjustment:"),e.qZA(),e.TgZ(3,"input",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onLoadEAorSH())}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function $e(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"label",22),e._uU(2,"Load from Central Shortage Adjustment:"),e.qZA(),e.TgZ(3,"input",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onLoadEAorSH())}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function ze(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No :"),e.qZA(),e.TgZ(3,"input",49),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function et(o,c){if(1&o&&(e.TgZ(0,"option",36),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.s9C("value",t.NAME),e.xp6(1),e.hij(" ",t.NAME," ")}}function tt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Warehouse :"),e.qZA(),e.TgZ(3,"select",50),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.MWAREHOUSE=n)}),e.ALo(4,"disableField"),e.YNc(5,et,2,2,"option",35),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||e.lcZ(4,3,"disableWareHouse")||t.WarehouseFieldDisabled()||t.disableForLite),e.xp6(2),e.Q6J("ngForOf",t.warehouseList)}}function it(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Types :"),e.qZA(),e.TgZ(3,"select",51),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.INVOICETYPE=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.typeChange(n.target.value))}),e._UZ(4,"option",52),e.TgZ(5,"option",53),e._uU(6,"Fixed Asset"),e.qZA(),e.TgZ(7,"option",54),e._uU(8,"Others"),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.INVOICETYPE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function nt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"input",55),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.ADJUSTEXPIRY=n.target.checked?1:0)})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.ADJUSTEXPIRY=n)}),e.qZA(),e.TgZ(2,"label",56),e._uU(3,"Expiry Goods Exchange"),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t._trnMainService.TrnMainObj.ADJUSTEXPIRY)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function rt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Allocation Type :"),e.qZA(),e.TgZ(3,"input",57),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.ALLOCATIONTYPE=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.ALLOCATIONTYPE)}}function ot(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"PI Ref No. :"),e.qZA(),e.TgZ(3,"input",58),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.loadFromPIinIA())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)}}function st(o,c){1&o&&(e.TgZ(0,"label",22),e._uU(1,"From Warehouse :"),e.qZA())}function at(o,c){1&o&&(e.TgZ(0,"label",62),e._uU(1,"Production Warehouse :"),e.qZA())}function ct(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function lt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21),e.YNc(1,st,2,0,"label",59),e.YNc(2,at,2,0,"label",60),e.TgZ(3,"select",61),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTO=n)})("keydown.enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.focusToIS())})("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.focusToIS())}),e.ALo(4,"disableField"),e._UZ(5,"option",52),e.YNc(6,ct,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",88!=t._trnMainService.TrnMainObj.VoucherType&&75!=t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==t._trnMainService.TrnMainObj.VoucherType||75==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTO)("disabled",t.FromWarehouseFieldDisabled()||e.lcZ(4,5,"disableWareHouse")||"stock-issue-approval"==t.activeurlpath),e.xp6(3),e.Q6J("ngForOf",t.warehouseList)}}function dt(o,c){1&o&&(e.TgZ(0,"label",22),e._uU(1,"To Warehouse :"),e.qZA())}function ht(o,c){1&o&&(e.TgZ(0,"label",62),e._uU(1,"Consumption Warehouse :"),e.qZA())}function ut(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function pt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21),e.YNc(1,dt,2,0,"label",63),e.YNc(2,ht,2,0,"label",60),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTOADD=n)}),e.YNc(4,ut,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",88!=t._trnMainService.TrnMainObj.VoucherType&&75!=t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==t._trnMainService.TrnMainObj.VoucherType||75==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTOADD)("disabled","stock-issue-approval"==t.activeurlpath||"VIEW"==t._trnMainService.TrnMainObj.Mode||t.ToWarehouseFieldDisabled()),e.xp6(1),e.Q6J("ngForOf",t.warehouseList)}}function Tt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function _t(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Transfer From :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTO=n)}),e._UZ(4,"option",46),e.YNc(5,Tt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTO)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||null!=t._trnMainService.TrnMainObj.REFBILL&&""!=t._trnMainService.TrnMainObj.REFBILL),e.xp6(2),e.Q6J("ngForOf",t.divisionlist)}}function vt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No :"),e.qZA(),e.TgZ(3,"input",64),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.fromTransferOut())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)("disabled",t.disableRefNo())}}function Mt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No:"),e.qZA(),e.TgZ(3,"input",65),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFORDBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.forTransferOutApproval())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFORDBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function St(o,c){1&o&&(e.TgZ(0,"label",22),e._uU(1,"Transfer To :"),e.qZA())}function gt(o,c){1&o&&(e.TgZ(0,"label",22),e._uU(1,"Requisition To :"),e.qZA())}function mt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function Ct(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21),e.YNc(1,St,2,0,"label",63),e.YNc(2,gt,2,0,"label",63),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTOADD=n)}),e._UZ(4,"option",46),e.YNc(5,mt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",8==t._trnMainService.TrnMainObj.VoucherType&&"transfer-out-approval"!=t.activeurlpath),e.xp6(1),e.Q6J("ngIf",80==t._trnMainService.TrnMainObj.VoucherType&&"TransferOut"==t._trnMainService.TrnMainObj.INVOICETYPE),e.xp6(1),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTOADD)("disabled","transfer-out-approval"==t.activeurlpath||t.disableTransferTo()||"VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(2),e.Q6J("ngForOf",t.divisionlist)}}function bt(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",21)(2,"label",22),e._uU(3,"Filter By :"),e.qZA(),e.TgZ(4,"select",66),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.filterByInReqApproval=n)})("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n._trnMainService.callPipe=!n._trnMainService.callPipe)}),e.TgZ(5,"option",67),e._uU(6,"Requisition"),e.qZA(),e.TgZ(7,"option",68),e._uU(8,"Supplier"),e.qZA()()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t._trnMainService.TrnMainObj.filterByInReqApproval)("disabled",null==t._trnMainService.TrnMainObj||null==t._trnMainService.TrnMainObj.ProdList[0]?null:t._trnMainService.TrnMainObj.ProdList[0].MCODE)}}function ft(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.DESCRIPTION),e.xp6(1),e.Oqu(t.DESCRIPTION)}}function Ot(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Settlement Mode :"),e.qZA(),e.TgZ(3,"select",69),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onChangeSettlementMode(n))})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.TRNMODE=n)}),e._UZ(4,"option",52),e.YNc(5,ft,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.TRNMODE),e.xp6(2),e.Q6J("ngForOf",t._trnMainService.settlementList)}}function Et(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No:"),e.qZA(),e.TgZ(3,"input",70),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.CHALANNO=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.CHALANNO)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function At(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Ref No:"),e.qZA(),e.TgZ(3,"input",71),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.forTransferOutApproval())}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFBILL)}}function Pt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Remarks :"),e.qZA(),e.TgZ(3,"input",72),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.AdditionalObj.CREMARKS=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)("ngModel",t._trnMainService.TrnMainObj.AdditionalObj.CREMARKS)}}function It(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Remarks :"),e.qZA(),e.TgZ(3,"textarea",73),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REMARKS=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)("ngModel",t._trnMainService.TrnMainObj.REMARKS)}}function yt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.hij(" ",t.NAME," ")}}function Lt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Division:"),e.qZA(),e.TgZ(3,"select",74),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.DIVISION=n)}),e._UZ(4,"option",75),e.YNc(5,yt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.DIVISION),e.xp6(2),e.Q6J("ngForOf",t.divisionlist)}}function xt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2," Adjustment Mode :"),e.qZA(),e.TgZ(3,"select",76),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.TRNMODE=n)}),e._UZ(4,"option",52),e.TgZ(5,"option",77),e._uU(6,"Excess Stock Adjustment"),e.qZA(),e.TgZ(7,"option",78),e._uU(8,"Shortage Stock Adjustment"),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.TRNMODE)("disabled",t.DisableFieldAfterCalc())}}function wt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"button",79),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.run())}),e._uU(2,"Calculate"),e.qZA()()}}function Nt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function Rt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"From Warehouse :"),e.qZA(),e.TgZ(3,"select",80),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onchangeFromwarhouse())})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTO=n)}),e.ALo(4,"disableField"),e.YNc(5,Nt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTO)("disabled",t.FromWarehouseFieldDisabled()||e.lcZ(4,3,"disableWareHouse")||"stock-issue-approval"==t.activeurlpath),e.xp6(2),e.Q6J("ngForOf",t.warehouseList)}}function Dt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function jt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"To Warehouse :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTOADD=n)}),e.YNc(4,Dt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTOADD)("disabled","stock-issue-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngForOf",t.notLoginWarehouseList)}}function Ut(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function Zt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"To warehouse :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.MWAREHOUSE=n)}),e.ALo(4,"disableField"),e.YNc(5,Ut,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||e.lcZ(4,3,"disableWareHouse")),e.xp6(2),e.Q6J("ngForOf",t.warehouseList)}}function kt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.Oqu(t.NAME)}}function Bt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"From warehouse :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.MWAREHOUSE=n)}),e.ALo(4,"disableField"),e.YNc(5,kt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","transfer-out-approval"==t.activeurlpath||"VIEW"==t._trnMainService.TrnMainObj.Mode||e.lcZ(4,3,"disableWareHouse")),e.xp6(2),e.Q6J("ngForOf",t.warehouseList)}}function Qt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Reference IS No:"),e.qZA(),e.TgZ(3,"input",81),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REFORDBILL=n)})("keydown.enter",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.StockIssueEnter(n))})("keydown.Tab",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.masterService.focusAnyControl(1==n.userSetting.GblEnableMixedTenderMode?"customerselectid":"paymentTerms"))}),e.qZA(),e.TgZ(4,"input",82),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.DOFULLRETURN=n.target.checked?1:0)})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.DOFULLRETURN=n)}),e.qZA(),e.TgZ(5,"label",56),e._uU(6,"Load Full Stock Issue"),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFORDBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngModel",t._trnMainService.TrnMainObj.DOFULLRETURN)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Ht(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Remarks :"),e.qZA(),e.TgZ(3,"textarea",73),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.REMARKS=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)("ngModel",t._trnMainService.TrnMainObj.REMARKS)}}function Ft(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",21)(2,"label",22),e._uU(3,"Party Name :"),e.qZA(),e.TgZ(4,"input",57),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTO=n)}),e.qZA()(),e.TgZ(5,"div",83)(6,"div")(7,"label",84),e._uU(8,"Is Full Allocation :"),e.qZA(),e.TgZ(9,"input",85),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.DOFULLRETURN=n.target.checked?1:0)})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.DOFULLRETURN=n)}),e.qZA()(),e.TgZ(10,"div")(11,"label",84),e._uU(12,"Allocation For New :"),e.qZA(),e.TgZ(13,"input",86),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.changeForceAllocation(n))}),e.ALo(14,"async"),e.qZA()()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTO),e.xp6(5),e.Q6J("ngModel",t._trnMainService.TrnMainObj.DOFULLRETURN),e.xp6(4),e.Q6J("checked",e.lcZ(14,3,t.forceAllocation$))}}function Vt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"button",87),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.calculateConProdList())}),e._uU(2,"Calculate"),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("disabled",t._trnMainService.disableCalculateButton)}}function Gt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Supplier Name :"),e.qZA(),e.TgZ(3,"input",88),e.NdJ("keydown.Enter",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onSupplierEnter())})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTONAME=n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)("ngModel",t._trnMainService.TrnMainObj.BILLTONAME)}}function qt(o,c){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",89),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.loadExcessReturn(n))}),e.qZA(),e.TgZ(2,"label",90),e._uU(3,"Load excess goods to return"),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Yt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",91)(2,"input",92),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.loadFromRequisitionLog=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.checkRQlog(n))}),e.qZA()(),e.TgZ(3,"label",90),e._uU(4,"Load from Requisition Log"),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",t._trnMainService.loadFromRequisitionLog)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function Wt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.NAME),e.xp6(1),e.hij(" ",t.NAME," ")}}function Kt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Warehouse :"),e.qZA(),e.TgZ(3,"select",93),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.MWAREHOUSE=n)})("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onChangeWarehouseInApproval(n))}),e.ALo(4,"disableField"),e.YNc(5,Wt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.MWAREHOUSE)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode||e.lcZ(4,3,"disableWareHouse")),e.xp6(2),e.Q6J("ngForOf",t.warehouseList)}}function Jt(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function Xt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Requisition From :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(3);return e.KtG(r._trnMainService.TrnMainObj.AdditionalObj.REFORDID=n)}),e._UZ(4,"option",46),e.YNc(5,Jt,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(3);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.AdditionalObj.REFORDID)("disabled",t.disableAfterReqNoLoad()||"VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngValue",t.all),e.xp6(1),e.Q6J("ngForOf",t.divisionlist)}}function $t(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Requisition No :"),e.qZA(),e.TgZ(3,"input",94),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(3);return e.KtG(r._trnMainService.TrnMainObj.REFORDBILL=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.fromReqApproval())}),e.qZA()()}if(2&o){const t=e.oxw(3);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.REFORDBILL)("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)}}function zt(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Supplier Name :"),e.qZA(),e.TgZ(3,"input",88),e.NdJ("keydown.Enter",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onSupplierEnter())})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(3);return e.KtG(r._trnMainService.TrnMainObj.BILLTO=n)}),e.qZA()()}if(2&o){const t=e.oxw(3);e.xp6(3),e.Q6J("disabled","VIEW"==t._trnMainService.TrnMainObj.Mode)("ngModel",t._trnMainService.TrnMainObj.BILLTO)}}function ei(o,c){if(1&o&&(e.ynx(0),e.YNc(1,Xt,6,4,"div",18),e.YNc(2,$t,4,2,"div",18),e.YNc(3,zt,4,2,"div",18),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf","requisition"==t._trnMainService.TrnMainObj.filterByInReqApproval),e.xp6(1),e.Q6J("ngIf","requisition"==t._trnMainService.TrnMainObj.filterByInReqApproval),e.xp6(1),e.Q6J("ngIf","supplier"==t._trnMainService.TrnMainObj.filterByInReqApproval)}}function ti(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",95),e._uU(2,"Autoload Dispatch Quantity :"),e.qZA(),e.TgZ(3,"input",96),e.NdJ("change",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.AUTOLOAD=n.target.checked?1:0)})("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.AUTOLOAD=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onChangeAutoLoad(n._trnMainService.TrnMainObj.AUTOLOAD))}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.AUTOLOAD)("disabled",null==t._trnMainService.TrnMainObj.REFORDBILL||"VIEW"==t._trnMainService.TrnMainObj.Mode)}}function ii(o,c){if(1&o&&(e.TgZ(0,"option",46),e._uU(1),e.qZA()),2&o){const t=c.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function ni(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"label",22),e._uU(2,"Transfer To :"),e.qZA(),e.TgZ(3,"select",45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r._trnMainService.TrnMainObj.BILLTOADD=n)}),e.YNc(4,ii,2,2,"option",47),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t._trnMainService.TrnMainObj.BILLTOADD)("disabled","transfer-out-approval"==t.activeurlpath||"VIEW"==t._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngForOf",t.divisionlist)}}function ri(o,c){if(1&o&&(e.TgZ(0,"div",15)(1,"div",16)(2,"div",17),e.YNc(3,Re,5,2,"div",18),e.YNc(4,De,5,2,"div",19),e.YNc(5,je,5,1,"div",18),e.YNc(6,Ue,7,8,"div",18),e.YNc(7,Ze,7,8,"div",18),e.YNc(8,ke,4,2,"div",18),e.YNc(9,Be,5,2,"div",18),e.YNc(10,He,6,3,"div",18),e.YNc(11,Ve,4,1,"div",18),e.YNc(12,Ge,8,3,"div",18),e.YNc(13,qe,4,2,"div",18),e.qZA(),e.TgZ(14,"div",20),e.YNc(15,Ye,4,2,"div",18),e.YNc(16,We,4,2,"ng-container",9),e.YNc(17,Je,11,5,"ng-container",9),e.YNc(18,Xe,4,2,"ng-container",9),e.YNc(19,$e,4,2,"ng-container",9),e.YNc(20,ze,4,2,"div",18),e.YNc(21,tt,6,5,"div",18),e.YNc(22,it,9,2,"div",18),e.YNc(23,nt,4,2,"div",18),e.YNc(24,rt,4,1,"div",18),e.YNc(25,ot,4,1,"div",18),e.YNc(26,lt,7,7,"div",18),e.YNc(27,pt,5,5,"div",18),e.YNc(28,_t,6,3,"div",18),e.YNc(29,vt,4,2,"div",18),e.YNc(30,Mt,4,2,"div",18),e.YNc(31,Ct,6,5,"div",18),e.YNc(32,bt,9,2,"ng-container",9),e.YNc(33,Ot,6,2,"div",18),e.YNc(34,Et,4,2,"div",18),e.YNc(35,At,4,1,"div",18),e.YNc(36,Pt,4,2,"div",18),e.YNc(37,It,4,2,"div",18),e.YNc(38,Lt,6,2,"div",18),e.YNc(39,xt,9,2,"div",18),e.YNc(40,wt,3,0,"div",9),e.qZA(),e.TgZ(41,"div",20),e.YNc(42,Rt,6,5,"div",18),e.YNc(43,jt,5,3,"div",18),e.YNc(44,Zt,6,5,"div",18),e.YNc(45,Bt,6,5,"div",18),e.YNc(46,Qt,7,4,"div",18),e.YNc(47,Ht,4,2,"div",18),e.YNc(48,Ft,15,5,"ng-container",9),e.YNc(49,Vt,3,1,"div",9),e.YNc(50,Gt,4,2,"div",18),e.YNc(51,qt,4,1,"ng-container",9),e.YNc(52,Yt,5,2,"div",18),e.YNc(53,Kt,6,5,"div",18),e.YNc(54,ei,4,3,"ng-container",9),e.YNc(55,ti,4,2,"div",18),e.YNc(56,ni,5,3,"div",18),e.qZA()()()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.ShowTransactionMode),e.xp6(1),e.Q6J("ngIf",9!=t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",9==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10!=t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",1==t.userSetting.EnableJobCardEntry&&5==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",80===t._trnMainService.TrnMainObj.VoucherType&&!t.userSetting.IsBBSM),e.xp6(1),e.Q6J("ngIf",1==t.userSetting.EnableJobCardEntry&&80==t._trnMainService.TrnMainObj.VoucherType),e.xp6(2),e.Q6J("ngIf",8==t._trnMainService.TrnMainObj.VoucherType&&"transfer-out-approval"!=t.activeurlpath),e.xp6(1),e.Q6J("ngIf","shortage-adjustment"==t.activeurlpath||"excess-adjustment"==t.activeurlpath||87==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",86==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf","excess-goods-acknowledgement"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf","branch-shortage-adjustment"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",80==t._trnMainService.TrnMainObj.VoucherType||5==t._trnMainService.TrnMainObj.VoucherType&&1==t.userSetting.EnableJobCardEntry),e.xp6(1),e.Q6J("ngIf","openingstockentry"==t.activeurlpath||74==t._trnMainService.TrnMainObj.VoucherType||89==t._trnMainService.TrnMainObj.VoucherType||9==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf","assets-openingstockentry"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",89==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",82==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",82==t._trnMainService.TrnMainObj.VoucherType&&"Purchase"==t._trnMainService.TrnMainObj.ALLOCATIONTYPE),e.xp6(1),e.Q6J("ngIf",(5==t._trnMainService.TrnMainObj.VoucherType||88==t._trnMainService.TrnMainObj.VoucherType||75==t._trnMainService.TrnMainObj.VoucherType||81==t._trnMainService.TrnMainObj.VoucherType||10==t._trnMainService.TrnMainObj.VoucherType||80==t._trnMainService.TrnMainObj.VoucherType&&"StockIssue"==t._trnMainService.TrnMainObj.INVOICETYPE)&&"stock-issue-approval"!=t.activeurlpath&&"lite"!=t.AppMode),e.xp6(1),e.Q6J("ngIf",(5==t._trnMainService.TrnMainObj.VoucherType||88==t._trnMainService.TrnMainObj.VoucherType||75==t._trnMainService.TrnMainObj.VoucherType||81==t._trnMainService.TrnMainObj.VoucherType||80==t._trnMainService.TrnMainObj.VoucherType&&"StockIssue"==t._trnMainService.TrnMainObj.INVOICETYPE)&&"stock-issue-approval"!=t.activeurlpath&&"lite"!=t.AppMode),e.xp6(1),e.Q6J("ngIf",7==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",7==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",8==t._trnMainService.TrnMainObj.VoucherType&&"transfer-out-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",(8==t._trnMainService.TrnMainObj.VoucherType||80==t._trnMainService.TrnMainObj.VoucherType&&"TransferOut"==t._trnMainService.TrnMainObj.INVOICETYPE)&&"transfer-out-approval"!=t.activeurlpath),e.xp6(1),e.Q6J("ngIf",90==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",9==t._trnMainService.TrnMainObj.VoucherType||59==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",74==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",5==t._trnMainService.TrnMainObj.VoucherType&&"stock-issue-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf","stock-issue-approval"==t.activeurlpath||"transfer-out-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf","lite"==t.AppMode),e.xp6(1),e.Q6J("ngIf",10==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",10===t._trnMainService.TrnMainObj.VoucherType),e.xp6(2),e.Q6J("ngIf",5==t._trnMainService.TrnMainObj.VoucherType&&"stock-issue-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",5==t._trnMainService.TrnMainObj.VoucherType&&"stock-issue-approval"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",7==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",8==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",81==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf","stock-issue-approval"!=t.activeurlpath&&"transfer-out-approval"!=t.activeurlpath&&10!=t._trnMainService.TrnMainObj.VoucherType&&"lite"!=t.AppMode&&0==t.userSetting.EnableRQLogInRQEntry),e.xp6(1),e.Q6J("ngIf",82==t._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf",88==t._trnMainService.TrnMainObj.VoucherType&&"newproduction-entry"!=t.activeurlpath&&"lite"!=t.AppMode&&1==t.userSetting.EnableOnetoOneProduction),e.xp6(1),e.Q6J("ngIf",80==t._trnMainService.TrnMainObj.VoucherType&&t.userSetting.IsBBSM),e.xp6(1),e.Q6J("ngIf","excess-goods-return"==t.activeurlpath),e.xp6(1),e.Q6J("ngIf",80==t._trnMainService.TrnMainObj.VoucherType&&1==t.userSetting.EnableRQLogInRQEntry),e.xp6(1),e.Q6J("ngIf",80===t._trnMainService.TrnMainObj.VoucherType&&"TransferOut"==t._trnMainService.TrnMainObj.INVOICETYPE&&0==t.userSetting.EnableRQLogInRQEntry),e.xp6(1),e.Q6J("ngIf",90==t._trnMainService.TrnMainObj.VoucherType&&t.userSetting.IsBBSM),e.xp6(1),e.Q6J("ngIf",90==t._trnMainService.TrnMainObj.VoucherType&&0==t.userSetting.LogBasedRequisitionApproval),e.xp6(1),e.Q6J("ngIf",8==t._trnMainService.TrnMainObj.VoucherType&&"transfer-out-approval"==t.activeurlpath)}}function oi(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",97)(2,"div",98)(3,"div",99)(4,"h6",100),e._uU(5,"Authorization for Negative Stock Entry"),e.qZA(),e.TgZ(6,"button",101),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e.TgZ(7,"span",102),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",103)(10,"div",104)(11,"label",105),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",106)(14,"input",107),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.NegativeBillAuthObj.username=n)}),e.qZA()()(),e.TgZ(15,"div",104)(16,"label",105),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",106)(19,"input",108),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.NegativeBillAuthObj.password=n)}),e.qZA()()()(),e.TgZ(20,"div",109)(21,"button",110),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.NegativeBillAuthConfirm())}),e._uU(22,"Confirm"),e.qZA(),e.TgZ(23,"button",111),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e._uU(24,"Cancel"),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(14),e.Q6J("ngModel",t.NegativeBillAuthObj.username),e.xp6(5),e.Q6J("ngModel",t.NegativeBillAuthObj.password)}}let N=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_,S){this.masterService=t,this._trnMainService=i,this._authservice=n,this._loadingService=r,this._alterService=s,this._date=a,this.adjustmentService=l,this.arouter=h,this.spinnerService=v,this.genericProductService=_,this.productHelper=S,this.warehouseList=[],this.divisionlist=[],this.BatchSelectionList=[],this.stockAdjustObj={},this.isActive=!1,this.NegativeBillAuthObj={username:"",password:"",remarks:""},this.gridPopupSettingsForDivision=new E.im,this.gridPopupSettingsForERref=new E.im,this.gridPopupSettingsForExcessGR=new E.im,this.stockAdjustmentLoaded=new e.vpe,this.onClickStockIssueSelectionPopUp=new e.vpe,this.typeChangeEvent=new e.vpe,this.onClickPIRef=new e.vpe,this.onClickSupplier=new e.vpe,this.genericGridTransferOutSetting=new E.im,this.genericGridRequesitionSetting=new E.im,this.genericGridForSupplierSetting=new E.im,this.genericGridApprovalSetting=new E.im,this.genericGridReferenceOutSetting=new E.im,this.genericGridPIRefSetting=new E.im,this.genericGridJobCardNoSetting=new E.im,this.billLabel="Bill No",this.formObj={},this.multiplePIVoucher=[],this.ShowTransactionMode=!1,this.warehouseByDivList=[],this.disableLoadReq=!0,this.disableNepaliDate=!1,this.loggedinUserDetail={},this.activerowIndex=0,this.masterService.getAllDivisions().subscribe(C=>{this.divisionlist=C,this.filterloginDivision()}),this.masterService.getDivisionWiseWarehouseList(this._trnMainService.userProfile.userDivision).subscribe(C=>{this.warehouseList=C}),this._trnMainService.TrnMainObj.ALLOCATIONTYPE="Purchase",this._trnMainService.TrnMainObj.VoucherType!=d.Km.Stockadjustment&&this.masterService.getNotLoginDivisionList().subscribe(C=>{this.divisionlist=C,this.filterloginDivision()}),this.masterService.getNotLoginWarehouseList().subscribe(C=>{this.notLoginWarehouseList=C}),this.masterService.getLoginWarehouseList().subscribe(C=>{this.LoginWarehouseList=C}),this.userProfile=this._authservice.getUserProfile(),this.userSetting=n.getSetting(),this.fiscalStartDate_Eng=this.userProfile.CompanyInfo.FBDATE.split("T")[0],this.fiscalStartDate_Nep=this._date.transform(this.userProfile.CompanyInfo.FBDATE_BS,"yyyy-dd-MM"),this.warehouseByDivList=this.masterService.userProfile.warehouses,this.activeurlpath=h.snapshot.url[0].path,this.AppMode=ee.N.appMode,"lite"==this.AppMode&&(this.disableForLite=!0);var g=this.masterService.PhiscalObj.BeginDate;g=g.substring(0,10),this.date2=g,this._trnMainService.TrnMainObj.VoucherType==d.Km.BatchAdjustment&&(this.ShowTransactionMode=!0),this.getBatchList(),"production-entry"==this.activeurlpath&&0==this.userSetting.EnableCompulsaryConsumption&&(this._trnMainService.TrnMainObj.BILLTOADD=this.userProfile.userWarehouse),"stock-adjustment"===this.activeurlpath&&(this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision),this._trnMainService.TrnMainObj.VoucherType===d.Km.InventoryAllocation&&(this._trnMainService.TrnMainObj.DOFULLRETURN=1)}filterloginDivision(){(this._trnMainService.TrnMainObj.VoucherType==d.Km.RequisitionEntry||"add-branch-out"==this._trnMainService.activeurlpath)&&(this.divisionlist=this.divisionlist.filter(t=>t.INITIAL!=this.userProfile.userDivision))}updown(t){"Escape"==t.code&&(t.preventDefault(),1==this._trnMainService.showNegativeBillingAuthForMain&&this.closeModal())}changeForceAllocation(t){console.log(t,"event for changeForceAllocation"),this.productHelper.changeForceAllocation(t.target.checked)}ngOnInit(){this.forceAllocation$=this.productHelper.forceAllocation$;const t=new Date;this.currDate=(0,m.p6)(t,"yyyy-MM-dd","en-US"),this.currDateBS=this._trnMainService.getBsDate(this.currDate),this.masterService.getSettlementMode().subscribe(i=>{this._trnMainService.settlementList=i}),24==this._trnMainService.TrnMainObj.VoucherType&&(this._trnMainService.disableNepaliDate=!0),(this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssueReturn)&&(1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),setTimeout(()=>{null!=document.getElementById("stockissueFromWH")&&document.getElementById("stockissueFromWH").focus()},500)),this._trnMainService.TrnMainObj.VoucherType===d.Km.RequisitionEntry&&1==this._trnMainService.userSetting.UserWiseWarehouse&&(this._trnMainService.TrnMainObj.BILLTO=this.userProfile.userWarehouse),"assets-openingstockentry"==this.activeurlpath&&this.masterService.getMinimumDepValue().subscribe(i=>{this._trnMainService.TrnMainObj.MinDepValue=i}),this.masterService.GetAssetLocation().subscribe(i=>{"ok"==i.status&&(this._trnMainService.TrnMainObj.LOCATIONLIST=i.result)})}ngAfterViewInit(){}changeEntryDate(t,i){"AD"==i?(t>this.currDate&&(t=this.currDate,this._trnMainService.TrnMainObj.TRNDATE=this.currDate),this._trnMainService.TrnMainObj.BSDATE=this.masterService.toBSDate(t)):"BS"==i&&(t>this.currDateBS&&(t=this.currDateBS,this._trnMainService.TrnMainObj.BSDATE=this.currDateBS),this._trnMainService.TrnMainObj.TRNDATE=this.masterService.toADDate(t)),"assets-openingstockentry"===this.activeurlpath&&this.masterService.getAssetDepreciationDoneMonths().subscribe(n=>{const r=this._trnMainService.TrnMainObj.BSDATE.split("/")[1];for(const s of n.result)if(s.MONTHNO===r){this._trnMainService.TrnMainObj.TRNDATE=this.currDate,this._trnMainService.TrnMainObj.BSDATE=this.currDateBS,this._alterService.info(`Depreciation cancellation is required to enter opening stock entry for this month(${s.MONTHNAME.toLowerCase()})`);break}})}StockIssueEnter(){this.onClickStockIssueSelectionPopUp.emit()}getWarehouseList(){this.adjustmentService.getWarehouses().subscribe(t=>{this.warehouseList=t})}getBatchList(){this.adjustmentService.getBatchSelectionList(this._trnMainService.TrnMainObj.DIVISION).subscribe(t=>{this.BatchSelectionList=t,console.log(this.BatchSelectionList)})}batchSelctionForDate(t){let i;i=this.BatchSelectionList.find(a=>a.BATCH==t),this._trnMainService.TrnMainObj.TRNDATE=i.TRNDATE.substring(0,10);var n=p(10484),r=i.TRNDATE.substring(0,10).replace("-","/").replace("-","/"),s=n.ad2bs(r);this._trnMainService.TrnMainObj.BSDATE=("1"==s.en.day||"2"==s.en.day||"3"==s.en.day||"4"==s.en.day||"5"==s.en.day||"6"==s.en.day||"7"==s.en.day||"8"==s.en.day||"9"==s.en.day?"0"+s.en.day:s.en.day)+"/"+("1"==s.en.month||"2"==s.en.month||"3"==s.en.month||"4"==s.en.month||"5"==s.en.month||"6"==s.en.month||"7"==s.en.month||"8"==s.en.month||"9"==s.en.month?"0"+s.en.month:s.en.month)+"/"+s.en.year,console.log(i)}typeChange(t){this.typeChangeEvent.emit(t),console.log("data k huncha",t)}closeDialog(){this.isActive=!1,this.stockAdjustObj={}}run(){this.adjustmentService.checkDuplicateStockAdjustmentBatch(this._trnMainService.TrnMainObj.REFBILL,this._trnMainService.TrnMainObj.TRNMODE).subscribe(t=>{if("ok"==t.status){let i={BATCH:this._trnMainService.TrnMainObj.REFBILL,DATE:this._trnMainService.TrnMainObj.TRNDATE,WARE:this._trnMainService.TrnMainObj.BILLTO,DIVISION:this._trnMainService.TrnMainObj.DIVISION,VARIANCEMODE:this._trnMainService.TrnMainObj.TRNMODE};if(!(i.BATCH&&i.DATE&&i.WARE&&i.DIVISION&&i.VARIANCEMODE))return void this._alterService.warning("Please enter all the required fields!");this._loadingService.show("Loading data, please wait.."),this.adjustmentService.runBatches(i).subscribe(n=>{console.log("result on save",n),"ok"==n.status?(this._loadingService.hide(),this._trnMainService.TrnMainObj.ProdList=n.result,this._trnMainService.ReCalculateBillWithNormal(),this.isActive=!1):(this._loadingService.hide(),this._alterService.error(n.result.error))},n=>{this._loadingService.hide(),this._alterService.error(n)})}else this._alterService.error(t.result)},t=>{this._alterService.info(t.error.result)})}clickIsLoadFromOrder(t){1==t?(this._trnMainService.TrnMainObj.ISLOADFROMORDER=1,this.disableLoadReq=!1):(this._trnMainService.TrnMainObj.ISLOADFROMORDER=0,this.disableLoadReq=!0)}FromWarehouseFieldDisabled(){return null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.VoucherType!=d.Km.RequisitionEntry&&(this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE).length>0||this._trnMainService.TrnMainObj.VoucherType==d.Km.StockIssue&&0==this._trnMainService.TrnMainObj.DOFULLRETURN)}DisableFieldAfterCalc(){return null!=this._trnMainService.TrnMainObj.ProdList&&"stock-adjustment"===this.activeurlpath&&this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE).length>0}ToWarehouseFieldDisabled(){return this._trnMainService.TrnMainObj.VoucherType==d.Km.StockIssueReturn&&0==this._trnMainService.TrnMainObj.DOFULLRETURN&&null!=this._trnMainService.TrnMainObj.REFORDBILL&&null!=this._trnMainService.TrnMainObj.REFORDBILL&&""!=this._trnMainService.TrnMainObj.REFORDBILL||this._trnMainService.TrnMainObj.VoucherType==d.Km.StockIssue&&0==this._trnMainService.TrnMainObj.DOFULLRETURN||null!=this._trnMainService.TrnMainObj.ConsumptionProdList&&this._trnMainService.TrnMainObj.ConsumptionProdList.filter(t=>null!=t.MCODE).length>0||this._trnMainService.TrnMainObj.VoucherType!=d.Km.ProductionEntry&&null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE).length>0}consumputionWarehouseDisable(){return this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry&&0==this.userSetting.EnableCompulsaryConsumption}WarehouseFieldDisabled(){if(this._trnMainService.TrnMainObj.VoucherType===d.Km.BatchAdjustment)return null!=this._trnMainService.TrnMainObj.ProdList&&this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE).length>0}disableAfterReqNoLoad(){return 1==this._trnMainService.disbaleReqFrom}onChangeSettlementMode(t){}fromReqApproval(){let t="";t=this._trnMainService.TrnMainObj.VoucherType!==d.Km.RequisitionApproval||this._trnMainService.TrnMainObj.AdditionalObj.REFORDID?this._trnMainService.TrnMainObj.AdditionalObj.REFORDID:"all",this.genericGridRequesitionSetting={title:"Requisition Request List",apiEndpoints:`/getTransferOutPagedList/${t}/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Requisition From",hidden:!1,noSearch:!1},{key:"REQUISTIONTO",title:"Requisition To",hidden:!1,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1}]},this.genericGridRequesitionApproval.show()}fromTransferOut(){let t="";t=this._trnMainService.TrnMainObj.VoucherType===d.Km.BranchTransferOut?this._trnMainService.TrnMainObj.AdditionalObj.REFORDID:this._trnMainService.TrnMainObj.BILLTO,1==this.userSetting.EnableTransitWiseTransferIn&&(this._trnMainService.TrnMainObj.VoucherPrefix="TC"),this.genericGridTransferOutSetting={title:"Transferred List",apiEndpoints:`/getTransferOutPagedList/${t}/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Ref No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Transfer From",hidden:!1,noSearch:!1},{key:"REFBILL",title:"TC Voucher No",hidden:!1,noSearch:!1}]},this.genericGridTransferOut.show()}fromReferenceOut(){this.genericGridReferenceOutSetting={title:"Purchase Invoice List",apiEndpoints:"/getPIpagedListForTransferOut/PI",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"BILLTO",title:"Supplier Name",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1}]},this.genericGridReferenceOut.show()}dblClickLoadReferenceOutData(t){let i=this._trnMainService.TrnMainObj.MWAREHOUSE,n=this.userProfile.userDivision;console.log("User Dvision",n,this.masterService.userProfile),this._loadingService.show("Please wait while loading invoice details"),this.masterService.LoadTransactionForBranchOut(t.VCHRNO,n,this.userProfile.PhiscalYearInfo.PhiscalID,i).subscribe(r=>{if("ok"==r.status){this._loadingService.hide();const s=p(67816);this._trnMainService.TrnMainObj=r.result,this._trnMainService.TrnMainObj.guid=s(),this._trnMainService.TrnMainObj.VoucherType=8,this._trnMainService.TrnMainObj.VoucherPrefix="TO",this._trnMainService.TrnMainObj.VoucherAbbName="TO",this._trnMainService.TrnMainObj.COMPANYID=this.masterService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._trnMainService.TrnMainObj.tag="FROMTRANSFERRED",console.log("user division",this.userProfile.userDivision,"warehouse",this.userProfile.userWarehouse),this._trnMainService.TrnMainObj.DIVISION=this.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this.userProfile.userWarehouse,this._trnMainService.TrnMainObj.BILLTOADD="",this._trnMainService.callPipe=!this._trnMainService.callPipe,this._trnMainService.TrnMainObj?.STOCKMESSAGE&&(1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE?1==this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT?this._alterService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE):2==this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT&&(this._trnMainService.checkForUserMinusStockAuthorization()?this._alterService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE):this.NegativeAuthPopup.show()):this._alterService.info(this._trnMainService.TrnMainObj.STOCKMESSAGE));for(const a of this._trnMainService.TrnMainObj.ProdList)a.isDisabled=!0,0==this._trnMainService.nullToZeroConverter(a.ALTCONFACTOR)&&(a.ALTCONFACTOR=1);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.TRN_DATE=r.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTO=r.result.BILLTO,this._trnMainService.TrnMainObj.MWAREHOUSE=i}},r=>{this._loadingService.hide(),this._alterService.error(r._body)},()=>{this._loadingService.hide()})}forTransferOutApproval(){this.genericGridApprovalSetting={title:"Transferred Unapproved List",apiEndpoints:`/getTransferOutUnapprovedPagedList/${this._trnMainService.TrnMainObj.VoucherPrefix}`,defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Entry No",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"NAME",title:"Transfer From",hidden:!1,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1}]},this.genericGridApproval.show()}dblClickLoadRequisitionForApproval(t){this._trnMainService.TrnMainObj.VoucherType==d.Km.RequisitionApproval&&(console.log("dblClick event",t),this.loadRequisitionApprovalData(t))}dblClickLoadTransferOutData(t){if(this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferOut&&1==this._trnMainService.TrnMainObj.ISLOADFROMORDER)return void(this._trnMainService.TrnMainObj.REFORDBILL=t.VCHRNO);let r,i=this._trnMainService.TrnMainObj.MWAREHOUSE,n=this.userProfile.CompanyInfo.INITIAL;r=t.VCHRNO,1==this.userSetting.IsBBSM||this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferIn&&1==this._trnMainService.userSetting.EnableTransitWiseTransferIn?(n=t.BILLTOADD,r=t.REFBILL):n=t.BILLTO,this._loadingService.show("Please wait while loading invoice details"),this.masterService.LoadTransaction(r,n,this.userProfile.PhiscalYearInfo.PhiscalID,"VIEW","",this._trnMainService.TrnMainObj.BILLTO).subscribe(s=>{if("ok"==s.status){this._loadingService.hide();const a=p(67816);this._trnMainService.TrnMainObj=s.result,this._trnMainService.TrnMainObj.guid=a(),this._trnMainService.TrnMainObj.VoucherType=7,this._trnMainService.TrnMainObj.VoucherPrefix="TR",this._trnMainService.TrnMainObj.VoucherAbbName="TR",this._trnMainService.TrnMainObj.COMPANYID=this._trnMainService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._trnMainService.TrnMainObj.REFORDBILL=t.REFBILL,this._trnMainService.TrnMainObj.tag="FROMTRANSFERRED",this._trnMainService.TrnMainObj.DIVISION=this._trnMainService.userProfile.userDivision,this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.userProfile.userWarehouse;for(const l of this._trnMainService.TrnMainObj.ProdList)l.MFGDATE=this.mfgExpDateFormatter(l.MFGDATE),l.EXPDATE=this.mfgExpDateFormatter(l.EXPDATE),l.isDisabled=!0,0==this._trnMainService.nullToZeroConverter(l.ALTCONFACTOR)&&(l.ALTCONFACTOR=1),1==this._trnMainService.userSetting.IsBBSM&&(l.TotalReceived=l.ALTERNATEQUANTIY,l.AMOUNT=l.MRP*l.ALTERNATEQUANTIY,l.RATE=l.ALTRATE=l.MRP);null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.prePareVariantDescription(),this._trnMainService.TrnMainObj.TRN_DATE=s.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTO=s.result.BILLTO,this._trnMainService.TrnMainObj.MWAREHOUSE=i,console.log("inproddata",this._trnMainService.TrnMainObj.ProdList)}},s=>{this._loadingService.hide(),this._alterService.error(s._body)},()=>{this._loadingService.hide()})}mfgExpDateFormatter(t){return t?0==this.userSetting.enableDayWiseMfgEXPDate?t?.toString().substring(0,7):t?.toString().substring(0,10):""}onChangeWarehouseInApproval(t){this._trnMainService.TrnMainObj.VoucherType==d.Km.RequisitionApproval&&(console.log("event on change",t,this.tempObjForOnChange),this.loadRequisitionApprovalData(this.tempObjForOnChange))}onChangeAutoLoad(t){console.log("check for tick value",t),1==t?(this._trnMainService.TrnMainObj.ProdList.forEach(i=>i.APPROVEDALTQTY=i.ALTERNATEQUANTIY),0==this.userSetting.LogBasedRequisitionApproval&&this._trnMainService.TrnMainObj.ProdList.forEach(i=>this.validateStockonAutoLoad(i)),this._trnMainService.afterAutoloadCheck=!0):(this._trnMainService.TrnMainObj.ProdList.forEach(i=>i.APPROVEDALTQTY=0),this._trnMainService.afterAutoloadCheck=!1),this._trnMainService.CalculateApprovalBill()}validateStockonAutoLoad(t){let i=this._trnMainService.nullToZeroConverter(t.APPROVEDALTQTY);return!(10!=t.PTYPE&&7!=t.NATURETYPE||i>t.ALTERNATEQUANTIY)||(i>t.STOCK?(this._alterService.error("Approved Quantity cannot be greater than stock... Please Check Your Entry."),t.APPROVEDALTQTY=0,!1):void 0)}loadRequisitionApprovalData(t){this.tempObjForOnChange=t;let i=this._trnMainService.TrnMainObj.MWAREHOUSE;t.DefaultWarehouse&&(i=t.DefaultWarehouse),this._loadingService.show("Please wait while loading invoice details"),this.masterService.LoadRequisitionForRA(t.VCHRNO,t.DIVISION,t.PhiscalID,i,"FROMRA",t.BILLTOADD).subscribe(n=>{if("ok"==n.status){this._loadingService.hide();const r=p(67816);this._trnMainService.TrnMainObj=n.result,this._trnMainService.TrnMainObj.guid=r(),this._trnMainService.TrnMainObj.VoucherType=d.Km.RequisitionApproval,this._trnMainService.TrnMainObj.VoucherPrefix="RA",this._trnMainService.TrnMainObj.VoucherAbbName="RA",this._trnMainService.TrnMainObj.COMPANYID=this.masterService.userProfile.CompanyInfo.COMPANYID,this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._trnMainService.TrnMainObj.DIVISION=this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.AUTOLOAD=1,this._trnMainService.TrnMainObj.filterByInReqApproval="requisition",this.onChangeAutoLoad(this._trnMainService.TrnMainObj.AUTOLOAD);for(const s of this._trnMainService.TrnMainObj.ProdList)s.REQUESTTOTALQTY=s.Quantity,s.REQUESTALTQTY=s.ALTERNATEQUANTIY,s.REFBILLQTY=s.REQUESTALTQTY,0==this._trnMainService.nullToZeroConverter(s.ALTCONFACTOR)&&(s.ALTCONFACTOR=1),s.BASEUNIT===s.ALTUNIT&&(s.RATE=s.ALTRATE);for(let s in this._trnMainService.TrnMainObj.ProdList)this._trnMainService.TrnMainObj.ProdList[s].COMMENTS=n.result.ProdList[s].COMMENTS;null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.REFORDBILL=t.VCHRNO,this._trnMainService.TrnMainObj.AdditionalObj.REFORDID=t.DIVISION,this._trnMainService.CalculateApprovalBill(),this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),i="",this._trnMainService.TrnMainObj.TRN_DATE=n.result.TRNDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.BILLTO=this._trnMainService.TrnMainObj.AdditionalObj.REFORDID,this._trnMainService.TrnMainObj.BILLTOADD=t.BILLTOADD,this.masterService.getWarehouseListInReqApproval(t.BILLTOADD).subscribe(s=>{this.warehouseList=s.result}),this._trnMainService.disbaleReqFrom=!0}},n=>{this._loadingService.hide(),this._alterService.error(n._body)})}dblClickLoadApprovalData(t){this._trnMainService.disableOnApproval=!0,this._loadingService.show("Please wait while loading invoice details"),this.masterService.LoadTransaction(t.VCHRNO,t.DIVISION,t.PhiscalID).subscribe(i=>{if("ok"==i.status){this._loadingService.hide();const n=p(67816);this._trnMainService.TrnMainObj=i.result,this._trnMainService.TrnMainObj.guid=n(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.REFORDBILL=t.VCHRNO,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={})}},i=>{this._loadingService.hide(),this._alterService.error(i._body)},()=>{this._loadingService.hide()})}onchangeFromwarhouse(){this._trnMainService.TrnMainObj.VoucherType==d.Km.StockIssue&&(this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.TrnMainObj.BILLTO)}disableRefNo(){return""===this._trnMainService.TrnMainObj.BILLTO||null==this._trnMainService.TrnMainObj.BILLTO||null==this._trnMainService.TrnMainObj.BILLTO||"VIEW"==this._trnMainService.TrnMainObj.Mode}disableTransferTo(){if(this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferOut)return!(!this._trnMainService.disableTranferToFromReq&&"VIEW"!=this._trnMainService.TrnMainObj.Mode)}focusToIS(){(this._trnMainService.TrnMainObj.VoucherType==d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssueReturn)&&(this._trnMainService.TrnMainObj.MWAREHOUSE=this._trnMainService.TrnMainObj.BILLTO),setTimeout(()=>{null!==document.getElementById("soNoId")&&document.getElementById("soNoId").focus()},500)}closeModal(){this._trnMainService.showNegativeBillingAuthForMain=!1,this._trnMainService.filterOnNoAuthorization()}NegativeBillAuthConfirm(){this._loadingService.show("Authorizing Please wait"),this.masterService.NegativeBillingAuth(this.NegativeBillAuthObj).subscribe(t=>{this.NegativeBillAuthObj={username:"",password:"",remarks:""},console.log("Negative stock responee",t),console.log("voucher type,",this._trnMainService.TrnMainObj.VoucherType,this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT),this._loadingService.hide(),"ok"==t.status?"ALLOW"==t.result?(this._alterService.success("User Right Granted !"),this._trnMainService.showNegativeBillingAuthForMain=!1):(console.log("DENIED"),this._alterService.warning("this user has no rights to do negative stock billing !"),this._trnMainService.showNegativeBillingAuthForMain=!1,this._trnMainService.filterOnNoAuthorization()):(this._alterService.warning("Authorization Failed"),this._trnMainService.showNegativeBillingAuthForMain=!1,this._trnMainService.filterOnNoAuthorization())},t=>{this._loadingService.hide(),this._alterService.error(t)})}onNegativeStockAuthorized(t){console.log("onNegativeStockAuthorized",t),t||this._trnMainService.filterOnNoAuthorization()}JobCardNoEnter(){this.genericGridJobCardNoSetting={title:"Job Card List",apiEndpoints:"/getJobCardNoPagedList",defaultFilterIndex:0,columns:[{key:"JobCardNO",title:"Job Card No",hidden:!1,noSearch:!1},{key:"CustomerName",title:"Customer Name",hidden:!1,noSearch:!1},{key:"MobileNo",title:"Mobile No",hidden:!1,noSearch:!1},{key:"VehicleNO",title:"VehicleNo",hidden:!1,noSearch:!1}]},this.genericGridJobCardNO.show()}onSelectJobCardEntry(t){this._trnMainService.TrnMainObj.BILLTO=t.CustomerName,this._trnMainService.TrnMainObj.BILLTOADD=t.Address,this._trnMainService.TrnMainObj.PARAC=t.ACID,this._trnMainService.TrnMainObj.AdditionalObj.JOBCARDNO=t.JobCardNO,this._trnMainService.TrnMainObj.MobileNo=t.MobileNo}calculateConProdList(){1==this.userSetting.EnableOnetoOneProduction&&(document.getElementById("consumption1").click(),this.masterService.getConProdList(this._trnMainService.TrnMainObj.ProdList[0].MCODE,this.masterService.userProfile.userDivision,this._trnMainService.TrnMainObj.BILLTOADD,this._trnMainService.TrnMainObj.ProdList[0].Quantity,this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj.VCHRNO).subscribe(i=>{"ok"==i.status?(this._trnMainService.TrnMainObj.ConsumptionProdList=i.result.res,this._trnMainService.disableConsumption=!0,this._trnMainService.TrnMainObj.ConsumptionProdList.forEach(n=>{n.RATE=n.ALTRATE,n.MFGDATE=n.MFGDATE?.toString().substring(0,10),n.EXPDATE=n.EXPDATE?.toString().substring(0,10)}),this._trnMainService.ReCalculateBillForConsumption()):this._alterService.error(i.result)}))}checkRQlog(t){this._trnMainService.loadFromRequisitionLog=t.target.checked?1:0,1==this._trnMainService.loadFromRequisitionLog?(this.spinnerService.show("Loading..."),this.masterService.getRequisitionLogDetails().subscribe(i=>{i?(this.spinnerService.hide(),i.result?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],i.result.forEach(n=>{this.pushValueInProdList(n),n.checkInRQentry=!0}),this._trnMainService.ReCalculateBillWithNormal()):0==i.result?.length&&this._alterService.info("Requisition Log is Empty!")):(this.spinnerService.hide(),this._alterService.error(i.result))},i=>{this.spinnerService.hide(),this._alterService.error(i.error)})):this.addEmptyRow(),this._trnMainService.ReCalculateBillWithNormal()}addRow(t){this._trnMainService.barCodes.Quantity=1;let i={};i.ALTCONFACTOR=t.ALTCONFACTOR,i.ALTERNATEQUANTIY=t.ALTERNATEQUANTIY,i.ALTUNIT=t.ALTUNIT,i.ALTRATE=t.ALTRATE,i.BASEQUANTITY=t.BASEQUANTITY,i.BASEUNIT=t.BASEUNIT,i.ITEMDESC=t.ITEMDESC,i.MCODE=t.MCODE,i.PhiscalID=t.PhiscalID,i.TRNAC=t.TRNAC,i.UNIT=t.UNIT,i.MCODE=t.MCODE,i.ReferenceGUID=t.GUID,i.SUPPNAME=t.SUPPNAME,i.COMMENTS=t.COMMENTS,i.checkInRQentry=!0,i.RATE=t.RATE,this._trnMainService.TrnMainObj.ProdList[0].BC||this._trnMainService.TrnMainObj.ProdList[0].MCODE?this._trnMainService.TrnMainObj.ProdList.push(i):this._trnMainService.TrnMainObj.ProdList[0]=i;let n=0;n=this._trnMainService.TrnMainObj.ProdList.length-1}addEmptyRow(){console.log("ADDROW");try{return this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.ProdList.push({inputMode:!0,MENUCODE:null,ITEMDESC:null,RATE:null,NCRATE:null,AMOUNT:null,INDDISCOUNTRATE:null,INDDISCOUNT:null,DISCOUNT:null,VAT:null,NETAMOUNT:null,ITEMTYPE:null,RECEIVEDTYPE:null,WAREHOUSE:null,BC:null,ALTERNATEQUANTIY:null,PRATE:0,isConfirmed:!1,IsAuthorizeForNegative:!1}),!0}catch(t){return console.log({error:t}),!1}}loadFromPIinIA(){this.genericGridPIRefSetting={title:"Purchase Invoice List",apiEndpoints:"/getPIpagedListForInventoryAllocation",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1},{key:"REFBILL",title:"Ref No",hidden:!1,noSearch:!1},{key:"BILLTO",title:"Supplier Name",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1}]},this.genericGridPIRef.show()}dblClickLoadOnPIRefInIAData(t){this._trnMainService.TrnMainObj.REFBILL!=t.VCHRNO&&(this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._trnMainService.TrnMainObj.BILLTO=t.BILLTO,this._trnMainService.TrnMainObj.TRNAC=t.TRNAC,this._trnMainService.TrnMainObj.PARAC=t.PARAC,console.log("EVENTTT",t),this.spinnerService.show("Loading..."),this.masterService.getRequisitionProdList({vchrno:t.VCHRNO,division:t.DIVISION,phiscalId:t.PhiscalID}).subscribe(n=>{n&&(this.spinnerService.hide(),n?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.Mode="NEW",n.forEach(r=>{this.pushValueInProdList(r)}),this.onClickPIRef.emit()):0==n?.length&&this._alterService.info("There is no Data!"))},n=>{this.spinnerService.hide(),this._alterService.error(n.error)}))}pushValueInProdList(t){this._trnMainService.TrnMainObj.ProdList.push(t)}onSupplierEnter(){this._trnMainService.TrnMainObj.BILLTO="",this.genericGridForSupplierSetting=this.masterService.getGenericGridPopUpSettings("SupplierList"),this.genericGridForSupplier.show()}dblClickLoadOnSupplierClick(t){console.log("event",t),this.spinnerService.show("Loading..."),this._trnMainService.TrnMainObj.TRNAC=t.ACID,this._trnMainService.TrnMainObj.PARAC=t.ACID,this._trnMainService.TrnMainObj.BILLTO=t.ACNAME,this._trnMainService.TrnMainObj.BILLTONAME=t.ACNAME,this._trnMainService.TrnMainObj.VoucherType==d.Km.RequisitionApproval?this.masterService.getRequisitionProdList({supplierId:t.ACID}).subscribe(n=>{n?(this.spinnerService.hide(),n?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],this._trnMainService.TrnMainObj.Mode="NEW",n.forEach(r=>{r.rowMode="NEW",this.pushValueInProdList(r)}),this.onClickSupplier.emit()):0==n?.length&&this._alterService.info("There is no Data!")):(this.spinnerService.hide(),this._alterService.error("Could not load data."))},n=>{this.spinnerService.hide(),this._alterService.error(n.error)}):this.spinnerService.hide()}pushValueInAdditionProdList(t){this._trnMainService.TrnMainObj.AdditionProdList.push(t)}keyPress(t){const n=String.fromCharCode(t.charCode);/[\b]/.test(n)||t.preventDefault()}onDivisionEnter(){this.gridPopupSettingsForDivision={title:"Division",apiEndpoints:"/getDivisionPagedlist",defaultFilterIndex:1,columns:[{key:"INITIAL",title:"INITIAL",hidden:!1,noSearch:!1},{key:"NAME",title:"DIVISION NAME",hidden:!1,noSearch:!1}]},this.genericDivisionGrid.show()}onERrefClick(){this._trnMainService.TrnMainObj.BILLTOADD?(this.gridPopupSettingsForERref={title:"Excess Return List",apiEndpoints:`/getExcessGoodsReturnListFromBranch/${this._trnMainService.TrnMainObj.BILLTOADD}`,defaultFilterIndex:1,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"DIVISION",title:"Division",hidden:!1,noSearch:!1},{key:"TDATE",title:"Date",hidden:!1,noSearch:!0}]},this.genericForERrefGrid.show()):this._alterService.info("Please select Division first.")}doubleClickERrefClick(t){console.log("EVEMT",t),this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._trnMainService.TrnMainObj.BILLTOADD=t.DIVISION,this._trnMainService.TrnMainObj.BILLTO=this.masterService.userProfile.userDivision,this._loadingService.show("Loading Data..."),this.masterService.loadExcessGoodsReturnDetailsFromBranch(t.VCHRNO,t.DIVISION).subscribe(i=>{i&&(this._loadingService.hide(),"ok"==i.status?i?.result?.ProdList?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],i.result.ProdList.forEach(n=>{this.pushValueInProdList(n),this._trnMainService.ReCalculateBillWithNormal()})):0==i?.result?.ProdList?.length&&this._alterService.info("There is no data!"):this._alterService.error(i.result))},i=>{this._loadingService.hide(),this._alterService.error(i)})}doubleClickDivision(t){let i;this._trnMainService.TrnMainObj.BILLTO=t.INITIAL,this._trnMainService.TrnMainObj.BILLTONAME=t.NAME,87!=this._trnMainService.TrnMainObj.VoucherType?(this._loadingService.show("Loading data..."),"excess-adjustment"==this.activeurlpath?i="excess":"shortage-adjustment"==this.activeurlpath&&(i="shortage"),this.getExcessAndShortageAdjustment(i,!0,t.INITIAL)):setTimeout(()=>{document.getElementById("ITEMDESC0").focus(),this.genericProductService.activerowIndex=0})}loadExcessReturn(t){if(t.target.checked){let i="excess",n=!1,r=this.masterService.userProfile.userDivision;this._loadingService.show("Loading data..."),this.getExcessAndShortageAdjustment(i,n,r)}}getExcessAndShortageAdjustment(t,i,n){this.masterService.getExcessAndShortageAdjustmentProdlist(t,i,n).subscribe(r=>{"ok"==r.status?(this._loadingService.hide(),r?.result?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],r.result.forEach(s=>{s.checkInExcessAdj=!0,this.pushValueInProdList(s)}),this._trnMainService.ReCalculateBillWithNormal()):0==r?.result?.length&&this._alterService.info("There is no Data!")):(this._loadingService.hide(),this._alterService.error("Failed to load data."))},r=>{this._loadingService.hide(),this._alterService.error(r.error)})}onLoadEAorSH(){let t,i;"branch-shortage-adjustment"==this.activeurlpath?(t="SH",i="Central Shortage Adjustment List"):"excess-goods-acknowledgement"==this.activeurlpath&&(t="EA",i="Excess Adjustment List"),this.gridPopupSettingsForExcessGR={title:i,apiEndpoints:`/getEAandSHPagedListFromCentral/${t}`,defaultFilterIndex:1,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"NETAMNT",title:"Amount",hidden:!1,noSearch:!1},{key:"TDATE",title:"Date",hidden:!1,noSearch:!1}]},this.genericExcessGRGrid.show()}doubleClickExcessGR(t){console.log("event",t),this._trnMainService.TrnMainObj.REFBILL=t.VCHRNO,this._loadingService.show("Loading data..."),this.masterService.loadEAandSHAdjustmentDetails(t.VCHRNO).subscribe(i=>{"ok"==i.status?(this._loadingService.hide(),i?.result?.ProdList?.length>0?(this._trnMainService.TrnMainObj.ProdList=[],i.result.ProdList.forEach(n=>{this.pushValueInProdList(n)}),this._trnMainService.ReCalculateBillWithNormal()):0==i?.result?.ProdList?.length&&this._alterService.info("There is no Data!")):(this._loadingService.hide(),this._alterService.error("Error Loading Data."))},i=>{this._loadingService.hide(),this._alterService.error(i.error)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(k.e),e.Y36(j.V),e.Y36(I.c),e.Y36(m.uU),e.Y36(ge.z),e.Y36(O.gz),e.Y36(j.V),e.Y36(b.w),e.Y36(F.h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["inv-params"]],viewQuery:function(t,i){if(1&t&&(e.Gf(fe,5),e.Gf(Oe,5),e.Gf(Ee,5),e.Gf(Ae,5),e.Gf(Pe,5),e.Gf(Ie,5),e.Gf(ye,5),e.Gf(Le,5),e.Gf(xe,5),e.Gf(we,5),e.Gf(Ne,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.genericDivisionGrid=n.first),e.iGM(n=e.CRH())&&(i.genericForERrefGrid=n.first),e.iGM(n=e.CRH())&&(i.genericExcessGRGrid=n.first),e.iGM(n=e.CRH())&&(i.genericGridTransferOut=n.first),e.iGM(n=e.CRH())&&(i.genericGridRequesitionApproval=n.first),e.iGM(n=e.CRH())&&(i.genericGridForSupplier=n.first),e.iGM(n=e.CRH())&&(i.genericGridApproval=n.first),e.iGM(n=e.CRH())&&(i.genericGridReferenceOut=n.first),e.iGM(n=e.CRH())&&(i.genericGridPIRef=n.first),e.iGM(n=e.CRH())&&(i.genericGridJobCardNO=n.first),e.iGM(n=e.CRH())&&(i.NegativeAuthPopup=n.first)}},hostBindings:function(t,i){1&t&&e.NdJ("keydown",function(r){return i.updown(r)},!1,e.evT)},outputs:{stockAdjustmentLoaded:"stockAdjustmentLoaded",onClickStockIssueSelectionPopUp:"onClickStockIssueSelectionPopUp",typeChangeEvent:"typeChangeEvent",onClickPIRef:"onClickPIRef",onClickSupplier:"onClickSupplier"},features:[e._Bn([m.uU])],decls:24,vars:12,consts:[["class","pd0 mr5 plainBackGround",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridTransferOut",""],["genericGridRequesitionApproval",""],["genericGridReferenceOut",""],["genericGridPIRef",""],["genericGridForSupplier",""],["genericGridApproval",""],["genericGridJobCardNO",""],[4,"ngIf"],[3,"onNegativeStockAuthorized"],["NegativeAuth",""],["genericDivisionGrid",""],["genericForERrefGrid",""],["genericExcessGRGrid",""],[1,"pd0","mr5","plainBackGround"],[1,"row","col-md-12","pd0"],[1,"col-md-4",2,"max-height","190px","padding-top","5px","padding-left","15px"],["class","row",4,"ngIf"],["class","row",3,"hidden",4,"ngIf"],[1,"col-md-4",2,"max-height","150px","padding-top","5px","padding-left","15px"],[1,"row"],[2,"width","25%"],[2,"float","right","width","73%","margin-top","3px","font-weight","bold"],[1,"row",3,"hidden"],[2,"float","right","width","73%","margin-top","0px","font-weight","bold"],[2,"float","right","width","34%"],["type","date",2,"width","100%",3,"ngModel","disabled","max","min","ngModelChange","change"],[2,"float","right","width","30%"],["name","EntrynepaliDateFrom",3,"id","label","disable","ngModel","change","ngModelChange"],["type","text","autocomplete","off",2,"width","67%","float","right",3,"ngModel","disabled","ngModelChange"],[2,"float","right","width","73%","margin-top","7px"],["id","refnoInput","type","text","placeholder","Enter to Select Job Card Entry no.","autocomplete","off",2,"width","90%",3,"ngModel","disabled","ngModelChange","Keydown.Enter","focus"],[2,"width","67%",3,"ngModel","disabled","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["style","width: 67%; height: 23px; float: right; font-size: smaller; font-weight: 599; margin-top: -0.25%;",4,"ngIf"],[2,"width","67%","height","23px","float","right","font-size","smaller","font-weight","599","margin-top","-0.25%"],[2,"width","67%",3,"ngModel","disabled","ngModelChange"],["value","TransferOut",3,"selected"],["value","StockIssue"],["id","refnoInput","type","text","placeholder","Enter to Select Job Card Entry no.","autocomplete","off",2,"width","67%",3,"ngModel","disabled","ngModelChange","Keydown.Enter","focus"],["type","text","placeholder","Press Enter For Reference List","autocomplete","off","readonly","",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],["type","text","readonly","","placeholder","Press ENTER to Select Division",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[2,"width","70%",3,"ngModel","disabled","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","readonly","","placeholder","Press ENTER to Select",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],["type","text","autocomplete","off",2,"width","70%",3,"ngModel","disabled","ngModelChange"],["id","wh","name","selectedWarehouse",1,"form-control",2,"width","70%","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange"],["id","types","name","selectedWarehouse",1,"form-control",2,"width","70%","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange","change"],["value","%"],["value","fixed"],["value","others"],["type","checkbox",2,"width","10%","height","19px","margin-top","4px","margin-left","24%",3,"ngModel","disabled","change","ngModelChange"],[2,"width","auto","font-size","12px","margin-left","-7px"],["type","text","readonly","",2,"width","70%",3,"ngModel","ngModelChange"],["type","text","placeholder","Press ENTER to Select","readonly","",2,"width","70%",3,"ngModel","ngModelChange","keydown.enter"],["style","width:25%;",4,"ngIf"],["style","width:27%;",4,"ngIf"],["id","stockissueFromWH",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.enter","change"],[2,"width","27%"],["style","width: 25%;",4,"ngIf"],["type","text","placeholder","Press Enter For Transferred List","autocomplete","off",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],["type","text","placeholder","Press Enter to load Unapproved List","autocomplete","off",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[2,"width","70%",3,"ngModel","disabled","ngModelChange","change"],["value","requisition"],["value","supplier"],[2,"width","70%","padding","1px 12px",3,"ngModel","change","ngModelChange"],["id","refnoInput","type","text",2,"width","70%",3,"ngModel","disabled","ngModelChange"],["type","text","placeholder","Press Enter to load Unapproved List","autocomplete","off",2,"width","70%",3,"ngModel","ngModelChange","keydown.Enter"],["type","text",2,"width","70%",3,"disabled","ngModel","ngModelChange"],["type","text",2,"width","70%","height","24px","min-height","24px","max-height","55px",3,"disabled","ngModel","ngModelChange"],["id","stockissueFromWH","disabled","",2,"width","70%",3,"ngModel","ngModelChange"],["value","%","selected",""],["id","stockissueFromWH",2,"width","70%",3,"ngModel","disabled","ngModelChange"],["value","2"],["value","3"],[1,"btn","btn-info","pull-right",3,"click"],[2,"width","70%",3,"ngModel","disabled","change","ngModelChange"],["id","soNoId","type","text","placeholder","Enter to Select IS no.","autocomplete","off","readonly","",2,"width","30%",3,"ngModel","disabled","ngModelChange","keydown.enter","keydown.Tab"],["type","checkbox",2,"width","10%","height","19px","margin-top","4px","margin-left","8px",3,"ngModel","disabled","change","ngModelChange"],[2,"display","flex","gap","11rem"],[2,"width","auto","margin-inline-end","0.2rem"],["type","checkbox","checked","",3,"ngModel","change","ngModelChange"],["type","checkbox",3,"checked","change"],["type","button ",1,"btn","btn-info",2,"width","30%","border-radius","4px","height","30%",3,"disabled","click"],["type","text","placeholder","Press ENTER to Select","autocomplete","off","readonly","",2,"width","70%",3,"disabled","ngModel","keydown.Enter","ngModelChange"],["type","checkbox",1,"mr-2",2,"width","19px",3,"disabled","change"],[2,"width","70%"],[2,"width","6%","margin-top","-2px"],["type","checkbox",2,"width","19px",3,"ngModel","disabled","ngModelChange","change"],["id","whouse","name","selectedWarehouse",2,"width","70%","height","25px","color","black","font-size","13px","padding","1px 12px",3,"ngModel","disabled","ngModelChange","change"],["type","text","placeholder","Press Enter For Requisition List","autocomplete","off",2,"width","70%",3,"ngModel","disabled","ngModelChange","keydown.Enter"],[2,"width","40%"],["type","checkbox",2,"width","17px","height","27px",3,"ngModel","disabled","change","ngModelChange"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-6vh","margin-right","20vw"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"],["type","button",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(t,i){1&t&&(e.YNc(0,ri,57,52,"div",0),e.TgZ(1,"generic-popup-grid",1,2),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadTransferOutData(r)}),e.qZA(),e.TgZ(3,"generic-popup-grid",1,3),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadRequisitionForApproval(r)}),e.qZA(),e.TgZ(5,"generic-popup-grid",1,4),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadReferenceOutData(r)}),e.qZA(),e.TgZ(7,"generic-popup-grid",1,5),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadOnPIRefInIAData(r)}),e.qZA(),e.TgZ(9,"generic-popup-grid",1,6),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadOnSupplierClick(r)}),e.qZA(),e.TgZ(11,"generic-popup-grid",1,7),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadApprovalData(r)}),e.qZA(),e.TgZ(13,"generic-popup-grid",1,8),e.NdJ("onItemDoubleClick",function(r){return i.onSelectJobCardEntry(r)}),e.qZA(),e.YNc(15,oi,25,2,"div",9),e.TgZ(16,"negativestock-auth",10,11),e.NdJ("onNegativeStockAuthorized",function(r){return i.onNegativeStockAuthorized(r)}),e.qZA(),e.TgZ(18,"generic-popup-grid",1,12),e.NdJ("onItemDoubleClick",function(r){return i.doubleClickDivision(r)}),e.qZA(),e.TgZ(20,"generic-popup-grid",1,13),e.NdJ("onItemDoubleClick",function(r){return i.doubleClickERrefClick(r)}),e.qZA(),e.TgZ(22,"generic-popup-grid",1,14),e.NdJ("onItemDoubleClick",function(r){return i.doubleClickExcessGR(r)}),e.qZA()),2&t&&(e.Q6J("ngIf",1==i.masterService.ShowMore),e.xp6(1),e.Q6J("popupsettings",i.genericGridTransferOutSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridRequesitionSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridReferenceOutSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridPIRefSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridForSupplierSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridApprovalSetting),e.xp6(2),e.Q6J("popupsettings",i.genericGridJobCardNoSetting),e.xp6(2),e.Q6J("ngIf",1==i._trnMainService.showNegativeBillingAuthForMain),e.xp6(3),e.Q6J("popupsettings",i.gridPopupSettingsForDivision),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettingsForERref),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettingsForExcessGR))},dependencies:[m.sg,m.O5,u.YN,u.Kr,u.Fj,u.Wl,u.EJ,u.JJ,u.On,E.Zl,me.v,te,m.Ov,m.uU,be.u],encapsulation:2}),o})();var B=p(54471),U=p(41544);const si=["fileUploadPopup"];function ai(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}function ci(o,c){1&o&&(e.TgZ(0,"div",14),e._UZ(1,"discounts-insert"),e.qZA())}let ie=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_,S,g,C){this.masterService=t,this._trnMainService=i,this.alertService=n,this.router=r,this.arouter=s,this.setting=a,this.aroute=l,this.authService=h,this.loadingSerive=v,this.itemKeyEventService=_,this.entryValidateService=S,this.quantityChangeEventService=g,this.genericProductEntryService=C,this.fileUploadPopupSettings=new Z.s,"add-stock-issue-approval"==this.aroute.snapshot.url[0].path?(this._trnMainService.initialFormLoad(5),this._trnMainService.pageHeading="Stock Transfer Approval"):("add-stock-issue"==this.aroute.snapshot.url[0].path||"stock-issue-approval"==this.aroute.snapshot.url[0].path)&&this._trnMainService.initialFormLoad(5)}ngOnInit(){this.aroute.queryParams.subscribe(t=>{if("DRILL"==t.mode){let i=t.voucher,n=[];n=i.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(i,n[1],n[2]).subscribe(r=>{"ok"==r.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=r.result,this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.pageHeading="Stock Issue",this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.Mode="VIEW",null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(s=>s.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},r=>{this.loadingSerive.hide(),this.alertService.info(r)})}}),this.fileUploadPopupSettings=Object.assign(new Z.s,{title:"Stock Issue",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Stock Issue Sample"}),this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"BC",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT"},{field:"BATCH",header:"BatchNo",hidden:this.hide("BATCH"),isActiveColumnHeader:!0,inputType:"batch",headerNgStyle:{width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableBatch",n,r),onEnter:(n,r,s,a)=>{this.genericProductEntryService.BatchEnter(n,r,s,a)},onKeyPress:(n,r)=>{this.genericProductEntryService.onKeyDownBatch(n,r)}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"70px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(n,r,s)=>this.QuantityChangeEvent_default(n,r,s),onEnter:(n,r,s,a)=>this.quantityChangeEventService.AlternateQuantityEventClick(r),onKeyPress:(n,r,s,a)=>this.quantityChangeEventService.quantityKeyPress(n,r,s,a),applyTwoDigitPipe:!1,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s)=>this.mrpEnterEvent(n,r,s),onChange:(n,r,s,a)=>this.entryValidateService.MRPChangeEvent(n,r,s,a),focusTo:"ITEMDESC",disablePipe:(n,r)=>this.getColumnDisablePipe("disableRateandDiscount",n,r)},{field:"MRP",header:"MRP",hidden:this.hide("MRP"),isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"AMOUNT",header:"Amnt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"MFGDATE",header:"Mfg Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},focusTo:"EXPDATE",applyTwoDigitPipe:!1,onEnter:(n,r,s)=>{this.genericProductEntryService.MFGDateEnterEvent(n,r,s)},disablePipe:(n,r)=>this.getColumnDisablePipe("disableMfgDate",n,r)},{field:"EXPDATE",header:"Exp Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},applyTwoDigitPipe:!1,focusTo:"ITEMDESC",onEnter:(n,r,s)=>{this.genericProductEntryService.expDateEnterEvent(n,r,s)},disablePipe:(n,r)=>this.getColumnDisablePipe("disableExpDate",n,r)},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableRowDelete",n,r)}];this.genericProductEntrySetting.columns=i,this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.StockIssue,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r),this.genericProductEntrySetting.hideColumn=n=>this.hideColumn(n)}SetRowItemRate(t,i){i()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}getColumnDisablePipe(t,i,n){return t}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}hide(t){return"BATCH"==t&&(console.log("stok setting batch",this._trnMainService.userSetting),!(1==this._trnMainService.userSetting.EnableProperExpTracking||2==this._trnMainService.userSetting.EnableBatch))||(console.log("hide column method",t),"MRP"==t&&1!=this._trnMainService.userSetting.BATCHWISEPRICE)}hideColumn(t){if(!t)return!1;var i=this._trnMainService.checkRightForOptional("StockIssue","HideColumn",t.header);return!(!i||"true"!=i&&"1"!=i)||void 0}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>(this.get_showStockedQuantityOnly(),T.K.done),i=>(this.setItemPopupUrl(i),T.K.default),()=>T.K.default,()=>T.K.default,()=>T.K.default)}get_showStockedQuantityOnly(){return this.genericProductEntryService.showStockedQuantityOnly=0,this._trnMainService.TrnMainObj.VoucherType===d.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===d.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,this.genericProductEntryService.showStockedQuantityOnly}setItemPopupUrl(t){return this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${t}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this._trnMainService.userSetting.DefaultFilterIndex?this._trnMainService.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:!0,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:!0,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:!0,noSearch:!0,alignment:"right",pipe:!0}]},this.genericProductEntryService.gridPopupSettings}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}showPurchaseInvoicePopup(t){null!=this._trnMainService.TrnMainObj.BILLTOADD&&""!=this._trnMainService.TrnMainObj.BILLTOADD?this.fileUploadPopup.show():this.alertService.warning("Please select the transfer branch...")}fileUploadSuccess(t){if(console.log("file upload in stock issue",t),"ok"==t.status){if(this._trnMainService.TrnMainObj.ProdList=t.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherType=5,this._trnMainService.TrnMainObj.VoucherPrefix="IS",this._trnMainService.TrnMainObj.VoucherAbbName="IS",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="";for(let i of this._trnMainService.TrnMainObj.ProdList)i.MFGDATE=null==i.MFGDATE?"":i.MFGDATE.toString().substring(0,10),i.EXPDATE=null==i.EXPDATE?"":i.EXPDATE.toString().substring(0,10),i.REALRATE=i.ALTRATE/i.ALTCONFACTOR,i.RATE=i.ALTRATE/i.ALTCONFACTOR;""!=t.result2&&null!=t&&1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE&&(1==this._trnMainService.userSetting.ALLOWMINUSTOCK_STOCKISSUE||2==this._trnMainService.userSetting.ALLOWMINUSTOCK_STOCKISSUE)&&this.alertService.info(t.result2),this._trnMainService.ReCalculateBillWithNormal()}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(I.c),e.Y36(O.F0),e.Y36(O.gz),e.Y36(G.R),e.Y36(O.gz),e.Y36(k.e),e.Y36(j.V),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["stock-issue"]],viewQuery:function(t,i){if(1&t&&e.Gf(si,5),2&t){let n;e.iGM(n=e.CRH())&&(i.fileUploadPopup=n.first)}},features:[e._Bn([M.p,T.X,A.C,b.w,P.s])],decls:23,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onFileUploadPopupEmit"],[1,"main-container"],[4,"ngIf"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"footer-wrapper"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onFileUploadPopupEmit",function(r){return i.showPurchaseInvoicePopup(r)}),e.qZA()()()(),e.TgZ(11,"div",9),e.YNc(12,ai,2,0,"div",10),e.TgZ(13,"div",11),e.YNc(14,ci,2,0,"div",12),e.qZA()()(),e.TgZ(15,"div",13)(16,"div",11)(17,"div",14)(18,"generic-product-entry",15),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(19,"div",16),e._UZ(20,"voucher-total-area"),e.qZA()(),e.TgZ(21,"file-uploader-popup",17,18),e.NdJ("onUploaded",function(r){return i.fileUploadSuccess(r)}),e.qZA()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting),e.xp6(3),e.Q6J("popupsettings",i.fileUploadPopupSettings))},dependencies:[m.O5,L.q,x.i,w.u,N,Z.U,B.o,U.Z],encapsulation:2}),o})(),li=(()=>{class o{constructor(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["inventory"]],decls:1,vars:0,template:function(t,i){1&t&&e._UZ(0,"router-outlet")},dependencies:[O.lC],encapsulation:2}),o})();var Q=p(75810),di=p(32635);function hi(o,c){1&o&&(e.TgZ(0,"div",13),e._UZ(1,"discounts-insert"),e.qZA())}function ui(o,c){1&o&&e._UZ(0,"productentry")}function pi(o,c){1&o&&e._UZ(0,"productentryLite")}let Ti=(()=>{class o{constructor(t,i,n,r,s,a,l){this.masterService=t,this._trnMainService=i,this.itemKeyEventService=n,this.productHelperService=r,this.entryValidateService=s,this.quantityChangeEventService=a,this.genericProductEntryService=l,this._trnMainService.initialFormLoad(24)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT"},{field:"BATCH",header:"BatchNo",hidden:!1,isActiveColumnHeader:!0,inputType:"batch",headerNgStyle:{width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableBatch",n,r),onEnter:(n,r,s,a)=>{this.genericProductEntryService.BatchEnter(n,r,s,a)},onKeyPress:(n,r)=>{this.genericProductEntryService.onKeyDownBatch(n,r)}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"70px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(n,r,s)=>this.QuantityChangeEvent_default(n,r,s),onEnter:(n,r,s,a)=>this.quantityChangeEventService.AlternateQuantityEventClick(r),onKeyPress:(n,r,s,a)=>this.quantityChangeEventService.quantityKeyPress(n,r,s,a),applyTwoDigitPipe:!1,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s)=>this.mrpEnterEvent(n,r,s),onChange:(n,r,s,a)=>this.entryValidateService.MRPChangeEvent(n,r,s,a),focusTo:"INDDISCOUNTRATE",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"AMOUNT",header:"Amnt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"MRP",header:"Sales Price",hidden:this.hide("MRP"),isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s,a)=>this.genericProductEntryService.onTabMRP(a,r),onChange:(n,r,s,a)=>this.genericProductEntryService.RecalculateMRP(),focusTo:"SPRICE",disablePipe:(n,r)=>this.getColumnDisablePipe("disableOnView",n,r)},{field:"SPRICE",header:"Sales Price(W/V)",hidden:this.hide("SPRICE"),isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s,a)=>this.genericProductEntryService.onTabSPRICE(a,r),onChange:(n,r,s,a)=>this.genericProductEntryService.RecalculateSPRICE(),focusTo:"VSRATE",disablePipe:(n,r)=>this.getColumnDisablePipe("disableOnView",n,r)},{field:"VSRATE",header:"WSP",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s,a)=>this.genericProductEntryService.onTabVSRATE(a),onChange:(n,r,s,a)=>this.genericProductEntryService.RecalculateVSRATE(),focusTo:"VPRATE",disablePipe:(n,r)=>this.getColumnDisablePipe("disableOnView",n,r)},{field:"VPRATE",header:"WSP(W/V)",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s,a)=>this.genericProductEntryService.onTabVPRATE(a,r),onChange:(n,r,s,a)=>this.genericProductEntryService.RecalculateVPRATE(),focusTo:"ITEMDESC",disablePipe:(n,r)=>this.getColumnDisablePipe("disableOnView",n,r)},{field:"MFGDATE",header:"Mfg Date",hidden:!1,inputType:"date",isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},focusTo:"EXPDATE",applyTwoDigitPipe:!1,onEnter:(n,r,s)=>{this.genericProductEntryService.MFGDateEnterEvent(n,r,s)},onModelChange:(n,r,s,a)=>this.productHelperService.CalculateExpiryDate(a.MFGDATE,s,a),disablePipe:(n,r)=>this.getColumnDisablePipe("disableMfgDate",n,r)},{field:"EXPDATE",header:"Exp Date",inputType:"date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},applyTwoDigitPipe:!1,focusTo:"ITEMDESC",onEnter:(n,r,s)=>{this.genericProductEntryService.expDateEnterEvent(n,r,s)},disablePipe:(n,r)=>this.getColumnDisablePipe("disableExpDate",n,r)},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableRowDelete",n,r)}];this.genericProductEntrySetting.columns=i,this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.StockIssue,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r)}hide(t){return("MRP"==t||"SPRICE"==t)&&1==this._trnMainService.userSetting.BATCHWISEPRICE||("VSRATE"==t||"VPRATE"==t)&&1==this._trnMainService.userSetting.BATCHWISEPRICE&&1==this._trnMainService.userSetting.ENABLEWSALESRATEBILLING}SetRowItemRate(t,i){i()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}getColumnDisablePipe(t,i,n){return t}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>(this.get_showStockedQuantityOnly(),T.K.done),i=>(this.setItemPopupUrl(i),T.K.default),()=>T.K.default,()=>T.K.default,()=>T.K.default)}get_showStockedQuantityOnly(){return this.genericProductEntryService.showStockedQuantityOnly=0,this._trnMainService.TrnMainObj.VoucherType===d.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===d.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,this.genericProductEntryService.showStockedQuantityOnly}setItemPopupUrl(t){return this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${t}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this._trnMainService.userSetting.DefaultFilterIndex?this._trnMainService.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:!0,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:!0,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:!0,noSearch:!0,alignment:"right",pipe:!0}]},this.genericProductEntryService.gridPopupSettings}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(T.X),e.Y36(F.h),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["openingstockentry"]],features:[e._Bn([M.p,T.X,F.h,A.C,b.w,P.s])],decls:23,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top",2,"padding-bottom","1px"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[3,"hidden"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[4,"ngIf"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8)(12,"div",9),e._UZ(13,"inv-params"),e.qZA(),e.TgZ(14,"div",10),e.YNc(15,hi,2,0,"div",11),e.qZA()()(),e.TgZ(16,"div",12)(17,"div",10)(18,"div",13),e.YNc(19,ui,1,0,"productentry",14),e.YNc(20,pi,1,0,"productentryLite",14),e.qZA()()(),e.TgZ(21,"div",15),e._UZ(22,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(3),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("ngIf","pro"==i._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf","lite"==i._trnMainService.AppMode))},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N,B.o,di.j],encapsulation:2}),o})();const _i=["genericGridSO"],vi=["genericGridUnApproveList"];function Mi(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}function Si(o,c){1&o&&(e.TgZ(0,"div",16),e._UZ(1,"discounts-insert"),e.qZA())}let gi=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v){this._trnMainService=t,this.masterService=i,this.arouter=n,this.alertService=r,this.setting=s,this.genericProductEntryService=a,this.itemKeyEventService=l,this.quantityChangeEventService=h,this.entryValidateService=v,this.gridPopupSettings=new E.im,this.gridPopupApproveSettings=new E.im,this.genericProductEntryService.activeurlpath=this.arouter.snapshot.url[0].path,this._trnMainService.initialFormLoad(9),this._trnMainService.settlementList=[],this.masterService.getSettlementMode().subscribe(_=>{this._trnMainService.settlementList.push(_)}),this.setProductEntryTable(),console.log({setting:this.genericProductEntrySetting}),this.gridPopupSettings={title:"Settlement Item",apiEndpoints:"/getTrnMainPagedList/DM/tag",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"REMARKS",title:"Remarks",hidden:!1,noSearch:!1},{key:"TRNMODE",title:"Settlement Mode",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1}]},this.gridPopupApproveSettings={title:"Unapproved Settlement Item",apiEndpoints:"/getUnApprovedStockSettlementPagedList",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"Voucher No.",hidden:!1,noSearch:!1},{key:"REMARKS",title:"Remarks",hidden:!1,noSearch:!1},{key:"TRNMODE",title:"Settlement Mode",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"Date",hidden:!1,noSearch:!1}]}}ngOnInit(){"StockSettlementEntryApproval"==this.genericProductEntryService.activeurlpath&&(this._trnMainService.pageHeading="Stock Settlement Approval"),this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{border:"1px solid #e6e6e6",width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{border:"1px solid #e6e6e6",width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{border:"1px solid #e6e6e6",width:"180px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r)},{field:"BATCH",header:"Batch",hidden:!0,isActiveColumnHeader:!0,inputType:"batch",headerNgStyle:{border:"1px solid #e6e6e6",width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{border:"1px solid #e6e6e6",width:"60px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{border:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"RATE",onChange:(n,r,s)=>this.QuantityChangeEvent(n,r,s),applyTwoDigitPipe:!1,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"RATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{border:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s)=>this.mrpEnterEvent(n,r,s),focusTo:"ITEMDESC",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"AMOUNT",header:"Amnt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{border:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{border:"1px solid #e6e6e6",width:"40px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.StockSettlement,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r)}getColumnDisablePipe(t,i,n){return t}quantiyOnChange(t,i,n){console.log({col:i,index:n,rate:this._trnMainService.TrnMainObj.ProdList[n].RATE,qty:this._trnMainService.TrnMainObj.ProdList[n].Quantity}),this._trnMainService.TrnMainObj.ProdList[n].AMOUNT=(this._trnMainService.TrnMainObj.ProdList[n].RATE||0)*this._trnMainService.TrnMainObj.ProdList[n].Quantity}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}QuantityChangeEvent(t,i,n){var r=n;this.quantityChangeEventService.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.allowMinusStockInEditMode(this.genericProductEntryService.activerowIndex),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal(),console.log("activerowinsert",this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_new(t,i,n){"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.allowMinusStockInEditMode(n),this.reCalculateBillWithNormal(this._trnMainService.TrnMainObj.ProdList[n]),console.log("activerowinsert",n)}nullToZeroConverter(t){return void 0===t||null==t||null===t||""===t||"Infinity"===t||"NaN"===t||NaN===t||isNaN(parseFloat(t))?0:parseFloat(t)}reCalculateBillWithNormal(t){let i;i=this.nullToZeroConverter(t.ALTERNATEQUANTIY),t.ALTQTY_IN=t.REALQTY_IN=t.Quantity=t.AltQty=t.RealQty=i,t.REALQTY_IN=0,t.ALTQTY_IN=0,t.AMOUNT=i*this.nullToZeroConverter(t.RATE),"kg"===t.Weighable||"ltr"===t.Weighable?t.WEIGHT=i*this.nullToZeroConverter(t.PWEIGHT):("gram"===t.Weighable||"ml"===t.Weighable)&&(t.WEIGHT=i*this.nullToZeroConverter(t.PWEIGHT/1e3)),t.NCRATE=t.RATE*t.EXRATE,t.GSTRATE=1==t.ISVAT?13:0,t.TAXABLE=0,t.VAT=0,t.NONTAXABLE=t.AMOUNT+this.nullToZeroConverter(t.ECSAMOUNT)-t.DISCOUNT+this.nullToZeroConverter(t.SERVICETAX),t.NETAMOUNT=t.TAXABLE+t.NONTAXABLE+t.VAT+this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TOTAMNT+=this.nullToZeroConverter(t.AMOUNT),this._trnMainService.TrnMainObj.GROSSAMNT+=this.nullToZeroConverter(t.Quantity*t.RATE),this._trnMainService.TrnMainObj.TOTALINDDISCOUNT+=this.nullToZeroConverter(t.INDDISCOUNT),this._trnMainService.TrnMainObj.TOTALLOYALTY+=this.nullToZeroConverter(t.LOYALTY),this._trnMainService.TrnMainObj.TOTALPROMOTION+=this.nullToZeroConverter(t.PROMOTION),this._trnMainService.TrnMainObj.DCAMNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.ServiceCharge+=this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TAXABLE+=this.nullToZeroConverter(t.TAXABLE),this._trnMainService.TrnMainObj.NONTAXABLE+=this.nullToZeroConverter(t.NONTAXABLE),this._trnMainService.TrnMainObj.VATAMNT+=this.nullToZeroConverter(t.VAT),this._trnMainService.TrnMainObj.NETAMNT+=this.nullToZeroConverter(t.NETAMOUNT),this._trnMainService.TrnMainObj.TotalWithIndDiscount+=this.nullToZeroConverter(t.TOTAL),this._trnMainService.TrnMainObj.TOTALDISCOUNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.TOTALQTY+=i,this._trnMainService.TrnMainObj.TOTALSQTY+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.TOTALWEIGHT+=this.nullToZeroConverter(t.WEIGHT),this._trnMainService.TrnMainObj.totalAlternateQuantity+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.totalBaseQuantity+=this.nullToZeroConverter(t.BASEQUANTITY),this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT+=this.nullToZeroConverter(t.PrimaryDiscount),this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT+=this.nullToZeroConverter(t.SecondaryDiscount),this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT+=this.nullToZeroConverter(t.LiquiditionDiscount),this._trnMainService.TOTALALLDISCOUNT=this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALQPSDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT),this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=Math.round(this.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)),this._trnMainService.TrnMainObj.ROUNDOFF=this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF-this._trnMainService.TrnMainObj.NETAMNT}showLoadFromStockSettlement(t){this.genericGridUnApproveList.show()}onItemDoubleClick(t){this.loadVoucher(t)}saveChangeStockSettlement(t){this.genericGridSO.show()}onApproveStockSettlementList(t){this.genericGridSO.show()}loadVoucher(t){this._trnMainService.loadData(t.VCHRNO,t.DIVISION,t.PhiscalID)}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>(this.get_showStockedQuantityOnly(),T.K.done),i=>(this.setItemPopupUrl(i),T.K.default),()=>T.K.default)}itemKeyEvent_CheckRefBill(){{this.genericProductEntryService.showStockedQuantityOnly=0;let i,t="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(t=this._trnMainService.TrnMainObj.VoucherPrefix);let n="";return n=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC,(0==this._trnMainService.userSetting.GblBarcodeWiseBilling||null==i||void 0===i||""==i)&&(i="A"),this.genericProductEntryService.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.genericProductEntryService.showStockedQuantityOnly}/${i}/all/${t}/${n}`,this._trnMainService.itemselectevent=!0,this.genericProductEntryService.genericGrid.show(this._trnMainService.TrnMainObj.REFBILL),!1}}itemKeyEvent_CheckFlatDiscount(){if(this._trnMainService.TrnMainObj.VoucherType===d.Km.Purchase&&(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)>0||this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.DCRATE)>0))return this.alertService.info("Flat Discount is already given could not add new product"),!0}get_showStockedQuantityOnly(){return this.genericProductEntryService.showStockedQuantityOnly=0,this._trnMainService.TrnMainObj.VoucherType===d.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===d.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,this.genericProductEntryService.showStockedQuantityOnly}displayProductDetailInViewMode(t){}setItemPopupUrl(t){return this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${t}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this._trnMainService.userSetting.DefaultFilterIndex?this._trnMainService.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:!0,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:!0,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:!0,noSearch:!0,alignment:"right",pipe:!0}]},this.genericProductEntryService.gridPopupSettings}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>!0,()=>({useDefault:!0,preCheck:!0}),()=>(this.reCalculateBillWithNormal(t),!1))}validateRate(t,i){if(t.ALTRATE<1||null==t.ALTRATE||null==t.ALTRATE)return confirm(" Zero  Rate Entry Detected For Item '"+t.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")?(console.log("reachq"),!1):(document.getElementById("rate"+i).focus(),console.log("reachq"),!0)}checkValidation(t){var i=this._trnMainService.TrnMainObj.ProdList[t];if(null==i)return;if(null==i.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this.ReCalculateBillWithNormal(),!this._trnMainService.TrnMainObj.ProdList.some(r=>null==r.MCODE)&&!1===this.addRow())return;let n=t+1;setTimeout(()=>{const r=document.getElementById("ITEMDESC"+n);console.log({controltofocus:r}),r?.focus()},100)}addRow(){console.log("ADDROW");try{return null==this._trnMainService.TrnMainObj.ProdList&&(this._trnMainService.TrnMainObj.ProdList=[]),this._trnMainService.TrnMainObj.ProdList.push({inputMode:!0,MENUCODE:null,ITEMDESC:null,RATE:null,NCRATE:null,AMOUNT:null,INDDISCOUNTRATE:null,INDDISCOUNT:null,DISCOUNT:null,VAT:null,NETAMOUNT:null,ITEMTYPE:null,RECEIVEDTYPE:null,WAREHOUSE:null,BC:null,ALTERNATEQUANTIY:null,PRATE:0,isConfirmed:!1,IsAuthorizeForNegative:!1}),this._trnMainService.checkBatchWiseApiResponses=!1,!0}catch(t){return console.log({error:t}),!1}}ReCalculateBillWithNormal(){try{console.log("CheckProd#",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.TrnMainObj.TOTAMNT=0,this._trnMainService.TrnMainObj.TOTALINDDISCOUNT=0,this._trnMainService.TrnMainObj.TOTALPROMOTION=0,this._trnMainService.TrnMainObj.TOTALLOYALTY=0,this._trnMainService.TrnMainObj.DCAMNT=0,this._trnMainService.TrnMainObj.ServiceCharge=0,this._trnMainService.TrnMainObj.TAXABLE=0,this._trnMainService.TrnMainObj.NONTAXABLE=0,this._trnMainService.TrnMainObj.NETAMNT=0,this._trnMainService.TrnMainObj.VATAMNT=0,this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=0,this._trnMainService.TrnMainObj.NETAMNT=0,this._trnMainService.TrnMainObj.TotalWithIndDiscount=0,this._trnMainService.TrnMainObj.TOTALDISCOUNT=0,this._trnMainService.TrnMainObj.TOTALQTY=0,this._trnMainService.TrnMainObj.TOTALWEIGHT=0,this._trnMainService.TrnMainObj.totalAlternateQuantity=0,this._trnMainService.TrnMainObj.totalBaseQuantity=0,this._trnMainService.TrnMainObj.TOTALECSAMOUNT=0,this._trnMainService.TrnMainObj.GROSSAMNT=0,this._trnMainService.TrnMainObj.TOTALSQTY=0,this._trnMainService.TrnMainObj.ProdList.forEach(t=>{let n;t.VoucherType=this._trnMainService.TrnMainObj.VoucherType,t.ALTUNIT===t.BASEUNIT?n=this.nullToZeroConverter(t.ALTERNATEQUANTIY):(n=this.nullToZeroConverter(t.ALTERNATEQUANTIY)*this.nullToZeroConverter(t.ALTCONFACTOR),t.RATE=this.nullToZeroConverter(t.ALTRATE)/this.nullToZeroConverter(t.ALTCONFACTOR)),t.ALTQTY_IN=t.REALQTY_IN=t.Quantity=t.AltQty=t.RealQty=n,t.REALQTY_IN=0,t.ALTQTY_IN=0,t.AMOUNT=n*this.nullToZeroConverter(t.RATE),"kg"===t.Weighable||"ltr"===t.Weighable?t.WEIGHT=n*this.nullToZeroConverter(t.PWEIGHT):("gram"===t.Weighable||"ml"===t.Weighable)&&(t.WEIGHT=n*this.nullToZeroConverter(t.PWEIGHT/1e3));let r=this.nullToZeroConverter(t.INDDISCOUNT)+this.nullToZeroConverter(t.PROMOTION)+this.nullToZeroConverter(t.LOYALTY)+this.nullToZeroConverter(t.PrimaryDiscount)+this.nullToZeroConverter(t.SecondaryDiscount)+this.nullToZeroConverter(t.LiquiditionDiscount),s=0;this._trnMainService.TrnMainObj.ProdList.forEach(l=>{s+=n*this.nullToZeroConverter(l.RATE)-this.nullToZeroConverter(l.INDDISCOUNT)-this.nullToZeroConverter(l.PROMOTION)-this.nullToZeroConverter(l.LOYALTY)-this.nullToZeroConverter(l.PrimaryDiscount)-this.nullToZeroConverter(l.SecondaryDiscount)-this.nullToZeroConverter(l.LiquiditionDiscount)}),0===s&&(t.FLATDISCOUNT=0),t.DISCOUNT=r+this.nullToZeroConverter(t.FLATDISCOUNT),1===t.ISSERVICECHARGE&&1===this._trnMainService.userSetting.EnableServiceCharge&&(t.SERVICETAX=(t.AMOUNT-t.DISCOUNT)*this.setting.appSetting.ServiceTaxRate),t.NCRATE=t.RATE*t.EXRATE,t.GSTRATE=1==t.ISVAT?13:0,t.TAXABLE=0,t.VAT=0,t.NONTAXABLE=t.AMOUNT+this.nullToZeroConverter(t.ECSAMOUNT)-t.DISCOUNT+this.nullToZeroConverter(t.SERVICETAX),t.NETAMOUNT=t.TAXABLE+t.NONTAXABLE+t.VAT+this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TOTAMNT+=this.nullToZeroConverter(t.AMOUNT),this._trnMainService.TrnMainObj.GROSSAMNT+=this.nullToZeroConverter(t.Quantity*t.RATE),this._trnMainService.TrnMainObj.TOTALINDDISCOUNT+=this.nullToZeroConverter(t.INDDISCOUNT),this._trnMainService.TrnMainObj.TOTALLOYALTY+=this.nullToZeroConverter(t.LOYALTY),this._trnMainService.TrnMainObj.TOTALPROMOTION+=this.nullToZeroConverter(t.PROMOTION),this._trnMainService.TrnMainObj.DCAMNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.ServiceCharge+=this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TAXABLE+=this.nullToZeroConverter(t.TAXABLE),this._trnMainService.TrnMainObj.NONTAXABLE+=this.nullToZeroConverter(t.NONTAXABLE),this._trnMainService.TrnMainObj.VATAMNT+=this.nullToZeroConverter(t.VAT),this._trnMainService.TrnMainObj.NETAMNT+=this.nullToZeroConverter(t.NETAMOUNT),this._trnMainService.TrnMainObj.TotalWithIndDiscount+=this.nullToZeroConverter(t.TOTAL),this._trnMainService.TrnMainObj.TOTALDISCOUNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.TOTALQTY+=n,this._trnMainService.TrnMainObj.TOTALSQTY+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.TOTALWEIGHT+=this.nullToZeroConverter(t.WEIGHT),this._trnMainService.TrnMainObj.totalAlternateQuantity+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.totalBaseQuantity+=this.nullToZeroConverter(t.BASEQUANTITY),this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT+=this.nullToZeroConverter(t.PrimaryDiscount),this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT+=this.nullToZeroConverter(t.SecondaryDiscount),this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT+=this.nullToZeroConverter(t.LiquiditionDiscount),this._trnMainService.TOTALALLDISCOUNT=this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALQPSDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)}),this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=Math.round(this.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)),this._trnMainService.TrnMainObj.ROUNDOFF=this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF-this._trnMainService.TrnMainObj.NETAMNT}catch{}}SetRowItemFromSelectedItem(t){if(this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex]){this.genericProductEntryService.batchlist=[];let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];i.RATE=t.RATE,i.BASERATE=t.RATE,i.ALTRATE=t.RATE,i.PTYPE=t.PTYPE,i.ECSRATE=t.ECSRATE,i.HASECSCHARGE=t.HASECSCHARGE,i.NATURETYPE=t.NATURETYPE,i.ENABLEITEMWISEBATCH=t.ENABLEITEMWISEBATCH,i.isPurchaseOrder=!1,i.REQEXPDATE=t.REQEXPDATE,i.DISMODE=t.DISMODE,i.PWEIGHT=t.GWEIGHT,i.PROMOTION=0,i.BATCHSCHEME=null,i.ALLSCHEME=null,i.ISVAT=t.ISVAT,i.MENUCODE=t.MENUCODE,i.ITEMDESC=t.DESCA,i.MCODE=t.MCODE,i.WEIGHT=t.GWEIGHT,i.Mcat=t.MCAT,i.BASEUNIT=t.BASEUNIT,i.SHELFLIFE=t.SHELFLIFE,i.Weighable=t.Weighable,i.MRP=t.MRP,i.ALTCONFACTOR=t.CONFACTOR,i.BARCODE=t.BARCODE,i.TOTSTOCK=t.STOCK,i.PSTOCK=t.PSTOCK,i.UNIT=t.BASEUNIT,i.WARRANTY=t.WARRANTY,i.W_MRP=t.W_MRP,i.W_SELLRATEBEFORETAX=t.W_SELLRATEBEFORETAX,i.STOCK=t.STOCK,i.WSRATE_DISCOUNT=t.WSRATE_DISCOUNT,i.MINLEVEL=t.MINLEVEL,i.MAXLEVEL=t.MAXLEVEL,i.ROLEVEL=t.ROLEVEL,i.ROWARN=t.ROWARN,i.MINWARN=t.MINWARN,i.HASVARIANT=t.HASVARIANT,i.Mcat=t.MCAT,i.REMARKS=t.REMARKS,i.PRATE=t.PRATE,i.ISRECURRING=t.ISRECURRING,i.HASCOMMISSIONCHARGE=t.HASCOMMISSIONCHARGE,1==t.HASVARIANT&&(i.BC=t.BC),1==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].NATURETYPE&&!this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].NATURETYPE&&1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].isItemDesReadonly=!0)}this.genericProductEntrySetting.getIdToSetFocus=this.GetIdTofocusAfterItemSelect()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}SetRowItemRate(t,i){10!=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].PTYPE&&this.genericProductEntryService.checkBatchWiseRate(),(1===this._trnMainService.userSetting.EnableBatch||2===this._trnMainService.userSetting.EnableBatch)&&10!==t.PTYPE&&9!==t.PTYPE&&!1===this.genericProductEntryService.itemFromBC(t.HASVARIANT)&&this.genericProductEntryService.checkBatchWiseRate()}GetIdTofocusAfterItemSelect(){return 2==this._trnMainService.userSetting.EnableBatch?"BATCH"+this.genericProductEntryService.activerowIndex:"ALTERNATEUNIT"+this.genericProductEntryService.activerowIndex}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.p),e.Y36(f.P),e.Y36(O.gz),e.Y36(I.c),e.Y36(G.R),e.Y36(b.w),e.Y36(T.X),e.Y36(P.s),e.Y36(A.C))},o.\u0275cmp=e.Xpm({type:o,selectors:[["StockSettlement"]],viewQuery:function(t,i){if(1&t&&(e.Gf(_i,5),e.Gf(vi,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGridSO=n.first),e.iGM(n=e.CRH())&&(i.genericGridUnApproveList=n.first)}},features:[e._Bn([M.p,T.X,b.w,P.s,A.C])],decls:25,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-8"],[3,"onLoadFromStockSettlementApproval","onApproveStockSettlementList"],[3,"popupsettings","onItemDoubleClick"],["genericGridSO",""],[1,"main-container"],[4,"ngIf"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"row",2,"margin-top","5px"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"footer-wrapper"],["genericGridUnApproveList",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",4)(7,"label",5),e._uU(8),e.qZA()(),e.TgZ(9,"div",6)(10,"voucher-master-action",7),e.NdJ("onLoadFromStockSettlementApproval",function(r){return i.showLoadFromStockSettlement(r)})("onApproveStockSettlementList",function(r){return i.onApproveStockSettlementList(r)}),e.qZA(),e.TgZ(11,"generic-popup-grid",8,9),e.NdJ("onItemDoubleClick",function(r){return i.onItemDoubleClick(r)}),e.qZA()()()(),e.TgZ(13,"div",10),e.YNc(14,Mi,2,0,"div",11),e.TgZ(15,"div",12),e.YNc(16,Si,2,0,"div",13),e.qZA()()(),e.TgZ(17,"div",14)(18,"div",15)(19,"div",16)(20,"generic-product-entry",17),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(21,"div",18),e._UZ(22,"voucher-total-area"),e.qZA()(),e.TgZ(23,"generic-popup-grid",8,19),e.NdJ("onItemDoubleClick",function(r){return i.onItemDoubleClick(r)}),e.qZA()),2&t&&(e.xp6(8),e.Oqu(i._trnMainService.pageHeading),e.xp6(3),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(3),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting),e.xp6(3),e.Q6J("popupsettings",i.gridPopupApproveSettings))},dependencies:[m.O5,L.q,x.i,w.u,N,E.Zl,B.o,U.Z],encapsulation:2}),o})();function mi(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Ci=(()=>{class o{constructor(t,i,n,r,s,a,l){this.masterService=t,this.alertService=i,this.quantityChangeEventService=n,this._trnMainService=r,this.itemKeyEventService=s,this.genericProductEntryService=a,this.cdref=l,this._trnMainService.initialFormLoad(7)}ngOnInit(){this.setProductEntryTable(),this.cdref.detectChanges(),1==this._trnMainService.userSetting.IsBBSM?this.assignQuantityColumnInGrid():this.assignConFactorAndRateColumnInGrid()}setProductEntryTable(){this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"20px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"BC",header:"Barcode",hidden:!1,inputType:"barcodeInputText",isActiveColumnHeader:!0,headerNgStyle:{width:"60px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableBarcodeField",i,n),focusTo:"ITEMDESC"},{field:"ITEMDESC",header:"Description",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"200px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableItemDesc",i,n)},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"60px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltUnit",i,n)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(i,n,r)=>this.QuantityChangeEvent_default(i,n,r),applyTwoDigitPipe:!1,disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"AMOUNT",header:"Amnt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"MFGDATE",header:"Mfg Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"6%"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},applyTwoDigitPipe:!1},{field:"EXPDATE",header:"Exp Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"6%"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},applyTwoDigitPipe:!1},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"40px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.setRowItemFromSelectedItem=i=>this.SetRowItemFromSelectedItem(i),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(i,n=new Function)=>this.SetRowItemRate(i,n)}assignQuantityColumnInGrid(){let t=[{field:"ShortageQuantity",header:"Shortage Qty",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"DamageQuantity",onChange:(i,n,r,s)=>this.shortageQtyChange(i,n,r,s),applyTwoDigitPipe:!1,disablePipe:(i,n)=>this.getColumnDisablePipe("disableQtyInTR",i,n)},{field:"DamageQuantity",header:"Damage Qty",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ExcessQuantity",onChange:(i,n,r,s)=>this.damageQtyChange(i,n,r,s),applyTwoDigitPipe:!1,disablePipe:(i,n)=>this.getColumnDisablePipe("disableQtyInTR",i,n)},{field:"ExcessQuantity",header:"Excess Qty",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"OPQTY",applyTwoDigitPipe:!1,onChange:(i,n,r,s)=>this.excessQtyChange(i,n,r,s),disablePipe:(i,n)=>this.getColumnDisablePipe("disableQtyInTR",i,n)},{field:"TotalReceived",header:"Received Qty",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"OPQTY",applyTwoDigitPipe:!1,onChange:(i,n,r,s)=>this.excessQtyChange(i,n,r,s),disablePipe:(i,n)=>this.getColumnDisablePipe("disableQtyInTR",i,n)}];for(let i=0;i<t?.length;i++)this.genericProductEntrySetting.columns.splice(6+i,0,t[i])}assignConFactorAndRateColumnInGrid(){let t=[{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"ALTCONFACTOR",header:"Con. Factor",hidden:1!=this._trnMainService.userSetting.IsBBSM,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,focusTo:"OPQTY",disablePipe:(i,n)=>this.getColumnDisablePipe("",i,n)}];for(let i=0;i<t?.length;i++)this.genericProductEntrySetting.columns.splice(6+i,0,t[i])}shortageQtyChange(t,i,n,r){r.ShortageQuantity>0&&r.ExcessQuantity>0&&(this.alertService.info("Both Shortage and Excess Quantity cannot have values"),r.ShortageQuantity=0),r.TotalReceived=r.ALTERNATEQUANTIY-r.ShortageQuantity-r.DamageQuantity+r.ExcessQuantity}excessQtyChange(t,i,n,r){r.ShortageQuantity>0&&r.ExcessQuantity>0&&(this.alertService.info("Both Shortage and Excess Quantity cannot have values"),r.ExcessQuantity=0),r.TotalReceived=r.ALTERNATEQUANTIY-r.ShortageQuantity-r.DamageQuantity+r.ExcessQuantity}damageQtyChange(t,i,n,r){r.TotalReceived=r.ALTERNATEQUANTIY-r.ShortageQuantity-r.DamageQuantity+r.ExcessQuantity}getColumnDisablePipe(t,i,n){return t}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}SetRowItemRate(t,i){}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>T.K.default,i=>T.K.default,()=>T.K.default,()=>T.K.default,()=>T.K.default)}QuantityChangeEvent(t,i,n){var r=n;this.quantityChangeEventService.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.allowMinusStockInEditMode(this.genericProductEntryService.activerowIndex),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal(),console.log("activerowinsert",this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(I.c),e.Y36(P.s),e.Y36(M.p),e.Y36(T.X),e.Y36(b.w),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["branch-in"]],features:[e._Bn([M.p,b.w,T.X,P.s,b.w])],decls:19,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,mi,2,0,"div",9),e.qZA()(),e.TgZ(13,"div",10)(14,"div",11)(15,"div",12)(16,"generic-product-entry",13),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(17,"div",14),e._UZ(18,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(4),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,L.q,x.i,w.u,N,U.Z],styles:["th[_ngcontent-%COMP%]{\n    white-space: nowrap !important;\n  }"]}),o})();var Y=p(79765),ne=p(46782),bi=p(61574),fi=p(76018);const Oi=["fileUploadPopup"],Ei=["NegativeAuth"];function Ai(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}function Pi(o,c){1&o&&(e.TgZ(0,"div",14),e._UZ(1,"discounts-insert"),e.qZA())}function Ii(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"app-quantity-change-popup",21),e.NdJ("showChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.transferOutFromNotificationPopup=n)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("show",t.transferOutFromNotificationPopup)}}let re=(()=>{class o{constructor(t,i,n,r,s){this.masterService=t,this.alertService=i,this._trnMainService=n,this.route=r,this.dataCommunication=s,this.fileUploadPopupSettings=new Z.s,this.transferOutFromNotificationPopup=!1,this.destroy$=new Y.xQ,this._trnMainService.initialFormLoad(8)}ngOnDestroy(){this.dataCommunication.launchTransferOutPopup(null),this.destroy$.next(!0),this.destroy$.complete()}ngOnInit(){this.dataCommunication.transferOutFromNotification$.pipe((0,ne.R)(this.destroy$)).subscribe(t=>{this._trnMainService.loadFullRequesitoninTo(t,!0),this.transferOutFromNotificationPopup=!0}),this.fileUploadPopupSettings=Object.assign(new Z.s,{title:"Transfer Out ",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Transfer Out Sample"})}showPurchaseInvoicePopup(t){null!=this._trnMainService.TrnMainObj.BILLTOADD&&""!=this._trnMainService.TrnMainObj.BILLTOADD?this.fileUploadPopup.show():this.alertService.warning("Please select the transfer branch...")}fileUploadSuccess(t){if(console.log("upload success",t),"ok"==t.status){if(this._trnMainService.TrnMainObj.ProdList=t.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherType=8,this._trnMainService.TrnMainObj.VoucherPrefix="TO",this._trnMainService.TrnMainObj.VoucherAbbName="TO",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.TrnMainObj.VCHRNO="",this._trnMainService.TrnMainObj.CHALANNO="";for(let i of this._trnMainService.TrnMainObj.ProdList)i.MFGDATE=null==i.MFGDATE?"":i.MFGDATE.toString().substring(0,10),i.EXPDATE=null==i.EXPDATE?"":i.EXPDATE.toString().substring(0,10),i.REALRATE=i.ALTRATE/i.ALTCONFACTOR,i.RATE=i.ALTRATE/i.ALTCONFACTOR;""!=t.result2&&null!=t&&1==this._trnMainService.userSetting.ENABLESINGLEBATCHMODE&&(1==this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT||2==this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT)&&(this.alertService.info(t.result2),this.alertService.emitShowHideSubject.subscribe(i=>{console.log("result",i),2==this._trnMainService.userSetting.ALLOWMINUSTOCK_TRANSFEROUT&&(this.NegativeAuthPopup.show(),this.alertService.emitShowHideSubject.unsubscribe(),this.alertService.emitShowHideSubject=new Y.xQ)})),this._trnMainService.prePareVariantDescription(),this._trnMainService.ReCalculateBillWithNormal()}}onNegativeStockAuthorized(t){console.log("onNegativeStockAuthorized",t),t||this._trnMainService.filterOnNoAuthorization()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(I.c),e.Y36(M.p),e.Y36(O.gz),e.Y36(bi.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["branch-out"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Oi,5),e.Gf(Ei,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.fileUploadPopup=n.first),e.iGM(n=e.CRH())&&(i.NegativeAuthPopup=n.first)}},features:[e._Bn([M.p])],decls:26,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onFileUploadPopupEmit"],[1,"main-container"],[4,"ngIf"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[1,"footer-wrapper"],[3,"show","showChange",4,"ngIf"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""],[3,"onNegativeStockAuthorized"],["NegativeAuth",""],[3,"show","showChange"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onFileUploadPopupEmit",function(r){return i.showPurchaseInvoicePopup(r)}),e.qZA()()()(),e.TgZ(11,"div",9),e.YNc(12,Ai,2,0,"div",10),e.TgZ(13,"div",11),e.YNc(14,Pi,2,0,"div",12),e.qZA()()(),e.TgZ(15,"div",13)(16,"div",11)(17,"div",14),e._UZ(18,"productentry"),e.qZA()()(),e.TgZ(19,"div",15),e._UZ(20,"voucher-total-area"),e.qZA()(),e.YNc(21,Ii,1,1,"app-quantity-change-popup",16),e.TgZ(22,"file-uploader-popup",17,18),e.NdJ("onUploaded",function(r){return i.fileUploadSuccess(r)}),e.qZA(),e.TgZ(24,"negativestock-auth",19,20),e.NdJ("onNegativeStockAuthorized",function(r){return i.onNegativeStockAuthorized(r)}),e.qZA()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(7),e.Q6J("ngIf",i.transferOutFromNotificationPopup),e.xp6(1),e.Q6J("popupsettings",i.fileUploadPopupSettings))},dependencies:[fi.E,m.O5,Q.x,L.q,x.i,w.u,N,Z.U,B.o,te],encapsulation:2}),o})();function yi(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Li=(()=>{class o{constructor(t,i,n,r,s){this.masterService=t,this._trnMainService=i,this.alertService=n,this.loadingService=r,this.route=s,this._trnMainService.initialFormLoad(74)}ngOnInit(){this.route.queryParams.subscribe(t=>{if("DRILL"==t.mode){let i=t.voucher,n=[];n=i.split("-"),this.loadingService.show("Loading voucher..."),this.masterService.LoadTransaction(i,n[1],n[2]).subscribe(r=>{"ok"==r.status&&(this.loadingService.hide(),this._trnMainService.TrnMainObj=r.result,this._trnMainService.TrnMainObj.VoucherType=74,this._trnMainService.pageHeading="REPACK ENTRY",this._trnMainService.TrnMainObj.VoucherPrefix="RP",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.callPipe=!this._trnMainService.callPipe,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(s=>s.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},r=>{this.loadingService.hide(),this.alertService.error(r)})}else this.masterService.refreshTransactionList()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(I.c),e.Y36(j.V),e.Y36(O.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["repack-entry"]],features:[e._Bn([M.p])],decls:19,vars:3,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,yi,2,0,"div",9),e.qZA()(),e.TgZ(13,"div",10)(14,"div",11)(15,"div",12),e._UZ(16,"productentry"),e.qZA()()(),e.TgZ(17,"div",13),e._UZ(18,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore))},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N],encapsulation:2}),o})();function xi(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}function wi(o,c){1&o&&(e.TgZ(0,"div",13),e._UZ(1,"discounts-insert"),e.qZA())}function Ni(o,c){1&o&&(e.ynx(0),e._UZ(1,"productentry"),e.BQk())}function Ri(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"generic-product-entry",17),e.NdJ("ShowGenericGridEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.showGenericGrid(n))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("GenericProductEntrySetting",t.genericProductEntrySetting)}}let Di=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v){this.masterService=t,this._trnMainService=i,this.genericProductEntryService=n,this.itemKeyEventService=r,this.quantityChangeEventService=s,this.entryValidateService=a,this.route=l,this.loadingService=h,this.alertService=v,this.arr=[],this._trnMainService.initialFormLoad(80)}ngOnInit(){this.setProductEntryTable(),this.route.queryParams.subscribe(t=>{if("DRILL"==t.mode){let i=t.voucher,n=[];n=i.split("-"),this.loadingService.show("Loading voucher..."),this.masterService.LoadTransaction(i,n[1],n[2]).subscribe(r=>{"ok"==r.status&&(this.loadingService.hide(),this._trnMainService.TrnMainObj=r.result,this._trnMainService.TrnMainObj.VoucherType=80,this._trnMainService.pageHeading="REQUISITION ENTRY",this._trnMainService.TrnMainObj.VoucherPrefix="RQ",this._trnMainService.TrnMainObj.Mode="VIEW",this._trnMainService.callPipe=!this._trnMainService.callPipe,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(s=>s.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},r=>{this.loadingService.hide(),this.alertService.error(r)})}else this.masterService.refreshTransactionList()})}setProductEntryTable(){this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,checkbox:!0,checkboxField:"checkInRQentry",headerNgStyle:{width:"50px"},onCheckBoxChange:(i,n,r,s)=>this.onCheckBoxChangeEvent(i,n,r,s)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"300px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableItemDesc",i,n),focusTo:"ALTERNATEQUANTIY"},{field:"SUPPNAME",header:"Supplier",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{width:"100px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableSupplier",i,n)},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{width:"60px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltUnit",i,n)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(i,n,r)=>this.QuantityChangeEvent_default(i,n,r),applyTwoDigitPipe:!1,disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"ALTRATE",header:"Selling Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,focusTo:"COMMENTS",disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"COMMENTS",header:"Order Comments",hidden:!1,isActiveColumnHeader:!0,inputType:"CommentsSelect",onEnter:(i,n,r,s)=>{this.entryValidateService.RemarksEnterCommand(i,n,r,s)},focusTo:"ITEMDESC",headerNgStyle:{width:"60px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableOtherComments",i,n)}],this.genericProductEntrySetting.setRowItemFromSelectedItem=i=>this.SetRowItemFromSelectedItem(i),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(i,n=new Function)=>this.SetRowItemRate(i,n)}onCheckBoxChangeEvent(t,i,n,r){this._trnMainService.callPipe=!this._trnMainService.callPipe,this._trnMainService.TrnMainObj.ProdList[i].checkInRQentry=!!t.target.checked,this._trnMainService.TrnMainObj.ProdList[i].checkInRQentry?this.arr.push(this._trnMainService.TrnMainObj.ProdList[i]):this.arr.splice(i,1)}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}SetRowItemRate(t,i){}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>!0,()=>({useDefault:!0,preCheck:!0}),()=>!1)}getColumnDisablePipe(t,i,n){return t}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>T.K.default,i=>T.K.default,()=>T.K.default,()=>T.K.default,()=>T.K.default)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(b.w),e.Y36(T.X),e.Y36(P.s),e.Y36(A.C),e.Y36(O.gz),e.Y36(j.V),e.Y36(I.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["requisition-entry"]],features:[e._Bn([M.p,A.C,T.X,b.w,P.s])],decls:23,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[4,"ngIf","ngIfElse"],["newRQentry",""],[1,"footer-wrapper"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,xi,2,0,"div",9),e.TgZ(13,"div",10),e.YNc(14,wi,2,0,"div",11),e.qZA()()(),e.TgZ(15,"div",12)(16,"div",10)(17,"div",13),e.YNc(18,Ni,2,0,"ng-container",14),e.YNc(19,Ri,1,1,"ng-template",null,15,e.W1O),e.qZA()()(),e.TgZ(21,"div",16),e._UZ(22,"voucher-total-area"),e.qZA()()),2&t){const n=e.MAs(20);e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(2),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("ngIf",0==i._trnMainService.userSetting.EnableRQLogInRQEntry)("ngIfElse",n)}},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N,B.o,U.Z],encapsulation:2}),o})();var oe=p(15257),se=p(19102),W=p(37051),ae=p(82484),ce=p(27009),le=p(64752),q=p(71732),de=p(54536),ji=p(59963),Ui=p(87454),K=p(89952);const Zi=["genericGrid"],ki=["genericGridSupplierPopup"],Bi=["barCodeGridPopup"],Qi=["genericGridMulitplePricePopup"],Hi=["matrixitemgrid"],Fi=["focusBatch"],Vi=["rateValidatoin"];function Gi(o,c){1&o&&(e.TgZ(0,"th"),e._uU(1,"Batch No"),e.qZA())}function qi(o,c){1&o&&(e.TgZ(0,"th",18),e._uU(1," Amt"),e.qZA())}function Yi(o,c){1&o&&(e.TgZ(0,"th",4),e._uU(1," Mfg Date"),e.qZA())}function Wi(o,c){1&o&&(e.TgZ(0,"th",4),e._uU(1," Exp Date"),e.qZA())}function Ki(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"td",43)(1,"input",44,45),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.BATCH=n)})("keydown.Tab",function(n){e.CHM(t);const r=e.oxw().index,s=e.oxw();return e.KtG(s.BatchTabClick(r,n))})("keydown.enter",function(n){e.CHM(t);const r=e.oxw().index,s=e.oxw();return e.KtG(s.BatchEnter(r,n))}),e.qZA(),e.TgZ(3,"span",27),e._uU(4,"press ENTER or TAB to Select Batch"),e.qZA()()}if(2&o){const t=e.oxw(),i=t.index,n=t.$implicit;e.xp6(1),e.MGl("id","batchcon",i,""),e.Q6J("ngModel",n.BATCH)("disabled",0===n.REQEXPDATE||null==n.REQEXPDATE)}}function Ji(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"option",46),e._uU(2),e.qZA(),e.BQk()),2&o){const t=c.$implicit;e.xp6(1),e.s9C("value",t.ALTUNIT),e.xp6(1),e.Oqu(t.ALTUNIT)}}function Xi(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"td",47)(1,"input",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.MFGDATE=n)})("keydown.enter",function(){e.CHM(t);const n=e.oxw().index,r=e.oxw();return e.KtG(r.MFGDateEnterEvent(n))})("keydown.Tab",function(){e.CHM(t);const n=e.oxw().index,r=e.oxw();return e.KtG(r.MFGDateEnterEvent(n))}),e.qZA()()}if(2&o){const t=e.oxw(),i=t.index,n=t.$implicit,r=e.oxw();e.xp6(1),e.MGl("id","mfgdate",i,""),e.s9C("type",r.mfgExpDateType),e.Q6J("ngModel",n.MFGDATE)("disabled","VIEW"==n.rowMode||n.isDisabled||"VIEW"==r._trnMainService.TrnMainObj.Mode)}}function $i(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"td",47)(1,"input",49),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onChangeExpDate())})("ngModelChange",function(n){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.EXPDATE=n)})("keydown.enter",function(){e.CHM(t);const n=e.oxw().index,r=e.oxw();return e.KtG(r.expDateEnterEvent(n))})("keydown.Tab",function(){e.CHM(t);const n=e.oxw().index,r=e.oxw();return e.KtG(r.expDateEnterEvent(n))}),e.qZA()()}if(2&o){const t=e.oxw(),i=t.index,n=t.$implicit,r=e.oxw();e.xp6(1),e.MGl("id","expdate",i,""),e.s9C("type",r.mfgExpDateType),e.Q6J("ngModel",n.EXPDATE)("disabled","VIEW"==n.rowMode||n.isDisabled||"VIEW"==r._trnMainService.TrnMainObj.Mode)}}function zi(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"tbody",19)(1,"tr",20),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.RowClick(r))})("keydown.Shift.delete",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteRow())}),e.TgZ(2,"td",21),e._uU(3),e.qZA(),e.TgZ(4,"td",22),e._uU(5),e.qZA(),e.TgZ(6,"td",23)(7,"input",24),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.BC=n)})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.ItemBarCodeClick(s,n))})("change",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.ItemBarCodeClick(s,n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.ItemBarCodeClick(s,n))})("focusout",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.ItemBarCodeFoucusOut(s,n))})("focus",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.ItemBarCodeClickFocusIn(s,n))}),e.qZA()(),e.TgZ(8,"td",25)(9,"input",26),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ITEMDESC=n)})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return a.ItemkeyEvent(s,n),e.KtG(a.displayProductDetailInViewMode(a.event))})("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClicked())}),e.qZA(),e.TgZ(10,"span",27),e._uU(11,"Press ENTER to Select Item"),e.qZA(),e.ynx(12),e._UZ(13,"br")(14,"span",28),e.BQk(),e.qZA(),e.YNc(15,Ki,5,3,"td",29),e.TgZ(16,"td",30)(17,"select",31),e.NdJ("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.SelectUnit(r))})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateUnitEnterEventClick(s,n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateUnitEnterEventClick(s,n))})("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTUNIT=n)}),e.YNc(18,Ji,3,2,"ng-container",32),e.qZA()(),e.TgZ(19,"td",33)(20,"input",34),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTERNATEQUANTIY=n)})("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.QuantityChangeEvent(r))})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.focusToRate(s,n))})("keydown.Enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateQuantityEventClick(s,n))})("keypress",function(n){const r=e.CHM(t),s=r.$implicit,a=r.index,l=e.oxw();return e.KtG(6==s.PTYPE&&1!=s.isPurchaseOrder?l.AlternateQuantityEventClick(a,n):l.return)}),e.qZA()(),e.TgZ(21,"td",35)(22,"input",36),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTRATE=n)})("change",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.MRPChangeEvent(r,s))})("keydown.Tab",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.mrpEnterEvent(r,s))})("keydown.enter",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.mrpEnterEvent(r,s))})("keyup",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.rateChange(n))})("focusout",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.rateFocusOut(n))}),e.ALo(23,"twoDigitNumber"),e.qZA()(),e.TgZ(24,"td",37),e.NdJ("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.MRPChangeEvent(r))})("keydown.Tab",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.mrpEnterEvent(r))})("keydown.enter",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.mrpEnterEvent(r))}),e._uU(25),e.ALo(26,"twoDigitNumber"),e.qZA(),e.YNc(27,Xi,2,4,"td",38),e.YNc(28,$i,2,4,"td",38),e.TgZ(29,"td",39)(30,"div",40)(31,"button",41),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.deleteRow(r))}),e._UZ(32,"img",42),e.qZA()()()()()}if(2&o){const t=c.$implicit,i=c.index,n=e.oxw();e.xp6(1),e.ekj("selected",n.isTableRowSelected(i))("highlighted",i==n.activerowIndex),e.xp6(1),e.MGl("id","sno",i,""),e.xp6(1),e.Oqu(i+1),e.xp6(1),e.Q6J("disabled",1==n._trnMainService.disableConsumption),e.xp6(1),e.hij(" ",t.MENUCODE," "),e.xp6(2),e.MGl("id","barcode",i,""),e.Q6J("ngModel",t.BC)("readonly","VIEW"==t.rowMode)("disabled",n.disableBarcodeField(i)),e.xp6(2),e.MGl("id","itemDesccon",i,""),e.Q6J("readonly",!0)("ngModel",t.ITEMDESC)("disabled",n.disableItemDesc(i)),e.xp6(5),e.Q6J("innerHtml",t.VARIANTDESCA,e.oJD),e.xp6(1),e.Q6J("ngIf","pro"==n.AppMode),e.xp6(2),e.MGl("id","alternateunitcon",i,""),e.Q6J("ngModel",t.ALTUNIT)("disabled",n.disableAltUnit(i)),e.xp6(1),e.Q6J("ngForOf",null==t.Product?null:t.Product.AlternateUnits),e.xp6(2),e.MGl("id","alternateqtycon",i,""),e.Q6J("ngModel",t.ALTERNATEQUANTIY)("readonly",t.isQuantityReadonly)("disabled",n.disableAltQty(i)),e.xp6(2),e.MGl("id","ratecon",i,""),e.Q6J("ngModel",n.applyPipeInRate?e.lcZ(23,33,t.ALTRATE):t.ALTRATE)("disabled","VIEW"==t.rowMode||t.isDisabled||1==n._trnMainService.disableAllFieldinPurchase||t.isPurchaseOrderItem||7==n._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==n.activeurlpath||"stock-issue-approval"==n.activeurlpath||1==n._trnMainService.disableConsumption||"VIEW"==n._trnMainService.TrnMainObj.Mode),e.xp6(3),e.hij(" ",e.lcZ(26,35,n._trnMainService.nullToZeroConverter(t.AMOUNT)),""),e.xp6(2),e.Q6J("ngIf","lite"!=n._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf","lite"!=n._trnMainService.AppMode),e.xp6(3),e.Q6J("disabled","VIEW"==n._trnMainService.TrnMainObj.Mode||1==n._trnMainService.TrnMainObj.ProdList.length)}}function en(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"span",50),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addRowInsert())}),e.TgZ(1,"p"),e._uU(2,"+"),e.qZA()()}}function tn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"tr",61),e.NdJ("click",function(){const r=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.selectProductDetails(r))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()}if(2&o){const t=c.$implicit;e.xp6(2),e.Oqu(t.color),e.xp6(2),e.Oqu(t.size),e.xp6(2),e.Oqu(t.imeI1),e.xp6(2),e.Oqu(t.imeI2)}}function nn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",51)(2,"div",52)(3,"div")(4,"div")(5,"div",53)(6,"h4",54),e._uU(7,"Product Details"),e.qZA(),e.TgZ(8,"button",55),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeProductDetails())}),e.TgZ(9,"span",56),e._uU(10,"\xd7"),e.qZA()()(),e.TgZ(11,"div",57)(12,"table",58)(13,"thead")(14,"tr",59)(15,"th"),e._uU(16,"Color Group"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Size Group"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"IMEI 1"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"IMEI 2"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,tn,9,4,"tr",60),e.qZA()()()()()()()()}if(2&o){const t=e.oxw();e.xp6(24),e.Q6J("ngForOf",t.selectedProductDetails)}}function rn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",62)(1,"PItemList",63),e.NdJ("dbClickEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.dblClickPopupItem(n))})("itemCloseClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.model1Closed())}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("title",t.masterService.PlistTitle)}}function on(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",64)(1,"PBatchList",65),e.NdJ("dbClickEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.dblClickPopupBatch(n))})("BatchClosedClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.model1Closed())})("returnBatchValue",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.returnBatch(n))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("AlternateUnits",t.AlternateUnits)("activerowIndex",t.activerowIndex)("title",t.masterService.PlistTitle)("BList",t.batchlist)("voucherType",t._trnMainService.TrnMainObj.VoucherType)}}function sn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",64)(1,"popPartyChoose",66),e.NdJ("dbClickEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.dblClickPopupParty(n))})("partyCloseClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.partypopupClosed())}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("partyList",t._trnMainService.partyList)}}function an(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",67)(2,"div",68)(3,"div",53)(4,"h6",54),e._uU(5,"Authorization for Negative Stock Billing"),e.qZA(),e.TgZ(6,"button",55),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeModal())}),e.TgZ(7,"span",56),e._uU(8,"\xd7"),e.qZA()()(),e.TgZ(9,"div",69)(10,"div",70)(11,"label",71),e._uU(12,"User Name:"),e.qZA(),e.TgZ(13,"div",72)(14,"input",73),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r._trnMainService.disAuthObj.username=n)}),e.qZA()()(),e.TgZ(15,"div",70)(16,"label",71),e._uU(17,"Password:"),e.qZA(),e.TgZ(18,"div",72)(19,"input",74),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r._trnMainService.disAuthObj.password=n)}),e.qZA()()()(),e.TgZ(20,"div",75)(21,"button",76),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.negativeBillAuth())}),e._uU(22,"Confirm"),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(14),e.Q6J("ngModel",t._trnMainService.disAuthObj.username),e.xp6(5),e.Q6J("ngModel",t._trnMainService.disAuthObj.password)}}let cn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_){this.masterService=t,this._trnMainService=i,this.setting=n,this.dialog=r,this.fb=s,this.arouter=a,this.alertService=l,this.authservice=h,this.changeDetection=v,this.loader=_,this.showDiscount=!0,this.SupplierList=[],this.activerowIndex=0,this.barcodeDetailActiverowIndex=0,this.barcodeWiseProductIndex=0,this.barCodeAdded=0,this.previousOpeningStockData=[],this.WarehouseWiseCounterMProduct=[],this.stockList=[],this.ItemObj={},this.AlternateUnits=[],this.schemeList=[],this.gridPopupSettings=new se.sG,this.showStockedQuantityOnly=0,this.supFilter="all",this.approvalFlag=!1,this.realQty=0,this.realQtyin=0,this.alterRate=[],this.eachRate=[],this.productWiseBarCode=[],this.batchWisePricList=[],this.showDiscountAuth=!1,this.mfgExpDateType="month",this.ServiceTaxRate=0,this.VatRate=0,this.TotalBill=new e.vpe,this.gridPopupSettingsForSupplier=new E.im,this.barcodeGridSettings=new E.im,this.gridPopupSettingsForMultiplePrice=new le.JP,this.onClickItemSelectPopUp=new e.vpe,this.barcodeDisplay=!1,this.showBarCodeDetail=!1,this.loadFromBarcode=!1,this.batchlist=[],this.showBatchWiseDetail=!1,this.matrixItemAtrribute=[],this.applyPipeInRate=!0,this.tabAcivateforQty=!1,this.isProductDetailView=!1,this.selectedProductDetails=[],this.listObj={},this.setVariantData=S=>{let g=Object.assign({},this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex]),C=[],H=["A","B","C","D"],Me=0;for(var R of S)if(g.VaraintDetailS=[],this.masterService.nullToZeroConverter(R.QTY)>0){let X="";g.VARIANTDESCA="";var Se={};for(var V in R)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(V)&&(console.log("varaint attirbute",V),X+=R[V].VARIANTBARCODE,g.VARIANTDESCA=g.VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(V)}</b>:${R[V].NAME} &nbsp;`,Se[R[V].VARIANTNAME]=R[V].NAME);g.VaraintDetailS.push(Se),g.VARIANTLIST=R,g.BC=R.BARCODE?R.BARCODE:g.MCODE+X,g.Quantity=R.QTY,g.MRP=R.MRP,g.ALTMRP=R.MRP,g.REALQTY_IN=R.QTY,g.ALTERNATEQUANTIY=R.QTY,g.AltQty=R.QTY,g.PRATE=R.PRATE,g.RATE=R.PRATE,g.REALRATE=R.PRATE,g.ALTRATE=R.PRATE,g.SPRICE=R.SRATE,g.SellingPrice=R.SRATE,g.ALTRATE2=R.SRATE,g.BATCH=H[Me],C.push(Object.assign({},g)),Me++}let J=this._trnMainService.TrnMainObj.ConsumptionProdList.slice(0,this.activerowIndex),Tr=this._trnMainService.TrnMainObj.ConsumptionProdList.slice(this.activerowIndex+1);for(var _r of(this._trnMainService.TrnMainObj.ConsumptionProdList.splice(this.activerowIndex),C))J.push(_r);for(var vr of Tr)J.push(vr);this._trnMainService.TrnMainObj.ConsumptionProdList=J,this._trnMainService.ReCalculateBillForConsumption(),setTimeout(()=>{console.log("rate3"),document.getElementById("ratecon"+this.activerowIndex).focus()},500)},this.appType=this.masterService.appType,this.userSetting=this.authservice.getSetting(),1==this.userSetting.enableDayWiseMfgEXPDate&&(this.mfgExpDateType="date");try{57===this._trnMainService.TrnMainObj.VoucherType&&(this.AppSettings=n.appSetting),this.ServiceTaxRate=this.setting.appSetting.ServiceTaxRate,this.VatRate=this.setting.appSetting.VATRate,t.ShowMore=!0}catch{}this.activeurlpath=a.snapshot.url[0].path,this.form=this.fb.group({demoArray:this.fb.array([])}),this._trnMainService.TrnMainObj.CHALANNO=""}ngOnInit(){this.AppMode=ee.N.appMode,this.arrayItems=[]}get demoArray(){return this.form.get("demoArray")}RowClick(t){this.activerowIndex=this.rowIndex=t,this.masterService.ShowMore=!1}addRowInsert(){this._trnMainService.addConsumptionRow()}heightChange(){let t;return t=this.masterService.ShowMore?this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry?66:50:76,t}ItemBarCodeClick(t,i){console.log("IteBarCodeClick",this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC,t),this.activerowIndex=t,this._trnMainService.TrnMainObj.BILLTOADD||1!=this.userSetting.EnableCompulsaryConsumption?void 0===this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC||null==this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC||""==this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC?(1==this._trnMainService.TrnMainObj.ConsumptionProdList[t].isBarcodeOfPtypeSix&&(console.log("inside isBarcodeOfPtypeSix condt"),this._trnMainService.TrnMainObj.ConsumptionProdList[t].isBarcodeOfPtypeSix=!1,setTimeout(()=>{this._trnMainService.TrnMainObj.ConsumptionProdList[t]={}},0)),null!=document.getElementById("itemDesccon"+t)&&setTimeout(()=>{document.getElementById("itemDesccon"+t).focus()},50)):this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC&&this._trnMainService.checkBarcode(this._trnMainService.TrnMainObj.ConsumptionProdList[t].BC,this._trnMainService.TrnMainObj.MWAREHOUSE).subscribe(n=>{console.log("result",n),"ok"==n.status?this.loadBarcodeWiseProductList():(console.log("reache1"),this.alertService.info(n.result))},n=>{this.alertService.info(n.result)}):this.alertService.info("Please select consumption warehouse")}onChangeBarCode(t){}closeModal(){this.showDiscountAuth=!1,this._trnMainService.showNegativeBillingInConsumption=!1,1==this.userSetting.ENABLESINGLEBATCHMODE&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTERNATEQUANTIY=0)}negativeBillAuth(){this._trnMainService.NegativeBillAuthConfirm(this.activerowIndex)}ItemkeyEvent(t,i){if(i.preventDefault(),this.activerowIndex=t,console.log("hhhh",this.activerowIndex,this._trnMainService.TrnMainObj.ConsumptionProdList),this.setItemPopupUrl(),"VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){this.showStockedQuantityOnly=0;let r,n="";n=this._trnMainService.TrnMainObj.VoucherPrefix;let s=this._trnMainService.userProfile.userWarehouse;return r=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC,((0,q.isNullOrUndefined)(r)||null==r||void 0===r||""==r)&&(r="A"),this._trnMainService.TrnMainObj.BILLTOADD||1!=this.userSetting.EnableCompulsaryConsumption?(s=this._trnMainService.TrnMainObj.BILLTOADD,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${r}/all/${n}/${s}`,this._trnMainService.itemselectevent=!0,this.genericGrid.show(this._trnMainService.TrnMainObj.VoucherType==d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==d.Km.SalesOrder||"FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL),!1):void this.alertService.info("Please select consumption warehouse")}this.displayProductDetailInViewMode(i)}displayProductDetailInViewMode(t){"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==t.code&&this.dialougeOpen()}onChangeExpDate(){}loadBarcodeWiseProductList(t=0){this.loadFromBarcode=!1;let n=[];this.masterService.masterGetmethod(`/getMenuitemBarCodeWise?showstockqty=${this.showStockedQuantityOnly}&prefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&barcode=${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC}&warehouse=${this._trnMainService.userProfile.userWarehouse}`).subscribe(s=>{if("ok"===s.status)if(n=s.result.data,0===n.length)this.alertService.info("Product is out of Stock ");else if(1===n.length){this.loadFromBarcode=!0;var a=n[0];if(this._trnMainService.CheckIfSalesReturn()){a.STOCK=t;var l=0;for(let _ of this._trnMainService.TrnMainObj.ConsumptionProdList)_.BC==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC&&(l+=_.ALTERNATEQUANTIY);if(a.STOCK<l)return void this.alertService.warning("Quantity exceed the actual Barcode stock!")}if(this.dblClickPopupItem(a),this.loadFromBarcode=!1,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTDESCA="",a.VARIANTDETAIL){var h=JSON.parse(a.VARIANTDETAIL);for(var v in h)-1==["QTY","PRATE","MRP","SRATE","BARCODE"].indexOf(v)&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTDESCA=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTDESCA+`<b>${this._trnMainService.getVariantNameFromId(v)}</b>:${h[v].NAME} &nbsp;`)}}else this.genericGrid.show();else this.alertService.info(s.result.error)})}checkDuplicatProductWithBarcode(){let t=[];return t=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(i=>i.BARCODE===this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BARCODE),t.length>1?(this._trnMainService.duplicateBarCodeMessage="duplicateBarcode",!0):(this._trnMainService.duplicateBarCodeMessage="",!1)}checkBatchWiseRate(){this.batchlist=[];let t="";t=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MCODE;let i="";i=this._trnMainService.TrnMainObj.BILLTOADD?this._trnMainService.TrnMainObj.BILLTOADD:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${t}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${i}&barcode=`).subscribe(n=>{"ok"===n.status?(this.batchlist=n.result,1===this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===n.message&&1===this.userSetting.BATCHWISEPRICE&&(this.changeBatchWiseRate(n.result[0].RATE),this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PRATE=n.result[0].costprice),"SHOWPRICEPOPUP"===n.message&&(this.masterService.PlistTitle="Batch Price Selection"),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")):this.alertService.info(n.result)})}changeBatchWiseRate(t){(this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote||"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE)&&this._trnMainService.nullToZeroConverter(t)>0&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].RATE=t,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].REPACKRATE=t,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PRATE=t,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.VoucherType==d.Km.Repack?this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR):t)}BatchTabClick(t,i){if(console.log("BATCH TAB CLICK called"),i?.preventDefault(),this.activerowIndex=t,null==this._trnMainService.TrnMainObj.ProdList[t]||null==this._trnMainService.TrnMainObj.ProdList[t].MCODE||""===this._trnMainService.TrnMainObj.ProdList[t].MCODE)return!1;let n=this._trnMainService.userProfile.userWarehouse;return this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue&&(n=this._trnMainService.TrnMainObj.BILLTO),this._trnMainService.TrnMainObj.VoucherType==d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==d.Km.OpeningStockBalance||0!=this._trnMainService.prodListForUnfinedBill||"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&this._trnMainService.TrnMainObj.VoucherType==d.Km.CreditNote||this.masterService.masterPostmethod("/getBatchListOfItem",{mcode:this._trnMainService.TrnMainObj.ProdList[t].MCODE,onlynonexpireditem:this._trnMainService.TrnMainObj.VoucherType==d.Km.TaxInvoice?1:0,voucherprefix:this._trnMainService.TrnMainObj.VoucherPrefix,warehouse:n}).subscribe(r=>{"ok"==r.status?(this.batchlist=JSON.parse(r.result),1==this.batchlist.length?this.masterService.PlistTitle="Batch Price Selection":0==this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?alert("Rate not Detected!"):0==this.batchlist.length&&"NewBill"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||(this.masterService.PlistTitle="Batch Price Selection")):console.log("error on getting BatchListOfItem "+r.result)},r=>{console.log("error on getting BatchListOfItem ",r)}),!1}BatchEnter(t,i){return i.preventDefault(),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&(console.log("rn"),this.checkBatchWiseRate()),null!=document.getElementById("alternateunit"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateunit"+this.activerowIndex).focus()},20),this.showBatchWiseDetail=!0,!1}popupShowHideControl(){}closeProductDetails(){this.isProductDetailView=!1,this.selectedProductDetails=[]}prepareProductDetails(){let i={color:""};i.quantity=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity,i.IEMI1=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BARCODE,i.IEMI2="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(i)}selectProductDetails(t){let i=[];i=t,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails.push(i),this.isProductDetailView=!1}getProductDetailsFromMCode(){this.masterService.getProductDetailsFromMCode({mcode:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,vchrno:this._trnMainService.TrnMainObj.REFBILL}).subscribe(i=>{i&&"ok"===i.status?(this.isProductDetailView=!0,this.selectedProductDetails=i.result):(this.isProductDetailView=!1,this.selectedProductDetails=[])},i=>{this.selectedProductDetails=[]})}discEnterClicked(t){return this._trnMainService.TrnMainObj.VoucherType===d.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===d.Km.GoodsReceived||this._trnMainService.TrnMainObj.VoucherType===d.Km.CreditNote&&0==this.userSetting.REFBILLCOMPULSORINCNOTE?0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach1"),this.checkValidation(t)):document.getElementById("mfgdate"+t).focus():this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales?this.checkValidation(t):document.getElementById("mfgdate"+t).focus(),!1}discRateEnterClicked(t){if(this._trnMainService.TrnMainObj.VoucherType===d.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===d.Km.GoodsReceived){let i=this.masterService.userProfile.roleRights.find(n=>"DISLIMIT"==n.right);if(this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>i.value)return void(confirm("Sorry, Discount Limit Exceeded. Please, Ask for it's Authorization?")&&(this.showDiscountAuth=!0,console.log("reached here",this.showDiscountAuth)));this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)>0&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE)?(console.log("reach12"),this.checkValidation(t)):0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE)?null!=document.getElementById("discountAmt"+t)&&document.getElementById("discountAmt"+t).focus():document.getElementById("mfgdate"+t).focus()}return!1}checkValidation(t){console.log("reached cehck validation");var i=this._trnMainService.TrnMainObj.ConsumptionProdList[t];if(null!=i&&null==i.MCODE)return this.alertService.warning("Please select a Product"),!1;if(!this._trnMainService.TrnMainObj.ConsumptionProdList.some(r=>null==r.MCODE)&&!1===this._trnMainService.addConsumptionRow())return;let n=this.activerowIndex+1;1==this.userSetting.GblBarcodeWiseBilling?this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry?setTimeout(()=>{null!=document.getElementById("barcode"+n)&&(console.log("rn1"),document.getElementById("barcode"+n).focus())},50):(console.log("focus here in cons"),setTimeout(()=>{null!=document.getElementById("itemDesccon"+n)&&document.getElementById("itemDesccon"+n).focus()},50)):setTimeout(()=>{null!=document.getElementById("itemDesccon"+n)&&document.getElementById("itemDesccon"+n).focus()},50)}onChangeColor(){}returnBatch(t){console.log("return batch",t);let i=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(r=>r.BATCH==t.BATCH&&r.MCODE==t.MCODE);if(i.length>0)return console.log("b",i.length),this.alertService.warning("Cannot add same item with same batch"),void this.alertService.emitShowHideSubject.subscribe(r=>{setTimeout(()=>{document.getElementById("itemDesccon"+this.activerowIndex).focus()},0)});if(this.assignBatchToActiveProdRow(t,this.activerowIndex),this.masterService.PlistTitle="",1===this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].HASVARIANT)for(var n in this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTLIST=t.VARIANTDETAIL,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC=t.BCODE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTLIST)console.log("Var attribute",n,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTLIST[n]),this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTDESCA+=`<b>${n}</b>:${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].VARIANTLIST[n]} &nbsp;`;this.masterService.focusAnyControl("alternateunitcon"+this.activerowIndex)}dblClickPopupBatch(t){this.returnBatch(t)}model1Closed(){this.masterService.PlistTitle="",1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE?setTimeout(()=>{document.getElementById("batchcon"+this.activerowIndex).focus()},300):setTimeout(()=>{document.getElementById("alternateunitcon"+this.activerowIndex).focus()},300)}QuantityChangeEvent(t){console.log("call this"),this._trnMainService.ReCalculateBillForConsumption(),(7==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].NATURETYPE||10==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PTYPE||this._trnMainService.allowNegativeBilling(this.activerowIndex,!1,!0)||this.checkChildproductEnterQuantity())&&1==this.userSetting.EnableRateFromConsumption&&this._trnMainService.calculateRateForProductionFromConsumption()}assignBatchToActiveProdRow(t,i){this._trnMainService.TrnMainObj.ConsumptionProdList[i].BATCH=t.BATCH,this._trnMainService.TrnMainObj.ConsumptionProdList[i].MFGDATE=null==t.MFGDATE?"":t.MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ConsumptionProdList[i].EXPDATE=null==t.EXPDATE?"":t.EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ConsumptionProdList[i].STOCK=t.STOCK,this._trnMainService.TrnMainObj.ConsumptionProdList[i].WAREHOUSE=t.WAREHOUSE,this._trnMainService.TrnMainObj.ConsumptionProdList[i].BATCHSCHEME=t.SCHEME,this._trnMainService.TrnMainObj.ConsumptionProdList[i].PRATE=t.costprice,this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTRATE=t.RATE,this._trnMainService.TrnMainObj.ConsumptionProdList[i].RATE=this._trnMainService.TrnMainObj.ConsumptionProdList[i].UNIT===this._trnMainService.TrnMainObj.ConsumptionProdList[i].BASEUNIT?t.RATE:t.RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTCONFACTOR)}ratechangeEvent(t){this._trnMainService.ReCalculateBillWithNormal()}IndDiscountRateChangeEvent(t){this._trnMainService.calculateNetRATE(t),this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT=0,this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE<0?this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE=0:this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE>100&&(this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE=100),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeEvent(t,i){this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT=this._trnMainService.nullToZeroConverter(i.target.value),(this._trnMainService.TrnMainObj.VoucherType===d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===d.Km.GoodsReceived)&&(this._trnMainService.TrnMainObj.ProdList[t].UNIT==this._trnMainService.TrnMainObj.ProdList[t].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[t].NETRATE=this._trnMainService.TrnMainObj.ProdList[t].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[t].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT),this._trnMainService.TrnMainObj.ProdList[t].CRATE=this._trnMainService.TrnMainObj.ProdList[t].NETRATE):(this._trnMainService.TrnMainObj.ProdList[t].NETRATE=this._trnMainService.TrnMainObj.ProdList[t].RATE+this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].ECSAMOUNT)/this._trnMainService.TrnMainObj.ProdList[t].Quantity-this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT/this._trnMainService.TrnMainObj.ProdList[t].Quantity),this._trnMainService.TrnMainObj.ProdList[t].CRATE=this._trnMainService.TrnMainObj.ProdList[t].NETRATE)),this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT<0?this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT=0:this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT>this._trnMainService.TrnMainObj.ProdList[t].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[t].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}IndDiscountAmountChangeOfRetailerVATINCEvent(t,i){this._trnMainService.TrnMainObj.ProdList[t].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.nullToZeroConverter(i.target.value),this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE=0,this._trnMainService.TrnMainObj.ProdList[t].INDIVIDUALDISCOUNT_WITHVAT<0?this._trnMainService.TrnMainObj.ProdList[t].INDIVIDUALDISCOUNT_WITHVAT=0:this._trnMainService.TrnMainObj.ProdList[t].INDIVIDUALDISCOUNT_WITHVAT>this._trnMainService.TrnMainObj.ProdList[t].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[t].INDIVIDUALDISCOUNT_WITHVAT=this._trnMainService.TrnMainObj.ProdList[t].AMOUNT),this._trnMainService.ReCalculateBillWithNormal()}discountRateToAmnt(){}QuantityEventClick(t){return this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].Quantity)<1||(this.activerowIndex=t,this._trnMainService.TrnMainObj.VoucherType===d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===d.Km.PurchaseOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.OpeningStockBalance||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockSettlement||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.GoodsReceived?document.getElementById("alternateunitcon"+t).focus():(this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote||this._trnMainService.TrnMainObj.VoucherType===d.Km.CreditNote)&&document.getElementById("remarks"+t).focus()),!1}canAddRow(){try{return{status:"ok"}}catch(t){return{status:"error",error:t}}}isTableRowSelected(t){return this.activerowIndex===t}scroll(t){t.preventDefault()}deleteRow(){confirm("Are you sure u you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ConsumptionProdList.splice(this.activerowIndex,1),0===this._trnMainService.TrnMainObj.ConsumptionProdList.length&&this._trnMainService.addConsumptionRow())}restrictPercentageNumeric(t,i){try{parseFloat(t)<0||isNaN(parseFloat(t))?this._trnMainService.TrnMainObj.ProdList[i].INDDISCOUNTRATE=0:(parseFloat(t)>100||isNaN(parseFloat(t)))&&(this._trnMainService.TrnMainObj.ProdList[i].INDDISCOUNTRATE=100)}catch{}}restrictDisAmntNumeric(t,i){try{parseFloat(t)<0||isNaN(parseFloat(t))?this._trnMainService.TrnMainObj.ProdList[i].INDDISCOUNT=0:parseFloat(t)>this._trnMainService.TrnMainObj.ProdList[i].AMOUNT&&(this._trnMainService.TrnMainObj.ProdList[i].INDDISCOUNT=this._trnMainService.TrnMainObj.ProdList[i].AMOUNT)}catch{}}SelectUnit(t){let i=this._trnMainService.TrnMainObj.ConsumptionProdList[t].Product.AlternateUnits.find(n=>n.ALTUNIT==this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT);this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT==this._trnMainService.TrnMainObj.ConsumptionProdList[t].BASEUNIT?this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTRATE=this._trnMainService.TrnMainObj.ConsumptionProdList[t].RATE:(this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTCONFACTOR=i.CONFACTOR,this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTRATE=this._trnMainService.TrnMainObj.ConsumptionProdList[t].RATE*this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTCONFACTOR),this._trnMainService.ReCalculateBillForConsumption(),1==this.userSetting.EnableRateFromConsumption&&this._trnMainService.calculateRateForProductionFromConsumption()}returnMultiBatchScheme(t){for(let i of t)this._trnMainService.assignBatchToActiveProdRow(i,this.activerowIndex)}flatDisChange(t){this.flatDiscountValue=t,this.flatDiscountAssign()}flatDiscountUnitChange(t){this.radioFlatDiscount=t,this.flatDiscountAssign()}flatDiscountAssign(){if("percent"===this.radioFlatDiscount&&(this.flatDiscountValue<0||this.flatDiscountValue>100))alert("Invalid Flat Discount Percent");else{if("amount"===this.radioFlatDiscount)this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue;else{let t=this._trnMainService.TrnMainObj.ProdList.reduce((i,n)=>i+(this._trnMainService.nullToZeroConverter(n.AMOUNT)-this._trnMainService.nullToZeroConverter(n.INDDISCOUNT)),0);this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT=this.flatDiscountValue*t/100}this._trnMainService.ReCalculateBillWithNormal()}}TotalClick(){this.TotalBill.emit()}BatchMFGDateEnterEvent(t,i){this.showBatchWiseDetail=!1,this.checkValidation(i)||this.masterService.focusAnyControl("remarks"+i)}RemarksEnterCommand(t,i){return t.preventDefault(),this.showBatchWiseDetail=!1,this.checkValidation(i)||this.masterService.focusAnyControl("remarks"+i),!1}dblClickPricePopUP(t){let i=this._trnMainService.mulitplePriceItemList.filter(_=>this._trnMainService.nullToZeroConverter(_.qty)>0),n=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT,r=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT,s=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,a=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE,l=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC,h=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.AlternateUnits,v=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR;if(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(_=>0!=this._trnMainService.nullToZeroConverter(_.ALTERNATEQUANTIY)),null!=i)for(let _=0;_<i.length;_++){let S={Product:{}};S.MCODE=s,S.MENUCODE=a,S.INDDISCOUNT=i[_].dcamount,S.INDDISCOUNTRATE=i[_].dcrate,S.ITEMDESC=l,S.UNIT=n,S.BASEUNIT=r,S.RATE=i[_].rate,S.ALTRATE=i[_].rate,S.ALTERNATEQUANTIY=i[_].qty,S.inputMode=!0,S.CRATE=i[_].netrate,S.ALTCONFACTOR=v,S.Product.AlternateUnits=h,this._trnMainService.TrnMainObj.ProdList.push(S)}this._trnMainService.ReCalculateBillWithNormal()}dblClickPopupParty(t){null!=t&&(this._trnMainService.TrnMainObj.VoucherType===d.Km.OpeningStockBalance?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TRNAC=t.ACID,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ACNAME=t.ACNAME,document.getElementById("remarks"+this.activerowIndex).focus()):(this._trnMainService.TrnMainObj.PARAC=t.ACID,this._trnMainService.TrnMainObj.BILLTO=t.ACNAME,this._trnMainService.TrnMainObj.BILLTOADD=t.ADDRESS,this._trnMainService.TrnMainObj.BILLTOTEL=t.VATNO,this._trnMainService.TrnMainObj.BILLTOMOB=t.MOBILE,null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.AdditionalObj.TRNTYPE=t.PSTYPE),this.partypopupClosed())}partypopupClosed(){this.masterService.PlistTitle="",this._trnMainService.TrnMainObj.VoucherType===d.Km.OpeningStockBalance&&document.getElementById("remarks"+this.activerowIndex).focus()}SupplierEnterClicked(t){return t.preventDefault(),document.getElementById("supplier"+this.activerowIndex).blur(),this.genericGridSupplierPopup.show(),!1}onKeydownPreventEdit(t){"Enter"===t.key||"Tab"===t.key||t.preventDefault()}batchKeyDownEvent(){return!1}popUpBatchList(){}MFGDateEnterEvent(t){return document.getElementById("expdate"+this.activerowIndex).focus(),!1}expDateEnterEvent(t){return this.checkValidation(t)||this.masterService.focusAnyControl("remarks"+t),!1}AlternateUnitEnterEventClick(t,i){i.preventDefault(),console.log("alternate unit",this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT),null!=this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTUNIT&&(console.log("yoyoyoyo"),document.getElementById("alternateqtycon"+t).focus())}PrateEnterEvent(){return document.getElementById("srateid"+this.activerowIndex).focus(),!1}SrateEnterEvent(){return document.getElementById("discount"+this.activerowIndex).focus(),!1}mrpEnterEvent(t,i){return this.validateRate(t,i),this.checkValidation(i),this.checkDeuplicateCodeAndRate(),this._trnMainService.ReCalculateBillForConsumption(),!1}setItemPopupUrl(){this.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this.userSetting.DefaultFilterIndex?this.userSetting.DefaultFilterIndex:0,useDefinefilterValue:this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ITEMDESC,columns:[{key:"MENUCODE",title:"PRODUCT CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"MENUCODE",title:"P-QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO(STOCK)",hidden:!0,noSearch:!0},{key:"OPSTOCK",title:"SO (STOCK)",hidden:!0,noSearch:!0},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0}]},this.gridPopupSettingsForSupplier={title:"Supplier",apiEndpoints:"/getAccountPagedListByPType/PA/V",defaultFilterIndex:0,columns:[{key:"ACNAME",title:"NAME",hidden:!1,noSearch:!1},{key:"ERPPLANTCODE",title:"CODE",hidden:!1,noSearch:!1},{key:"ADDRESS",title:"ADDRESS",hidden:!1,noSearch:!1},{key:"EMAIL",title:"EMAIL",hidden:!1,noSearch:!1}]}}assignValueForReturnModeInProd(t){this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CRATE=t.CRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=t.RATE):this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=t.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REALRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=t.RATE,console.log("prodRAte",t.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SPRICE=t.SPRICE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH=t.BATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=null==t.MFGDATE?"":t.MFGDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=null==t.EXPDATE?"":t.EXPDATE.toString().substring(0,7),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=t.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].STOCK=t.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity=t.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].WAREHOUSE=t.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=t.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNT=t.INDDISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].INDDISCOUNTRATE=t.INDDISCOUNTRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PrimaryDiscount=t.PrimaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SecondaryDiscount=t.SecondaryDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].LiquiditionDiscount=t.LiquiditionDiscount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEUNIT=t.BASEUNIT,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product={}),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Product.MCODE=t.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].CONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT=t.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].UNIT=t.UNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BASEQUANTITY=t.Quantity,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTCONFACTOR=t.ALTCONFACTOR,console.log("RATE",this._trnMainService.TrnMainObj.ProdList,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE),this._trnMainService.ReCalculateBillWithNormal()}BarcodeClick(t){this.activerowIndex=t,this.batchlist=[]}validateRate(t,i){if(t.ALTRATE<1||null==t.ALTRATE||null==t.ALTRATE)return!confirm(" Zero Purchase Rate Entry Detected For Item '"+t.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")&&(console.log("reachratecon"),document.getElementById("ratecon"+i).focus(),!0)}MRPChangeEvent(t,i){this.validateRate(t,i),this._trnMainService.TrnMainObj.ConsumptionProdList[i].UNIT==this._trnMainService.TrnMainObj.ConsumptionProdList[i].BASEUNIT?this._trnMainService.TrnMainObj.ConsumptionProdList[i].RATE=this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTRATE)&&(this._trnMainService.TrnMainObj.ConsumptionProdList[i].RATE=this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ConsumptionProdList[i].ALTCONFACTOR)),this._trnMainService.ReCalculateBillForConsumption(),1==this.userSetting.EnableRateFromConsumption&&this._trnMainService.calculateRateForProductionFromConsumption()}BarcodeKeyDownEvent(t,i){}AlternateKeyUp(t,i){}AlternateQuantityEventClick(t,i){i.preventDefault(),1===this.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ProductDetails=[])),console.log("ratecond"),document.getElementById("ratecon"+this.activerowIndex).focus()}checkChildproductEnterQuantity(){let t=0;return this._trnMainService.TrnMainObj.ConsumptionProdList.filter(n=>n.MCODE==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MCODE&&n.BATCH==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BATCH).forEach(n=>{t+=n.Quantity}),t>this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].STOCK?(this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n      Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].STOCK)} \n      ${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BASEUNIT},      \n      Item : ${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ITEMDESC} \n      @Qty = ${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].Quantity} ${this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}focusToRate(t,i){i.preventDefault(),0!=this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTERNATEQUANTIY?null!=this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTERNATEQUANTIY&&null!=this._trnMainService.TrnMainObj.ConsumptionProdList[t].ALTERNATEQUANTIY?(console.log("rate1"),document.getElementById("ratecon"+t).focus()):this.alertService.warning(`Qty Is Not Specified For The Item ${this._trnMainService.TrnMainObj.ConsumptionProdList[t].ITEMDESC} (${this._trnMainService.TrnMainObj.ConsumptionProdList[t].MENUCODE}). Please Check Your Entry.`):this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ConsumptionProdList[t].ITEMDESC} (${this._trnMainService.TrnMainObj.ConsumptionProdList[t].MENUCODE}). Please Check Your Entry.`)}newNulltoconverter(){}BaseQuantityEventClick(t,i){i.preventDefault(),this.activerowIndex=t,null!=document.getElementById("mrp"+t)?this.masterService.focusAnyControl("mrp"+t):this.masterService.focusAnyControl("remarks"+t),this.SelectUnit(t)}stockCheck(t,i){this.realQty=0,this.realQtyin=0,this.finalRes=0,this.masterService.getStockForCheck(t).subscribe(n=>{if("ok"===n.status){if(this.stockList=n.result,this.stockList.forEach(r=>{this.realQty+=r.RealQty,this.realQtyin+=r.REALQTY_IN}),this.finalRes=this.realQty-this.realQtyin,this._trnMainService.TrnMainObj.TOTALQTY>this.finalRes)return this.alertService.info("Quantity exceed the transaction stock"),void(this._trnMainService.QuantityMsg="GreaterQuantity");this._trnMainService.QuantityMsg=""}else this.alertService.info(n.result)})}checkBatchWiseStock(){let t=[];this.masterService.getStockBatchWise(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE).subscribe(i=>{"ok"==i.status&&(t=i.result,console.log("checkBatchWise",this._trnMainService.TrnMainObj.ProdList,t),null!=t&&this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].Quantity>t[0].STOCK&&(this.gridPopupSettingsForMultiplePrice=this.masterService.getGridSetttingForMultiplePrice("multiplePrice",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE,this._trnMainService.TrnMainObj.VoucherPrefix),this.genericGridMulitplePricePopup.show()))})}getBatchWiseDateForNoBill(t){if(this.activerowIndex=t,null==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH)return!1;this.masterService.masterGetmethod("/batch/getmfgdate?batchCode="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BATCH+"&&selfLife="+this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SHELFLIFE).subscribe(i=>{"ok"===i.status?(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MFGDATE=i.result.mfgdate,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE=i.result.expdate,this.masterService.focusAnyControl("alternateQty"+t)):this.alertService.info("Invalid BatchCode.Error Details: "+i.message)},i=>{this.alertService.info("Invalid BatchCode.Error Details: "+i)})}onClicked(){this._trnMainService.inputCode=!0}dblClickPopupItem(t){!this.checkDuplicateIteminProdConsumption(t.MCODE)||1==this.userSetting.EnableBatch&&this._trnMainService.TrnMainObj.VoucherType!=d.Km.ProductionEntry&&!this.ItemValidation(t.MCODE)||this._trnMainService.TrnMainObj.VoucherType!=d.Km.ProductionEntry&&0!==this.userSetting.PODELIVERYMODE&&!this.ItemValidation(t.MCODE)||(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex]={},this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].RATE=t.RATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTRATE=t.RATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PTYPE=t.PTYPE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].HASECSCHARGE=t.HASECSCHARGE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].NATURETYPE=t.NATURETYPE,6==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].NATURETYPE&&this._trnMainService.TrnMainObj.VoucherType!=d.Km.PurchaseOrder&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].isQuantityReadonly=!0),this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].isPurchaseOrder=!1,null!=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex]&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC=t.BARCODE),6==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC&&null!=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].isBarcodeOfPtypeSix=!0),this.focusAfterItemSelect(),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex]&&(this.batchlist=[],this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].REQEXPDATE=t.REQEXPDATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].DISMODE=t.DISMODE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PWEIGHT=t.GWEIGHT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PROMOTION=0,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BATCHSCHEME=null,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALLSCHEME=null,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ISVAT=t.ISVAT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MENUCODE=t.MENUCODE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ITEMDESC=t.DESCA,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MCODE=t.MCODE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].WEIGHT=t.GWEIGHT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].Mcat=t.MCAT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BASEUNIT=t.BASEUNIT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].SHELFLIFE=t.SHELFLIFE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].Weighable=t.Weighable,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MRP=t.MRP,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTCONFACTOR=t.CONFACTOR,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BARCODE=t.BARCODE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].UNIT=t.BASEUNIT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].WARRANTY=t.WARRANTY,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].W_MRP=t.W_MRP,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].W_SELLRATEBEFORETAX=t.W_SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].STOCK=t.STOCK,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].WSRATE_DISCOUNT=t.WSRATE_DISCOUNT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MINLEVEL=t.MINLEVEL,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MAXLEVEL=t.MAXLEVEL,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ROLEVEL=t.ROLEVEL,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ROWARN=t.ROWARN,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MINWARN=t.MINWARN,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].HASVARIANT=t.HASVARIANT,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].Mcat=t.MCAT,6==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PTYPE&&!(0,q.isNullOrUndefined)(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTERNATEQUANTIY=1),6==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].PTYPE&&1==this.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.getAllUnitsForConsumption(this.activerowIndex),this._trnMainService.NeedToTakePriceFromMenuItem()||(1===this.userSetting.EnableBatch||2===this.userSetting.EnableBatch)&&1===this.userSetting.EnableBatchWisePrice&&10!==t.PTYPE&&9!==t.PTYPE&&!1===this.itemFromBC(t.HASVARIANT)&&this.checkBatchWiseRate(),this._trnMainService.NeedToTakePriceFromMenuItem()||1===this.userSetting.EnableBatch&&1===this.userSetting.EnableBatchWisePrice&&10!==t.PTYPE&&9!==t.PTYPE&&!1===this.itemFromBC(t.HASVARIANT)&&this.checkBatchWiseRate(),"production-entry"===this.activeurlpath&&(this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].RATE=t.PRATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].REQEXPDATE=t.REQEXPDATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].SELLRATEBEFORETAX=t.RATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].ALTRATE=t.PRATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].RECRATE=t.RECRATE,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].POSTOCK=t.POSTOCK,this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].HASVARIANT=t.HASVARIANT)))}ItemValidation(t){let i;return i=this._trnMainService.TrnMainObj.ConsumptionProdList.find(n=>n.MCODE==t),console.log("duplicate",i),null==i||(this.alertService.info("Cannot enter duplicate item !"),this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("itemDesccon"+this.activerowIndex).focus()},0)}),!1)}checkDuplicateIteminProdConsumption(t){var i=this._trnMainService.TrnMainObj.ProdList.find(n=>n.MCODE==t);return!i||(this.alertService.warning(`Item :${i.ITEMDESC} is already selected in Production.`),!1)}dialougeOpen(){this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open(ce.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(n=>{this.productLists=this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.CreditNote||this._trnMainService.TrnMainObj.VoucherType===d.Km.DebitNote?n?.data:n&&n.data&&n.data.productColorList?n.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0,(this._trnMainService.TrnMainObj.VoucherType==d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType===d.Km.GoodsReceived)&&this._trnMainService.calculateNetRATE(this.activerowIndex),setTimeout(()=>{if(0==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY){if(this._trnMainService.TrnMainObj.VoucherType==d.Km.TaxInvoice)return void this.alertService.warning(`Zero Quantity Detected for Item ${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC} (${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE}). Please Check Your Entry.`)}else console.log("rate2"),document.getElementById("ratecon"+this.activerowIndex).focus()},20)})}checkDeuplicateCodeAndRate(){let t=[],i=this._trnMainService.TrnMainObj.ConsumptionProdList.filter(n=>n.MCODE==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MCODE);if(null!=i&&i.length>1){let n=0;for(let r of this._trnMainService.TrnMainObj.ConsumptionProdList)r.MCODE==this._trnMainService.TrnMainObj.ConsumptionProdList[this.activerowIndex].MCODE&&t.push(n),n++}}rateChange(){this.applyPipeInRate=!1}rateFocusOut(){this.applyPipeInRate=!0,console.log("COLUMN CHANGE ",this.applyPipeInRate)}AtFocusOut(t,i){6!=this._trnMainService.TrnMainObj.ProdList[t].PTYPE&&this.focusToRate(t,i)}ItemBarCodeFoucusOut(t,i){this.barcodeDisplay=!1}ItemBarCodeClickFocusIn(t,i){this.barcodeDisplay=!0}focusAfterItemSelect(){2==this.userSetting.EnableBatch?null!=document.getElementById("batchcon"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("batchcon"+this.activerowIndex).focus()},20):(null!=document.getElementById("alternateunitcon"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateunitcon"+this.activerowIndex).focus()},20),74===this._trnMainService.TrnMainObj.VoucherType&&null!=document.getElementById("alternateqty"+this.activerowIndex)&&setTimeout(()=>{document.getElementById("alternateqty"+this.activerowIndex).focus()},20))}itemFromBC(t){return 1==t&&1==this.loadFromBarcode}disableItemDesc(t){let i=this._trnMainService.TrnMainObj.ConsumptionProdList[t];return!!(i.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||i.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||1==this._trnMainService.disableConsumption||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)}disableAltUnit(t){let i=this._trnMainService.TrnMainObj.ConsumptionProdList[t];return!!("VIEW"==this._trnMainService.TrnMainObj.Mode||i.isDisabled||1==this._trnMainService.disableAllFieldinPurchase||i.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||this._trnMainService.disableOnGRNload||1==this._trnMainService.disableConsumption||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)}disableAltQty(t){let i=this._trnMainService.TrnMainObj.ConsumptionProdList[t];return!!("VIEW"==this._trnMainService.TrnMainObj.Mode||i.isDisabled||i.isBarcodeOfPtypeSix||1==this._trnMainService.disableAllFieldinPurchase||i.isPurchaseOrderItem||7==this._trnMainService.TrnMainObj.VoucherType||this._trnMainService.disableOnGRNload||1==this._trnMainService.disableConsumption||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)}disableBarcodeField(t){return!!(1==this._trnMainService.disableAllFieldinPurchase||this._trnMainService.TrnMainObj.ConsumptionProdList[t].isPurchaseOrderItem||"VIEW"==this._trnMainService.TrnMainObj.Mode||7==this._trnMainService.TrnMainObj.VoucherType||"transfer-out-approval"==this.activeurlpath||"stock-issue-approval"==this.activeurlpath||1==this._trnMainService.disableConsumption||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this.userSetting.REFBILLCOMPULSORINCNOTE)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(G.R),e.Y36(de.uw),e.Y36(u.qu),e.Y36(O.gz),e.Y36(I.c),e.Y36(k.e),e.Y36(e.sBO),e.Y36(j.V))},o.\u0275cmp=e.Xpm({type:o,selectors:[["consumptionentry"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Zi,5),e.Gf(ae.q,5),e.Gf(W.K,5),e.Gf(ki,5),e.Gf(Bi,5),e.Gf(Qi,5),e.Gf(Hi,5),e.Gf(Fi,5),e.Gf(Vi,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGrid=n.first),e.iGM(n=e.CRH())&&(i.itemListChild=n.first),e.iGM(n=e.CRH())&&(i.batchlistChild=n.first),e.iGM(n=e.CRH())&&(i.genericGridSupplierPopup=n.first),e.iGM(n=e.CRH())&&(i.barCodeGridPopup=n.first),e.iGM(n=e.CRH())&&(i.genericGridMulitplePricePopup=n.first),e.iGM(n=e.CRH())&&(i.matrixitemgrid=n.first),e.iGM(n=e.CRH())&&(i.focusBatch=n.first),e.iGM(n=e.CRH())&&(i.rateValidation=n.first)}},outputs:{TotalBill:"TotalBill",onClickItemSelectPopUp:"onClickItemSelectPopUp"},decls:37,vars:17,consts:[[1,"wrapper","height-wrapper"],["id","prodlistTableheader",2,"border-bottom","2px solid #E6E6E6","border-top","2px solid #E6E6E6","background","silver","color","black"],["scope","col",2,"width","4%"],[4,"ngIf"],[2,"width","50px"],[2,"width","100px"],["style","width:70px",4,"ngIf"],["style","width:50px",4,"ngIf"],["style","border: 1px;",4,"ngFor","ngForOf"],["class","add",3,"click",4,"ngIf"],["class","PList","style","    margin-top: 2%;\nheight: 640px;\nwidth: 78%; ",4,"ngIf"],["class","PList",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridSupplierPopup",""],["genericGridMulitplePricePopup",""],[3,"matrixItemAtrribute","onApplyClicked"],["matrixitemgrid",""],[2,"width","70px"],[2,"border","1px"],[2,"border","1px solid #e6e6e6","max-height","25px",3,"click","keydown.Shift.delete"],[2,"border","1px solid #e6e6e6","width","20px",3,"id"],[2,"width","6%","border-right","1px solid #e6e6e6",3,"disabled"],[2,"width","10%"],["autocomplete","off","type","text",2,"width","100%",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.Tab","change","keydown.enter","focusout","focus"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","20%"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item",2,"width","100%",3,"id","readonly","ngModel","disabled","ngModelChange","keydown.enter","click"],["contenteditable","false",1,"CellComment"],[3,"innerHtml"],["class","CellWithComment","style","height:23px;border: 1px solid #e6e6e6;width:7%",4,"ngIf"],[2,"height","23px","border","1px solid #e6e6e6","width","5%"],[2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[4,"ngFor","ngForOf"],[2,"height","23px","border","1px solid #e6e6e6","width","4%"],["type","number",2,"width","60px","text-align","right",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Tab","keydown.Enter","keypress"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9"],["type","number",2,"width","100%","text-align","right",3,"id","ngModel","disabled","ngModelChange","change","keydown.Tab","keydown.enter","keyup","focusout"],["id","amntId",2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right",3,"change","keydown.Tab","keydown.enter"],["style","height:23px;border: 1px solid #e6e6e6;background-color: #f9f9f9; text-align: right;",4,"ngIf"],[2,"width","2%"],[1,"close-wrapper"],[1,"closeTooltip",3,"disabled","click"],["src","../../../assets/icons/close-icon.png","alt","",2,"width","20px","padding","2.5px"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","7%"],["type","text","autocomplete","off",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],["focusBatch",""],[3,"value"],[2,"height","23px","border","1px solid #e6e6e6","background-color","#f9f9f9","text-align","right"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","ngModelChange","keydown.enter","keydown.Tab"],["max","2999-12-31",2,"height","33px","border","1px solid #e6e6e6","width","100%","font-size","11px",3,"id","type","ngModel","disabled","change","ngModelChange","keydown.enter","keydown.Tab"],[1,"add",3,"click"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","20px"],[1,"modal-content","modal-content-main-area",2,"width","70%"],[1,"modal-header",2,"padding","0px","background","#c0c0c0"],[1,"modal-title",2,"padding-left","5px"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"col-md-12","table-scroll"],[1,"table"],[2,"background","#81DAAC"],["class","highlight",3,"click",4,"ngFor","ngForOf"],[1,"highlight",3,"click"],[1,"PList",2,"margin-top","2%","height","640px","width","78%"],[3,"title","dbClickEvent","itemCloseClick"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","dbClickEvent","BatchClosedClick","returnBatchValue"],[3,"partyList","dbClickEvent","partyCloseClick"],[1,"modal-sticky",2,"display","block","padding","0px","margin-bottom","-4rem","margin-right","27rem"],[1,"modal-content","modal-content-main-area",2,"width","70%","height","auto"],[1,"modal-body"],[1,"form-group","row",2,"margin","0.5rem"],[1,"col-sm-4","form-control-label",2,"font-size","13px"],[1,"col-sm-7",2,"padding","0px"],["type","text","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],["type","password","id","Parent","autocomplete","off",1,"form-control",2,"height","4vh","font-size","13px",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-sm","btn-info",2,"font-size","12px",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div")(1,"div",0)(2,"table")(3,"tr",1)(4,"th",2),e._uU(5,"S.No."),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Code"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Barcode"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Description"),e.qZA(),e.YNc(12,Gi,2,0,"th",3),e.TgZ(13,"th"),e._uU(14," Unit"),e.qZA(),e.TgZ(15,"th",4),e._uU(16," Quantity"),e.qZA(),e.TgZ(17,"th",5),e._uU(18," Rate"),e.qZA(),e.YNc(19,qi,2,0,"th",6),e.YNc(20,Yi,2,0,"th",7),e.YNc(21,Wi,2,0,"th",7),e.qZA(),e.YNc(22,zi,33,37,"tbody",8),e.qZA(),e.YNc(23,en,3,0,"span",9),e.qZA()(),e.YNc(24,nn,25,1,"div",3),e.YNc(25,rn,2,1,"div",10),e.YNc(26,on,2,5,"div",11),e.YNc(27,sn,2,1,"div",11),e.TgZ(28,"generic-popup-grid",12,13),e.NdJ("onItemDoubleClick",function(r){return i.dblClickPopupItem(r)}),e.qZA(),e.TgZ(30,"generic-popup-grid",12,14),e.NdJ("onItemDoubleClick",function(r){return i.dblClickPopupParty(r)}),e.qZA(),e.TgZ(32,"multiple-price-popup-grid",12,15),e.NdJ("onItemDoubleClick",function(r){return i.dblClickPricePopUP(r)}),e.qZA(),e.TgZ(34,"matrix-item-grid",16,17),e.NdJ("onApplyClicked",function(r){return i.setVariantData(r)}),e.qZA(),e.YNc(36,an,23,2,"div",3)),2&t&&(e.xp6(1),e.Udp("height",i.heightChange()+"vh"),e.xp6(11),e.Q6J("ngIf","pro"==i.AppMode),e.xp6(7),e.Q6J("ngIf",14!=i._trnMainService.TrnMainObj.VoucherType&&16!=i._trnMainService.TrnMainObj.VoucherType&&57!=i._trnMainService.TrnMainObj.VoucherType&&64!=i._trnMainService.TrnMainObj.VoucherType&&74!=i._trnMainService.TrnMainObj.VoucherType),e.xp6(1),e.Q6J("ngIf","lite"!=i._trnMainService.AppMode),e.xp6(1),e.Q6J("ngIf","lite"!=i._trnMainService.AppMode),e.xp6(1),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.ConsumptionProdList),e.xp6(1),e.Q6J("ngIf","VIEW"!=i._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngIf",i.isProductDetailView),e.xp6(1),e.Q6J("ngIf","itemList"==i.masterService.PlistTitle&&i.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","Batch Price Selection"==i.masterService.PlistTitle||"Batch Selection"==i.masterService.PlistTitle),e.xp6(1),e.Q6J("ngIf","partyPopUp"==i.masterService.PlistTitle),e.xp6(1),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettingsForSupplier),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettingsForMultiplePrice),e.xp6(2),e.Q6J("matrixItemAtrribute",i.matrixItemAtrribute),e.xp6(2),e.Q6J("ngIf",1==i._trnMainService.showNegativeBillingInConsumption))},dependencies:[m.sg,m.O5,u.YN,u.Kr,u.Fj,u.wV,u.EJ,u.JJ,u.On,E.Zl,ae.q,W.K,ji.H,le._v,Ui.t,K.g],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}",'table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n.closeTooltip[_ngcontent-%COMP%] {\n  display: inline-block;\n  transition: 0.3s ease;\n  border: none;\n  \n}\n.closeTooltip[_ngcontent-%COMP%]:focus{\n  outline: none;\n\n}\n\n.add[_ngcontent-%COMP%]{\n  color: #04AA6D;\n  border: 2px solid #04AA6D;\n  margin-top: 5px;\n}\n\nspan.add[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{\n  position: absolute;\n  left: 50%;\n  top:50%;\n  transform: translate(-50%, -50%);\n\n}\n  span.add[_ngcontent-%COMP%]{\n   display: inline-block;\n    width: 22px;\n    height: 22px;\n    text-align: center;\n    font-size: 20px;\n    font-family: "Roboto";\n    border-radius: 50%;\n    background: #FFF;\n    position: relative;\n    cursor: pointer;\n}\n\n.wrapper[_ngcontent-%COMP%] {\n  border: 1px solid #ddd;\n  width: 100%;\n  overflow-x: hidden;\n  overflow-y:auto ;\n}\n    .col1[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 10em;\n        left: 0em;\n        top: auto;\n    }\n\n    .col2[_ngcontent-%COMP%] {\n        position: absolute;\n        width: 5em;\n        left: 10em;\n        top: auto;\n    }\n\n    .modal-footer[_ngcontent-%COMP%] {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%] {\n        cursor: pointer;\n        position: absolute;\n        top: 10px;\n        right: 10px;\n    }\n\n    .modal-backdrop[_ngcontent-%COMP%] {\n        display: none;\n    }',".modal-content[_ngcontent-%COMP%] {\n        padding: 1px;\n        margin: 0px;\n        float: right;\n    }\n\n    tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover {\n        background-color: #f3f5f4;\n        cursor: pointer;\n    }\n\n    tr[_ngcontent-%COMP%] {\n        font-size: 13px;\n    }\n\n    .selected-row[_ngcontent-%COMP%] {\n        background-color: #ced6d3 !important;\n    }\n\n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%] {\n        line-height: 30px !important;\n        padding: 3px;\n    }\n\n    .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%] {\n        line-height: 5px !important;\n    }\n\n    .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]:first-child {\n        text-align: left !important;\n        padding: 0px 0px 0px 11px !important;\n    }\n\n    .modal-content[_ngcontent-%COMP%] {\n        box-shadow: -10px 0px 10px 1px #aaaaaa;\n    }\n\n    .modal-content-main-area[_ngcontent-%COMP%] {\n        max-height: 100%;\n        height: 94%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .modal-content-summary-area[_ngcontent-%COMP%] {\n        max-height: 20%;\n        height: 20%;\n        overflow: auto;\n        overflow-x: hidden;\n    }\n\n    .ellipsis[_ngcontent-%COMP%] {\n        white-space: nowrap;\n    }\n\n    .close[_ngcontent-%COMP%] {\n        margin: -9px 0px -9px 0px;\n    }"]}),o})(),ln=(()=>{class o{constructor(t,i,n,r){this.masterService=t,this._trnMainService=i,this.loadService=n,this.alertService=r,this.childMessage=new e.vpe}ngOnInit(){this.sendMessage()}emit(){this.childMessage.emit("consumption")}sendMessage(){this.childMessage.emit("production")}checkConsumptionStockinEdit(){1==this.masterService.userSetting.EnableOnetoOneProduction&&(document.getElementById("consumption1").click(),this.masterService.getConProdList(this._trnMainService.TrnMainObj.ProdList[0].MCODE,this.masterService.userProfile.CompanyInfo.INITIAL,this._trnMainService.TrnMainObj.BILLTOADD,this._trnMainService.TrnMainObj.ProdList[0].Quantity,this._trnMainService.TrnMainObj.Mode,this._trnMainService.TrnMainObj.VCHRNO).subscribe(t=>{"ok"==t.status?(this._trnMainService.TrnMainObj.ConsumptionProdList=t.result.res,this._trnMainService.disableConsumption=!0,this._trnMainService.TrnMainObj.ConsumptionProdList.forEach(i=>{i.RATE=i.ALTRATE}),this._trnMainService.ReCalculateBillForConsumption()):(this._trnMainService.TrnMainObj.ProdList[0].ALTERNATEQUANTIY=0,this.alertService.info(t.result))}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(j.V),e.Y36(I.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["production-consumption"]],outputs:{childMessage:"childMessage"},decls:36,vars:6,consts:[[1,"row",2,"margin-top","3px"],[1,"col-12"],[1,"tabbable"],[1,"nav","nav-tabs",2,"background","#17a2b8"],[1,"nav-item"],["id","production1","href","#production","data-toggle","tab","role","tab",1,"nav-link","active",2,"font-size","14px",3,"click"],["id","consumption1","href","#consumption","data-toggle","tab","role","tab",1,"nav-link",2,"font-size","14px",3,"click"],[1,"tab-content","mr5"],["id","production",1,"tab-pane","active",2,"height","49vh"],[2,"display","inline-block","width","100%"],[1,"clearfix"],[3,"onChangeProductionItem"],[1,"sticky-bottom"],["id","consumption",1,"tab-pane",2,"height","49vh"],[1,"row"],[1,"col-md-6"],[1,"pull-right"],[1,"col-md-2"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3)(4,"li",4)(5,"a",5),e.NdJ("click",function(){return i.sendMessage()}),e._uU(6,"Production Entry"),e.qZA()(),e.TgZ(7,"li",4)(8,"a",6),e.NdJ("click",function(){return i.emit()}),e._uU(9,"Consumption Entry"),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"div")(15,"productentry",11),e.NdJ("onChangeProductionItem",function(){return i.checkConsumptionStockinEdit()}),e.qZA(),e.TgZ(16,"div",12),e._UZ(17,"voucher-total-area"),e.qZA()()()()(),e.TgZ(18,"div",13)(19,"div",9)(20,"div",10)(21,"div"),e._UZ(22,"consumptionentry"),e.TgZ(23,"div",12)(24,"div",14)(25,"div",15)(26,"h6",16),e._uU(27,"TOTAL:"),e.qZA()(),e.TgZ(28,"div",17)(29,"h6",16),e._uU(30),e.ALo(31,"twoDigitNumber"),e.qZA()(),e.TgZ(32,"div",17)(33,"h6",16),e._uU(34),e.ALo(35,"twoDigitNumber"),e.qZA()()()()()()()()()()()()),2&t&&(e.xp6(30),e.hij("",e.lcZ(31,2,i._trnMainService.TrnMainObj.TOTALCONSUMPTIONQTY)," "),e.xp6(4),e.hij("",e.lcZ(35,4,i._trnMainService.TrnMainObj.CONSUMPTIONGROSS)," "))},dependencies:[Q.x,w.u,cn,K.g],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], option[_ngcontent-%COMP%]{height:23px;vertical-align:middle;font-size:13px;color:#000;border-bottom:1px solid #ddd}textarea[_ngcontent-%COMP%]{font-size:13px;border:1px solid #cbcbcb;border-radius:3px;color:#000}.plainBackGround[_ngcontent-%COMP%]{border:2px solid #e6e6e6;margin-bottom:5px;padding:10px}label[_ngcontent-%COMP%]{height:28px;font-weight:400;width:90px;margin:2px;vertical-align:middle;font-size:13px;padding-top:4px}input[_ngcontent-%COMP%]{padding-left:4px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled, textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important;color:#000!important;background-color:#ebebe4!important}button[_ngcontent-%COMP%]:disabled{cursor:not-allowed!important}.btn-add-focus[_ngcontent-%COMP%]:focus{transform:scale(1.2);-webkit-transform:scale(1.2);-ms-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2)}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700}.tableBorder[_ngcontent-%COMP%]{border:1px solid;border-color:#dcdcdc}.show[_ngcontent-%COMP%]{overflow:visible;height:auto}.alert-danger[_ngcontent-%COMP%]{background-color:none!important;border-color:none!important;color:#a94442}.tab[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:17px}.tab[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.tab[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tabcontent[_ngcontent-%COMP%]{display:none;padding:6px 12px;border:1px solid #ccc;border-top:none}.custom-asset-dropdown[_ngcontent-%COMP%]    {line-height:13px;font-size:14px}  .custom-asset-dropdown .multiselect-dropdown .dropdown-btn{padding:2px 11px}.sourceBatchRate[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;background-color:#f9f9f9;width:9%;.batchRateInput{width: 100%; text-align: right}}.sourceBarCode[_ngcontent-%COMP%]{height:23px;border:1px solid #b4b4b4;width:6%;.barCodeInput{width: 100%;}}"]}),o})();const dn=["fileUploadPopup"];function hn(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let un=(()=>{class o{constructor(t,i,n,r,s){this.masterService=t,this.authservice=i,this._trnMainService=n,this.alertService=r,this.activatedRoute=s,this.fileUploadPopupSettings=new Z.s,this.ChildMessage="",this._trnMainService.initialFormLoad(88),this.userSetting=this.authservice.getSetting()}childMessage(t){this.ChildMessage=t}ngOnInit(){this.activatedRoute.queryParams.pipe((0,oe.q)(1)).subscribe(t=>{"consumptionOld"===t.navigateTo&&this._trnMainService.loadDataForProductionEntry()}),this.fileUploadPopupSettings=Object.assign(new Z.s,{title:"Production Entry",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.productionEntryPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.productionEntryPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"production entry samplefile"})}showPurchaseInvoicePopup(t){if("production"==this.ChildMessage){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please select Production warehouse ");if(!this._trnMainService.TrnMainObj.BILLTOADD&&1==this.userSetting.EnableCompulsaryConsumption)return void this.alertService.info("Please select consumption warehouse")}else if("consumption"==this.ChildMessage){if(!this._trnMainService.TrnMainObj.BILLTO)return void this.alertService.info("Please select Production warehouse ");if(!this._trnMainService.TrnMainObj.BILLTOADD&&1==this.userSetting.EnableCompulsaryConsumption)return void this.alertService.info("Please select consumption warehouse")}this.fileUploadPopup.show()}fileUploadSuccess(t){if(console.log("upresult",t),"ok"==t.status){this._trnMainService.TrnMainObj.ProdList=t.result,this._trnMainService.TrnMainObj.ConsumptionProdList=t.result2,this._trnMainService.TrnMainObj.tag="FROMEXCEL";for(let i of this._trnMainService.TrnMainObj.ProdList)this.assignMfgExpDate(i);for(let i of this._trnMainService.TrnMainObj.ConsumptionProdList)this.assignMfgExpDate(i);this._trnMainService.ReCalculateBillForConsumption(),this._trnMainService.ReCalculateBillWithNormal()}}assignMfgExpDate(t){t.MFGDATE=null==t.MFGDATE?"":t.MFGDATE.toString().substring(0,10),t.EXPDATE=null==t.EXPDATE?"":t.EXPDATE.toString().substring(0,10)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(k.e),e.Y36(M.p),e.Y36(I.c),e.Y36(O.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["production-entry"]],viewQuery:function(t,i){if(1&t&&e.Gf(dn,5),2&t){let n;e.iGM(n=e.CRH())&&(i.fileUploadPopup=n.first)}},features:[e._Bn([M.p])],decls:20,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top",2,"padding-bottom","1px"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","margin-top","-3px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onFileUploadPopupEmit"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row",2,"margin-top","5px"],[1,"col-md-12","pd5"],[3,"childMessage"],[1,"footer-wrapper"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onFileUploadPopupEmit",function(r){return i.showPurchaseInvoicePopup(r)}),e.qZA()()()(),e.TgZ(11,"div",9),e.YNc(12,hn,2,0,"div",10),e.qZA()(),e.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"production-consumption",14),e.NdJ("childMessage",function(r){return i.childMessage(r)}),e.qZA()()()(),e._UZ(17,"div",15),e.qZA(),e.TgZ(18,"file-uploader-popup",16,17),e.NdJ("onUploaded",function(r){return i.fileUploadSuccess(r)}),e.qZA()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("popupsettings",i.fileUploadPopupSettings))},dependencies:[m.O5,L.q,x.i,N,Z.U,ln],encapsulation:2}),o})();function pn(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Tn=(()=>{class o{constructor(t,i,n){this.masterService=t,this._trnMainService=i,this.activatedRoute=n,this._trnMainService.activeurlpath=this.activatedRoute.snapshot.url[0].path,this._trnMainService.initialFormLoad(88)}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(O.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["consumption-entry"]],features:[e._Bn([M.p])],decls:16,vars:3,consts:[[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"row",2,"margin-top","5px"],[1,"col-md-12","pd5"],[1,"sticky-bottom"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6),e.qZA()(),e.TgZ(7,"div",5),e._UZ(8,"voucher-master-action"),e.qZA()()(),e.TgZ(9,"div",6),e.YNc(10,pn,2,0,"div",7),e.TgZ(11,"div",8)(12,"div",9),e._UZ(13,"productentry"),e.qZA()()(),e.TgZ(14,"div",10),e._UZ(15,"voucher-total-area"),e.qZA()),2&t&&(e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore))},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N],encapsulation:2}),o})();const _n=["genericGridStockIssue"];function vn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"inv-params",16),e.NdJ("onClickStockIssueSelectionPopUp",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.EnterStockIssueSelect(n))}),e.qZA()()}}let Mn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_,S,g,C){this.masterService=t,this._trnMainService=i,this.router=n,this.arouter=r,this.setting=s,this.aroute=a,this._alertService=l,this.authService=h,this.loadingSerive=v,this.itemKeyEventService=_,this.entryValidateService=S,this.quantityChangeEventService=g,this.genericProductEntryService=C,this.genericGridStockIssueSetting=new E.im,this._trnMainService.initialFormLoad(81)}ngOnInit(){this.aroute.queryParams.subscribe(t=>{if("DRILL"==t.mode){let i=t.voucher,n=[];n=i.split("-"),this.loadingSerive.show("Loading Invoice"),this.masterService.LoadTransaction(i,n[1],n[2]).subscribe(r=>{"ok"==r.status&&(this.loadingSerive.hide(),this._trnMainService.TrnMainObj=r.result,this._trnMainService.TrnMainObj.VoucherType=81,this._trnMainService.pageHeading="Stock Issue Return",this._trnMainService.TrnMainObj.VoucherPrefix="IR",this._trnMainService.TrnMainObj.Mode="VIEW",null==this._trnMainService.TrnMainObj.AdditionalObj&&(this._trnMainService.TrnMainObj.AdditionalObj={}),this._trnMainService.TrnMainObj.ProdList.forEach(s=>s.rowMode="VIEW"),this._trnMainService.ReCalculateBillWithNormal())},r=>{this.loadingSerive.hide(),this._alertService.error(r)})}else this._trnMainService.TrnMainObj.DOFULLRETURN=1}),this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"BC",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT"},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"unitsOption",headerNgStyle:{width:"70px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(n,r,s)=>this.QuantityChangeEvent_default(n,r,s),onEnter:(n,r,s,a)=>this.quantityChangeEventService.AlternateQuantityEventClick(r),onKeyPress:(n,r,s,a)=>this.quantityChangeEventService.quantityKeyPress(n,r,s,a),applyTwoDigitPipe:!1,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r)},{field:"ALTRATE",header:"Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(n,r,s)=>this.mrpEnterEvent(n,r,s),onChange:(n,r,s,a)=>this.entryValidateService.MRPChangeEvent(n,r,s,a),focusTo:"MFGDATE",disablePipe:(n,r)=>this.getColumnDisablePipe("disableRateandDiscount",n,r)},{field:"AMOUNT",header:"MRP",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"NETAMOUNT",header:"Amnt",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"MFGDATE",header:"Mfg Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},focusTo:"EXPDATE",inputType:"date",applyTwoDigitPipe:!1,onEnter:(n,r,s)=>{this.genericProductEntryService.MFGDateEnterEvent(n,r,s)},disablePipe:(n,r)=>this.getColumnDisablePipe("disableMfgDate",n,r)},{field:"EXPDATE",header:"Exp Date",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right","font-size":"11px"},inputType:"date",applyTwoDigitPipe:!1,focusTo:"ITEMDESC",onEnter:(n,r,s)=>{this.genericProductEntryService.expDateEnterEvent(n,r,s)},disablePipe:(n,r)=>this.getColumnDisablePipe("disableExpDate",n,r)},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableRowDelete",n,r)}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.StockIssue,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r)}SetRowItemRate(t,i){i()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}getColumnDisablePipe(t,i,n){return t}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>(this.get_showStockedQuantityOnly(),T.K.done),i=>(this.setItemPopupUrl(i),T.K.default),()=>T.K.default,()=>T.K.default,()=>T.K.default)}get_showStockedQuantityOnly(){return this.genericProductEntryService.showStockedQuantityOnly=0,this._trnMainService.TrnMainObj.VoucherType===d.Km.PerformaSalesInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.SalesOrder||this._trnMainService.TrnMainObj.VoucherType===d.Km.Sales||this._trnMainService.TrnMainObj.VoucherType===d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssue||this._trnMainService.TrnMainObj.VoucherType===d.Km.Repack||this._trnMainService.TrnMainObj.VoucherType===d.Km.Quotation?(this.genericProductEntryService.showStockedQuantityOnly=1,this.genericProductEntryService.loadBarCodeWiseProduct=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex].BARCODE??""):this.genericProductEntryService.showStockedQuantityOnly=0,this.genericProductEntryService.showStockedQuantityOnly}setItemPopupUrl(t){return this.genericProductEntryService.gridPopupSettings={title:"PRODUCTS",apiEndpoints:`/getMenuitemWithStockPagedList/${t}/all/NO/${this._trnMainService.userProfile.userWarehouse}`,defaultFilterIndex:this._trnMainService.userSetting.DefaultFilterIndex?this._trnMainService.userSetting.DefaultFilterIndex:0,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1},{key:"GroupName",title:"GROUP NAME",hidden:!1,noSearch:!0},{key:"PSTOCK",title:"P-QTY",hidden:!0,noSearch:!0},{key:"ISSUEQTY",title:"ISSUE QTY",hidden:!0,noSearch:!0},{key:"CRATE",title:"NETRATE",hidden:!0,noSearch:!0},{key:"RATE",title:"S-RATE",hidden:!0,noSearch:!0},{key:"BASEUNIT",title:"UNIT",hidden:!0,noSearch:!0},{key:"STOCK",title:"STOCK",hidden:!1,noSearch:!0,alignment:"right"},{key:"REALQTY_IN",title:"Req.Order Qty",hidden:!0,noSearch:!0},{key:"REALQTY",title:"Sales-Qty",hidden:!0,noSearch:!0},{key:"POSTOCK",title:"PO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"POSTOCK",title:"QT QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"OPSTOCK",title:"SO QTY",hidden:!0,noSearch:!0,alignment:"right"},{key:"RATE",title:"PORATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"RATE",title:"SO RATE",hidden:!0,noSearch:!0,alignment:"right",pipe:!0},{key:"BARCODE",title:"BARCODE",hidden:!0,noSearch:!0},{key:"MRP",title:"MRP",hidden:!0,noSearch:!0,alignment:"right",pipe:!0}]},this.genericProductEntryService.gridPopupSettings}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}EnterStockIssueSelect(){console.log("onclidk"),this._trnMainService.TrnMainObj.BILLTO?(this.genericGridStockIssueSetting={title:"Stock Issue",apiEndpoints:"/getSIpagedListForIssueReturn/IS",defaultFilterIndex:0,columns:[{key:"VCHRNO",title:"STOCK ISSUE NO",hidden:!1,noSearch:!1},{key:"TRNDATE",title:"DATE",hidden:!1,noSearch:!1},{key:"BILLTO",title:"ISSUING WAREHOUSE",hidden:!1,noSearch:!1},{key:"BILLTOADD",title:"RECEIVING WAREHOUSE",hidden:!1,noSearch:!1},{key:"TOTAMNT",title:"AMOUNT",hidden:!1,noSearch:!1,alignment:"right",pipe:!0}]},this.genericGridStockIssue.show()):this._alertService.info("Please select From Warhouse")}EnterOnStockIssueSelect(t){if(t){if(this._trnMainService.TrnMainObj.REFORDBILL=t.VCHRNO,this._trnMainService.TrnMainObj.BILLTO!=t.BILLTOADD)return this._alertService.info(`From Warehouse ${this._trnMainService.TrnMainObj.BILLTO} is not match with To Warehouse ${t.BILLTOADD}`),void(this._trnMainService.TrnMainObj.REFORDBILL="");this._trnMainService.TrnMainObj.BILLTOADD=t.BILLTO,this._trnMainService.TrnMainObj.VoucherType===d.Km.StockIssueReturn&&1===this._trnMainService.TrnMainObj.DOFULLRETURN&&this._trnMainService.loadDataForStockIssueReturn(t.VCHRNO,t.DIVISION,t.PhiscalID,"ISINIR",this._trnMainService.TrnMainObj.BILLTO,t.BILLTO)}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(O.F0),e.Y36(O.gz),e.Y36(G.R),e.Y36(O.gz),e.Y36(I.c),e.Y36(k.e),e.Y36(j.V),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["stock-issue-return"]],viewQuery:function(t,i){if(1&t&&e.Gf(_n,5),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGridStockIssue=n.first)}},features:[e._Bn([M.p,T.X,A.C,b.w,P.s])],decls:21,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"footer-wrapper"],[3,"popupsettings","onItemDoubleClick"],["genericGridStockIssue",""],[3,"onClickStockIssueSelectionPopUp"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,vn,2,0,"div",9),e.qZA()(),e.TgZ(13,"div",10)(14,"div",11)(15,"div",12),e._UZ(16,"productentry"),e.qZA()()(),e.TgZ(17,"div",13),e._UZ(18,"voucher-total-area"),e.qZA()(),e.TgZ(19,"generic-popup-grid",14,15),e.NdJ("onItemDoubleClick",function(r){return i.EnterOnStockIssueSelect(r)}),e.qZA()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(7),e.Q6J("popupsettings",i.genericGridStockIssueSetting))},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N,E.Zl],encapsulation:2}),o})(),Sn=(()=>{class o{constructor(t,i,n){this._trnMainService=t,this.route=i,this.masterService=n,this._trnMainService.initialFormLoad(10),this.masterService.ShowMore=!0}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.p),e.Y36(O.gz),e.Y36(f.P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["stock-adjustments"]],features:[e._Bn([M.p])],decls:20,vars:1,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[3,"hidden"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8,"Stock Adjustment"),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8)(12,"div",9),e._UZ(13,"inv-params"),e.qZA()()(),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12),e._UZ(17,"productentry"),e.qZA()()(),e.TgZ(18,"div",13),e._UZ(19,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(12),e.Q6J("hidden",!i.masterService.ShowMore))},dependencies:[Q.x,L.q,x.i,w.u,N],encapsulation:2}),o})();const gn=["fileUploadPopup"];let mn=(()=>{class o{constructor(t,i,n){this._trnMainService=t,this.masterService=i,this.alertService=n,this.fileUploadPopupSettings=new Z.s,this._trnMainService.initialFormLoad(89),this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.BATCHADJUSTMENTMODE=0}ngOnInit(){this.fileUploadPopupSettings=Object.assign(new Z.s,{title:"Batch Adjustment",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this._trnMainService.TrnMainObj.VoucherPrefix}`,uploadEndpoints:`/importFileForTransaction/${this._trnMainService.TrnMainObj.VoucherPrefix}`,allowMultiple:!1,acceptFormat:".xlsx",filename:"Batch Adjustment Sample"})}showBatchAdjustPopUp(t){this.fileUploadPopup.show()}fileUploadSuccess(t){if(console.log("erroe message",t),"ok"==t.status){if(this._trnMainService.TrnMainObj.ProdList=t.result,!this._trnMainService.TrnMainObj||!this._trnMainService.TrnMainObj.ProdList||null==this._trnMainService.TrnMainObj.ProdList)return;this._trnMainService.TrnMainObj.VoucherType=89,this._trnMainService.TrnMainObj.VoucherPrefix="BA",this._trnMainService.TrnMainObj.VoucherAbbName="BA",this._trnMainService.getVoucherNumber(),this._trnMainService.getCurrentDate(),this._trnMainService.TrnMainObj.Mode="NEW",this._trnMainService.ReCalculateBillWithNormal()}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.p),e.Y36(f.P),e.Y36(I.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["batch-adjustment"]],viewQuery:function(t,i){if(1&t&&e.Gf(gn,5),2&t){let n;e.iGM(n=e.CRH())&&(i.fileUploadPopup=n.first)}},decls:22,vars:2,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onFileUploadPopupEmit"],[1,"main-container"],[3,"hidden"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"footer-wrapper"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8,"BATCH ADJUSTMENT"),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onFileUploadPopupEmit",function(r){return i.showBatchAdjustPopUp(r)}),e.qZA()()()(),e.TgZ(11,"div",9)(12,"div",10),e._UZ(13,"inv-params"),e.qZA()()(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13),e._UZ(17,"productentry"),e.qZA()()(),e.TgZ(18,"div",14),e._UZ(19,"voucher-total-area"),e.qZA()(),e.TgZ(20,"file-uploader-popup",15,16),e.NdJ("onUploaded",function(r){return i.fileUploadSuccess(r)}),e.qZA()),2&t&&(e.xp6(12),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(8),e.Q6J("popupsettings",i.fileUploadPopupSettings))},dependencies:[Q.x,L.q,x.i,w.u,N,Z.U],encapsulation:2}),o})(),Cn=(()=>{class o{constructor(t,i){this._trnMainService=t,this.masterService=i,this._trnMainService.initialFormLoad(89),this.masterService.ShowMore=!0,this._trnMainService.TrnMainObj.BATCHADJUSTMENTMODE=0}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.p),e.Y36(f.P))},o.\u0275cmp=e.Xpm({type:o,selectors:[["variant-adjustment"]],decls:20,vars:1,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2","pd0"],[1,"col-md-3","pd0"],[2,"color","black"],[1,"col-md-7"],[1,"main-container"],[3,"hidden"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"h5",6),e._uU(8,"Variant Adjustment"),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8)(12,"div",9),e._UZ(13,"inv-params"),e.qZA()()(),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12),e._UZ(17,"productentry"),e.qZA()()(),e.TgZ(18,"div",13),e._UZ(19,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(12),e.Q6J("hidden",!i.masterService.ShowMore))},dependencies:[Q.x,L.q,x.i,w.u,N],encapsulation:2}),o})();function bn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"inv-params",17),e.NdJ("onClickSupplier",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClickSupplier())}),e.qZA()()}}function fn(o,c){1&o&&(e.ynx(0),e._UZ(1,"productentry"),e.BQk())}function On(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"generic-product-entry",18),e.NdJ("ShowGenericGridEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.showGenericGrid(n))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("GenericProductEntrySetting",t.genericProductEntrySetting)("GenericProductEntrySetting2",t.genericProductEntrySetting2)}}let En=(()=>{class o{constructor(t,i,n,r,s){this.masterService=t,this.alertService=i,this._trnMainService=n,this.entryValidateService=r,this.genericProductEntryService=s,this._trnMainService.initialFormLoad(90)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"S.No",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px",zIndex:1},showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"600px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT",showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{textAlign:"right"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a),showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"RealQty",header:"Total Requested",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];this.genericProductEntrySetting.showSubHeading=!0,this.genericProductEntrySetting.columns=i,this.genericProductEntrySetting.height="218px",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.RequisitionApproval}getColumnDisablePipe(t,i,n){return t}setProductEntryTable2(){var t=this._trnMainService.TrnMainObj.AdditionProdList;this.genericProductEntrySetting2=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"S.No",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px",zIndex:1},showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"600px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT",showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{textAlign:"right"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a),showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];this.genericProductEntrySetting2.showSubHeading=!0,this.genericProductEntrySetting2.columns=i,this.genericProductEntrySetting2.height="218px",this.genericProductEntrySetting2.prodlist=t,this.genericProductEntrySetting2.voucherType=d.Km.RequisitionApproval}setDivisionInBranchList(){let t;this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BranchWiseDistributionList?.length>0&&(i.DivisionNames?.forEach(n=>{i.BranchWiseDistributionList.filter(r=>r.Division==n.divisionName)[0]||(t={Division:n.divisionName,Request:0,Dispatch:0,Priority:n.Priority},i.BranchWiseDistributionList.push(t))}),i.BranchWiseDistributionList.sort((n,r)=>n.Division.localeCompare(r.Division)))})}onClickSupplier(){if(this.setProductEntryTable(),this.setProductEntryTable2(),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[],"VIEW"==this._trnMainService.TrnMainObj.Mode&&this.setDivisionInBranchList(),"NEW"==this._trnMainService.TrnMainObj.Mode)for(let t=0;t<this._trnMainService.TrnMainObj.ProdList?.length;t++)this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList.forEach(i=>{i.Dispatch=i.Request});this.setUpProdList(),this.addBranchWiseToTable1(),this.addBranchWiseToTable2(),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.RealQty=t.BranchWiseDistributionList1.map(i=>i.Request).reduce((i,n)=>i+n,0)+t.BranchWiseDistributionList2.map(i=>i.Request).reduce((i,n)=>i+n,0)})}setUpProdList(){null==this._trnMainService.TrnMainObj.ProdList[0].MCODE&&this._trnMainService.TrnMainObj.ProdList.splice(0,1),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{let i=[],n=[];t.BranchWiseDistributionList.forEach(r=>{r.Priority>Math.ceil(t.BranchWiseDistributionList?.length/2)?i.push(r):n.push(r)}),t.BranchWiseDistributionList1=i,t.BranchWiseDistributionList2=n})}setUpAdditionProdList(){null==this._trnMainService.TrnMainObj.AdditionProdList[0].MCODE&&this._trnMainService.TrnMainObj.AdditionProdList.splice(0,1),this._trnMainService.TrnMainObj.AdditionProdList.forEach(t=>{t.BranchWiseDistributionList1=t.BranchWiseDistributionList1.slice(5,t.BranchWiseDistributionList1.length)})}pushAfterSubHeaders(){let t=[{field:"TotalReqQuantity",header:"Total Request",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"OrderDifference",header:"Order Difference",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];for(let i=0;i<t?.length;i++)this.genericProductEntryService.headerAfterSubHeader.push(t[i])}addBranchWiseToTable1(){this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.BranchWiseDistributionList1?.length>0&&t.BranchWiseDistributionList1.forEach(i=>{if(0==this.genericProductEntrySetting.columns.filter(r=>r.field==i.Division).length){let r={field:`${i.Division}`,header:`${i.Division}`,hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"115px",textAlign:"center"},colspan:2,showSubHeading:!0,subHeader:[{field:"Request",showSubHeading:!0,header:"REQ",isActiveColumnHeader:!0,headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"30px"},columnNgStyle:{width:"100%","text-align":"right"}},{field:"Dispatch",showSubHeading:!0,header:"APV",isActiveColumnHeader:!0,inputType:"quantity",disablePipe:(s,a)=>this.getColumnDisablePipe("disableAprroveQty",s,a),class:(s,a,l)=>this.style(s,a,l),headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"38px"},columnNgStyle:{width:"100%","text-align":"right"}}]};this.genericProductEntrySetting.columns.push(r),this.genericProductEntryService.subHeader.push(r)}})})}addBranchWiseToTable2(){this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.BranchWiseDistributionList2?.length>0&&t.BranchWiseDistributionList2.forEach(i=>{if(0==this.genericProductEntrySetting2.columns.filter(r=>r.field==i.Division).length){let r={field:`${i.Division}`,header:`${i.Division}`,hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"115px",textAlign:"center"},colspan:2,showSubHeading:!0,subHeader:[{field:"Request",showSubHeading:!0,header:"REQ",isActiveColumnHeader:!0,headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"30px"},columnNgStyle:{width:"100%","text-align":"right"}},{field:"Dispatch",showSubHeading:!0,header:"APV",isActiveColumnHeader:!0,inputType:"quantity",class:(s,a,l)=>this.style(s,a,l),headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"38px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(s,a)=>this.getColumnDisablePipe("disableAprroveQty",s,a)}]};this.genericProductEntrySetting2.columns.push(r),this.genericProductEntryService.subHeader2.push(r)}})})}onclickOnResetPopupEmit(){this.setProductEntryTable(),this.genericProductEntrySetting2=new D.Vn(this._trnMainService),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[]}style(t,i,n){if(n?.Request>0){if(n.Request==n.Dispatch)return"green";if(0==n.Dispatch)return"brown";if(n.Request>n.Dispatch)return"yellow";if(n.Request<n.Dispatch)return"red"}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(I.c),e.Y36(M.p),e.Y36(A.C),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["requisition-approval"]],features:[e._Bn([M.p,A.C,b.w])],decls:21,vars:5,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onclickOnResetPopupEmit","onDoubleClickForAllocation"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[4,"ngIf","ngIfElse"],["supplierWise",""],[1,"footer-wrapper"],[3,"onClickSupplier"],[3,"GenericProductEntrySetting","GenericProductEntrySetting2","ShowGenericGridEvent"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onclickOnResetPopupEmit",function(){return i.onclickOnResetPopupEmit()})("onDoubleClickForAllocation",function(){return i.onClickSupplier()}),e.qZA()()()(),e.TgZ(11,"div",9),e.YNc(12,bn,2,0,"div",10),e.qZA()(),e.TgZ(13,"div",11)(14,"div",12)(15,"div",13),e.YNc(16,fn,2,0,"ng-container",14),e.YNc(17,On,2,2,"ng-template",null,15,e.W1O),e.qZA()()(),e.TgZ(19,"div",16),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t){const n=e.MAs(18);e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(4),e.Q6J("ngIf","requisition"==i._trnMainService.TrnMainObj.filterByInReqApproval)("ngIfElse",n)}},dependencies:[m.O5,Q.x,L.q,x.i,w.u,N,U.Z],encapsulation:2}),o})();var he=p(60694),ue=p(74263),An=p(77398);const Pn=["genericGrid"],In=["genericGridConsumption"],yn=["genericGridSupplierPopup"];function Ln(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"option",47),e._uU(2),e.qZA(),e.BQk()),2&o){const t=c.$implicit;e.xp6(1),e.s9C("value",t.ALTUNIT),e.xp6(1),e.Oqu(t.ALTUNIT)}}function xn(o,c){1&o&&(e.TgZ(0,"thead",48)(1,"tr",49)(2,"th",50),e._uU(3,"S.No."),e.qZA(),e.TgZ(4,"th",51),e._uU(5,"Description"),e.qZA(),e.TgZ(6,"th",52),e._uU(7,"Batch No"),e.qZA(),e.TgZ(8,"th",53),e._uU(9," Unit"),e.qZA(),e.TgZ(10,"th",54),e._uU(11," Quantity"),e.qZA(),e.TgZ(12,"th",52),e._uU(13," Rate"),e.qZA(),e.TgZ(14,"th",52),e._uU(15," Amt"),e.qZA(),e.TgZ(16,"th",55),e._uU(17," Mfg Date"),e.qZA(),e.TgZ(18,"th",55),e._uU(19," Exp Date"),e.qZA()()())}function wn(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"option",47),e._uU(2),e.qZA(),e.BQk()),2&o){const t=c.$implicit;e.xp6(1),e.s9C("value",t.ALTUNIT),e.xp6(1),e.Oqu(t.ALTUNIT)}}function Nn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"tbody",56)(1,"tr",57),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.RowClickForConsumption(r))})("keydown.Shift.delete",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.deleteRow())}),e.TgZ(2,"td",58),e._uU(3),e.qZA(),e.TgZ(4,"td",51)(5,"input",59),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ITEMDESC=n)})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw(2);return a.Consumption_ItemkeyEvent(s,n),e.KtG(a.displayProductDetailInViewMode(a.event))})("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onClicked())}),e.ALo(6,"disable"),e.qZA()(),e.TgZ(7,"td",60)(8,"input",61,62),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.BATCH=n)})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw().index,l=e.oxw();return e.KtG(l.BatchEnterForConsumption(a,s,n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw().index,l=e.oxw();return e.KtG(l.BatchEnterForConsumption(a,s,n))}),e.qZA(),e.TgZ(10,"span",63),e._uU(11,"press ENTER or TAB to Select Batch"),e.qZA()(),e.TgZ(12,"td",53)(13,"select",64),e.NdJ("change",function(){const r=e.CHM(t).index,s=e.oxw().index,a=e.oxw();return e.KtG(a.SelectUnitForConsumption(s,r))})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw().index,l=e.oxw();return e.KtG(l.AlternateUnitEnterEventClickInConsumption(a,s,n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw().index,l=e.oxw();return e.KtG(l.AlternateUnitEnterEventClickInConsumption(a,s,n))})("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTUNIT=n)}),e.ALo(14,"disable"),e.YNc(15,wn,3,2,"ng-container",32),e.qZA()(),e.TgZ(16,"td",54)(17,"input",65),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTERNATEQUANTIY=n)})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw().index,l=e.oxw();return e.KtG(l.AlternateQuantityEventClickForConsumption(a,s,n))})("change",function(){const r=e.CHM(t).index,s=e.oxw().index,a=e.oxw();return e.KtG(a.QuantityChangeEventForConsumption(s,r))})("keypress",function(n){const r=e.CHM(t),s=r.$implicit,a=r.index,l=e.oxw().index,h=e.oxw();return e.KtG(6==s.PTYPE&&1!=s.isPurchaseOrder?h.AlternateQuantityEventClickForConsumption(l,a,n):h.return)}),e.ALo(18,"disable"),e.qZA()(),e.TgZ(19,"td",52)(20,"input",66),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTRATE=n)})("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTRATE=n)})("change",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.MRPChangeEventForConsumption(r,a,s))})("keydown.Tab",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.mrpEnterEventForConsumption(r,a,s))})("keydown.enter",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.mrpEnterEventForConsumption(r,a,s))}),e.ALo(21,"twoDigitNumber"),e.ALo(22,"disable"),e.qZA()(),e.TgZ(23,"td",67),e.NdJ("change",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.MRPChangeEventForConsumption(r,a,s))})("keydown.Tab",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.mrpEnterEventForConsumption(r,a,s))})("keydown.enter",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw().index,l=e.oxw();return e.KtG(l.mrpEnterEventForConsumption(r,a,s))}),e._uU(24),e.ALo(25,"twoDigitNumber"),e.qZA(),e.TgZ(26,"td",55)(27,"input",68),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.MFGDATE=n)}),e.qZA()(),e.TgZ(28,"td",55)(29,"input",68),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.EXPDATE=n)}),e.qZA()()()()}if(2&o){const t=c.$implicit,i=c.index,n=e.oxw(),r=n.index,s=n.$implicit,a=e.oxw();e.xp6(1),e.ekj("selected",a.isTableRowSelected(r))("highlighted",r==a.activerowIndex),e.xp6(2),e.Oqu(i+1),e.xp6(2),e.MGl("id","description",""+r+i,""),e.Q6J("ngModel",t.ITEMDESC)("disabled",e.xi3(6,29,"disableItemDescInMultipleConsumption",i)),e.xp6(3),e.MGl("id","batchcon",r,""),e.Q6J("ngModel",t.BATCH)("disabled",0===s.REQEXPDATE||null==s.REQEXPDATE),e.xp6(5),e.MGl("id","unit",""+r+i,""),e.Q6J("ngModel",t.ALTUNIT)("disabled",e.xi3(14,32,"disableAltUnit",i)),e.xp6(2),e.Q6J("ngForOf",null==t.Product?null:t.Product.AlternateUnits),e.xp6(2),e.MGl("id","quantity",""+r+i,""),e.Q6J("ngModel",t.ALTERNATEQUANTIY)("disabled",e.xi3(18,35,"disableAltQty",i)),e.xp6(3),e.MGl("id","rate",""+r+i,""),e.Q6J("ngModel",t.ALTRATE)("ngModel",a.applyPipeInRate?e.lcZ(21,38,t.ALTRATE):t.ALTRATE)("disabled",e.xi3(22,40,"disableAltQty",r))("readonly",!0),e.xp6(3),e.MGl("id","amt",""+r+i,""),e.xp6(1),e.hij(" ",e.lcZ(25,43,a._trnMainService.nullToZeroConverter(t.AMOUNT)),""),e.xp6(3),e.MGl("id","mfgdate",""+r+i,""),e.Q6J("ngModel",t.MFGDATE),e.xp6(2),e.MGl("id","expdate",""+r+i,""),e.Q6J("ngModel",t.EXPDATE)}}function Rn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"tbody",17)(1,"tr",18),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.RowClickForProductionConsumption(r))}),e.TgZ(2,"td",19),e._uU(3),e.qZA(),e.TgZ(4,"td",20)(5,"div",21)(6,"div",22)(7,"label",23),e._uU(8,"ItemName:"),e.qZA(),e.TgZ(9,"input",24),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ITEMDESC=n)})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return a.ItemkeyEvent(s,n),e.KtG(a.displayProductDetailInViewMode(a.event))}),e.ALo(10,"disable"),e.qZA()(),e.TgZ(11,"div",25)(12,"div",26)(13,"label",27),e._uU(14,"Batch:"),e.qZA(),e.TgZ(15,"input",28),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.BATCH=n)})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.BatchEnter(s,n))})("keydown",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeydownOnBatch(n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.BatchEnter(s,n))}),e.ALo(16,"disable"),e.qZA()(),e.TgZ(17,"div",29)(18,"label",30),e._uU(19,"Unit:"),e.qZA(),e.TgZ(20,"select",31),e.NdJ("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.SelectUnit(r))})("keydown.Tab",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateUnitEnterEventClick(s,n))})("keydown.enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateUnitEnterEventClick(s,n))})("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTUNIT=n)}),e.ALo(21,"disable"),e.YNc(22,Ln,3,2,"ng-container",32),e.qZA()()(),e.TgZ(23,"div",25)(24,"div",26)(25,"label",33),e._uU(26,"Quantity:"),e.qZA(),e.TgZ(27,"input",34),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTERNATEQUANTIY=n)})("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.QuantityChangeEvent(r))})("keydown.Enter",function(n){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.AlternateQuantityEventClick(s,n))}),e.ALo(28,"disable"),e.qZA()(),e.TgZ(29,"div",29)(30,"label",35),e._uU(31,"Rate:"),e.qZA(),e.TgZ(32,"input",36),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.ALTRATE=n)})("change",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.MRPChangeEvent(r,s))})("keydown.Tab",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.mrpEnterEvent(r,s))})("keydown.enter",function(){const n=e.CHM(t),r=n.$implicit,s=n.index,a=e.oxw();return e.KtG(a.mrpEnterEvent(r,s))}),e.ALo(33,"twoDigitNumber"),e.qZA()()(),e.TgZ(34,"div",37)(35,"label",35),e._uU(36,"Amount:"),e.qZA(),e.TgZ(37,"input",38),e.NdJ("change",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.MRPChangeEvent(r))})("keydown.Tab",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.mrpEnterEvent(r))})("keydown.enter",function(){const r=e.CHM(t).index,s=e.oxw();return e.KtG(s.mrpEnterEvent(r))}),e.ALo(38,"twoDigitNumber"),e.ALo(39,"disable"),e.qZA()()()(),e.TgZ(40,"td",39)(41,"div",40)(42,"table"),e.YNc(43,xn,20,0,"thead",41),e.YNc(44,Nn,30,45,"tbody",42),e.qZA()(),e._UZ(45,"hr",43),e.TgZ(46,"div",44)(47,"h6",45),e._uU(48),e.ALo(49,"twoDigitNumber"),e.qZA(),e.TgZ(50,"h6",45),e._uU(51),e.ALo(52,"twoDigitNumber"),e.qZA(),e.TgZ(53,"h6",46),e._uU(54," CONSUMPTION TOTAL:"),e.qZA()()()()()}if(2&o){const t=c.$implicit,i=c.index,n=e.oxw();e.xp6(1),e.ekj("selected",n.isTableRowSelected(i))("highlighted",i==n.activerowIndex),e.xp6(2),e.hij("",i+1," "),e.xp6(6),e.MGl("id","PCitemname",i,""),e.Q6J("ngModel",t.ITEMDESC)("readonly",!0)("disabled",e.xi3(10,31,"disableItemDesc","i")),e.xp6(6),e.MGl("id","PCbatch",i,""),e.Q6J("ngModel",t.BATCH)("disabled",e.lcZ(16,34,"disableBatch")),e.xp6(5),e.MGl("id","PCunit",i,""),e.Q6J("ngModel",t.ALTUNIT)("disabled",e.xi3(21,36,"disableAltUnit",i)),e.xp6(2),e.Q6J("ngForOf",null==t.Product?null:t.Product.AlternateUnits),e.xp6(5),e.MGl("id","PCquantity",i,""),e.Q6J("ngModel",t.ALTERNATEQUANTIY)("readonly",t.isQuantityReadonly)("disabled",e.xi3(28,39,"disableAltQty",i)),e.xp6(5),e.MGl("id","PCrate",i,""),e.Q6J("ngModel",n.applyPipeInRate?e.lcZ(33,42,t.ALTRATE):t.ALTRATE),e.xp6(5),e.MGl("id","PCamount",i,""),e.Q6J("ngModel",n._trnMainService.nullToZeroConverter(e.lcZ(38,44,t.AMOUNT)))("disabled",e.xi3(39,46,"disableAltQty",i))("readonly",!0),e.xp6(6),e.Q6J("ngIf",0==i),e.xp6(1),e.Q6J("ngForOf",n._trnMainService.TrnMainObj.ProdList[i].ConsumptionList),e.xp6(2),e.MGl("id","consumptiontotal",i,""),e.xp6(2),e.hij("",e.lcZ(49,49,n._trnMainService.TrnMainObj.ProdList[i].TotalConsumptionAmount)," "),e.xp6(3),e.hij("",e.lcZ(52,51,n._trnMainService.TrnMainObj.ProdList[i].TotalConsumptionQuantity)," ")}}function Dn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",69)(1,"PBatchList",70),e.NdJ("dbClickEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.dblClickPopupBatch(n))})("BatchClosedClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.model1Closed())})("returnBatchValue",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.returnBatch(n))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("AlternateUnits",t.AlternateUnits)("activerowIndex",t.activerowIndex)("title",t.masterService.PlistTitle)("BList",t.batchlist)("voucherType",t._trnMainService.TrnMainObj.VoucherType)}}let jn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v){this.masterService=t,this._trnMainService=i,this.loadService=n,this.alertService=r,this.arouter=s,this.dialog=a,this.responseMsgService=l,this.validationService=h,this.productHelperService=v,this.applyPipeInRate=!0,this.loadFromBarcode=!1,this.showStockedQuantityOnly=0,this.activerowIndex=0,this.ConsumptionactiverowIndex=0,this.gridPopupSettings=new E.im,this.gridPopupSettingsForSupplier=new E.im,this.batchlist=[],this.onChangeProductionItem=new e.vpe,this.showBatchWiseDetail=!1}onClicked(){this._trnMainService.inputCode=!0}RowClickForProductionConsumption(t){this.activerowIndex=t,this.masterService.ShowMore=!1}RowClickForConsumption(t){this.ConsumptionactiverowIndex=t,this.masterService.ShowMore=!1}AddProductionConsumption(){null!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MENUCODE&&null!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ITEMDESC?null!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[0].MENUCODE&&null!==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[0].ITEMDESC?(this._trnMainService.addRow(),this.activerowIndex=this._trnMainService.TrnMainObj.ProdList.length-1,this.focusOnProductionEntry("PCitemname",this.activerowIndex),this._trnMainService.addConsumptionRowForConsumptionInNewProductionEntry(this.activerowIndex)):this.alertService.info("Select the item in Consumption"):this.alertService.info("Select the item in production")}heightChange(){let t;return t=this.masterService.ShowMore?67:71,t}focusOnProductionEntry(t,i){setTimeout(()=>{document.getElementById(t+i).focus()},0)}ItemkeyEvent(t,i){if(i.preventDefault(),this.activerowIndex=t,this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this._trnMainService.TrnMainObj,this._trnMainService.activeurlpath),this._trnMainService.currentIndexProductDetails=[],"VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){this.showStockedQuantityOnly=0;let r,n="";null!=this._trnMainService.TrnMainObj.VoucherPrefix&&(n=this._trnMainService.TrnMainObj.VoucherPrefix);let s="";return s=this._trnMainService.TrnMainObj.MWAREHOUSE?this._trnMainService.TrnMainObj.MWAREHOUSE:this._trnMainService.userProfile.userWarehouse,this._trnMainService.TrnMainObj.BILLTO?(s=this._trnMainService.TrnMainObj.BILLTO,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${r}/all/${n}/${s}`,this._trnMainService.itemselectevent=!0,this.genericGrid.show("FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMIMPORTPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL),!1):void this.alertService.info("Please select Production warehouse")}this.displayProductDetailInViewMode(i)}displayProductDetailInViewMode(t){"VIEW"==this._trnMainService.TrnMainObj.Mode.toUpperCase()&&"F9"==t.code&&this.dialougeOpen()}dialougeOpen(){this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this.dialog.open(ce.H,{hasBackdrop:!0,autoFocus:!1,data:{type:this._trnMainService.TrnMainObj.VoucherPrefix,mode:this._trnMainService.TrnMainObj.Mode,warehouse:this._trnMainService.TrnMainObj.MWAREHOUSE,message:this._trnMainService.TrnMainObj.ProdList[this.activerowIndex],curretnIndexPrevDetials:this._trnMainService.currentIndexProductDetails,productList:this._trnMainService.TrnMainObj.ProdList}}).afterClosed().subscribe(n=>{this.productLists=n&&n.data&&n.data.productColorList?n.data.productColorList:[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=this.productLists,this._trnMainService.currentIndexProductDetails=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=this.productLists?this.productLists.length:0})}dblClickPopupItem(t){if(this.checkDuplicateIteminConsumption(t.MCODE,this.activerowIndex)){if(0==this.validationService.validateDuplicateItemEntry(this._trnMainService.TrnMainObj,t))return this.alertService.info("Cannot enter duplicate item !"),void this.alertService.emitShowHideSubject.subscribe(r=>{setTimeout(()=>{document.getElementById("PCitemname"+this.activerowIndex).focus()},0)});if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PTYPE=t.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ECSRATE=t.ECSRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].HASECSCHARGE=t.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE=t.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ENABLEITEMWISEBATCH=t.ENABLEITEMWISEBATCH,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isPurchaseOrder=!1,this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]){this.batchlist=[];let r=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];r.REQEXPDATE=t.REQEXPDATE,r.DISMODE=t.DISMODE,r.PWEIGHT=t.GWEIGHT,r.PROMOTION=0,r.BATCHSCHEME=null,r.ALLSCHEME=null,r.ISVAT=t.ISVAT,r.MENUCODE=t.MENUCODE,r.ITEMDESC=t.DESCA,r.MCODE=t.MCODE,r.WEIGHT=t.GWEIGHT,r.Mcat=t.MCAT,r.BASEUNIT=t.BASEUNIT,r.SHELFLIFE=t.SHELFLIFE,r.Weighable=t.Weighable,r.MRP=t.MRP,r.ALTCONFACTOR=t.CONFACTOR,r.BARCODE=t.BARCODE,r.TOTSTOCK=t.STOCK,r.PSTOCK=t.PSTOCK,r.UNIT=t.BASEUNIT,r.WARRANTY=t.WARRANTY,r.W_MRP=t.W_MRP,r.W_SELLRATEBEFORETAX=t.W_SELLRATEBEFORETAX,r.STOCK=t.STOCK,r.WSRATE_DISCOUNT=t.WSRATE_DISCOUNT,r.MINLEVEL=t.MINLEVEL,r.MAXLEVEL=t.MAXLEVEL,r.ROLEVEL=t.ROLEVEL,r.ROWARN=t.ROWARN,r.MINWARN=t.MINWARN,r.HASVARIANT=t.HASVARIANT,r.Mcat=t.MCAT,r.REMARKS=t.REMARKS,r.PRATE=t.PRATE,r.ISRECURRING=t.ISRECURRING,r.HASCOMMISSIONCHARGE=t.HASCOMMISSIONCHARGE,1==t.HASVARIANT&&(r.BC=t.BC),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&!(0,q.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTERNATEQUANTIY=1),1==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].isItemDesReadonly=!0),this._trnMainService.TrnMainObj.VoucherType in d.i1&&this._trnMainService.getAllUnitsOfItem(this.activerowIndex),"newproduction-entry"===this._trnMainService.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].SELLRATEBEFORETAX=t.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RECRATE=t.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].POSTOCK=t.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PREV_PRATE=t.PREV_PRATE)}this.focusOnProductionEntry("PCunit",this.activerowIndex)}}checkBatchWiseRate(){this.batchlist=[];let t="";t=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MCODE;let i="";i=this._trnMainService.TrnMainObj.BILLTOADD?this._trnMainService.TrnMainObj.BILLTOADD:this._trnMainService.userProfile.userWarehouse,this.masterService.masterGetmethod(`/getProuductMultiplePriceBatchWise?mcode=${t}&voucherPrefix=${this._trnMainService.TrnMainObj.VoucherPrefix}&warehouse=${i}&barcode=`).subscribe(n=>{"ok"===n.status?(this.batchlist=n.result,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BARCODE&&(this.masterService.PlistTitle="Batch Selection"),"replacerate"===n.message&&1===this._trnMainService.userSetting.BATCHWISEPRICE&&(this.changeBatchWiseRate(n.result[0].RATE),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PRATE=n.result[0].costprice),"SHOWPRICEPOPUP"===n.message&&(this.masterService.PlistTitle="Batch Price Selection"),0===this.batchlist.length&&"NewBill"!=this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE&&alert("Rate not Detected!")):this.alertService.info(n.result)})}itemFromBC(t){return 1==t&&1==this.loadFromBarcode}AlternateUnitEnterEventClick(t,i){i.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[t].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[t].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[t].ALTUNIT&&document.getElementById("PCquantity"+t).focus()}AlternateUnitEnterEventClickInConsumption(t,i,n){n.preventDefault(),null!=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT&&""!=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT&&void 0!==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT&&this.focusOnProductionEntry("quantity",""+t+i)}SelectUnit(t){this._trnMainService.TrnMainObj.ProdList[t].DiscountOnAltUnit=!1,this._trnMainService.TrnMainObj.ProdList[t].ALTERNATEQUANTIY=0,this._trnMainService.TrnMainObj.ProdList[t].CRATE=0;let i=this._trnMainService.TrnMainObj.ProdList[t].Product.AlternateUnits.find(n=>n.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[t].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[t].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[t].BASEUNIT?(this._trnMainService.TrnMainObj.ProdList[t].ALTRATE=this._trnMainService.TrnMainObj.ProdList[t].RATE,this._trnMainService.TrnMainObj.ProdList[t].ALTCONFACTOR=1,this._trnMainService.TrnMainObj.ProdList[t].INDDISCOUNTRATE=0):(this._trnMainService.TrnMainObj.ProdList[t].ALTCONFACTOR=i.CONFACTOR,this._trnMainService.TrnMainObj.ProdList[t].ALTRATE=this._trnMainService.TrnMainObj.ProdList[t].RATE*this._trnMainService.TrnMainObj.ProdList[t].ALTCONFACTOR,this._trnMainService.ReCalculateBillWithNormal())}SelectUnitForConsumption(t,i,n,r){let s=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product.AlternateUnits.find(a=>a.ALTUNIT==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT);this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTRATE=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].RATE:(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTCONFACTOR=s.CONFACTOR,this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTRATE=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].RATE*this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTCONFACTOR)}MRPChangeEvent(t,i){this.validateRate(t,i),this._trnMainService.TrnMainObj.ProdList[i].UNIT==this._trnMainService.TrnMainObj.ProdList[i].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[i].RATE=this._trnMainService.TrnMainObj.ProdList[i].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[i].RATE=this._trnMainService.TrnMainObj.ProdList[i].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ALTCONFACTOR)),this._trnMainService.ReCalculateBillWithNormal()}validateRate(t,i){if(0==this._trnMainService.nullToZeroConverter(t.ALTRATE))return!confirm(" Zero  Rate Entry Detected For Item '"+t.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")&&(document.getElementById("PCrate"+i).focus(),!0)}validateRateForConsumptionInProductionEntry(t,i,n){if(0==this._trnMainService.nullToZeroConverter(t.ALTRATE))return!confirm(" Zero  Rate Entry Detected For Item '"+t.ITEMDESC+"'. Do You Want To Proceed Anyway ? ")}mrpEnterEvent(t,i){if(this.validateRate(t,i),this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry){if(1==this._trnMainService.userSetting.EnableOnetoOneProduction)return!1;this.checkValidation(i)}return this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry&&(this._trnMainService.calculateNetRATE(i),this.checkDeuplicateCodeAndRate()),this._trnMainService.ReCalculateBillWithNormal(),this.focusOnProductionEntry("description",""+i+0),!1}checkValidation(t){var i=this._trnMainService.TrnMainObj.ProdList[t];if(null!=i&&null==i.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry){let n=this._trnMainService.TrnMainObj.ProdList.filter(r=>1==r.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(r.EXPDATE))[0];if(null!=n&&1!=this._trnMainService.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${n.ITEMDESC}`),!1}this._trnMainService.ReCalculateBillWithNormal(),this._trnMainService.TrnMainObj.ProdList.some(n=>null==n.MCODE)}checkValidationForConsumptionInProductionEntry(t,i){var n=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i];if(null!=n&&null==n.MCODE)return this.alertService.warning("Please select a Product"),!1;if(this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry){let r=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList.filter(s=>1==s.REQEXPDATE&&0==this._trnMainService.nullToZeroConverter(s.EXPDATE))[0];if(null!=r&&1!=this._trnMainService.userSetting.ENABLESINGLEBATCHMODE)return this.alertService.info(`EXP date is required for item:${r.ITEMDESC}`),!1}this._trnMainService.ReCalculateBillForConsumptionInNewProductionEntry(t),this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList.some(r=>null==r.MCODE)}checkDeuplicateCodeAndRate(){let t=[],i=this._trnMainService.TrnMainObj.ProdList.filter(n=>n.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE);if(null!=i){if(i.length>1){let r=0;for(let s of this._trnMainService.TrnMainObj.ProdList)s.MCODE==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].MCODE&&t.push(r),r++}let n=1;for(let r of t)(this._trnMainService.TrnMainObj.ProdList[r].RATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE||this._trnMainService.TrnMainObj.ProdList[r].EXPDATE===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EXPDATE)&&(this._trnMainService.TrnMainObj.ProdList[r].BATCH=`-${n}`),n++}}checkDeuplicateCodeAndRateForConsumption(t,i){let n=[],r=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList.filter(s=>s.MCODE==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].MCODE);if(null!=r){if(r.length>1){let a=0;for(let l of this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList)l.MCODE==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].MCODE&&n.push(a),a++}let s=1;for(let a of n)(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[a].RATE===this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].RATE||this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[a].EXPDATE===this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].EXPDATE)&&(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[a].BATCH=`-${s}`),s++}}CalculateProductionRate(t){if(t.Quantity>0){let i=t.TotalConsumptionAmount/t.Quantity;if(t.ALTUNIT==t.BASEUNIT)t.RATE=i,t.ALTRATE=i;else{const n=t.ALTCONFACTOR??1;t.RATE=i,t.ALTRATE=i*n}}}QuantityChangeEvent(t){if(this.CalculateProductionRate(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex]),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&!this._trnMainService.allowMinusStockInEditMode(this.activerowIndex)){let i=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex];if(this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry&&"EDIT"===i.RowMode.toUpperCase()&&i&&!this.ValidateQtyINEditModeFroProduction(i))return}this._trnMainService.ReCalculateBillWithNormal(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.TrnMainObj.VoucherType==d.Km.ProductionEntry&&this.onChangeProductionItem.emit()}QuantityChangeEventForConsumption(t,i){this._trnMainService.ReCalculateBillForConsumptionInNewProductionEntry(t),this.CalculateConsumptionTotal(t),(7==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].NATURETYPE||10==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].PTYPE||this._trnMainService.allowNegativeBilling(this.activerowIndex,!1,!0)||this.checkChildproductEnterQuantityInNewProductionEntry(t,i))&&this._trnMainService.ReCalculateBillWithNormal()}CalculateConsumptionTotal(t){this._trnMainService.TrnMainObj.ProdList[t].TotalConsumptionQuantity=0,this._trnMainService.TrnMainObj.ProdList[t].TotalConsumptionAmount=0,this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList.forEach(i=>{this._trnMainService.TrnMainObj.ProdList[t].TotalConsumptionQuantity+=i.ALTERNATEQUANTIY,this._trnMainService.TrnMainObj.ProdList[t].TotalConsumptionAmount+=this._trnMainService.nullToZeroConverter(i.Quantity*i.RATE)})}checkChildproductEnterQuantityInNewProductionEntry(t,i){let n=0;return this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList.filter(s=>s.MCODE==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].MCODE&&s.BATCH==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].BATCH).forEach(s=>{n+=s.Quantity}),n>this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].STOCK?(this.alertService.info(`Inserted Quantity Is Greater Than Its Available Stock \n    Qty=${this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].STOCK)} \n    ${this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].BASEUNIT},      \n    Item : ${this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ITEMDESC} \n    @Qty = ${this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Quantity} ${this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT} `),this._trnMainService.quantityExceedCheck="QuantityExceed",this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTERNATEQUANTIY=0,!1):(this._trnMainService.quantityExceedCheck="",!0)}changeBatchWiseRate(t){"consumption"===this._trnMainService.TrnMainObj.AdditionalObj.RETURNTYPE&&this._trnMainService.nullToZeroConverter(t)>0&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=t,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REPACKRATE=t,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].PRATE=t,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=t,this.setDefaultUnitwisRate(this.activerowIndex))}setDefaultUnitwisRate(t){null!=this._trnMainService.TrnMainObj.ProdList[t].Product.AlternateUnits.filter(n=>1==n.ISDEFAULTPUNIT)[0]&&(this._trnMainService.TrnMainObj.ProdList[t].ALTRATE=this._trnMainService.TrnMainObj.ProdList[t].RATE*this._trnMainService.TrnMainObj.ProdList[t].ALTCONFACTOR)}ValidateQtyINEditModeFroProduction(t){let i=0;return i=t.BASEUNIT===t.ALTUNIT?t.ALTERNATEQUANTIY:t.ALTERNATEQUANTIY*t.ALTERNATEQUANTIY,!(i<t.OUTQTY&&(this.alertService.info(`Item : ${t.ITEMDESC} entered Qty:${i} ${t.BASEUNIT} is less than transaction Qty:${t.OUTQTY}`),1))}AlternateQuantityEventClick(t,i){i.preventDefault(),this.QuantityChangeEvent(t),1===this._trnMainService.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ProductDetails=[])),this.focusOnProductionEntry("description",""+t+0)}AlternateQuantityEventClickForConsumption(t,i,n){n.preventDefault(),1===this._trnMainService.userSetting.EnableTelcomDevices&&1===this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].NATURETYPE&&(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].visible=!0,!this._trnMainService.currentIndexProductDetails?.length&&"NEW"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ProductDetails=[])),this.focusOnProductionEntry("rate",""+t+i)}Consumption_ItemkeyEvent(t,i){if(i.preventDefault(),this.ConsumptionactiverowIndex=t,this.gridPopupSettings=this.productHelperService.getGridPopUpSettingForMenuItem(this.showStockedQuantityOnly,this._trnMainService.TrnMainObj,this._trnMainService.activeurlpath),"VIEW"!=this._trnMainService.TrnMainObj.Mode.toUpperCase()){this.showStockedQuantityOnly=0;let r,n="";n=this._trnMainService.TrnMainObj.VoucherPrefix;let s=this._trnMainService.userProfile.userWarehouse;return((0,q.isNullOrUndefined)(r)||null==r||void 0===r||""==r)&&(r="A"),this._trnMainService.TrnMainObj.BILLTOADD||1!=this._trnMainService.userSetting.EnableCompulsaryConsumption?(s=this._trnMainService.TrnMainObj.BILLTOADD,this.gridPopupSettings.apiEndpoints=`/getMenuitemWithStockPagedList/${this.showStockedQuantityOnly}/${r}/all/${n}/${s}`,this._trnMainService.itemselectevent=!0,this.genericGridConsumption.show(this._trnMainService.TrnMainObj.VoucherType==d.Km.Purchase||this._trnMainService.TrnMainObj.VoucherType==d.Km.BranchTransferOut||this._trnMainService.TrnMainObj.VoucherType==d.Km.TaxInvoice||this._trnMainService.TrnMainObj.VoucherType==d.Km.SalesOrder||"FROMPO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"FROMSO"==this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE?this._trnMainService.TrnMainObj.REFORDBILL:this._trnMainService.TrnMainObj.REFBILL),!1):void this.alertService.info("Please select consumption warehouse")}this.displayProductDetailInViewMode(i)}dblClickPopupItemForConsumption(t){!this.checkDuplicateIteminConsumption(t.MCODE,this.activerowIndex)||!this.ItemValidation(t.MCODE,this.activerowIndex)||0!==this._trnMainService.userSetting.PODELIVERYMODE&&!this.ItemValidation(t.MCODE,this.activerowIndex)||(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ALTRATE=t.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PTYPE=t.PTYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].HASECSCHARGE=t.HASECSCHARGE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].NATURETYPE=t.NATURETYPE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].isPurchaseOrder=!1,null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex]&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC=t.BARCODE),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].NATURETYPE&&""!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC&&null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].isBarcodeOfPtypeSix=!0),this.masterService.PlistTitle="",null!=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex]&&(this.batchlist=[],this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].REQEXPDATE=t.REQEXPDATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].DISMODE=t.DISMODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PWEIGHT=t.GWEIGHT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PROMOTION=0,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BATCHSCHEME=null,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ALLSCHEME=null,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ISVAT=t.ISVAT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MENUCODE=t.MENUCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ITEMDESC=t.DESCA,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MCODE=t.MCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].WEIGHT=t.GWEIGHT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].Mcat=t.MCAT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BASEUNIT=t.BASEUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].SHELFLIFE=t.SHELFLIFE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].Weighable=t.Weighable,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MRP=t.MRP,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ALTCONFACTOR=t.CONFACTOR,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BARCODE=t.BARCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].UNIT=t.BASEUNIT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].WARRANTY=t.WARRANTY,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].W_MRP=t.W_MRP,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].W_SELLRATEBEFORETAX=t.W_SELLRATEBEFORETAX,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].STOCK=t.STOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].WSRATE_DISCOUNT=t.WSRATE_DISCOUNT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MINLEVEL=t.MINLEVEL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MAXLEVEL=t.MAXLEVEL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ROLEVEL=t.ROLEVEL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ROWARN=t.ROWARN,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].MINWARN=t.MINWARN,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].HASVARIANT=t.HASVARIANT,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].Mcat=t.MCAT,6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PTYPE&&!(0,q.isNullOrUndefined)(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC)&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ALTERNATEQUANTIY=1),6==this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].PTYPE&&1==this._trnMainService.userSetting.GblBarcodeWiseBilling&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].isItemDesReadonly=!0),this.getAllUnitsForConsumptionInNewProductionEntry(this.activerowIndex,this.ConsumptionactiverowIndex),this._trnMainService.NeedToTakePriceFromMenuItem()||(1===this._trnMainService.userSetting.EnableBatch||2===this._trnMainService.userSetting.EnableBatch)&&1===this._trnMainService.userSetting.EnableBatchWisePrice&&10!==t.PTYPE&&9!==t.PTYPE&&!1===this.itemFromBC(t.HASVARIANT)&&this.checkBatchWiseRate(),"newproduction-entry"===this._trnMainService.activeurlpath&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].RATE=t.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].REQEXPDATE=t.REQEXPDATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].SELLRATEBEFORETAX=t.RATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].ALTRATE=t.PRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].RECRATE=t.RECRATE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].POSTOCK=t.POSTOCK,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].HASVARIANT=t.HASVARIANT)),this.focusOnProductionEntry("unit",""+this.activerowIndex+this.ConsumptionactiverowIndex))}checkDuplicateIteminConsumption(t,i){var n=this._trnMainService.TrnMainObj.ProdList.find(r=>r.MCODE==t);return!n||(this.alertService.warning(`Item :${n.ITEMDESC} is already selected in Production.`),!1)}ItemValidation(t,i){let n;return n=this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList.find(r=>r.MCODE==t),null==n||(this.alertService.info("Cannot enter duplicate item !"),this.alertService.emitShowHideSubject.subscribe(r=>{setTimeout(()=>{document.getElementById("itemDesccon"+this.activerowIndex).focus()},0)}),!1)}getAllUnitsForConsumptionInNewProductionEntry(t,i){let n=[],r=[];this.masterService.masterGetmethod("/getAllUnitsOfItem/"+this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].MCODE).subscribe(s=>{if("ok"===s.status){null==this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product&&(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product={}),this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product.MCODE=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].MCODE,n=JSON.parse(s.result);for(let l of n){let h={};h.ALTUNIT=l.UNIT,h.PRATE_A=l.PRATE_A,h.MCODE=l.MCODE,h.ISDEFAULTPUNIT=l.ISDEFAULTPUNIT,h.ISDEFAULT=l.ISDEFAULT,h.CONFACTOR=0==this._trnMainService.nullToZeroConverter(l.CONFACTOR)?1:l.CONFACTOR,h.RATE_A=l.RATE_A,r.push(h)}this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product.AlternateUnits=r,this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNITObj=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product.AlternateUnits[0],this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTERNATEUNIT=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNITObj.ALTUNIT,this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTCONFACTOR=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNITObj.CONFACTOR;let a=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].Product.AlternateUnits.filter(l=>1==l.ISDEFAULTPUNIT)[0];null!=a?(this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT=a.ALTUNIT,this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTCONFACTOR=a.CONFACTOR):this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNIT=this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].ALTUNITObj.ALTUNIT}},s=>{})}MRPChangeEventForConsumption(t,i,n){this.validateRate(t,i),this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].UNIT==this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].BASEUNIT?this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].RATE=this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTRATE:0!=this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTRATE)&&(this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].RATE=this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTRATE/this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTCONFACTOR)),this._trnMainService.ReCalculateBillForConsumptionInNewProductionEntry(i)}mrpEnterEventForConsumption(t,i,n){return this.validateRateForConsumptionInProductionEntry(t,i,n),this.checkValidationForConsumptionInProductionEntry(i,n),this.checkDeuplicateCodeAndRateForConsumption(i,n),this._trnMainService.ReCalculateBillForConsumptionInNewProductionEntry(i),this._trnMainService.addConsumptionRowForConsumptionInNewProductionEntry(i),this.focusOnProductionEntry("description",""+this.activerowIndex+(this.ConsumptionactiverowIndex+1)),!1}dblClickPopupBatch(t){this.returnBatch(t)}returnBatch(t){if(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList.filter(r=>r.BATCH==t.BATCH&&r.MCODE==t.MCODE).length>0)return this.alertService.warning("Cannot add same item with same batch"),void this.alertService.emitShowHideSubject.subscribe(r=>{setTimeout(()=>{this.focusOnProductionEntry("unit",""+this.activerowIndex+this.ConsumptionactiverowIndex)},0)});if(this.assignBatchToActiveProdRow(t,this.activerowIndex,this.ConsumptionactiverowIndex),this.masterService.PlistTitle="",1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].HASVARIANT)for(var n in this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].VARIANTLIST=t.VARIANTDETAIL,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].VARIANTDESCA="",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].BC=t.BCODE,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].VARIANTLIST)this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].VARIANTDESCA+=`<b>${n}</b>:${this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[this.ConsumptionactiverowIndex].VARIANTLIST[n]} &nbsp;`;this.focusOnProductionEntry("unit",""+this.activerowIndex+this.ConsumptionactiverowIndex)}assignBatchToActiveProdRow(t,i,n){this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].BATCH=t.BATCH,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].MFGDATE=null==t.MFGDATE?"":t.MFGDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].EXPDATE=null==t.EXPDATE?"":t.EXPDATE.toString().substring(0,10),this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].STOCK=t.STOCK,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].WAREHOUSE=t.WAREHOUSE,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].BATCHSCHEME=t.SCHEME,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].PRATE=t.costprice,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTRATE=t.RATE,this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].RATE=this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].UNIT===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList[n].BASEUNIT?t.RATE:t.RATE*this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[i].ConsumptionList[n].ALTCONFACTOR)}model1Closed(){this.masterService.PlistTitle="",setTimeout(()=>{this.focusOnProductionEntry("unit",""+this.activerowIndex+this.ConsumptionactiverowIndex)},300)}onKeydownOnBatch(t){this._trnMainService.TrnMainObj.VoucherType===d.Km.ProductionEntry||"NewBill"===this._trnMainService.TrnMainObj.AdditionalObj.INVOICETYPE||"Enter"===t.key||"Tab"===t.key||t.preventDefault()}BatchEnter(t,i){i.preventDefault();let n=this._trnMainService.TrnMainObj.VoucherType;return this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].VRATE=i.LANDINGCOST,2==this._trnMainService.userSetting.EnableBatch&&0==this._trnMainService.nullToZeroConverter(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].EnableAutoBatch)&&n in d.Bv&&this._trnMainService.checkBatchInSystem(this.activerowIndex),1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&this.checkBatchWiseRate(),this.showBatchWiseDetail=!0,!1}BatchEnterForConsumption(t,i,n){return n.preventDefault(),this._trnMainService.TrnMainObj.ProdList[t].ConsumptionList[i].VRATE=n.LANDINGCOST,1===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].REQEXPDATE&&!this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].BC&&this.checkBatchWiseRate(),this.showBatchWiseDetail=!0,!1}isTableRowSelected(t){return this.activerowIndex===t}deleteRow(){console.log("LENGTH",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList.length,this.activerowIndex),confirm("Are you sure u you want to delete the Row?")&&(this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList.splice(this.ConsumptionactiverowIndex,1),0===this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList.length&&this._trnMainService.addConsumptionRowForConsumptionInNewProductionEntry(this.activerowIndex)),console.log("LENGTH",this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ConsumptionList.length),this._trnMainService.ReCalculateBillForConsumptionInNewProductionEntry(this.activerowIndex),this.CalculateConsumptionTotal(this.activerowIndex),this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].ALTRATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TotalConsumptionAmount,this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].RATE=this._trnMainService.TrnMainObj.ProdList[this.activerowIndex].TotalConsumptionAmount,this._trnMainService.ReCalculateBillWithNormal()}disableItemDesc(t){let i=this._trnMainService.TrnMainObj.ConsumptionProdList[t];return!!(i.isBarcodeOfPtypeSix||!0===this._trnMainService.disableAllFieldinPurchase||i.isPurchaseOrderItem||7===this._trnMainService.TrnMainObj.VoucherType||1==this._trnMainService.TrnMainObj.DOFULLRETURN&&1==this._trnMainService.userSetting.REFBILLCOMPULSORINCNOTE)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(M.p),e.Y36(j.V),e.Y36(I.c),e.Y36(O.gz),e.Y36(de.uw),e.Y36(he.T),e.Y36(ue.R),e.Y36(F.h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["newproduction-consumption"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Pn,5),e.Gf(In,5),e.Gf(yn,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGrid=n.first),e.iGM(n=e.CRH())&&(i.genericGridConsumption=n.first),e.iGM(n=e.CRH())&&(i.genericGridSupplierPopup=n.first)}},outputs:{onChangeProductionItem:"onChangeProductionItem"},decls:29,vars:12,consts:[[1,"wrapper","col-md-12"],[1,"productionconsumptiontable"],[1,"mainTable-header"],["id","prodlistTableheader",2,"border","2px solid #E6E6E6","background","rgb(238,238,238)"],[2,"width","3%"],[1,"production",2,"width","20%","text-align","center"],[1,"consumption",2,"width","77%","text-align","center"],[1,"btn","btn-primary","btn-sm","pull-right",3,"click"],["class","productionconsumptiontableBody col-sm-12 col-md-12 col-lg-12",4,"ngFor","ngForOf"],[1,"col-md-12","sticky-bottom"],[1,"col-md-6"],[1,"pull-left"],[1,"pull-left",2,"margin-left","10%"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["genericGridConsumption",""],["class","PList",4,"ngIf"],[1,"productionconsumptiontableBody","col-sm-12","col-md-12","col-lg-12"],[3,"click"],[1,"col-sm-0","col-md-0","col-lg-0",2,"border","2px solid #63BBB2","text-align","center","border-top","none"],[1,"col-sm-3","col-md-3","col-lg-3","production-pad",2,"padding-left","0px","padding-right","0px","border","2px solid #63BBB2","border-top","none"],[1,"productiontabledata"],[1,"row","productiondata","col-md-12"],["for","itemname"],["type","text","placeholder","Press ENTER to Select Item",2,"width","78%",3,"id","ngModel","readonly","disabled","ngModelChange","keydown.enter"],[1,"row","col-md-12"],[1,"col-md-8","col-sm-12"],["for","Batch"],["type","text","autocomplete","off","placeholder","Please Enter to Select",2,"width","62%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown","keydown.enter"],[1,"col-md-4","col-sm-12"],["for","unit"],[2,"width","53%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],[4,"ngFor","ngForOf"],["for","quantity"],["type","text",2,"width","62%",3,"id","ngModel","readonly","disabled","ngModelChange","change","keydown.Enter"],["for","rate"],["type","text","disabled","",2,"width","53%",3,"id","ngModel","ngModelChange","change","keydown.Tab","keydown.enter"],[1,"row","col-md-12","col-sm-12"],["type","text",2,"width","41%",3,"id","ngModel","disabled","readonly","change","keydown.Tab","keydown.enter"],[1,"col-sm-9","col-md-9","col-lg-9",2,"padding-left","0px","padding-right","0px","border","2px solid #63BBB2","border-top","none"],[1,"consumptiontable",2,"height","96px","overflow-y","scroll"],["class","header","style","position: sticky;top: 0;",4,"ngIf"],["class","consumptionTable","style","border-collapse: collapse;overflow:scroll",4,"ngFor","ngForOf"],[2,"margin-bottom","0px","margin-top","0px","border","1px solid rgbda(0,0,0,.1)"],[1,"consumptiontotal",3,"id"],[1,"pull-right",2,"margin-left","10%"],[1,"pull-right",2,"font-size","small","margin","6px","padding-top","0px"],[3,"value"],[1,"header",2,"position","sticky","top","0"],[2,"border","0px solid #E6E6E6","background","rgb(126,208,255)","font-size","14px"],["scope","col",2,"width","3%"],[2,"width","45%"],[2,"width","10%"],[2,"width","6%"],[2,"width","5%"],[2,"width","7%"],[1,"consumptionTable",2,"border-collapse","collapse","overflow","scroll"],[2,"border","1px solid #e6e6e6",3,"click","keydown.Shift.delete"],[2,"text-align","center","width","3%"],["type","text","autocomplete","off","placeholder","Press ENTER to Select Item","readonly","",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.enter","click"],[1,"CellWithComment",2,"height","23px","border","1px solid #e6e6e6","width","10%"],["type","text","placeholder","batch","autocomplete","off",1,"CellWithComment",2,"width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.Tab","keydown.enter"],["focusBatch",""],["contenteditable","false",1,"CellComment"],["placeholder","unit",2,"width","100%",3,"id","ngModel","disabled","change","keydown.Tab","keydown.enter","ngModelChange"],["type","number","placeholder","Quantity",2,"text-align","right","width","100%",3,"id","ngModel","disabled","ngModelChange","keydown.enter","change","keypress"],["type","text","placeholder","rate",2,"text-align","right","width","100%",3,"id","ngModel","disabled","readonly","ngModelChange","change","keydown.Tab","keydown.enter"],[2,"text-align","right",3,"id","change","keydown.Tab","keydown.enter"],["type","date",3,"id","ngModel","ngModelChange"],[1,"PList"],[3,"AlternateUnits","activerowIndex","title","BList","voucherType","dbClickEvent","BatchClosedClick","returnBatchValue"]],template:function(t,i){1&t&&(e.TgZ(0,"div")(1,"div",0)(2,"table",1)(3,"thead",2)(4,"tr",3)(5,"th",4),e._uU(6,"SN"),e.qZA(),e.TgZ(7,"th",5),e._uU(8,"Production"),e.qZA(),e.TgZ(9,"th",6),e._uU(10,"Consumption "),e.TgZ(11,"button",7),e.NdJ("click",function(){return i.AddProductionConsumption()}),e._uU(12,"+"),e.qZA()()()(),e.YNc(13,Rn,55,53,"tbody",8),e.qZA()(),e.TgZ(14,"div",9)(15,"div",10)(16,"h6",11),e._uU(17,"PRODUCTION TOTAL:"),e.qZA(),e.TgZ(18,"h6",12),e._uU(19),e.ALo(20,"twoDigitNumber"),e.qZA(),e.TgZ(21,"h6",12),e._uU(22),e.ALo(23,"twoDigitNumber"),e.qZA()()()(),e.TgZ(24,"generic-popup-grid",13,14),e.NdJ("onItemDoubleClick",function(r){return i.dblClickPopupItem(r)}),e.qZA(),e.TgZ(26,"generic-popup-grid",13,15),e.NdJ("onItemDoubleClick",function(r){return i.dblClickPopupItemForConsumption(r)}),e.qZA(),e.YNc(28,Dn,2,5,"div",16)),2&t&&(e.xp6(1),e.Udp("height",i.heightChange()+"vh"),e.xp6(12),e.Q6J("ngForOf",i._trnMainService.TrnMainObj.ProdList),e.xp6(6),e.hij("",e.lcZ(20,8,i._trnMainService.TrnMainObj.TOTALQTY)," "),e.xp6(3),e.hij("",e.lcZ(23,10,i._trnMainService.TrnMainObj.GROSSAMNT)," "),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("ngIf","Batch Price Selection"==i.masterService.PlistTitle||"Batch Selection"==i.masterService.PlistTitle))},dependencies:[m.sg,m.O5,u.YN,u.Kr,u.Fj,u.wV,u.EJ,u.JJ,u.On,E.Zl,W.K,K.g,An.e],styles:["table.productionconsumptiontable[_ngcontent-%COMP%]{width:100%;border:groove;border-collapse:collapse}.wrapper[_ngcontent-%COMP%]{width:99%;overflow-x:hidden;overflow-y:auto}.consumptiontotal[_ngcontent-%COMP%]{z-index:0;background:#e2eaea!important}.mainTable-header[_ngcontent-%COMP%]{top:0;position:sticky;outline:1px solid #888888;outline-offset:-1px}",".production-pad[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%], .col-md-12[_ngcontent-%COMP%], .col-md-8[_ngcontent-%COMP%], .col-md-4[_ngcontent-%COMP%] {\n        padding-left: 0px !important;\n        padding-right: 0 !important;\n    }\n\n    .productiontabledata[_ngcontent-%COMP%]   .col-md-12[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n        width: 16%;\n    }\n\n    .productiontabledata[_ngcontent-%COMP%]   .col-md-8[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n        width: 24%;\n    }\n\n    .productiontabledata[_ngcontent-%COMP%]   .col-md-4[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n        width: 30%;\n    }\n\n    @media screen and (max-width:768px) {\n        .production-pad[_ngcontent-%COMP%]   .col-sm-12[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n            width: 100% !important;\n            width: 100%\n        }\n    }"]}),o})();function Un(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Zn=(()=>{class o{constructor(t,i,n,r){this.masterService=t,this.activatedRoute=i,this._trnMainService=n,this.alertService=r,this._trnMainService.initialFormLoad(88)}ngOnInit(){this.masterService.ShowMore=!0,this.activatedRoute.queryParams.pipe((0,oe.q)(1)).subscribe(t=>{"consumptionNew"===t.navigateTo&&this._trnMainService.loadDataForProductionEntry()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(O.gz),e.Y36(M.p),e.Y36(I.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["newproduction-entry"]],features:[e._Bn([M.p])],decls:14,vars:3,consts:[[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3","pd0"],[2,"white-space","nowrap","margin-left","-130px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"row",2,"margin-top","5px"],[1,"col-md-12","col-lg-12","col-xl-12","pd5"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"voucher-master-toggler"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6),e.qZA()(),e.TgZ(7,"div",5),e._UZ(8,"voucher-master-action"),e.qZA()()(),e.TgZ(9,"div",6),e.YNc(10,Un,2,0,"div",7),e.TgZ(11,"div",8)(12,"div",9),e._UZ(13,"newproduction-consumption"),e.qZA()()()),2&t&&(e.xp6(6),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"] "),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore))},dependencies:[m.O5,L.q,x.i,N,jn],encapsulation:2}),o})();function kn(o,c){1&o&&(e.TgZ(0,"div",12),e._UZ(1,"discounts-insert"),e.qZA())}let Bn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_,S){this.masterService=t,this.itemKeyEventService=i,this.quantityChangeEventService=n,this.entryValidateService=r,this.setting=s,this.spinnerService=a,this.genericProductEntryService=l,this.alertService=h,this._trnMainService=v,this.productHelperService=_,this.router=S,this.Snos=0,this._trnMainService.initialFormLoad(80),this.spinnerService.show("Loading..."),this.masterService.getRequisitionLogDetails().subscribe(g=>{if(g){this.spinnerService.hide();const C=p(67816);this._trnMainService.TrnMainObj.guid=C(),g.result.forEach(H=>{this.addDataInRow(H)})}else this.spinnerService.hide(),this.alertService.error(g.result)},g=>{this.spinnerService.hide(),this.alertService.error(g.error)})}ngOnInit(){this.setProductEntryTable()}addDataInRow(t){this._trnMainService.barCodes.Quantity=1;let i={};i.Sn=this.Snos+=1,i.inputMode=!0,i.MENUCODE=t.MENUCODE,i.ITEMDESC=t.ITEMDESC,i.ALTRATE=t.ALTRATE,i.MCODE=t.MCODE,i.ISVAT=t.ISVAT,i.UNIT=t.BASEUNIT,i.BASEUNIT=t.BASEUNIT,i.ALTUNIT=t.ALTUNIT,i.BATCH="",i.INDDISCOUNTRATE=null,i.INDDISCOUNT=null,i.DISCOUNT=null,i.VAT=null,i.NETAMOUNT=null,i.ITEMTYPE=null,i.RECEIVEDTYPE=null,i.WAREHOUSE=null,i.BC=t.BARCODE,i.ALTERNATEQUANTIY=t.ALTERNATEQUANTIY,i.HasMulitplePrice=0,i.REQEXPDATE=t.REQEXPDATE,i.PTYPE=t.PTYPE,i.NATURETYPE=t.NATURETYPE,i.DISMODE=t.DISMODE,i.ISUNKNOWN=t.ISUNKNOWN,i.GUID=t.GUID,i.SUPPNAME=t.SUPPNAME,i.COMMENTS=t.COMMENTS,i.ALTCONFACTOR=t.ALTCONFACTOR,1==this.genericProductEntryService.userSetting.ENABLEBARCODEWISEBATCH&&t?.BATCH&&(i.BATCH=t.BATCH),this._trnMainService.TrnMainObj.ProdList[0].BC||this._trnMainService.TrnMainObj.ProdList[0].MCODE?this._trnMainService.TrnMainObj.ProdList.push(i):this._trnMainService.TrnMainObj.ProdList[0]=i;let n=0;n=this._trnMainService.TrnMainObj.ProdList.length-1,this._trnMainService.ReCalculateBillWithNormal(),console.log("prodlist",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.allowNegativeBilling(n,!1,!1)}removeInvalidRowsFromprod(){this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE&&""!=t.MCODE)}getColumnDisablePipe(t,i,n){return t}setProductEntryTable(){this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"180px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableItemDesc",i,n)},{field:"SUPPNAME",header:"Supplier",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{width:"100px"},disablePipe:(i,n)=>this.getColumnDisablePipe("disableSupplier",i,n)},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{width:"60px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltUnit",i,n)},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(i,n,r)=>this.QuantityChangeEvent(i,n,r),applyTwoDigitPipe:!1,disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"ALTRATE",header:"Selling Rate",hidden:!1,isActiveColumnHeader:!0,inputType:"number",headerNgStyle:{width:"80px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,focusTo:"COMMENTS",disablePipe:(i,n)=>this.getColumnDisablePipe("disableAltQty",i,n)},{field:"COMMENTS",header:"Order Comments",hidden:!1,isActiveColumnHeader:!0,inputType:"CommentsSelect",onEnter:(i,n,r,s)=>{this.entryValidateService.RemarksEnterCommand(i,n,r,s)},focusTo:"ITEMDESC",headerNgStyle:{width:"60px"}}],this.genericProductEntrySetting.setRowItemFromSelectedItem=i=>this.SetRowItemFromSelectedItem(i),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(i,n=new Function)=>this.SetRowItemRate(i,n)}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}SetRowItemRate(t,i){}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>!0,()=>({useDefault:!0,preCheck:!0}),()=>(this.reCalculateBillWithNormal(t),!1)),this.addRow()}nullToZeroConverter(t){return void 0===t||null==t||null===t||""===t||"Infinity"===t||"NaN"===t||isNaN(parseFloat(t))?0:parseFloat(t)}reCalculateBillWithNormal(t){let i;i=this.nullToZeroConverter(t.ALTERNATEQUANTIY),t.ALTQTY_IN=t.REALQTY_IN=t.Quantity=t.AltQty=t.RealQty=i,t.REALQTY_IN=0,t.ALTQTY_IN=0,t.AMOUNT=i*this.nullToZeroConverter(t.RATE),"kg"===t.Weighable||"ltr"===t.Weighable?t.WEIGHT=i*this.nullToZeroConverter(t.PWEIGHT):("gram"===t.Weighable||"ml"===t.Weighable)&&(t.WEIGHT=i*this.nullToZeroConverter(t.PWEIGHT/1e3)),t.NCRATE=t.RATE*t.EXRATE,t.GSTRATE=1==t.ISVAT?13:0,t.TAXABLE=0,t.VAT=0,t.NONTAXABLE=t.AMOUNT+this.nullToZeroConverter(t.ECSAMOUNT)-t.DISCOUNT+this.nullToZeroConverter(t.SERVICETAX),t.NETAMOUNT=t.TAXABLE+t.NONTAXABLE+t.VAT+this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TOTAMNT+=this.nullToZeroConverter(t.AMOUNT),this._trnMainService.TrnMainObj.GROSSAMNT+=this.nullToZeroConverter(t.Quantity*t.RATE),this._trnMainService.TrnMainObj.TOTALINDDISCOUNT+=this.nullToZeroConverter(t.INDDISCOUNT),this._trnMainService.TrnMainObj.TOTALLOYALTY+=this.nullToZeroConverter(t.LOYALTY),this._trnMainService.TrnMainObj.TOTALPROMOTION+=this.nullToZeroConverter(t.PROMOTION),this._trnMainService.TrnMainObj.DCAMNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.ServiceCharge+=this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TAXABLE+=this.nullToZeroConverter(t.TAXABLE),this._trnMainService.TrnMainObj.NONTAXABLE+=this.nullToZeroConverter(t.NONTAXABLE),this._trnMainService.TrnMainObj.VATAMNT+=this.nullToZeroConverter(t.VAT),this._trnMainService.TrnMainObj.NETAMNT+=this.nullToZeroConverter(t.NETAMOUNT),this._trnMainService.TrnMainObj.TotalWithIndDiscount+=this.nullToZeroConverter(t.TOTAL),this._trnMainService.TrnMainObj.TOTALDISCOUNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.TOTALQTY+=i,this._trnMainService.TrnMainObj.TOTALSQTY+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.TOTALWEIGHT+=this.nullToZeroConverter(t.WEIGHT),this._trnMainService.TrnMainObj.totalAlternateQuantity+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.totalBaseQuantity+=this.nullToZeroConverter(t.BASEQUANTITY),this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT+=this.nullToZeroConverter(t.PrimaryDiscount),this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT+=this.nullToZeroConverter(t.SecondaryDiscount),this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT+=this.nullToZeroConverter(t.LiquiditionDiscount),this._trnMainService.TOTALALLDISCOUNT=this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALQPSDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT),this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=Math.round(this.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)),this._trnMainService.TrnMainObj.ROUNDOFF=this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF-this._trnMainService.TrnMainObj.NETAMNT}QuantityChangeEvent(t,i,n){var r=n;this.quantityChangeEventService.checkBCForMatrxiItem(),"EDIT"===this._trnMainService.TrnMainObj.Mode?.toUpperCase()&&this._trnMainService.allowMinusStockInEditMode(this.genericProductEntryService.activerowIndex),this._trnMainService.calculateNetRATE(r),this._trnMainService.ReCalculateBillWithNormal()}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>T.K.default,i=>T.K.default,()=>T.K.default,()=>T.K.default,()=>T.K.default)}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}addRow(){console.log("ADDROW");try{return null==this._trnMainService.TrnMainObj.ProdList&&(this._trnMainService.TrnMainObj.ProdList=[]),this._trnMainService.TrnMainObj.ProdList.push({inputMode:!0,MENUCODE:null,ITEMDESC:null,RATE:null,NCRATE:null,AMOUNT:null,INDDISCOUNTRATE:null,INDDISCOUNT:null,DISCOUNT:null,VAT:null,NETAMOUNT:null,ITEMTYPE:null,RECEIVEDTYPE:null,WAREHOUSE:null,BC:null,ALTERNATEQUANTIY:null,PRATE:0,isConfirmed:!1,IsAuthorizeForNegative:!1}),this._trnMainService.checkBatchWiseApiResponses=!1,!0}catch(t){return console.log({error:t}),!1}}ReCalculateBillWithNormal(){try{console.log("CheckProd#",this._trnMainService.TrnMainObj.ProdList),this._trnMainService.TrnMainObj.TOTAMNT=0,this._trnMainService.TrnMainObj.TOTALINDDISCOUNT=0,this._trnMainService.TrnMainObj.TOTALPROMOTION=0,this._trnMainService.TrnMainObj.TOTALLOYALTY=0,this._trnMainService.TrnMainObj.DCAMNT=0,this._trnMainService.TrnMainObj.ServiceCharge=0,this._trnMainService.TrnMainObj.TAXABLE=0,this._trnMainService.TrnMainObj.NONTAXABLE=0,this._trnMainService.TrnMainObj.NETAMNT=0,this._trnMainService.TrnMainObj.VATAMNT=0,this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=0,this._trnMainService.TrnMainObj.NETAMNT=0,this._trnMainService.TrnMainObj.TotalWithIndDiscount=0,this._trnMainService.TrnMainObj.TOTALDISCOUNT=0,this._trnMainService.TrnMainObj.TOTALQTY=0,this._trnMainService.TrnMainObj.TOTALWEIGHT=0,this._trnMainService.TrnMainObj.totalAlternateQuantity=0,this._trnMainService.TrnMainObj.totalBaseQuantity=0,this._trnMainService.TrnMainObj.TOTALECSAMOUNT=0,this._trnMainService.TrnMainObj.GROSSAMNT=0,this._trnMainService.TrnMainObj.TOTALSQTY=0,this._trnMainService.TrnMainObj.ProdList.forEach(t=>{let n;t.VoucherType=this._trnMainService.TrnMainObj.VoucherType,t.ALTUNIT===t.BASEUNIT?n=this.nullToZeroConverter(t.ALTERNATEQUANTIY):(n=this.nullToZeroConverter(t.ALTERNATEQUANTIY)*this.nullToZeroConverter(t.ALTCONFACTOR),t.RATE=this.nullToZeroConverter(t.ALTRATE)/this.nullToZeroConverter(t.ALTCONFACTOR)),t.ALTQTY_IN=t.REALQTY_IN=t.Quantity=t.AltQty=t.RealQty=n,t.REALQTY_IN=0,t.ALTQTY_IN=0,t.AMOUNT=n*this.nullToZeroConverter(t.RATE),"kg"===t.Weighable||"ltr"===t.Weighable?t.WEIGHT=n*this.nullToZeroConverter(t.PWEIGHT):("gram"===t.Weighable||"ml"===t.Weighable)&&(t.WEIGHT=n*this.nullToZeroConverter(t.PWEIGHT/1e3));let r=this.nullToZeroConverter(t.INDDISCOUNT)+this.nullToZeroConverter(t.PROMOTION)+this.nullToZeroConverter(t.LOYALTY)+this.nullToZeroConverter(t.PrimaryDiscount)+this.nullToZeroConverter(t.SecondaryDiscount)+this.nullToZeroConverter(t.LiquiditionDiscount),s=0;this._trnMainService.TrnMainObj.ProdList.forEach(l=>{s+=n*this.nullToZeroConverter(l.RATE)-this.nullToZeroConverter(l.INDDISCOUNT)-this.nullToZeroConverter(l.PROMOTION)-this.nullToZeroConverter(l.LOYALTY)-this.nullToZeroConverter(l.PrimaryDiscount)-this.nullToZeroConverter(l.SecondaryDiscount)-this.nullToZeroConverter(l.LiquiditionDiscount)}),0===s&&(t.FLATDISCOUNT=0),t.DISCOUNT=r+this.nullToZeroConverter(t.FLATDISCOUNT),1===t.ISSERVICECHARGE&&1===this._trnMainService.userSetting.EnableServiceCharge&&(t.SERVICETAX=(t.AMOUNT-t.DISCOUNT)*this.setting.appSetting.ServiceTaxRate),t.NCRATE=t.RATE*t.EXRATE,t.GSTRATE=1==t.ISVAT?13:0,t.TAXABLE=0,t.VAT=0,t.NONTAXABLE=t.AMOUNT+this.nullToZeroConverter(t.ECSAMOUNT)-t.DISCOUNT+this.nullToZeroConverter(t.SERVICETAX),t.NETAMOUNT=t.TAXABLE+t.NONTAXABLE+t.VAT+this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TOTAMNT+=this.nullToZeroConverter(t.AMOUNT),this._trnMainService.TrnMainObj.GROSSAMNT+=this.nullToZeroConverter(t.Quantity*t.RATE),this._trnMainService.TrnMainObj.TOTALINDDISCOUNT+=this.nullToZeroConverter(t.INDDISCOUNT),this._trnMainService.TrnMainObj.TOTALLOYALTY+=this.nullToZeroConverter(t.LOYALTY),this._trnMainService.TrnMainObj.TOTALPROMOTION+=this.nullToZeroConverter(t.PROMOTION),this._trnMainService.TrnMainObj.DCAMNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.ServiceCharge+=this.nullToZeroConverter(t.SERVICETAX),this._trnMainService.TrnMainObj.TAXABLE+=this.nullToZeroConverter(t.TAXABLE),this._trnMainService.TrnMainObj.NONTAXABLE+=this.nullToZeroConverter(t.NONTAXABLE),this._trnMainService.TrnMainObj.VATAMNT+=this.nullToZeroConverter(t.VAT),this._trnMainService.TrnMainObj.NETAMNT+=this.nullToZeroConverter(t.NETAMOUNT),this._trnMainService.TrnMainObj.TotalWithIndDiscount+=this.nullToZeroConverter(t.TOTAL),this._trnMainService.TrnMainObj.TOTALDISCOUNT+=this.nullToZeroConverter(t.DISCOUNT),this._trnMainService.TrnMainObj.TOTALQTY+=n,this._trnMainService.TrnMainObj.TOTALSQTY+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.TOTALWEIGHT+=this.nullToZeroConverter(t.WEIGHT),this._trnMainService.TrnMainObj.totalAlternateQuantity+=this.nullToZeroConverter(t.ALTERNATEQUANTIY),this._trnMainService.TrnMainObj.totalBaseQuantity+=this.nullToZeroConverter(t.BASEQUANTITY),this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT+=this.nullToZeroConverter(t.PrimaryDiscount),this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT+=this.nullToZeroConverter(t.SecondaryDiscount),this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT+=this.nullToZeroConverter(t.LiquiditionDiscount),this._trnMainService.TOTALALLDISCOUNT=this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALINDDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALPRIMARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALSECONDARYDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALLIQUIDATIONDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALQPSDISCOUNT)+this.nullToZeroConverter(this._trnMainService.TrnMainObj.TOTALFLATDISCOUNT)}),this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF=Math.round(this.nullToZeroConverter(this._trnMainService.TrnMainObj.NETAMNT)),this._trnMainService.TrnMainObj.ROUNDOFF=this._trnMainService.TrnMainObj.NETWITHOUTROUNDOFF-this._trnMainService.TrnMainObj.NETAMNT}catch{}}onReset(){confirm("Are you sure you want to reset?")&&(this._trnMainService.barCodes.DESCA="",this._trnMainService.barCodes.BC="",this._trnMainService.barCodes.Quantity=0,this.productHelperService.barcodeEnterStock=null,this._trnMainService.initialFormLoad(80))}onSave(){this.filterBeforeSave()?this.alertService.info("There is no item to save!"):(this.spinnerService.show("Saving..."),this.masterService.saveRequisitionLog(this._trnMainService.TrnMainObj.ProdList).subscribe(t=>{t?(this.spinnerService.hide(),"ok"==t.status?(this._trnMainService.TrnMainObj.ProdList=[],t.result.forEach(i=>{this._trnMainService.TrnMainObj.ProdList.push(i)}),this.alertService.success("Data saved successfully!")):this.alertService.error(t.result)):(this.spinnerService.hide(),this.alertService.error(t.result))},t=>{this.spinnerService.hide(),this.alertService.error(t.error)}))}filterBeforeSave(){return 0==this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE&&""!=t.MCODE)?.length||(this._trnMainService.TrnMainObj.ProdList=this._trnMainService.TrnMainObj.ProdList.filter(t=>null!=t.MCODE&&""!=t.MCODE&&t.ALTERNATEQUANTIY>0),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.Quantity=t.ALTERNATEQUANTIY*t.ALTCONFACTOR,t.ALTERNATEUNIT=t.ALTUNIT}),!1)}onBack(){this.router.navigate(["/pages/dashboard"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(T.X),e.Y36(P.s),e.Y36(A.C),e.Y36(G.R),e.Y36(j.V),e.Y36(b.w),e.Y36(I.c),e.Y36(M.p),e.Y36(F.h),e.Y36(O.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["requisition-log"]],features:[e._Bn([M.p,b.w,T.X,f.P,P.s,A.C])],decls:21,vars:2,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-5","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"btn","btn-info","pull-right",3,"click"],[1,"main-container"],[1,"row","row-margin"],["class","col-md-12 pd5",4,"ngIf"],[1,"midTableWrapper"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e._uU(6,"REQUISITION LOG"),e.qZA()(),e.TgZ(7,"div",6)(8,"button",7),e.NdJ("click",function(){return i.onBack()}),e._uU(9,"BACK"),e.qZA(),e.TgZ(10,"button",7),e.NdJ("click",function(){return i.onSave()}),e._uU(11,"SAVE"),e.qZA()()()(),e.TgZ(12,"div",8)(13,"div",9),e.YNc(14,kn,2,0,"div",10),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",9)(17,"div",12)(18,"generic-product-entry",13),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(14),e.Q6J("ngIf",1==i.masterService.userSetting.GblBarcodeWiseBilling),e.xp6(4),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,w.u,B.o,U.Z],encapsulation:2}),o})();var Qn=p(23815);const Hn=["genericGridTerms"];function Fn(o,c){if(1&o&&(e.TgZ(0,"tr"),e.ynx(1,27),e.TgZ(2,"td",28),e._uU(3),e.qZA(),e.TgZ(4,"td",29),e._UZ(5,"input",30),e.qZA(),e.TgZ(6,"td",31),e._UZ(7,"input",32),e.qZA(),e.BQk(),e.qZA()),2&o){const t=c.index;e.xp6(1),e.Q6J("formGroupName",t),e.xp6(2),e.Oqu(t+1),e.xp6(2),e.Q6J("readOnly",!0)}}function Vn(o,c){if(1&o&&(e.ynx(0,25),e.YNc(1,Fn,8,3,"tr",26),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.dispatchListOfBranchesControls.controls)}}let Gn=(()=>{class o{constructor(t,i,n){this.productHelper=t,this.transaction=i,this.fb=n,this.gridPopupSettingsForTerms=new se.sG,this.branches=[],this.newlyAddedBranches=[],this.mcode=""}ngOnInit(){if(this.branchName=new u.NI("",[u.kI.required]),this.dispatchValue=new u.NI("",[u.kI.required,u.kI.min(0)]),this.branchForm=this.fb.group({dispatchListOfBranch:this.fb.array([])}),this.productHelper.showorHideAllocationPopup$.subscribe(t=>{this.currentProductRow=t.index,this.mcode=this.transaction.TrnMainObj.ProdList[this.currentProductRow].MCODE,console.log("mcode",this.mcode)}),this.transaction.TrnMainObj?.ProdList?.[this.currentProductRow]?.BranchWiseDistributionList)for(const t of this.transaction.TrnMainObj.ProdList[this.currentProductRow].BranchWiseDistributionList)this.dispatchListOfBranchesControls.push(this.createFormGroup(t))}createFormGroup(t,i,n){return new u.cw("replaceAndPushMode"===t?{DivisionName:new u.NI(i.value,[u.kI.required]),Dispatch:new u.NI(n.value,[u.kI.required,u.kI.min(0)]),Division:new u.NI(this.selectedBranch.INITIAL,[u.kI.required]),Priority:new u.NI(this.selectedBranch.Priority,[u.kI.required]),isLast:new u.NI(!1),isChanged:new u.NI(!1),MCODE:new u.NI(this.mcode),Request:new u.NI(0)}:{DivisionName:new u.NI(t.DivisionName,[u.kI.required]),Dispatch:new u.NI(t.Dispatch,[u.kI.required,u.kI.min(0)]),Division:new u.NI(t.Division,[u.kI.required]),Priority:new u.NI(t.Priority,[u.kI.required]),isLast:new u.NI(!1),isChanged:new u.NI(!1),MCODE:new u.NI(this.mcode),Request:new u.NI(0)})}branchEnterCommand(t){this.getBranchList(),this.genericGridTerms.show()}getBranchList(){this.gridPopupSettingsForTerms={title:"Branch List",apiEndpoints:"/getDivisionPagedlist",defaultFilterIndex:0,useDefinefilterValue:this.transaction.TrnMainObj.BILLTO,columns:[{key:"INITIAL",title:"Initial",hidden:!1,noSearch:!1},{key:"NAME",title:"Name",hidden:!1,noSearch:!1}]}}onAddBranch(t,i){let n=!1;console.log(this.dispatchListOfBranchesControls.controls);for(let r=0;r<this.dispatchListOfBranchesControls.controls.length;r++)if(this.dispatchListOfBranchesControls.controls[r].value.DivisionName===t.value){this.dispatchListOfBranchesControls.setControl(r,this.createFormGroup("replaceAndPushMode",t,i)),n=!0;break}n||(this.dispatchListOfBranchesControls.push(this.createFormGroup("replaceAndPushMode",t,i)),this.newlyAddedBranches.push(this.dispatchListOfBranchesControls.controls[this.dispatchListOfBranchesControls.controls.length-1].value))}get dispatchListOfBranchesControls(){return this.branchForm.controls.dispatchListOfBranch}onBranchSelected(t){this.branchName.setValue(t.NAME),this.selectedBranch=t}submit(){for(let t=0;t<this.dispatchListOfBranchesControls.controls.length;t++)this.branches.push(this.dispatchListOfBranchesControls.controls[t].value);for(let t=0;t<this.transaction.TrnMainObj.ProdList.length;t++)if(this.newlyAddedBranches.length>0){const i=(0,Qn.cloneDeep)(this.newlyAddedBranches);if(t===this.currentProductRow)this.transaction.TrnMainObj.ProdList[t].BranchWiseDistributionList=this.branches;else{const n=this.setDispatchOfNewBranchesToZeroOfOtherProducts(i),r=Array.from([...this.transaction.TrnMainObj.ProdList[t].BranchWiseDistributionList,...n].reduce((s,a)=>s.set(a.Division,a),new Map).values());this.transaction.TrnMainObj.ProdList[t].BranchWiseDistributionList=r}}else t===this.currentProductRow&&(this.transaction.TrnMainObj.ProdList[t].BranchWiseDistributionList=this.branches);this.productHelper.setDesignBranchwiseTable(this.branches),this.closeDialog()}setDispatchOfNewBranchesToZeroOfOtherProducts(t){for(let i=0;i<t.length;i++)t[i].Dispatch=0;return t}closeDialog(){this.productHelper.showOrHideAllocationPopup({showOrHideAllocationPopup:!1})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(F.h),e.Y36(M.p),e.Y36(u.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-allocation-popup"]],viewQuery:function(t,i){if(1&t&&e.Gf(Hn,5),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGridTerms=n.first)}},decls:37,vars:6,consts:[[1,"card"],[1,"card-header",2,"background-color","#63bbb2"],[1,"row"],[1,"button-group"],["title","Save","type","submit",1,"btn","btn-info",2,"margin-right","2px",3,"click"],["type","button","title","Cancel",1,"btn","btn-info",3,"click"],[1,"card-body",2,"overflow","auto"],[1,"col-md-12",2,"margin-top","1rem"],[1,"col-md-8"],[1,"d-flex","align-items-center","custom-gap"],[2,"width","50%"],["type","text","id","customerselectid","placeholder","Press ENTER to Select","readonly","",3,"formControl","keydown.enter"],["type","number",3,"formControl"],["type","button","title","Cancel",1,"btn","btn-info","ml-5",3,"disabled","click"],[3,"formGroup"],["id","BlueHeaderResizableTable",1,"table","table-striped","mt-3"],[1,"stickHead"],[2,"line-height","2rem"],[1,"fontsize",2,"width","5%","font-weight","bold"],[1,"fontsize",2,"width","15%","font-weight","bold"],[1,"fontsize",2,"width","20%","font-weight","bold"],[2,"scrollbar-3dlight-color","#FFFFFF","scrollbar-arrow-color","#000000","scrollbar-base-color","#FF9999","scrollbar-darkshadow-color","#000000","scrollbar-face-color","#000000","scrollbar-highlight-color","#000000","scrollbar-shadow-color","#0033CC"],["formArrayName","dispatchListOfBranch",4,"ngIf"],[3,"popupsettings","onItemDoubleClick"],["genericGridTerms",""],["formArrayName","dispatchListOfBranch"],[4,"ngFor","ngForOf"],[3,"formGroupName"],[2,"width","5%"],[2,"width","15%"],["type","text","formControlName","DivisionName",3,"readOnly"],[2,"width","20%"],["type","number","formControlName","Dispatch"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),e._uU(4,"Product Allocation"),e.qZA(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return i.submit()}),e._uU(7,"APPLY"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return i.closeDialog()}),e._uU(9,"CANCEL"),e.qZA()()()(),e.TgZ(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",2)(14,"div",9)(15,"label",10),e._uU(16,"Branch: "),e.qZA(),e.TgZ(17,"input",11),e.NdJ("keydown.enter",function(r){return i.branchEnterCommand(r)}),e.qZA(),e.TgZ(18,"label",10),e._uU(19,"Quantity: "),e.qZA(),e._UZ(20,"input",12),e.TgZ(21,"button",13),e.NdJ("click",function(){return i.onAddBranch(i.branchName,i.dispatchValue)}),e._uU(22,"ADD"),e.qZA()()()(),e.TgZ(23,"form",14)(24,"table",15)(25,"thead",16)(26,"tr",17)(27,"th",18),e._uU(28,"S.N"),e.qZA(),e.TgZ(29,"th",19),e._uU(30,"Branch Name"),e.qZA(),e.TgZ(31,"th",20),e._uU(32,"Quantity"),e.qZA()()(),e.TgZ(33,"tbody",21),e.YNc(34,Vn,2,1,"ng-container",22),e.qZA()()()()()(),e.TgZ(35,"generic-popup-grid",23,24),e.NdJ("onItemDoubleClick",function(r){return i.onBranchSelected(r)}),e.qZA()),2&t&&(e.xp6(17),e.Q6J("formControl",i.branchName),e.xp6(3),e.Q6J("formControl",i.dispatchValue),e.xp6(1),e.Q6J("disabled",!i.branchName.valid||!i.dispatchValue.valid),e.xp6(2),e.Q6J("formGroup",i.branchForm),e.xp6(11),e.Q6J("ngIf",null==i.dispatchListOfBranchesControls?null:i.dispatchListOfBranchesControls.controls),e.xp6(1),e.Q6J("popupsettings",i.gridPopupSettingsForTerms))},dependencies:[m.sg,m.O5,u._Y,u.Fj,u.wV,u.JJ,u.JL,u.oH,u.sg,u.u,u.x0,u.CE,E.Zl],styles:["[_nghost-%COMP%]{display:block;position:fixed!important;transform:translate(-50px,-50px);background:#ffffff;z-index:99999;width:83%;top:20%;left:14%}.page-title[_ngcontent-%COMP%]{text-align:center}.form-control[_ngcontent-%COMP%]{font-size:12px;height:25px}.form-control[_ngcontent-%COMP%]:focus{border:2px solid #6aafd6}.button-group[_ngcontent-%COMP%]{position:absolute;right:3%;top:3%}.card[_ngcontent-%COMP%]{height:30rem;border:2px solid slategray}.number-button[_ngcontent-%COMP%]{border:1px solid black;width:65px}.large-button[_ngcontent-%COMP%]{border:1px solid black;width:100%}.fieldset-class[_ngcontent-%COMP%]{background:#f7f7f7;margin-right:-40px;margin-left:-35px;margin-top:12px;height:25rem;border:2px solid #999999}.payment-button[_ngcontent-%COMP%]{width:8em;margin-left:-45px;background-color:#fff;border-color:#117a8b;font-size:15px;color:#138496;transition-duration:.3s}.payment-button[_ngcontent-%COMP%]:hover, .clickedbutton[_ngcontent-%COMP%]{background-color:#138496;border-color:#117a8b;color:#fff}.table-class[_ngcontent-%COMP%]{height:10px;overflow-y:scroll;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:14px}.bodytable[_ngcontent-%COMP%]{display:block;height:15rem;overflow-y:scroll;overflow-x:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:97.3%;table-layout:fixed}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.1rem!important}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#e1eaea}.amountLabel[_ngcontent-%COMP%]{font-weight:700;font-size:16px;width:auto}.amountValue[_ngcontent-%COMP%]{width:auto;font-size:16px;color:#8b0000;font-weight:700}.totalLabel[_ngcontent-%COMP%]{font-weight:700}.totalValue[_ngcontent-%COMP%]{text-align:right;padding-right:7px;font-weight:700}.total[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:7px;padding-right:10px}#TnC[_ngcontent-%COMP%]{width:100%;height:60vh;max-height:60vh;background-color:#f0f8ff;overflow-y:scroll}.custom-gap[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:25px}"]}),o})();function qn(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"inv-params",16),e.NdJ("onClickPIRef",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClickPIRef())}),e.qZA()()}}function Yn(o,c){1&o&&e._UZ(0,"app-allocation-popup")}let Wn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_,S){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this.itemKeyEventService=l,this.entryValidateService=h,this.quantityChangeEventService=v,this.genericProductEntryService=_,this.productHelper=S,this.destroy$=new Y.xQ,this._trnMainService.initialFormLoad(82)}onclickOnResetPopupEmit(){this.setProductEntryTable(),this.genericProductEntrySetting2=new D.Vn(this._trnMainService),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[]}ngOnInit(){this.setProductEntryTable(),this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[],this.showorHideAllocationPopup$=this.productHelper.showorHideAllocationPopup$,this.productHelper.designBranchWiseTable$.pipe((0,ne.R)(this.destroy$)).subscribe(t=>{console.log("subscribe from inventory allocation"),this.setProductEntryTable(),this.setProductEntryTable2(),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[],this.setUpProdList(),this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.TotalReqQuantity=i.BranchWiseDistributionList1.map(n=>n.Request).reduce((n,r)=>n+r,0)+i.BranchWiseDistributionList2.map(n=>n.Request).reduce((n,r)=>n+r,0),i.TotalDispatch=i.BranchWiseDistributionList1.map(n=>n.Dispatch).reduce((n,r)=>n+r,0)+i.BranchWiseDistributionList2.map(n=>n.Dispatch).reduce((n,r)=>n+r,0),i.TotalReqQuantity<i.ALTQTY_IN&&(i.AltQty=i.TotalReqQuantity)}),this.addBranchWiseToTable1(),this.addBranchWiseToTable2()},t=>{this.alertService.error("error"),console.log("error in subscribe from inventory allocation",t)})}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"S.No",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px",zIndex:1},showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT",showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},columnNgStyle:{textAlign:"right","padding-right":"3px"},focusTo:"ALTERNATEQUANTIY",disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a),showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ALTQTY_IN",header:"Total Qty",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(n,r,s)=>this.QuantityChangeEvent_default(n,r,s),applyTwoDigitPipe:!1,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r),showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"AltQty",header:"Order To Dispatch",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},showSubHeading:!1,subHeader:[{showSubHeading:!1}],columnNgStyle:{width:"100%","text-align":"right"},rowspan:2,disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltQty",n,r),onEnter:(n,r,s,a)=>{this.orderDistribute(n)},onChange:(n,r,s,a)=>{this.orderDistribute(a)}}];this.genericProductEntrySetting.showSubHeading=!0,this.genericProductEntrySetting.columns=i,this.genericProductEntrySetting.height="218px",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.InventoryAllocation,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r)}setProductEntryTable2(){var t=this._trnMainService.TrnMainObj.AdditionProdList;this.genericProductEntrySetting2=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"S.No",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px",zIndex:1},showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r),focusTo:"ALTUNIT",showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY",columnNgStyle:{textAlign:"right","padding-right":"3px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableAltUnit",n,r),onEnter:(n,r,s,a)=>this.entryValidateService.AlternateUnitEnterEventClick(n,r,s,a),showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];this.genericProductEntrySetting2.showSubHeading=!0,this.genericProductEntrySetting2.columns=i,this.genericProductEntrySetting2.height="218px",this.genericProductEntrySetting2.prodlist=t,this.genericProductEntrySetting2.voucherType=d.Km.InventoryAllocation,this.genericProductEntrySetting.setRowItemFromSelectedItem=n=>this.SetRowItemFromSelectedItem(n),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(n,r=new Function)=>this.SetRowItemRate(n,r)}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}getColumnDisablePipe(t,i,n){return t}SetRowItemRate(t,i){i()}style(t){if(t?.Request>0){if(t.Request==t.Dispatch)return"green";if(0==t.Dispatch)return"brown";if(t.Request>t.Dispatch)return"yellow";if(t.Request<t.Dispatch)return"red"}}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}showGenericGrid(t){this.itemKeyEventService.ItemkeyEvent(t.index,t.event,()=>T.K.default,i=>T.K.default,()=>T.K.default,()=>T.K.default,()=>T.K.default)}nextRow(){let t=this.genericProductEntryService.activerowIndex+1;this._trnMainService.addRow(),setTimeout(()=>{document.getElementById("ITEMDESC"+t).focus()},0)}onSaveINVAllocation(){this.setProductEntryTable(),this.genericProductEntrySetting2=new D.Vn(this._trnMainService),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[]}onClickPIRef(){this.setProductEntryTable(),this.setProductEntryTable2(),this.genericProductEntryService.headerAfterSubHeader=[],this.genericProductEntryService.headerAfterSubHeader2=[],this.genericProductEntryService.subHeader=[],this.genericProductEntryService.subHeader2=[],"VIEW"==this._trnMainService.TrnMainObj.Mode&&(this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.ALTQTY_IN=t.ALTERNATEQUANTIY}),this.setDivisionInBranchList()),this.setUpProdList(),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.TotalReqQuantity=t.BranchWiseDistributionList1.map(i=>i.Request).reduce((i,n)=>i+n,0)+t.BranchWiseDistributionList2.map(i=>i.Request).reduce((i,n)=>i+n,0),t.TotalDispatch=t.BranchWiseDistributionList1.map(i=>i.Dispatch).reduce((i,n)=>i+n,0)+t.BranchWiseDistributionList2.map(i=>i.Dispatch).reduce((i,n)=>i+n,0),t.TotalReqQuantity<t.ALTQTY_IN&&(t.AltQty=t.TotalReqQuantity)}),this.addBranchWiseToTable1(),this.addBranchWiseToTable2(),this.pushAfterSubHeaders2(),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.OrderDifference=Math.abs(t.TotalReqQuantity-t.AltQty),this.totalReqByBranch1=t.BranchWiseDistributionList1.map(i=>i.Request).reduce((i,n)=>i+n,0),this.totalReqByBranch2=t.BranchWiseDistributionList2.map(i=>i.Request).reduce((i,n)=>i+n,0)})}setUpProdList(){null==this._trnMainService.TrnMainObj.ProdList[0].MCODE&&this._trnMainService.TrnMainObj.ProdList.splice(0,1),this._trnMainService.TrnMainObj.ProdList.forEach(t=>{let i=[],n=[];t.BranchWiseDistributionList.forEach(r=>{r.isChanged=!1,r.Priority>Math.ceil(t.BranchWiseDistributionList?.length/2)?i.push(r):n.push(r)}),t.BranchWiseDistributionList1=i,t.BranchWiseDistributionList2=n})}pushAfterSubHeaders1(){let t=[{field:"TotalReqQuantity",header:"Total REQ",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},focusTo:"ALTRATE",applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"OrderDifference",header:"Order Diff",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"TotalDispatch",header:"Total DP",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];for(let i=0;i<t.length;i++)this.genericProductEntryService.headerAfterSubHeader.push(t[i])}pushAfterSubHeaders2(){let t=[{field:"TotalReqQuantity",header:"Total REQ",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},focusTo:"ALTRATE",applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"OrderDifference",header:"Order Diff",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},color:!0,applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2},{field:"TotalDispatch",header:"Total DP",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},applyTwoDigitPipe:!1,showSubHeading:!1,subHeader:[{showSubHeading:!1}],rowspan:2}];for(let i=0;i<t.length;i++)this.genericProductEntryService.headerAfterSubHeader2.push(t[i])}addBranchWiseToTable1(){this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.BranchWiseDistributionList1?.length>0&&t.BranchWiseDistributionList1.forEach(i=>{if(0==this.genericProductEntrySetting.columns.filter(r=>r.field==i.Division).length){let r={field:`${i.Division}`,header:`${i.Division}`,hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"115px",textAlign:"center"},colspan:2,showSubHeading:!0,subHeader:[{field:"Request",showSubHeading:!0,header:"REQ",isActiveColumnHeader:!0,headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"30px"},disablePipe:(s,a)=>this.getColumnDisablePipe("disableAltQty",s,a),columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"}},{field:"Dispatch",showSubHeading:!0,header:"DP",isActiveColumnHeader:!0,inputType:"quantity",class:(s,a,l)=>this.style(l),headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"38px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},disablePipe:(s,a)=>this.getColumnDisablePipe("disableAltQty",s,a),onChange:(s,a,l,h)=>{this.onChangeDispatch(s,a,l,h)},onEnter:(s,a,l,h)=>{this.onChangeDispatch(h,l,a,s)}}]};this.genericProductEntrySetting.columns.push(r),this.genericProductEntryService.subHeader.push(r)}})})}addBranchWiseToTable2(){this._trnMainService.TrnMainObj.ProdList.forEach(t=>{t.BranchWiseDistributionList2?.length>0&&t.BranchWiseDistributionList2.forEach(i=>{if(0==this.genericProductEntrySetting2.columns.filter(r=>r.field==i.Division).length){let r={field:`${i.Division}`,header:`${i.Division}`,hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"115px",textAlign:"center"},colspan:2,showSubHeading:!0,subHeader:[{field:"Request",showSubHeading:!0,header:"REQ",isActiveColumnHeader:!0,headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"30px"},disablePipe:(s,a)=>this.getColumnDisablePipe("disableAltQty",s,a),columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"}},{field:"Dispatch",showSubHeading:!0,header:"DP",isActiveColumnHeader:!0,inputType:"quantity",class:(s,a,l)=>this.style(l),headerNgStyle:{borderTop:"1px solid #e6e6e6",borderRight:"1px solid #e6e6e6",width:"38px"},columnNgStyle:{width:"100%","text-align":"right","padding-right":"3px"},disablePipe:(s,a)=>this.getColumnDisablePipe("disableAltQty",s,a),onChange:(s,a,l,h)=>{this.onChangeDispatch(s,a,l,h)},onEnter:(s,a,l,h)=>{this.onChangeDispatch(h,l,a,s)}}]};this.genericProductEntrySetting2.columns.push(r),this.genericProductEntryService.subHeader2.push(r)}})})}onChangeDispatch(t,i,n,r){r.isChanged=!0,this.dispatchChangeValidation(n,r),r.Request!=this._trnMainService.TrnMainObj.ProdList[n].TotalReqQuantity&&this.orderDistributeFromDispatch(n,r),this._trnMainService.TrnMainObj.ProdList[n].TotalDispatch>this._trnMainService.TrnMainObj.ProdList[n].AltQty&&(this.alertService.info("Total dispatch cannot be greater than Order to dispatch!"),r.Dispatch=0,this.calculateTotalDispatch(n)),this._trnMainService.TrnMainObj.ProdList[n].OrderDifference=Math.abs(this._trnMainService.TrnMainObj.ProdList[n].TotalReqQuantity-this._trnMainService.TrnMainObj.ProdList[n].TotalDispatch)}calculateTotalDispatch(t){this._trnMainService.TrnMainObj.ProdList[t].TotalDispatch=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.map(i=>i.Dispatch).reduce((i,n)=>i+n,0)+this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.map(i=>i.Dispatch).reduce((i,n)=>i+n,0)}orderDistributeFromDispatch(t,i){if(i.Request>0&&(this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList.filter(S=>S.Request>0).length-(this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.filter(S=>S.isChanged).length+this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.filter(S=>S.isChanged).length)==0&&(i.isLast=!0,i.isChanged=!1),i.isLast&&this.alertService.info("Dispatch quantity of last branch cannot be changed!")),0==this._trnMainService.TrnMainObj.ProdList[t].AltQty)return i.Dispatch=0,void this.alertService.info("Please enter Order to Dispatch first!");let n=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.filter(h=>h.isChanged).map(h=>h.Dispatch).reduce((h,v)=>h+v,0)+this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.filter(h=>h.isChanged).map(h=>h.Dispatch).reduce((h,v)=>h+v,0),r=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.filter(h=>h.isChanged).map(h=>h.Request).reduce((h,v)=>h+v,0)+this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.filter(h=>h.isChanged).map(h=>h.Request).reduce((h,v)=>h+v,0),s=this._trnMainService.TrnMainObj.ProdList[t].AltQty-n,a=this._trnMainService.TrnMainObj.ProdList[t].TotalReqQuantity-r;this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.forEach(h=>{h.isChanged||(this._trnMainService.TrnMainObj.ProdList[t].AltQty>this._trnMainService.TrnMainObj.ProdList[t].TotalReqQuantity?h.Dispatch=h.Request:(h.Dispatch=Math.floor(s*h.Request/a),Number.isNaN(h.Dispatch)&&(h.Dispatch=0)))}),this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.forEach(h=>{h.isChanged||(this._trnMainService.TrnMainObj.ProdList[t].AltQty>this._trnMainService.TrnMainObj.ProdList[t].TotalReqQuantity?h.Dispatch=h.Request:(h.Dispatch=Math.floor(s*h.Request/a),Number.isNaN(h.Dispatch)&&(h.Dispatch=0)))});let l=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.map(h=>h.Dispatch).reduce((h,v)=>h+v,0)+this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.map(h=>h.Dispatch).reduce((h,v)=>h+v,0);if(l<this._trnMainService.TrnMainObj.ProdList[t].AltQty){let h=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList1.filter(_=>_.Request>_.Dispatch&&_.Division!=i.Division).map(_=>_.Priority).reduce((_,S)=>_>S?_:S,0),v=this._trnMainService.TrnMainObj.ProdList[t].BranchWiseDistributionList2.filter(_=>_.Request>_.Dispatch&&_.Division!=i.Division).map(_=>_.Priority).reduce((_,S)=>_>S?_:S,0);this.assignRemainingQtyToPriority(h,v,this._trnMainService.TrnMainObj.ProdList[t],l)}this._trnMainService.TrnMainObj.ProdList[t].OrderDifference=Math.abs(this._trnMainService.TrnMainObj.ProdList[t].TotalReqQuantity-this._trnMainService.TrnMainObj.ProdList[t].AltQty),this.calculateTotalDispatch(t)}setDivisionInBranchList(){let t;this._trnMainService.TrnMainObj.ProdList.forEach(i=>{i.BranchWiseDistributionList?.length>0&&(i.DivisionNames?.forEach(n=>{i.BranchWiseDistributionList.filter(r=>r.Division==n.divisionName)[0]||(t={Division:n.divisionName,Request:0,Dispatch:0,Priority:n.Priority},i.BranchWiseDistributionList.push(t))}),i.BranchWiseDistributionList.sort((n,r)=>n.Division.localeCompare(r.Division)))})}orderDistribute(t){t.AltQty>t.ALTQTY_IN&&(this.alertService.info("Entered quantity is more than actual quantity"),t.AltQty=t.ALTQTY_IN),t.BranchWiseDistributionList1.forEach(n=>{n.Dispatch=t.AltQty>t.TotalReqQuantity?n.Request:Math.floor(t.AltQty*n.Request/t.TotalReqQuantity)}),t.BranchWiseDistributionList2.forEach(n=>{n.Dispatch=t.AltQty>t.TotalReqQuantity?n.Request:Math.floor(t.AltQty*n.Request/t.TotalReqQuantity)});let i=t.BranchWiseDistributionList1.map(n=>n.Dispatch).reduce((n,r)=>n+r,0)+t.BranchWiseDistributionList2.map(n=>n.Dispatch).reduce((n,r)=>n+r,0);if(i<t.AltQty){let n=t.BranchWiseDistributionList1.filter(s=>s.Request>s.Dispatch).map(s=>s.Priority).reduce((s,a)=>s>a?s:a,0),r=t.BranchWiseDistributionList2.filter(s=>s.Request>s.Dispatch).map(s=>s.Priority).reduce((s,a)=>s>a?s:a,0);this.assignRemainingQtyToPriority(n,r,t,i)}t.OrderDifference=Math.abs(t.TotalReqQuantity-t.AltQty),t.TotalDispatch=t.BranchWiseDistributionList1.map(n=>n.Dispatch).reduce((n,r)=>n+r,0)+t.BranchWiseDistributionList2.map(n=>n.Dispatch).reduce((n,r)=>n+r,0)}assignRemainingQtyToPriority(t,i,n,r){t>i?n.BranchWiseDistributionList1.forEach(s=>{s.Priority==t&&(s.Dispatch=s.Dispatch+(n.AltQty-r))}):t<i&&n.BranchWiseDistributionList2.forEach(s=>{s.Priority==i&&(s.Dispatch=s.Dispatch+(n.AltQty-r))})}dispatchChangeValidation(t,i){if(this._trnMainService.TrnMainObj.ProdList[t].ALTQTY_IN<this._trnMainService.TrnMainObj.ProdList[t].TotalDispatch&&(this.alertService.info("Total dispatch quantity is more than available quantity!"),i.Dispatch=0),i.Dispatch>this._trnMainService.TrnMainObj.ProdList[t].ALTQTY_IN&&(this.alertService.info("Dispatch quantity is more than available quantity!"),i.Dispatch=0),i.Dispatch>this._trnMainService.TrnMainObj.ProdList[t].AltQty&&(this.alertService.info("Dispatch quantity cannot be more than total order to dispatch!"),i.Dispatch=0),this._trnMainService.TrnMainObj.ProdList[t].TotalDispatch>this._trnMainService.TrnMainObj.ProdList[t].AltQty&&(this.alertService.info("Total dispatch quantity cannot be more than total order to dispatch!"),i.Dispatch=0,this.calculateTotalDispatch(t),this._trnMainService.TrnMainObj.ProdList[t].TotalDispatch<this._trnMainService.TrnMainObj.ProdList[t].AltQty)){let n=this._trnMainService.TrnMainObj.ProdList[t].AltQty-this._trnMainService.TrnMainObj.ProdList[t].TotalDispatch;i.Dispatch=i.Request>n?n:i.Request}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w),e.Y36(F.h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-inventory-allocation"]],features:[e._Bn([M.p,A.C,T.X,b.w,P.s])],decls:21,vars:6,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[3,"onclickOnResetPopupEmit","onDoubleClickForAllocation","onSaveINVAllocation"],[1,"main-container"],[4,"ngIf"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","GenericProductEntrySetting2","ShowGenericGridEvent"],[1,"footer-wrapper"],[3,"onClickPIRef"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8,"INVENTORY ALLOCATION"),e.qZA()(),e.TgZ(9,"div",7)(10,"voucher-master-action",8),e.NdJ("onclickOnResetPopupEmit",function(){return i.onclickOnResetPopupEmit()})("onDoubleClickForAllocation",function(){return i.onClickPIRef()})("onSaveINVAllocation",function(){return i.onSaveINVAllocation()}),e.qZA()()()(),e.TgZ(11,"div",9),e.YNc(12,qn,2,0,"div",10),e.qZA()(),e.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"generic-product-entry",14),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(17,"div",15),e._UZ(18,"voucher-total-area"),e.qZA(),e.YNc(19,Yn,1,0,"app-allocation-popup",10),e.ALo(20,"async"),e.qZA()),2&t&&(e.xp6(12),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(4),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting)("GenericProductEntrySetting2",i.genericProductEntrySetting2),e.xp6(3),e.Q6J("ngIf",e.lcZ(20,4,i.showorHideAllocationPopup$).showOrHideAllocationPopup))},dependencies:[m.O5,L.q,x.i,w.u,N,U.Z,Gn,m.Ov]}),o})();function Kn(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Jn=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this.itemKeyEventService=l,this.entryValidateService=h,this.quantityChangeEventService=v,this.genericProductEntryService=_,this._trnMainService.initialFormLoad(95)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"S.No.",hidden:!1,isActiveColumnHeader:!1,isSno:!0,checkbox:!0,checkboxField:"checkInExcessAdj",onCheckBoxChange:(n,r,s,a)=>this.onCheckBoxChangeEvent(n,r,s,a),headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"},columnNgStyle:{"text-align":"right",marginRight:"5px"}},{field:"BARCODE",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY"},{field:"ALTERNATEQUANTIY",header:"Excess Quantity",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{marginRight:"5px","text-align":"right"},applyTwoDigitPipe:!1},{field:"MRP",header:"Rate",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{marginRight:"5px","text-align":"right"}},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.ExcessAdjustment}getColumnDisablePipe(t,i,n){return t}onCheckBoxChangeEvent(t,i,n,r){r.checkInExcessAdj=!!t.target.checked}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-excess-assessment"]],features:[e._Bn([M.p,T.X,A.C,b.w,P.s])],decls:21,vars:2,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"row","row-margin"],[3,"GenericProductEntrySetting"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8,"EXCESS ADJUSTMENT"),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,Kn,2,0,"div",9),e.TgZ(13,"div",10),e._UZ(14,"discounts-insert"),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",10),e._UZ(18,"generic-product-entry",13),e.qZA()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(12),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,L.q,x.i,w.u,N,B.o,U.Z],encapsulation:2}),o})();function Xn(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let pe=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this.itemKeyEventService=l,this.entryValidateService=h,this.quantityChangeEventService=v,this.genericProductEntryService=_,this._trnMainService.initialFormLoad(84)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService);var i=[{field:"SNO",header:"S.No.",hidden:!1,isActiveColumnHeader:!1,isSno:!0,checkbox:this.checkBox(),checkboxField:"checkInExcessAdj",onCheckBoxChange:(n,r,s,a)=>this.onCheckBoxChangeEvent(n,r,s,a),headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"BARCODE",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY"},{field:"ALTERNATEQUANTIY",header:"Shortage Quantity",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!1},{field:"MRP",header:"Rate",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableRemarks",n,r)}];this.genericProductEntrySetting.columns=i,this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.ShortageAdjustment}getColumnDisablePipe(t,i,n){return t}onCheckBoxChangeEvent(t,i,n,r){r.checkInExcessAdj=!!t.target.checked}checkBox(){return"shortage-adjustment"==this._trnMainService.activeurlpath}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-shortage-assessment"]],features:[e._Bn([M.p,T.X,A.C,b.w,P.s])],decls:21,vars:3,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"row","row-margin"],[3,"GenericProductEntrySetting"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,Xn,2,0,"div",9),e.TgZ(13,"div",10),e._UZ(14,"discounts-insert"),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",10),e._UZ(18,"generic-product-entry",13),e.qZA()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.Oqu(i._trnMainService.pageHeading),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,L.q,x.i,w.u,N,B.o,U.Z],encapsulation:2}),o})();function $n(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}let Te=(()=>{class o{constructor(t,i,n,r,s,a,l,h,v,_){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this.itemKeyEventService=l,this.entryValidateService=h,this.quantityChangeEventService=v,this.genericProductEntryService=_,this._trnMainService.initialFormLoad(85)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"S.No.",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"},focusTo:"ALTUNIT"},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"}},{field:"ALTERNATEQUANTIY",header:"Excess Quantity",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!1},{field:"MRP",header:"Rate",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.ShortageAdjustment}getColumnDisablePipe(t,i,n){return t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p),e.Y36(T.X),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-excess-goods"]],features:[e._Bn([M.p,T.X,A.C,b.w,P.s])],decls:21,vars:3,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"row","row-margin"],[3,"GenericProductEntrySetting"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,$n,2,0,"div",9),e.TgZ(13,"div",10),e._UZ(14,"discounts-insert"),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",10),e._UZ(18,"generic-product-entry",13),e.qZA()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.Oqu(i._trnMainService.pageHeading),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,L.q,x.i,w.u,N,B.o,U.Z]}),o})();function zn(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}const tr=["genericGridItemSelect"];function ir(o,c){1&o&&(e.TgZ(0,"div"),e._UZ(1,"inv-params"),e.qZA())}function rr(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"generic-product-entry",16),e.NdJ("ShowGenericGridEvent",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.showGenericGrid(n))})("showNonItemGenericGrid",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.showNonItemGenericGrid(n))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("GenericProductEntrySetting",t.genericProductEntrySetting)}}const _e=O.Bz.forChild([{path:"",component:li,children:[{path:"add-stock-issue",component:ie},{path:"stock-issue-return",component:Mn},{path:"openingstockentry",component:Ti,canActivate:[y.C]},{path:"StockSettlementEntry",component:gi,canActivate:[y.C]},{path:"add-branch-in",component:Ci,canActivate:[y.C]},{path:"excess-adjustment",component:Jn,canActivate:[y.C]},{path:"excess-goods-acknowledgement",component:Te,canActivate:[y.C]},{path:"excess-goods-return",component:Te,canActivate:[y.C]},{path:"excess-acknowledgement",component:(()=>{class o{constructor(t,i,n,r,s,a){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this._trnMainService.initialFormLoad(96)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"S.No.",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"BARCODE",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"}},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY"},{field:"ALTERNATEQUANTIY",header:"Returned Quantity",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!1},{field:"MRP",header:"Rate",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.ExcessAcknowledgement}getColumnDisablePipe(t,i,n){return t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-excess-acknowledgement"]],features:[e._Bn([M.p])],decls:21,vars:3,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"row","row-margin"],[3,"GenericProductEntrySetting"],[1,"footer-wrapper"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,zn,2,0,"div",9),e.TgZ(13,"div",10),e._UZ(14,"discounts-insert"),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",10),e._UZ(18,"generic-product-entry",13),e.qZA()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.Oqu(i._trnMainService.pageHeading),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting))},dependencies:[m.O5,L.q,x.i,w.u,N,B.o,U.Z],encapsulation:2}),o})(),canActivate:[y.C]},{path:"shortage-adjustment",component:pe,canActivate:[y.C]},{path:"branch-shortage-adjustment",component:pe,canActivate:[y.C]},{path:"add-branch-out",component:re,canActivate:[y.C]},{path:"repack-entry",component:Li,canActivate:[y.C]},{path:"requisition-log",component:Bn,canActivate:[y.C]},{path:"inventory-allocation",component:Wn,canActivate:[y.C]},{path:"requisition-entry",component:Di,canActivate:[y.C]},{path:"transfer-out-approval",component:re,canActivate:[y.C]},{path:"stock-issue-approval",component:ie},{path:"production-entry",component:un,canActivate:[y.C]},{path:"consumption-entry",component:Tn,canActivate:[y.C]},{path:"stock-adjustment",component:Sn},{path:"batch-adjustment",component:mn},{path:"variant-adjustment",component:Cn},{path:"requisition-approval",component:En,canActivate:[y.C]},{path:"close-requisition-approval",component:(()=>{class o{constructor(t,i,n,r,s,a,l,h){this.route=t,this.authservice=i,this.masterService=n,this.alertService=r,this.loadingSerive=s,this._trnMainService=a,this.itemKeyEventService=l,this.genericProductService=h,this.genericGridItemSelectSetting=new E.im,this._trnMainService.initialFormLoad(87)}ngOnInit(){this.setProductEntryTable()}setProductEntryTable(){var t=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"S.No.",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"BARCODE",header:"Barcode",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"30px"}},{field:"ITEMDESC",header:"Particular",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"380px"},disablePipe:(n,r)=>this.getColumnDisablePipe("disableItemDesc",n,r)},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"80px"},focusTo:"ALTERNATEQUANTIY"},{field:"ALTERNATEQUANTIY",header:"Quantity",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!1,inputType:"quantity",onChange:(n,r,s,a)=>this.quantityChange(n,r,s,a),focusTo:"REMARKS"},{field:"REMARKS",header:"Remarks",hidden:!1,isActiveColumnHeader:!0,inputType:"inputText",headerNgStyle:{borderRight:"1px solid #e6e6e6",width:"70px"},columnNgStyle:{width:"100%","text-align":"right"},onEnter:(n,r,s,a)=>{this.RemarksEnterCommand(r)}}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=t,this.genericProductEntrySetting.voucherType=d.Km.ApprovalClose}quantityChange(t,i,n,r){if(r.ALTERNATEQUANTIY>r.ALTQTY_IN)return this.alertService.info("Enter quantity is greater than available quantity!"),void(r.ALTERNATEQUANTIY=r.ALTQTY_IN)}showGenericGrid(t){this._trnMainService.TrnMainObj.BILLTO?(this.genericGridItemSelectSetting={title:"Approved Requisition List",apiEndpoints:`/getRequisitionApprovalForCloseBranchWise/${this._trnMainService.TrnMainObj.BILLTO}`,defaultFilterIndex:0,columns:[{key:"MENUCODE",title:"Code",hidden:!1,noSearch:!1},{key:"ITEMDESC",title:"Particular",hidden:!1,noSearch:!1},{key:"APP_ALTQTY",title:"Quantity",hidden:!1,noSearch:!0}]},this.genericGridItemSelect.show()):this.alertService.info("Please select Division first!")}getColumnDisablePipe(t,i,n){return t}dblClickLoadOnItemSelect(t){this._trnMainService.TrnMainObj.ProdList.filter(i=>i.MENUCODE==t.MENUCODE).length>0?this.alertService.info(`${t.ITEMDESC} is already selected!`):(this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex]={},this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ITEMDESC=t.ITEMDESC,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTUNIT=t.ALTUNIT,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].UNIT=t.UNIT,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].BASEUNIT=t.BASEUNIT,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].DIVISION=t.DIVISION,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].MCODE=t.MCODE,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].MENUCODE=t.MENUCODE,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTCONFACTOR=t.ALTCONFACTOR,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].REALQTY_IN=t.APP_QTY,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTQTY_IN=t.APP_ALTQTY,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].ALTERNATEQUANTIY=t.APP_ALTQTY,this._trnMainService.TrnMainObj.ProdList[this.genericProductService.activerowIndex].Quantity=t.APP_QTY,document.getElementById("ALTERNATEQUANTIY"+this.genericProductService.activerowIndex)&&setTimeout(()=>{document.getElementById("ALTERNATEQUANTIY"+this.genericProductService.activerowIndex).focus()},0),this._trnMainService.ReCalculateBillWithNormal())}RemarksEnterCommand(t){if(!this._trnMainService.TrnMainObj.ProdList[t].ITEMDESC)return void this.alertService.info("Please enter item first!");if(!this._trnMainService.TrnMainObj.ProdList.some(n=>null==n.MCODE)&&!1===this._trnMainService.addRow())return;let i=t+1;setTimeout(()=>{document.getElementById("ITEMDESC"+i)&&(document.getElementById("ITEMDESC"+i).focus(),this.genericProductService.activerowIndex=i)},50)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O.gz),e.Y36(k.e),e.Y36(f.P),e.Y36(I.c),e.Y36(j.V),e.Y36(M.p),e.Y36(T.X),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-close-approval"]],viewQuery:function(t,i){if(1&t&&e.Gf(tr,5),2&t){let n;e.iGM(n=e.CRH())&&(i.genericGridItemSelect=n.first)}},features:[e._Bn([M.p,T.X])],decls:23,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top"],[1,"row","clearfix"],[1,"col-md-1"],[1,"col-md-4","pd0"],[2,"white-space","nowrap","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[4,"ngIf"],[1,"col-md-12","pd5"],[1,"midTableWrapper"],[1,"row","row-margin"],[3,"GenericProductEntrySetting","ShowGenericGridEvent"],[1,"footer-wrapper"],[3,"popupsettings","onItemDoubleClick"],["genericGridItemSelect",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8),e.YNc(12,ir,2,0,"div",9),e.TgZ(13,"div",10),e._UZ(14,"discounts-insert"),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",10)(18,"generic-product-entry",13),e.NdJ("ShowGenericGridEvent",function(r){return i.showGenericGrid(r)}),e.qZA()()()(),e.TgZ(19,"div",14),e._UZ(20,"voucher-total-area"),e.qZA()(),e.TgZ(21,"generic-popup-grid",15,16),e.NdJ("onItemDoubleClick",function(r){return i.dblClickLoadOnItemSelect(r)}),e.qZA()),2&t&&(e.xp6(8),e.Oqu(i._trnMainService.pageHeading),e.xp6(4),e.Q6J("ngIf",i.masterService.ShowMore),e.xp6(6),e.Q6J("GenericProductEntrySetting",i.genericProductEntrySetting),e.xp6(3),e.Q6J("popupsettings",i.genericGridItemSelectSetting))},dependencies:[m.O5,L.q,x.i,w.u,N,E.Zl,B.o,U.Z],encapsulation:2}),o})(),canActivate:[y.C]},{path:"newproduction-entry",component:Zn,canActivate:[y.C]},{path:"assets-openingstockentry",component:(()=>{class o{constructor(t,i,n,r,s,a,l,h){this.masterService=t,this.alertService=i,this._trnMainService=n,this.itemKeyEventService=r,this.productHelperService=s,this.entryValidateService=a,this.quantityChangeEventService=l,this.genericProductEntryService=h,this._trnMainService.initialFormLoad(24),this._trnMainService.pageHeading="OPENING STOCK ENTRY - ASSET ITEM"}ngOnInit(){this.masterService.GetAssetLocation().subscribe(t=>{"ok"==t.status&&(this._trnMainService.TrnMainObj.LOCATIONLIST=t.result)}),this.setProductEntryTable("fixedAssets")}setProductEntryTable(t){var i=this._trnMainService.TrnMainObj.ProdList;this.genericProductEntrySetting=new D.Vn(this._trnMainService),this.genericProductEntrySetting.columns=[{field:"SNO",header:"Sno",hidden:!1,isActiveColumnHeader:!1,isSno:!0,headerNgStyle:{width:"40px"}},{field:"MENUCODE",header:"Code",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"80px"}},{field:"ITEMDESC",header:"Product Name",hidden:!1,isActiveColumnHeader:!0,inputType:"itemDesc",headerNgStyle:{width:"250px"},disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s),focusTo:"ALTUNIT"},{field:"ACNAME",header:"Account",hidden:"others"===t,isActiveColumnHeader:!0,placeholder:"Press ENTER to Select",inputType:"popup",headerNgStyle:{width:"175px"},disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s)},{field:"SL_ACNAME",header:"Sub-Ledger",hidden:"others"===t,isActiveColumnHeader:!0,inputType:"popup",placeholder:"Press ENTER to Select",headerNgStyle:{width:"175px"},disablePipe:(r,s)=>this.getColumnDisablePipe("disableSubLedger",r,s),focusTo:"ALTUNIT"},{field:"ALTUNIT",header:"Unit",hidden:!1,isActiveColumnHeader:!0,headerNgStyle:{width:"70px"},focusTo:"ALTQTY_IN"},{field:"ALTQTY_IN",header:"QTY",hidden:!1,isActiveColumnHeader:!0,inputType:"quantity",headerNgStyle:{width:"60px"},columnNgStyle:{width:"100%","text-align":"right"},focusTo:"ALTRATE",onChange:(r,s,a)=>this.QuantityChangeEvent_default(r,s,a),onEnter:(r,s,a,l)=>this.quantityChangeEventService.AlternateQuantityEventClick(s),onKeyPress:(r,s,a,l)=>this.quantityChangeEventService.quantityKeyPress(r,s,a,l),applyTwoDigitPipe:!1,disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s)},{field:"ALTRATE",header:"Cost Value",inputType:"number",hidden:"others"===t,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},columnNgStyle:{width:"100%","text-align":"right"},onEnter:(r,s,a)=>this.entryValidateService.mrpEnterAssetPI(r,s,a),onChange:(r,s,a,l)=>this.entryValidateService.mrpEnterAssetPI(l,a,s),applyTwoDigitPipe:!0,focusTo:"BOOKVALUE",disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s)},{field:"BOOKVALUE",header:"Book Value",inputType:"number",hidden:"others"===t,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,onEnter:(r,s,a)=>this.onChangeBookValue(r,s,a),onChange:(r,s,a,l)=>this.onChangeBookValue(l,a,s),focusTo:"PurchaseDate",disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s)},{field:"TOTALBOOKVALUE",header:"Total Book Value",hidden:"others"===t,isActiveColumnHeader:!0,headerNgStyle:{width:"100px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0},{field:"PurchaseDate",header:"Purchased Date",hidden:!1,isActiveColumnHeader:!0,inputType:"date",headerNgStyle:{width:"120px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s),focusTo:"OriginalCost"},{field:"LocID",header:"Location",hidden:!1,isActiveColumnHeader:!0,inputType:"locationOption",headerNgStyle:{width:"100px"},columnNgStyle:{width:"100%","text-align":"right"},applyTwoDigitPipe:!0,disablePipe:(r,s)=>this.getColumnDisablePipe("disableAssetItemDesc",r,s),onEnter:(r,s,a)=>{this.genericProductEntryService.useFulLifeEnter(r,s,a)}},{field:"",header:"",hidden:!1,isActiveColumnHeader:!0,removeButton:!0,headerNgStyle:{width:"30px"},columnNgStyle:{width:"100%","text-align":"right"},disablePipe:(r,s)=>this.getColumnDisablePipe("disableRowDelete",r,s)}],this.genericProductEntrySetting.height="100%",this.genericProductEntrySetting.prodlist=i,this.genericProductEntrySetting.voucherType=d.Km.OpeningStockBalance,this.genericProductEntrySetting.setRowItemFromSelectedItem=r=>this.SetRowItemFromSelectedItem(r),this.genericProductEntrySetting.setAllUnitsOfItem=()=>this.SetAllUnitsOfItem(),this.genericProductEntrySetting.setRowItemRate=(r,s=new Function)=>this.SetRowItemRate(r,s)}onChangeBookValue(t,i,n){t.ALTRATE<t.BOOKVALUE?(this.alertService.warning("Book value cannot be greater than cost value!"),t.BOOKVALUE=t.ALTRATE):t.BOOKVALUE<0?(this.alertService.warning("Book value cannot be less than zero!"),t.BOOKVALUE=0):(0===t.BOOKVALUE||!t.BOOKVALUE)&&this.alertService.warning("Book value cannot be zero!"),this._trnMainService.ReCalculateBillForAsset(this._trnMainService.TrnMainObj)}typeChangeEvent(t){this.setProductEntryTable(t)}SetRowItemRate(t,i){i()}SetAllUnitsOfItem(){this._trnMainService.getAllUnitsOfItem(this.genericProductEntryService.activerowIndex)}QuantityChangeEvent_default(t,i,n){this.quantityChangeEventService.QuantityChangeEvent(n)}getColumnDisablePipe(t,i,n){return t}mrpEnterEvent(t,i,n){this.entryValidateService.mrpEnterEvent(t,i,n,()=>"default",()=>({useDefault:!0,preCheck:!0}),()=>!1)}showGenericGrid(t){this.itemKeyEventService.ItemKeyEventForAsset(t.index,()=>{this.itemPopupSetting()})}SetRowItemFromSelectedItem(t){let i=this._trnMainService.TrnMainObj.ProdList[this.genericProductEntryService.activerowIndex];this._trnMainService.prepareItem(i,t),this._trnMainService.assignPrateaAsRATE(i,t)}showNonItemGenericGrid(t){console.log("k event aaucha",t),this.genericProductEntryService.NonProductPopupSelectEvent(()=>this.popUpSetting(t))}popUpSetting(t){this.genericProductEntryService.gridPopupSettings="Account"===t.col.header?{title:"Accounts",apiEndpoints:"/getNonTradingAccountpagedlist/fixed-assets",defaultFilterIndex:1,columns:[{key:"ACID",title:"AC CODE",hidden:!1,noSearch:!1},{key:"ACNAME",title:"A/C NAME",hidden:!1,noSearch:!1}]}:{title:"Sub Ledger Accounts",apiEndpoints:"/getTDSAccountPagedListWithSubLedger",defaultFilterIndex:1,columns:[{key:"SL_ACID",title:"AC CODE",hidden:!1,noSearch:!1},{key:"SL_ACNAME",title:"A/C NAME",hidden:!1,noSearch:!1}]}}itemPopupSetting(){this.genericProductEntryService.gridPopupSettings={title:"Product List",apiEndpoints:"/getAssetsMenuitemPagedList",defaultFilterIndex:1,columns:[{key:"MENUCODE",title:"ITEM CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"DESCRIPTION",hidden:!1,noSearch:!1}]}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.P),e.Y36(I.c),e.Y36(M.p),e.Y36(T.X),e.Y36(F.h),e.Y36(A.C),e.Y36(P.s),e.Y36(b.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["assets-openingstockentry"]],features:[e._Bn([M.p,T.X,F.h,A.C,b.w,P.s])],decls:20,vars:4,consts:[[1,"sectionWrapper"],[1,"topWrapper"],[1,"sticky-top",2,"padding-bottom","1px"],[1,"row","clearfix"],[1,"col-md-2"],[1,"col-md-3"],[2,"white-space","nowrap","margin-left","-144px","margin-bottom","8px","margin-top","-3px","font-family","Segoe UI Light","font-weight","bold","font-size","20px","padding-left","4%","width","192px"],[1,"col-md-7"],[1,"main-container"],[3,"hidden"],[3,"typeChangeEvent"],[1,"midTableWrapper"],[1,"row","row-margin"],[1,"col-md-12","pd5"],[3,"GenericProductEntrySetting","ShowGenericGridEvent","showNonItemGenericGrid",4,"ngIf"],[1,"footer-wrapper"],[3,"GenericProductEntrySetting","ShowGenericGridEvent","showNonItemGenericGrid"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"voucher-master-toggler"),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7),e._UZ(10,"voucher-master-action"),e.qZA()()(),e.TgZ(11,"div",8)(12,"div",9)(13,"inv-params",10),e.NdJ("typeChangeEvent",function(r){return i.typeChangeEvent(r)}),e.qZA()()()(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13),e.YNc(17,rr,1,1,"generic-product-entry",14),e.qZA()()(),e.TgZ(18,"div",15),e._UZ(19,"voucher-total-area"),e.qZA()()),2&t&&(e.xp6(8),e.AsE("",i._trnMainService.pageHeading," [",i._trnMainService.TrnMainObj.Mode,"]"),e.xp6(4),e.Q6J("hidden",!i.masterService.ShowMore),e.xp6(5),e.Q6J("ngIf","pro"==i._trnMainService.AppMode))},dependencies:[m.O5,L.q,x.i,w.u,N,U.Z],encapsulation:2}),o})()}]}]);var ar=p(7782),cr=p(40052),lr=p(33612),dr=p(32404),ve=p(56209),hr=p(92015),ur=p(64548);let pr=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[y.C,M.p,ue.R,he.T,ar.y,cr.w,F.h,y.C,lr.i,dr.i],imports:[ur.x,m.ez,u.u5,u.UX,_e,z.h,ve.u,m.ez,u.u5,u.UX,_e,z.h,ve.u,hr.y.forRoot()]}),o})()}}]);