"use strict";(self.webpackChunkimserp=self.webpackChunkimserp||[]).push([[9875],{8630:(T,P,c)=>{c.d(P,{n:()=>E});var r=c(64537),b=c(67297),g=c(53074);let E=(()=>{class d{constructor(f,e,A,v){this.authService=f,this.el=e,this.renderer=A,this.masterService=v,this.disallowSalesRateChangeValue=!1}ngOnInit(){this.userSetting=this.authService.getSetting();let f=this.masterService.userProfile.userRights.find(e=>"AllowRateChangeInSO"==e.right);f&&0==f?.value&&(this.disallowSalesRateChangeValue=!0,this.renderer.setAttribute(this.el.nativeElement,"disabled","true"))}disallowSalesRateChange(){return this.disallowSalesRateChangeValue}}return d.\u0275fac=function(f){return new(f||d)(r.Y36(b.e),r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(g.P))},d.\u0275dir=r.lG2({type:d,selectors:[["","appSalesRateDisableFromUserProfile",""]],exportAs:["appSalesRateDisableFromUserProfile"]}),d})()},92849:(T,P,c)=>{c.d(P,{S:()=>g});var r=c(88692),b=c(64537);let g=(()=>{class E{}return E.\u0275fac=function(I){return new(I||E)},E.\u0275mod=b.oAB({type:E}),E.\u0275inj=b.cJS({imports:[r.ez]}),E})()},89952:(T,P,c)=>{c.d(P,{g:()=>b});var r=c(64537);let b=(()=>{class g{transform(d){return d||(d=0),Number(d).toFixed(2)}}return g.\u0275fac=function(d){return new(d||g)},g.\u0275pipe=r.Yjl({name:"twoDigitNumber",type:g,pure:!0}),g})()},65171:(T,P,c)=>{c.d(P,{j:()=>N});var r=c(64537),b=c(53074),g=c(87584),E=c(88692),d=c(20092),I=c(28096);function f(p,C){1&p&&(r.TgZ(0,"th"),r._uU(1,"BATCHID"),r.qZA())}function e(p,C){1&p&&(r.TgZ(0,"th"),r._uU(1,"Barcode"),r.qZA())}function A(p,C){1&p&&(r.TgZ(0,"th",11),r._uU(1,"S-Price(Exc VAT)"),r.qZA())}function v(p,C){1&p&&(r.TgZ(0,"th",11),r._uU(1,"S-Price(Inc VAT)"),r.qZA())}function w(p,C){if(1&p&&(r.TgZ(0,"td",17),r._uU(1),r.qZA()),2&p){const a=r.oxw().$implicit;r.xp6(1),r.Oqu(a.BATCHID)}}function U(p,C){if(1&p&&(r.TgZ(0,"td",17),r._uU(1),r.qZA()),2&p){const a=r.oxw().$implicit;r.xp6(1),r.Oqu(a.BC)}}function y(p,C){if(1&p&&(r.TgZ(0,"td",18),r._uU(1),r.ALo(2,"number"),r.qZA()),2&p){const a=r.oxw().$implicit;r.xp6(1),r.Oqu(r.xi3(2,1,a.SELLRATEBEFORETAX,"1.2-2"))}}function Z(p,C){if(1&p&&(r.TgZ(0,"td",18),r._uU(1),r.ALo(2,"number"),r.qZA()),2&p){const a=r.oxw().$implicit;r.xp6(1),r.Oqu(r.xi3(2,1,a.MRP,"1.2-2"))}}function M(p,C){if(1&p){const a=r.EpF();r.TgZ(0,"tr",14),r.NdJ("click",function(){const x=r.CHM(a).index,B=r.oxw();return r.KtG(B.RowClickEvent(x))})("dblclick",function(){const x=r.CHM(a).$implicit,B=r.oxw();return r.KtG(B.dblClickBatchObj(x))}),r.TgZ(1,"td",15),r._uU(2),r.qZA(),r.YNc(3,w,2,1,"td",16),r.TgZ(4,"td",17),r._uU(5),r.qZA(),r.YNc(6,U,2,1,"td",16),r.TgZ(7,"td",17),r._uU(8),r.qZA(),r.TgZ(9,"td",18),r._uU(10),r.ALo(11,"number"),r.qZA(),r.YNc(12,y,3,4,"td",19),r.YNc(13,Z,3,4,"td",19),r.qZA()}if(2&p){const a=C.$implicit,_=C.index,m=r.oxw();r.ekj("selected-row",_===m.selectedRowIndex),r.xp6(2),r.Oqu(_+1),r.xp6(1),r.Q6J("ngIf",1==m._trnMainService.userSetting.EnableBatchIdInAdjustment),r.xp6(2),r.Oqu(a.BATCHCODE),r.xp6(1),r.Q6J("ngIf",1==m.HASVARIANT),r.xp6(2),r.Oqu(a.STOCK),r.xp6(2),r.Oqu(r.xi3(11,10,a.LANDINGCOST,"1.2-2")),r.xp6(2),r.Q6J("ngIf",89!=m._trnMainService.TrnMainObj.VoucherType),r.xp6(1),r.Q6J("ngIf",89!=m._trnMainService.TrnMainObj.VoucherType)}}let N=(()=>{class p{constructor(a,_){this.masterRepo=a,this._trnMainService=_,this.Blist=[],this.BatchClosedEmit=new r.vpe,this.dbClickEvent=new r.vpe,this.showPopup=!1}ngOnInit(){console.log("batch popup shown",this.Blist)}RowClickEvent(a){this.selectedRowIndex=a}dblClickBatchObj(a){this.dbClickEvent.emit(a)}itemBatchClosed(){this.BatchClosedEmit.emit()}updown(a){null==this.selectedRowIndex&&(this.selectedRowIndex=0),"ArrowDown"===a.code?(this.selectedRowIndex=this.selectedRowIndex+1,this.selectedRowIndex>this.Blist.length-1&&(this.selectedRowIndex=this.Blist.length-1)):"ArrowUp"===a.code&&(this.selectedRowIndex=this.selectedRowIndex-1,this.selectedRowIndex<0&&(this.selectedRowIndex=0)),"Enter"===a.code||"NumpadEnter"==a.code?null!=this.selectedRowIndex&&null!=this.Blist[this.selectedRowIndex]&&this.dblClickBatchObj(this.Blist[this.selectedRowIndex]):"Escape"===a.code&&this.itemBatchClosed()}}return p.\u0275fac=function(a){return new(a||p)(r.Y36(b.P),r.Y36(g.p))},p.\u0275cmp=r.Xpm({type:p,selectors:[["itemwisebatch"]],hostBindings:function(a,_){1&a&&r.NdJ("keydown",function(x){return _.updown(x)},!1,r.evT)},inputs:{Blist:"Blist",HASVARIANT:"HASVARIANT"},outputs:{BatchClosedEmit:"BatchClosedEmit",dbClickEvent:"dbClickEvent"},decls:27,vars:9,consts:[[1,"modal-sticky",2,"width","50vw"],[1,"modal-content",2,"padding","2px !important","box-shadow","-10px 0px 10px 1px #aaaaaa","width","101%","margin-left","1pc","margin-top","5pc","min-height","350px","max-height","350px","overflow","scroll","overflow-x","hidden"],[1,"modal-header",2,"padding","0px","background","#7ed0ff"],[1,"modal-title"],["aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[2,"float","right"],["type","search","autocomplete","off","placeholder","Search..","name","filter","id","filter",2,"height","1.5rem","font-size","13px","width","755px",3,"ngModel","ngModelChange"],[1,"Table1",2,"padding","0px","margin-top","2px","width","100%","overflow","scroll"],[2,"background","#7ed0ff"],[4,"ngIf"],[2,"text-align","right"],["style","text-align: right;",4,"ngIf"],["aria-disabled","true","class","highlight",3,"selected-row","click","dblclick",4,"ngFor","ngForOf"],["aria-disabled","true",1,"highlight",3,"click","dblclick"],[2,"border-bottom","1px solid #ddd","height","23px","width","3%"],["style","border-bottom: 1px solid #ddd;height: 23px;width:20%",4,"ngIf"],[2,"border-bottom","1px solid #ddd","height","23px","width","20%"],[2,"border-bottom","1px solid #ddd","height","23px","width","15%","text-align","right"],["style","border-bottom: 1px solid #ddd;height: 23px;width:15%;text-align: right;",4,"ngIf"]],template:function(a,_){1&a&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),r._uU(4,"Item Wise Batch List"),r.qZA(),r.TgZ(5,"button",4),r.NdJ("click",function(){return _.itemBatchClosed()}),r.TgZ(6,"span",5),r._uU(7,"\xd7"),r.qZA()()(),r.TgZ(8,"div",6)(9,"input",7),r.NdJ("ngModelChange",function(x){return _.filter=x}),r.qZA()(),r.TgZ(10,"table",8)(11,"tr",9)(12,"th"),r._uU(13,"Sn."),r.qZA(),r.YNc(14,f,2,0,"th",10),r.TgZ(15,"th"),r._uU(16,"BATCH"),r.qZA(),r.YNc(17,e,2,0,"th",10),r.TgZ(18,"th"),r._uU(19,"STOCK"),r.qZA(),r.TgZ(20,"th",11),r._uU(21,"P-Rate"),r.qZA(),r.YNc(22,A,2,0,"th",12),r.YNc(23,v,2,0,"th",12),r.qZA(),r.TgZ(24,"tbody"),r.YNc(25,M,14,13,"tr",13),r.ALo(26,"searchData"),r.qZA()()()()),2&a&&(r.xp6(9),r.Q6J("ngModel",_.filter),r.xp6(5),r.Q6J("ngIf",1==_._trnMainService.userSetting.EnableBatchIdInAdjustment),r.xp6(3),r.Q6J("ngIf",1==_.HASVARIANT),r.xp6(5),r.Q6J("ngIf",89!=_._trnMainService.TrnMainObj.VoucherType),r.xp6(1),r.Q6J("ngIf",89!=_._trnMainService.TrnMainObj.VoucherType),r.xp6(2),r.Q6J("ngForOf",r.xi3(26,6,_.Blist,_.filter)))},dependencies:[E.sg,E.O5,d.Fj,d.JJ,d.On,E.JJ,I.C],styles:[".selected-row[_ngcontent-%COMP%] {\n     background-color: #ced6d3 !important;\n   }\n   .modal-sticky[_ngcontent-%COMP%]{\n     right: 55px;\n   }\n \n   .unitLabel[_ngcontent-%COMP%]{\n     width: auto;\n     font-size: 14px;\n     margin-left: 5px;\n   }"]}),p})()},28096:(T,P,c)=>{c.d(P,{C:()=>b});var r=c(64537);let b=(()=>{class g{transform(d,I,f){if(d)return I?d.filter(e=>{if("BATCH"==f){const A=I.replace(/[^A-Z0-9]/gi,"").toLowerCase();if(-1!==(e.BATCH?e.BATCH.replace(/[^A-Z0-9]/gi,"").toLowerCase():"").indexOf(A))return e}else{const A=I.replace(/[^A-Z0-9]/gi,"").toLowerCase();if(-1!==(e.BATCHCODE?e.BATCHCODE.replace(/[^A-Z0-9]/gi,"").toLowerCase():"").indexOf(A))return e}}):d}}return g.\u0275fac=function(d){return new(d||g)},g.\u0275pipe=r.Yjl({name:"searchData",type:g,pure:!1}),g})()},99875:(T,P,c)=>{c.r(P),c.d(P,{BulkPriceChangeModule:()=>ae});var r=c(88692),b=c(54536),g=c(82738),E=c(46543),d=c(72533),I=c(12640),f=c(7976),e=c(64537),A=c(28698),v=c(65171),w=c(40216),U=c(67311),y=c(14970),Z=c(53074),M=c(87584),N=c(35732),p=c(92340),C=c(79765),a=c(67297),_=c(71180);let m=(()=>{class l{constructor(t,i,n){this.http=t,this.authService=i,this.state=n}get apiUrl(){let t=p.N.apiUrl,i="";return!!t&&t.length>0&&(i=t),i}getRequestOption(){return new N.WM({"Content-type":"application/json",Authorization:this.authService.getAuth().token,"X-Requested-With":"XMLHttpRequest"})}getProductInfo(t){let i={status:"error",result:""},n=new C.xQ;return this.http.get(this.apiUrl+"/getProductInfo?GROUPID="+t).subscribe(o=>{n.next(o),n.unsubscribe()},o=>{i.status="error2",i.result=o,n.next(i),n.unsubscribe()}),n}getSubGroupList(t){let i={status:"error",result:""},n=new C.xQ;return this.http.get(this.apiUrl+"/getSubGroupList?SELECTEDGROUPID="+t).subscribe(o=>{n.next(o),n.unsubscribe()},o=>{i.status="error2",i.result=o,n.next(i),n.unsubscribe()}),n}getMainGroupList(){let t={status:"error",result:""},i=new C.xQ;return this.http.get(this.apiUrl+"/getMainGroupList").subscribe(n=>{i.next(n),i.unsubscribe()},n=>{t.status="error",t.result=n,i.next(t),i.unsubscribe()}),i}saveBulkPriceChange(t,i){let n={status:"error",result:""},o=new C.xQ;this.getRequestOption(),new Headers({"Content-Type":"application/json"});const k={headers:this.getRequestOption(),method:"post"};let O={mode:t,data:i};return console.log("bodyData",O),this.http.post(this.apiUrl+"/bulkPriceChangeSave",O,k).subscribe(R=>{let S=R;"ok"==S.status?(n.status="ok",n.result=S.result,o.next(n),o.unsubscribe()):(n.status="error1",n.result=S.result,o.next(n),o.unsubscribe())},R=>{n.status="error2",n.result=R,o.next(n),o.unsubscribe()}),o}getMCatList(){return this.http.get(this.apiUrl+"/getMCatList")}getItemWiseBatch(t,i){return this.http.get(this.apiUrl+"/getAllStockItemWise/"+t+"?division="+i)}getCategoryWiseItemList(t){return this.http.get(this.apiUrl+"/getCategoryWiseItemList/"+t)}getGroupWiseItemList(t,i){return this.http.get(this.apiUrl+"/getGroupWiseItemList/"+i+"/"+t)}}return l.\u0275fac=function(t){return new(t||l)(e.LFG(N.eN),e.LFG(a.e),e.LFG(_.q))},l.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac}),l})();var x=c(8630),B=c(20092),W=c(89952);let G=(()=>{class l{transform(t,i){if(t)return i?t.filter(n=>{const o=i.replace(/[^A-Z0-9]/gi,"").toLowerCase(),s=n.MENUCODE?n.MENUCODE.replace(/[^A-Z0-9]/gi,"").toLowerCase():"",u=n.DESCA?n.DESCA.replace(/[^A-Z0-9]/gi,"").toLowerCase():"";if(-1!==s.indexOf(o)||-1!==u.indexOf(o))return n}):t}}return l.\u0275fac=function(t){return new(t||l)},l.\u0275pipe=e.Yjl({name:"searchDatas",type:l,pure:!1}),l})();const L=["genericGrid"],j=["fileUploadPopup"],J=["PaymentPopup"];function H(l,h){if(1&l&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("value",t.MENUCAT),e.xp6(1),e.Oqu(t.MENUCAT)}}function q(l,h){if(1&l&&(e.TgZ(0,"option",41),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("ngValue",t.INITIAL),e.xp6(1),e.Oqu(t.NAME)}}function F(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"div",46)(1,"label",47),e._uU(2,"Effective Date:"),e.qZA(),e.TgZ(3,"input",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw(2);return e.KtG(o.EffectiveDate=n)})("change",function(n){e.CHM(t);const o=e.oxw(2);return e.KtG(o.effectiveDateChange(n.target.value))}),e.qZA()()}if(2&l){const t=e.oxw(2);e.xp6(3),e.s9C("min",t.currDate),e.Q6J("ngModel",t.EffectiveDate)}}function V(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"div",42)(1,"div",43)(2,"input",44),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.saveObj.IsLatePriceUpdate=n)})("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.saveObj.IsLatePriceUpdate=n.target.checked?1:0)}),e.qZA(),e._uU(3,"Late Sales Price Update \xa0 "),e.qZA(),e.YNc(4,F,4,2,"div",45),e.qZA()}if(2&l){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.saveObj.IsLatePriceUpdate),e.xp6(2),e.Q6J("ngIf",t.saveObj.IsLatePriceUpdate)}}function K(l,h){1&l&&(e.TgZ(0,"th",31),e._uU(1," BATCH"),e.qZA())}function X(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"td",51)(1,"input",62),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.BATCH=n)})("keydown.enter",function(n){e.CHM(t);const o=e.oxw(),s=o.index,u=o.$implicit,k=e.oxw();return e.KtG(k.batchEnter(s,n,u))}),e.qZA()()}if(2&l){const t=e.oxw(),i=t.index,n=t.$implicit;e.xp6(1),e.MGl("id","batch",i,""),e.Q6J("ngModel",n.BATCH)}}function Q(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"tr",49),e.NdJ("click",function(){const n=e.CHM(t),o=n.index,s=n.$implicit,u=e.oxw();return e.KtG(u.rowClick(o,s))}),e.TgZ(1,"td",50),e._uU(2),e.qZA(),e.TgZ(3,"td",51)(4,"input",52),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.DESCA=n)})("keydown.enter",function(){const o=e.CHM(t).index,s=e.oxw();return e.KtG(s.itemKeyEvent(o))})("keydown.tab",function(){const o=e.CHM(t).index,s=e.oxw();return e.KtG(s.itemKeyEvent(o))})("keydown.Shift.Delete",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.clearRow(n))}),e.qZA()(),e.TgZ(5,"td",53),e._uU(6),e.qZA(),e.TgZ(7,"td",54),e._uU(8),e.qZA(),e.YNc(9,X,2,2,"td",55),e.TgZ(10,"td",56),e._uU(11),e.ALo(12,"twoDigitNumber"),e.qZA(),e.TgZ(13,"td",57),e._uU(14),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td",57),e._uU(17),e.ALo(18,"twoDigitNumber"),e.qZA(),e.TgZ(19,"td",57),e._uU(20),e.ALo(21,"twoDigitNumber"),e.qZA(),e.TgZ(22,"td",51)(23,"input",58),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.NEW_SPRICE_EX=n)})("change",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onChangeNewSpriceExVat(o))})("keydown.Enter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn())})("keydown.tab",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn())})("focus",function(){const n=e.CHM(t),o=n.$implicit,s=n.index,u=e.oxw();return e.KtG(u.clickRow(o,s))}),e.qZA()(),e.TgZ(24,"td",51)(25,"input",59),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.NEW_SPRICE_INC=n)})("change",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onChangeNewSpriceIncVat(o))})("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.verifyNewSpriceInc())})("keydown.Enter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn2())})("keydown.tab",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn2())}),e.qZA()(),e.TgZ(26,"td",57),e._uU(27),e.ALo(28,"twoDigitNumber"),e.qZA(),e.TgZ(29,"td",57),e._uU(30),e.ALo(31,"twoDigitNumber"),e.qZA(),e.TgZ(32,"td",51)(33,"input",60),e.NdJ("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.NEW_WSPRICE_EX=n)})("keydown.Enter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn3())})("keydown.tab",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.focusOn3())})("change",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onChangeNewWSpriceExVat(o))})("focus",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.clickRow(o))}),e.qZA()(),e.TgZ(34,"td",51)(35,"input",61),e.NdJ("change",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onChangeNewWSpriceIncVat(o))})("ngModelChange",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.NEW_WSPRICE_INC=n)})("keydown.tab",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.nextRow())})("keydown.Enter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.nextRow())})("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.verifyNewWSpriceInc())}),e.qZA()(),e.TgZ(36,"td",56),e._uU(37),e.ALo(38,"number"),e.qZA()()}if(2&l){const t=h.$implicit,i=h.index,n=e.oxw();e.xp6(2),e.hij(" ",i+1," "),e.xp6(2),e.MGl("id","itemname",i,""),e.Q6J("ngModel",t.DESCA),e.xp6(2),e.hij(" ",t.UNIT,""),e.xp6(2),e.hij(" ",t.MARGIN,"% "),e.xp6(1),e.Q6J("ngIf",1==n.userSetting.EnableBatchWisePrice),e.xp6(2),e.hij(" ",e.lcZ(12,21,t.P_RATE),""),e.xp6(3),e.hij(" ",e.xi3(15,23,t.CURRENTMARGIN,"1.2-2"),"% "),e.xp6(3),e.Oqu(e.lcZ(18,26,n._trnMainService.nullToZeroConverter(t.CURRENT_SPRICE_EX))),e.xp6(3),e.hij(" ",e.lcZ(21,28,n._trnMainService.nullToZeroConverter(t.CURRENT_SPRICE_INC)),""),e.xp6(3),e.MGl("id","newSpricevat",i,""),e.Q6J("ngModel",t.NEW_SPRICE_EX),e.xp6(2),e.MGl("id","newSpriceInc",i,""),e.Q6J("ngModel",t.NEW_SPRICE_INC),e.xp6(2),e.hij(" ",e.lcZ(28,30,n._trnMainService.nullToZeroConverter(t.CURRENT_WPRICE_EX)),""),e.xp6(3),e.hij(" ",e.lcZ(31,32,n._trnMainService.nullToZeroConverter(t.CURRENT_WPRICE_INC)),""),e.xp6(3),e.MGl("id","newWSpricevat",i,""),e.Q6J("ngModel",t.NEW_WSPRICE_EX),e.xp6(2),e.MGl("id","newWSpriceInc",i,""),e.Q6J("ngModel",t.NEW_WSPRICE_INC),e.xp6(2),e.hij(" ",e.xi3(38,34,t.NEWMARGIN,"1.2-2")," %")}}function Y(l,h){if(1&l&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("value",t.MCODE),e.xp6(1),e.Oqu(null==t?null:t.DESCA)}}function $(l,h){if(1&l&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("value",t.MCODE),e.xp6(1),e.Oqu(null==t?null:t.DESCA)}}function z(l,h){if(1&l&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("value",t.MCODE),e.xp6(1),e.Oqu(null==t?null:t.DESCA)}}function ee(l,h){if(1&l&&(e.TgZ(0,"option",14),e._uU(1),e.qZA()),2&l){const t=h.$implicit;e.Q6J("value",t.MCODE),e.xp6(1),e.Oqu(null==t?null:t.DESCA)}}function te(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"div",63)(1,"div",64)(2,"div",65)(3,"h4",66),e._uU(4,"Group Selection"),e.qZA()(),e.TgZ(5,"div",67)(6,"div",68)(7,"fieldset",69)(8,"div",20)(9,"label",70),e._uU(10,"Main Group :"),e.qZA(),e.TgZ(11,"div",71),e._UZ(12,"hr"),e.qZA()(),e.TgZ(13,"div",72)(14,"select",73),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.BulkgrpSelectObj.MGROUP=n)})("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.getSubGroupA(n))}),e._UZ(15,"option",14),e.YNc(16,Y,2,2,"option",15),e.qZA()(),e.TgZ(17,"div",20)(18,"label",70),e._uU(19,"Sub Group (A) :"),e.qZA(),e.TgZ(20,"div",71),e._UZ(21,"hr"),e.qZA()(),e.TgZ(22,"div",72)(23,"select",74),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.BulkgrpSelectObj.SUBGROUP_A=n)})("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.getSubGroupB(n))}),e._UZ(24,"option",14),e.YNc(25,$,2,2,"option",15),e.qZA()(),e.TgZ(26,"div",20)(27,"label",70),e._uU(28,"Sub Group (B) :"),e.qZA(),e.TgZ(29,"div",71),e._UZ(30,"hr"),e.qZA()(),e.TgZ(31,"div",72)(32,"select",74),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.BulkgrpSelectObj.SUBGROUP_B=n)})("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.getSubGroupC(n))}),e._UZ(33,"option",14),e.YNc(34,z,2,2,"option",15),e.qZA()(),e.TgZ(35,"div",20)(36,"label",70),e._uU(37,"Sub Group (C) :"),e.qZA(),e.TgZ(38,"div",71),e._UZ(39,"hr"),e.qZA()(),e.TgZ(40,"div",72)(41,"select",74),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.BulkgrpSelectObj.SUBGROUP_C=n)})("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.selectedSubGroupC(n))}),e.YNc(42,ee,2,2,"option",15),e.qZA()()()(),e.TgZ(43,"div",75)(44,"button",76),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClose())}),e._uU(45,"Cancel"),e.qZA(),e.TgZ(46,"button",77),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirmClick())}),e._uU(47,"Ok"),e.qZA()()()()()}if(2&l){const t=e.oxw();e.xp6(14),e.Q6J("ngModel",t.BulkgrpSelectObj.MGROUP),e.xp6(2),e.Q6J("ngForOf",t.mainGroupList),e.xp6(7),e.Q6J("ngModel",t.BulkgrpSelectObj.SUBGROUP_A)("disabled",t.disabledSubgroupA),e.xp6(2),e.Q6J("ngForOf",t.subGroupAList),e.xp6(7),e.Q6J("ngModel",t.BulkgrpSelectObj.SUBGROUP_B)("disabled",t.disabledSubgroupB),e.xp6(2),e.Q6J("ngForOf",t.subGroupBList),e.xp6(7),e.Q6J("ngModel",t.BulkgrpSelectObj.SUBGROUP_C)("disabled",t.disabledSubgroupC),e.xp6(1),e.Q6J("ngForOf",t.subGroupCList)}}function ie(l,h){if(1&l){const t=e.EpF();e.TgZ(0,"div")(1,"itemwisebatch",78),e.NdJ("BatchClosedEmit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.BatchPopupClosed())})("dbClickEvent",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.dblClickPopupBatch(n))}),e.qZA()()}if(2&l){const t=e.oxw();e.xp6(1),e.Q6J("Blist",t.batchList)}}let D=(()=>{class l{constructor(t,i,n,o,s,u,k,O,R){this.alertService=t,this.loadingService=i,this.masterService=n,this.router=o,this._trnMainService=s,this.activatedRoute=u,this.bulkpriceChangeService=k,this.authservice=O,this._trnmainservice=R,this.bulkPriceObj={},this.disableOnView=!1,this.activerowIndex=0,this.BulkPriceArray=[],this.ItemGroup=!1,this.BulkgrpSelectObj={},this.subGroupAList=[],this.mainGroupList=[],this.subGroupBList=[],this.subGroupCList=[],this.disabledSubgroupA=!0,this.disabledSubgroupB=!0,this.disabledSubgroupC=!0,this.MCatList=[],this.divisionlist=[],this.gridPopupSettings=new A.im,this.fileUploadPopupSettings=new w.s,this.onFileUploadPopupEmit=new e.vpe,this.selectedGroupInfo=new e.vpe,this.saveObj={},this.showBatchPopup=!1,this.userSetting=this.authservice.getSetting(),this.masterService.getAllDivisions().subscribe(S=>{this.divisionlist=S}),this.bulkpriceChangeService.getMainGroupList().subscribe(S=>{console.log("Main group",S),S.length>0?(this.mainGroupList=S,this.mainGroupList=S):(this.mainGroupList=[],this.mainGroupList=[])}),this.saveObj.IsLatePriceUpdate=0,this.bulkpriceChangeService.getMCatList().subscribe(S=>{console.log("Main MCatList",S),this.MCatList=S})}ngOnInit(){const t=new Date;this.currDate=(0,r.p6)(t,"yyyy-MM-dd","en-US"),this.modeTitle="Bulk Sales Price Update",this.addRow(),this.division=this._trnMainService.userProfile.userDivision,this.fileUploadPopupSettings=Object.assign(new w.s,{title:"Import Bulk Price Change",sampleFileUrl:`/downloadSampleExcelforMasterMigration?importName=${this.modeTitle}`,uploadEndpoints:"/masterImport/Bulk Price Change Master",allowMultiple:!1,acceptFormat:".xlsx",filename:this.modeTitle+" Sample"})}effectiveDateChange(t){this.EffectiveDate<this.currDate&&(this.alertService.info("Effective cannot be set to past date!"),this.EffectiveDate=this.currDate)}onImportBulkPrice(){console.log("button clicked"),this.fileUploadPopup.show()}handleKeyDownboardEvent(t){"ControlLeft"==t.code||"ControlRight"==t.code?(t.preventDefault(),console.log("r2"),this.showSecondaryButtons=!0):"Escape"==t.code&&(console.log("popup close"),this.fileUploadPopup.hide())}showBulkPricePopup(t){}fileUploadSuccess(t){console.log("console.",t),"ok"==t.status&&(this.BulkPriceArray=t.result)}addRow(){try{this.BulkPriceArray.push({})}catch(i){console.log(i),alert(i)}}rowClick(t,i){this.activerowIndex=t,this.data=i}onSave(){try{if(""==this.BulkPriceArray[this.activerowIndex].DESCA||null==this.BulkPriceArray[this.activerowIndex].DESCA||null==this.BulkPriceArray[this.activerowIndex].DESCA)return void this.alertService.warning("Please Select the Item Name.");if(!(null!=this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_EX&&null!=this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_EX||null!=this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_EX&&null!=this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_EX))return void this.alertService.warning("Please Enter the New S-Price or New W-Price.");if(1==this.userSetting.EnableBatchWisePrice&&(""==this.BulkPriceArray[this.activerowIndex].BATCH||null==this.BulkPriceArray[this.activerowIndex].BATCH||null==this.BulkPriceArray[this.activerowIndex].BATCH))return void this.alertService.warning("Please Select the Batch.");if(this.BulkPriceArray.forEach(t=>{1==this.userSetting.LateBulkPriceUpdate&&1==this.saveObj.IsLatePriceUpdate&&this.EffectiveDate?t.EffectiveDate=this.EffectiveDate:(this.EffectiveDate="",t.EffectiveDate="")}),this.saveObj.BulkPriceList=this.BulkPriceArray,this.mode=1==this.userSetting.LateBulkPriceUpdate?"new":1==this.userSetting.EnableBatchWisePrice?"batchwise":"menuitem",this.BulkPriceArray.find(t=>t.NEW_SPRICE_INC<t.P_RATE))return void this.alertService.warning("New S-PRICE (Inc vat)should be grater than P-RATE");if(1==this.userSetting.LateBulkPriceUpdate){if(1==this.saveObj.IsLatePriceUpdate&&""==this.EffectiveDate)return this.alertService.warning("Please select the Effective Date!"),void this.alertService.emitShowHideSubject.subscribe(t=>{setTimeout(()=>{null!==document.getElementById("effdate")&&document.getElementById("effdate").focus()},100)});(0==this.saveObj.IsLatePriceUpdate||1==this.saveObj.IsLatePriceUpdate&&this.EffectiveDate)&&this.onSubmit()}else this.onSubmit()}catch(t){alert(t)}}onSubmit(){this.removeInvalidRows(),this.loadingService.show("Saving new prices, please wait"),this.bulkpriceChangeService.saveBulkPriceChange(this.mode,this.saveObj).subscribe(t=>{console.log("result",t),"ok"==t.status?(this.loadingService.hide(),this.alertService.success("Price changed successfully !"),this.BulkPriceArray=[],this.saveObj.IsLatePriceUpdate=0,this.addRow()):(this.loadingService.hide(),this.alertService.info(t.result.error))})}removeInvalidRows(){this.saveObj.BulkPriceList=this.saveObj.BulkPriceList.filter(t=>(null!=t.NEW_SPRICE_EX&&0!=t.NEW_SPRICE_EX&&null!=t.NEW_SPRICE_INC&&0!=t.NEW_SPRICE_INC||null!=t.NEW_WSPRICE_INC&&0!=t.NEW_WSPRICE_INC&&null!=t.NEW_WSPRICE_INC&&0!=t.NEW_WSPRICE_INC)&&null!=t.MCODE&&""!=t.MCODE)}cancel(){try{this.router.navigate(["./pages/dashboard"])}catch(t){alert(t)}}Reset(){this.BulkPriceArray=[],this.saveObj.IsLatePriceUpdate=0,this.BulkPriceArray.push({}),this.BulkgrpSelectObj.MCAT="",this.groupDesca="",this.EffectiveDate="",this.BulkgrpSelectObj.PARENT="",this.filter=""}nextRow(){if(""!=this.BulkPriceArray[this.activerowIndex].DESCA&&null!=this.BulkPriceArray[this.activerowIndex].DESCA&&null!=this.BulkPriceArray[this.activerowIndex].DESCA)if(null!=this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_EX&&null!=this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_EX||null!=this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_EX&&null!=this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_EX)if(1!=this.userSetting.EnableBatchWisePrice||""!=this.BulkPriceArray[this.activerowIndex].BATCH&&null!=this.BulkPriceArray[this.activerowIndex].BATCH&&null!=this.BulkPriceArray[this.activerowIndex].BATCH)if(null!=this.BulkPriceArray[this.activerowIndex+1]||null!=this.BulkPriceArray[this.activerowIndex+1])document.getElementById("itemname"+(this.activerowIndex+1)).focus();else try{let i=this.activerowIndex+1;this.BulkPriceArray.push({}),setTimeout(()=>{document.getElementById("itemname"+i).focus()},50)}catch(i){console.log(i),alert(i)}else{this.alertService.warning("Please Enter the Batch FIRST.");let i=this.activerowIndex;setTimeout(()=>{document.getElementById("batch"+i).focus()},1500)}else{this.alertService.warning("Please Enter the New S-price or New W-Price first.");let i=this.activerowIndex;setTimeout(()=>{document.getElementById("newSpricevat"+i).focus()},1500)}else{this.alertService.warning("Please select the ITEM NAME FIRST.");let i=this.activerowIndex;setTimeout(()=>{document.getElementById("itemname"+i).focus()},1500)}}itemKeyEvent(t){this.activerowIndex=t,this.gridPopupSettings={title:"Item list",apiEndpoints:"/getItemPagedListForPriceChange",defaultFilterIndex:1,columns:[{key:"MENUCODE",title:"MENU CODE",hidden:!1,noSearch:!1},{key:"DESCA",title:"NAME",hidden:!1,noSearch:!1},{key:"BCODE",title:"Barcode",hidden:!1,noSearch:!1}]},null==this.groupDesca||null==this.groupDesca||""==this.groupDesca?this.genericGrid.show():this.masterService.focusAnyControl("batch"+this.activerowIndex)}dblClickPopupItem(t){console.log("slected",t),this.BulkPriceArray[this.activerowIndex].MENUCODE=t.MENUCODE,this.BulkPriceArray[this.activerowIndex].MCODE=t.MCODE,this.BulkPriceArray[this.activerowIndex].DESCA=t.DESCA,this.BulkPriceArray[this.activerowIndex].UNIT=t.BASEUNIT,this.BulkPriceArray[this.activerowIndex].ISVAT=t.ISVAT,1!=this.userSetting.EnableBatchWisePrice&&(this.BulkPriceArray[this.activerowIndex].P_RATE=t.PRATE_A,this.BulkPriceArray[this.activerowIndex].CURRENT_SPRICE_EX=t.RATE_A,this.BulkPriceArray[this.activerowIndex].CURRENT_SPRICE_INC=t.IN_RATE_A,this.BulkPriceArray[this.activerowIndex].CURRENT_WPRICE_EX=t.RATE_B,this.BulkPriceArray[this.activerowIndex].CURRENT_WPRICE_INC=t.IN_RATE_B,this.BulkPriceArray[this.activerowIndex].MARGIN=t.MARGIN,this.BulkPriceArray[this.activerowIndex].CURRENTMARGIN=Number(100*(t.RATE_A-t.PRATE_A)/t.PRATE_A).toFixed(5)),1==this.userSetting.EnableBatchWisePrice&&this.masterService.focusAnyControl("batch"+this.activerowIndex),0==this.userSetting.EnableBatchWisePrice&&this.masterService.focusAnyControl("newSpricevat"+this.activerowIndex)}onChangeNewSpriceExVat(t){if(this.filter)if(1==this.userSetting.EnableBatchWisePrice)this.recalculateIncVAT(this.ind);else{let i=this.BulkPriceArray.findIndex(n=>n.MCODE==t.MCODE);this.recalculateIncVAT(i)}else this.recalculateIncVAT(this.activerowIndex)}recalculateIncVAT(t){let i=this.BulkPriceArray[t];if(1==this.userSetting.EnableBatchWisePrice&&i.NEW_SPRICE_EX<i.COSTPRICE)return this.alertService.warning("Selling price cannot be less than the costprice: "+i.COSTPRICE),i.NEW_SPRICE_EX=0,i.NEW_SPRICE_INC=0,void this.alertService.emitShowHideSubject.subscribe(o=>{setTimeout(()=>{document.getElementById("newSpricevat"+this.activerowIndex).focus()},0)});i?.NEW_WSPRICE_EX>0&&i.NEW_SPRICE_EX<i.NEW_WSPRICE_EX&&this.alertService.warning("Retail price is less than wholesale price.");let n=1==i?.ISVAT?(this._trnMainService.nullToZeroConverter(i.NEW_SPRICE_EX)*this.userSetting.VatConRate).toFixed(5):this._trnMainService.nullToZeroConverter(i.NEW_SPRICE_EX);i.NEW_SPRICE_INC=Number(n),this.calculateNewMargin(t)}onChangeNewSpriceIncVat(t){if(this.filter)if(1==this.userSetting.EnableBatchWisePrice)this.recalculateExcVAT(this.ind);else{let i=this.BulkPriceArray.findIndex(n=>n.MCODE==t.MCODE);this.recalculateExcVAT(i)}else this.recalculateExcVAT(this.activerowIndex)}recalculateExcVAT(t){let i=this.BulkPriceArray[t];if(i){let n=1==i.ISVAT?(this._trnMainService.nullToZeroConverter(i.NEW_SPRICE_INC)/this.userSetting.VatConRate).toFixed(5):this._trnMainService.nullToZeroConverter(i.NEW_SPRICE_INC);i.NEW_SPRICE_EX=Number(n)}this.calculateNewMargin(t)}calculateNewMargin(t){let i=this.BulkPriceArray[t];i.NEWMARGIN=Number(100*(i.NEW_SPRICE_EX-i.P_RATE)/i.P_RATE).toFixed(5)}onChangeNewWSpriceExVat(t){if(this.filter)if(1==this.userSetting.EnableBatchWisePrice)this.recalculateWSIncVAT(this.ind);else{let i=this.BulkPriceArray.findIndex(n=>n.MCODE==t.MCODE);this.recalculateWSIncVAT(i)}else this.recalculateWSIncVAT(this.activerowIndex)}recalculateWSIncVAT(t){let i=this.BulkPriceArray[t];if(1==this.userSetting.EnableBatchWisePrice&&i.NEW_WSPRICE_EX<i.COSTPRICE)return this.alertService.warning("Wholesale price cannot be less than the costprice: "+i.COSTPRICE),i.NEW_WSPRICE_EX=0,i.NEW_WSPRICE_INC=0,void this.alertService.emitShowHideSubject.subscribe(o=>{setTimeout(()=>{document.getElementById("newWSpricevat"+this.activerowIndex).focus()},0)});i.NEW_SPRICE_EX>0&&i.NEW_SPRICE_EX<i.NEW_WSPRICE_EX&&this.alertService.warning("Retail price is less than wholesale price.");let n=1==i.ISVAT?(this._trnMainService.nullToZeroConverter(i.NEW_WSPRICE_EX)*this.userSetting.VatConRate).toFixed(5):this._trnMainService.nullToZeroConverter(i.NEW_WSPRICE_EX);i.NEW_WSPRICE_INC=Number(n)}onChangeNewWSpriceIncVat(t){if(this.filter)if(1==this.userSetting.EnableBatchWisePrice)this.recalculateWSExcVAT(this.ind);else{let i=this.BulkPriceArray.findIndex(n=>n.MCODE==t.MCODE);this.recalculateWSExcVAT(i)}else this.recalculateWSExcVAT(this.activerowIndex)}recalculateWSExcVAT(t){let i=this.BulkPriceArray[t];if(i){let n=1==i.ISVAT?(this._trnMainService.nullToZeroConverter(i.NEW_WSPRICE_INC)/this.userSetting.VatConRate).toFixed(5):this._trnMainService.nullToZeroConverter(i.NEW_WSPRICE_INC);i.NEW_WSPRICE_EX=Number(n)}}verifyNewWSpriceInc(){this.BulkPriceArray[this.activerowIndex].P_RATE>this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_INC&&this.alertService.warning("New WS-PRICE (Inc vat)should be grater than P-RATE"),this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_INC>0&&this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_INC<this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_INC&&this.alertService.warning("Retial price is less than wholesale price.")}onChangeDivision(){let t=this.BulkPriceArray[this.activerowIndex];t.MCODE&&this.bulkpriceChangeService.getItemWiseBatch(t.MCODE,this.division).subscribe(i=>{"ok"==i.status&&(this.batchList=i.result,this.batchList?this.showBatchPopup=!0:this.alertService.info("There are no batch assigned for this item"))})}batchEnter(t,i,n){this.filter&&(this.ind=this.BulkPriceArray.findIndex(u=>u.MCODE==n.MCODE)),this.batchList=[];let o=this.BulkPriceArray[this.activerowIndex].MCODE;o&&this.bulkpriceChangeService.getItemWiseBatch(o,this.division).subscribe(u=>{"ok"==u.status&&(this.batchList=u.result,this.batchList?this.showBatchPopup=!0:this.alertService.info("There are no batch assigned for this item"))}),setTimeout(()=>{document.getElementById("batch"+t).blur()},500)}BatchPopupClosed(){this.showBatchPopup=!1}dblClickPopupBatch(t){this.assignBatchDetails(this.filter?this.ind:this.activerowIndex,t),this.showBatchPopup=!1,this.masterService.focusAnyControl("newSpricevat"+this.activerowIndex)}assignBatchDetails(t,i){1==this.userSetting.EnableBatchWisePrice&&(this.BulkPriceArray[t].BATCH=i.BATCHCODE,this.BulkPriceArray[t].MARGIN=i.MARGIN,this.BulkPriceArray[t].P_RATE=i.LANDINGCOST,this.BulkPriceArray[t].CURRENT_SPRICE_EX=i.SELLRATEBEFORETAX,this.BulkPriceArray[t].CURRENT_SPRICE_INC=i.MRP,this.BulkPriceArray[t].CURRENTMARGIN=Number(100*(i.SELLRATEBEFORETAX-i.LANDINGCOST)/i.LANDINGCOST).toFixed(5),this.BulkPriceArray[t].COSTPRICE=i.COSTPRICE,this.BulkPriceArray[t].CURRENT_WPRICE_EX=i.W_SELLRATEBEFORETAX,this.BulkPriceArray[t].CURRENT_WPRICE_INC=i.W_MRP)}itemGroup(){this.ItemGroup=!0}onClose(){this.ItemGroup=!1,this.groupDesca="",this.EffectiveDate="",this.BulkgrpSelectObj.SUBGROUP_A="",this.BulkgrpSelectObj.SUBGROUP_B="",this.BulkgrpSelectObj.SUBGROUP_C="",this.BulkgrpSelectObj.MGROUP="",this.disabledSubgroupA=!0,this.disabledSubgroupB=!0,this.disabledSubgroupC=!0}getSubGroupA(t){this.bulkpriceChangeService.getSubGroupList(t.target.value).subscribe(n=>{n.length>0?(this.subGroupAList=n,this.disabledSubgroupA=!1,this.disabledSubgroupB=!0,this.disabledSubgroupC=!0,this.BulkgrpSelectObj.SUBGROUP_A="",this.BulkgrpSelectObj.SUBGROUP_B="",this.BulkgrpSelectObj.SUBGROUP_C=""):(this.subGroupAList=[],this.BulkgrpSelectObj.SUBGROUP_A="",this.BulkgrpSelectObj.SUBGROUP_B="",this.BulkgrpSelectObj.SUBGROUP_C="",this.disabledSubgroupA=!0,this.disabledSubgroupB=!0,this.disabledSubgroupC=!0)})}getSubGroupB(t){this.bulkpriceChangeService.getSubGroupList(t.target.value).subscribe(n=>{n.length>0?(this.subGroupBList=n,this.disabledSubgroupB=!1,this.disabledSubgroupC=!0):(this.subGroupBList=[],this.BulkgrpSelectObj.SUBGROUP_B="",this.disabledSubgroupB=!0,this.disabledSubgroupC=!0)})}getSubGroupC(t){this.bulkpriceChangeService.getSubGroupList(t.target.value).subscribe(n=>{n.length>0?(this.subGroupCList=n,this.disabledSubgroupC=!1):(this.subGroupCList=[],this.BulkgrpSelectObj.SUBGROUP_C="",this.disabledSubgroupC=!0)})}selectedSubGroupC(t){}verifyNewSpriceInc(){this.BulkPriceArray[this.activerowIndex].P_RATE>this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_INC&&this.alertService.warning("New S-PRICE (Inc vat)should be grater than P-RATE"),this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_INC>0&&this.BulkPriceArray[this.activerowIndex].NEW_SPRICE_INC<this.BulkPriceArray[this.activerowIndex].NEW_WSPRICE_INC&&this.alertService.warning("Retial price is less than wholesale price.")}confirmClick(){this.BulkgrpSelectObj.SUBGROUP_C?(this.BulkgrpSelectObj.PARENT=this.BulkgrpSelectObj.SUBGROUP_C,this.groupDesca=this.subGroupCList.filter(t=>this.BulkgrpSelectObj.SUBGROUP_C===t.MCODE)[0].DESCA):this.BulkgrpSelectObj.SUBGROUP_B?(this.BulkgrpSelectObj.PARENT=this.BulkgrpSelectObj.SUBGROUP_B,this.groupDesca=this.subGroupBList.filter(t=>this.BulkgrpSelectObj.SUBGROUP_B===t.MCODE)[0].DESCA):this.BulkgrpSelectObj.SUBGROUP_A?(this.BulkgrpSelectObj.PARENT=this.BulkgrpSelectObj.SUBGROUP_A,this.groupDesca=this.subGroupAList.filter(t=>this.BulkgrpSelectObj.SUBGROUP_A===t.MCODE)[0].DESCA):(this.BulkgrpSelectObj.PARENT=this.BulkgrpSelectObj.MGROUP,this.groupDesca=this.mainGroupList.filter(t=>this.BulkgrpSelectObj.MGROUP===t.MCODE)[0].DESCA),this.loadingService.show("Loading Data...."),this.ItemGroup=!1,this.BulkPriceArray=[],this.bulkpriceChangeService.getGroupWiseItemList(this.groupDesca,this.BulkgrpSelectObj.PARENT).subscribe(t=>{if("ok"==t.status){this.loadingService.hide();let n=t.result;if(n.length>0)n.forEach(o=>{let s={};1==this.userSetting.EnableBatchWisePrice?(s.MCODE=o.MCODE,s.MENUCODE=o.MENUCODE,s.DESCA=o.DESCA,s.UNIT=o.BASEUNIT,s.ISVAT=o.ISVAT,this.BulkPriceArray.push(s)):(s.MCODE=o.MCODE,s.MENUCODE=o.MENUCODE,s.DESCA=o.DESCA,s.UNIT=o.BASEUNIT,s.P_RATE=o.PRATE_A,s.MARGIN=o.MARGIN,s.ISVAT=o.ISVAT,s.CURRENT_SPRICE_EX=o.RATE_A,s.CURRENT_SPRICE_INC=o.In_Rate_A,s.CURRENT_WPRICE_EX=o.Rate_B,s.CURRENT_WPRICE_INC=o.In_Rate_B,this.BulkPriceArray.push(s))});else{this.alertService.warning("Data not available");let o=this.activerowIndex;this.BulkPriceArray.push({}),setTimeout(()=>{document.getElementById("itemname"+o).focus()},1500)}}this.loadingService.hide()})}getMcatList(){this.bulkpriceChangeService.getMCatList().subscribe(t=>{console.log("Main MCatList",t),this.MCatList=t})}categoryListclick(){console.log("reached inside");let t=this.BulkgrpSelectObj.MCAT;this.BulkPriceArray=[],this.bulkpriceChangeService.getCategoryWiseItemList(t).subscribe(i=>{if(console.log("Categorylist",i),"ok"==i.status){let o=i.result;if(console.log("Category Detail",o),o.length>0)o.forEach(s=>{let u={};1==this.userSetting.EnableBatchWisePrice?(u.MCODE=s.MCODE,u.MENUCODE=s.MENUCODE,u.DESCA=s.DESCA,u.UNIT=s.BASEUNIT,u.ISVAT=s.ISVAT,this.BulkPriceArray.push(u)):(u.MCODE=s.MCODE,u.MENUCODE=s.MENUCODE,u.DESCA=s.DESCA,u.UNIT=s.BASEUNIT,u.P_RATE=s.PRATE_A,u.MARGIN=s.MARGIN,u.ISVAT=s.ISVAT,u.CURRENT_SPRICE_EX=s.RATE_A,u.CURRENT_SPRICE_INC=s.In_Rate_A,u.CURRENT_WPRICE_EX=s.Rate_B,u.CURRENT_WPRICE_INC=s.In_Rate_B,this.BulkPriceArray.push(u))});else{this.alertService.warning("Data not avaliable");let s=this.activerowIndex;this.BulkPriceArray.push({}),setTimeout(()=>{document.getElementById("itemname"+s).focus()},1500)}}})}clickRow(t,i){let n=this.BulkPriceArray.findIndex(o=>o.MCODE==t.MCODE);this.activerowIndex=i,1!=this.userSetting.EnableBatchWisePrice||null!=this.BulkPriceArray[n].BATCH||this.alertService.warning("Enter Batch first")}focusOn(){let t=this.activerowIndex;t=null==this.filter||""===this.filter?this.activerowIndex:this.BulkPriceArray.findIndex(o=>o.MENUCODE==this.data.MENUCODE);let i=this.BulkPriceArray[t];if(1!=this.userSetting.EnableBatchWisePrice||null!=this.BulkPriceArray[t].BATCH)return 1==this.userSetting.EnableBatchWisePrice&&i.NEW_SPRICE_EX<i.COSTPRICE?(this.alertService.warning("Selling price cannot be less than the costprice: "+i.COSTPRICE),i.NEW_SPRICE_EX=0,i.NEW_SPRICE_INC=0,void this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("newSpricevat"+this.activerowIndex).focus()},0)})):void this.masterService.focusAnyControl("newSpriceInc"+this.activerowIndex);this.alertService.warning("Enter Batch first")}focusOn2(){let t=this.activerowIndex;t=null==this.filter||""===this.filter?this.activerowIndex:this.BulkPriceArray.findIndex(o=>o.MENUCODE==this.data.MENUCODE);let i=this.BulkPriceArray[t];if(1==this.userSetting.EnableBatchWisePrice&&i.NEW_SPRICE_EX<i.COSTPRICE)return this.alertService.warning("Selling price cannot be less than the costprice: "+i.COSTPRICE),i.NEW_SPRICE_EX=0,i.NEW_SPRICE_INC=0,void this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("newWSpricevat"+this.activerowIndex).focus()},0)});this.masterService.focusAnyControl("newWSpricevat"+this.activerowIndex)}focusOn3(){let t=this.activerowIndex;t=null==this.filter||""===this.filter?this.activerowIndex:this.BulkPriceArray.findIndex(o=>o.MENUCODE==this.data.MENUCODE);let i=this.BulkPriceArray[t];if(1==this.userSetting.EnableBatchWisePrice){let n=this.BulkPriceArray[t];if(null==n.NEW_WSPRICE_EX&&null==n.NEW_SPRICE_EX)return void this.alertService.warning("Enter wholesale price or selling price")}if(1==this.userSetting.EnableBatchWisePrice&&i.NEW_WSPRICE_EX<i.COSTPRICE)return this.alertService.warning("Wholesale price cannot be less than the costprice: "+i.COSTPRICE),i.NEW_WSPRICE_EX=0,i.NEW_WSPRICE_INC=0,void this.alertService.emitShowHideSubject.subscribe(n=>{setTimeout(()=>{document.getElementById("newWSpriceinc"+this.activerowIndex).focus()},0)});this.masterService.focusAnyControl("newWSpriceInc"+this.activerowIndex)}searchEnter(){this.masterService.focusAnyControl("batch"+this.activerowIndex)}clearRow(){confirm("Are you sure you want to delete the Row? ")&&this.BulkPriceArray.splice(this.activerowIndex,1)}}return l.\u0275fac=function(t){return new(t||l)(e.Y36(U.c),e.Y36(y.V),e.Y36(Z.P),e.Y36(f.F0),e.Y36(M.p),e.Y36(f.gz),e.Y36(m),e.Y36(a.e),e.Y36(M.p))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-bulkprice-change"]],viewQuery:function(t,i){if(1&t&&(e.Gf(v.j,5),e.Gf(L,5),e.Gf(j,5),e.Gf(J,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.batchListChild=n.first),e.iGM(n=e.CRH())&&(i.genericGrid=n.first),e.iGM(n=e.CRH())&&(i.fileUploadPopup=n.first),e.iGM(n=e.CRH())&&(i.PaymentPopup=n.first)}},hostBindings:function(t,i){1&t&&e.NdJ("keydown",function(o){return i.handleKeyDownboardEvent(o)},!1,e.evT)},outputs:{onFileUploadPopupEmit:"onFileUploadPopupEmit",selectedGroupInfo:"selectedGroupInfo"},decls:87,vars:19,consts:[[1,"sticky-top","row",2,"width","100%"],[1,"col-md-4"],[3,"onFileUploadPopupEmit"],[1,"col-md-8",2,"width","100%"],[1,"row","pull-right"],["type","submit",1,"btn","btn-info","btn-sm",3,"disabled","click"],["type","button",1,"btn","btn-info","btn-sm",3,"click"],[1,"row","plainBackGround",2,"margin-top","0.5rem"],[1,"form-group-row"],[1,"form-control-label",2,"width","78px"],["type","text","placeholder","Press Enter to Select",2,"width","40%","height","22px",3,"ngModel","ngModelChange","keydown.Enter"],[1,"col-md-3",2,"margin-left","-3%"],[1,"form-control-label",2,"width","62px"],["id","Category",2,"width","55%","height","22px",3,"ngModel","ngModelChange","change"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["sclass","form-control-label",2,"width","62px"],[2,"width","55%","height","22px",3,"ngModel","disabled","ngModelChange","change"],[3,"ngValue",4,"ngFor","ngForOf"],["class","row col-md-12","style","font-size: 13px;",4,"ngIf"],[1,"row"],[1,"col-md-3","pd0",2,"margin-top","5px"],[1,"form-group","row"],[1,"col-md-3","form-control-label"],[1,"col-md-8","row"],["type","search","placeholder","Search...","name","filters",1,"form-control",2,"height","1.5rem","font-size","13px","margin-top","7px",3,"ngModel","ngModelChange","keydown.enter"],[2,"margin-top","10px"],[2,"height","480px","overflow-y","scroll"],[2,"margin-bottom","5px","font-size","13px","width","98%","margin-left","10px"],[2,"width","2%","font-size","12px"],["scope","col",2,"text-align","center","width","13%","font-size","12px"],["scope","col",2,"text-align","center","font-size","12px"],["scope","col","style","text-align: center; font-size: 12px;",4,"ngIf"],["scope","col",2,"text-align","center","width","8%","font-size","12px"],["style","border: 1px; max-height: 25px",3,"click",4,"ngFor","ngForOf"],[3,"popupsettings","onItemDoubleClick"],["genericGrid",""],["class","party_container","role","document","style","max-width: 36%; max-height: 500px;margin-left: 253px; overflow:hidden",4,"ngIf"],[4,"ngIf"],[3,"popupsettings","onUploaded"],["fileUploadPopup",""],[3,"ngValue"],[1,"row","col-md-12",2,"font-size","13px"],[1,"col-md-4",2,"margin-top","9px","margin-left","-0.85%"],["type","checkbox","id","LateSale",2,"margin-top","-4px","margin-right","6px",3,"ngModel","ngModelChange","change"],["class","col-md-4","style","margin-left: -2.5%; margin-top: 9px; width:100%",4,"ngIf"],[1,"col-md-4",2,"margin-left","-2.5%","margin-top","9px","width","100%"],[2,"width","26%"],["type","date","id","effdate",2,"height","22px",3,"ngModel","min","ngModelChange","change"],[2,"border","1px","max-height","25px",3,"click"],["id","sn",2,"line-height","21px","text-align","center","border","1px solid #e6e6e6"],[2,"line-height","21px","text-align","center","border","1px solid #e6e6e6"],["placeholder","Press Enter to Select","autocomplete","off",2,"height","25px","width","100% !important",3,"id","ngModel","ngModelChange","keydown.enter","keydown.tab","keydown.Shift.Delete"],[2,"line-height","21px","text-align","center","width","5% !important","border","1px solid #e6e6e6"],[2,"line-height","21px","text-align","center","width","4% !important","border","1px solid #e6e6e6"],["style","line-height: 21px; text-align: center;border: 1px solid #e6e6e6;",4,"ngIf"],[2,"line-height","21px","text-align","center","border","1px solid #e6e6e6","width","5% !important"],[2,"line-height","21px","text-align","center","border","1px solid #e6e6e6","width","8% !important"],["type","number","appSalesRateDisableFromUserProfile","",2,"height","25px","width","95% !important",3,"id","ngModel","ngModelChange","change","keydown.Enter","keydown.tab","focus"],["type","number","appSalesRateDisableFromUserProfile","",2,"height","25px","width","95% !important",3,"id","ngModel","ngModelChange","change","keydown.Enter","keydown.tab"],["type","number","appSalesRateDisableFromUserProfile","",2,"height","25px","width","95% !important",3,"id","ngModel","ngModelChange","keydown.Enter","keydown.tab","change","focus"],["type","number","appSalesRateDisableFromUserProfile","",2,"height","25px","width","95% !important",3,"id","ngModel","change","ngModelChange","keydown.tab","keydown.Enter"],["type","text","placeholder","Please Enter to Select","autocomplete","off","readonly","",2,"height","25px",3,"id","ngModel","ngModelChange","keydown.enter"],["role","document",1,"party_container",2,"max-width","36%","max-height","500px","margin-left","253px","overflow","hidden"],[1,"modal-content",2,"padding","14px 16px 10px 16px","height","64vh"],[1,"modal-header","row"],[1,"modal-title"],[1,"modal-body"],[1,"col-md-12",2,"margin-top","2px","margin-bottom","12px"],[1,"regularClass",2,"border-color","#dcdcdc"],[1,"form-control-label","col-md-4"],[1,"col-md-7"],[1,"row","selectrow"],["id","mainGroup",1,"form-control",3,"ngModel","ngModelChange","change"],[1,"form-control",3,"ngModel","disabled","ngModelChange","change"],[1,"col-md-12"],["type","button",1,"btn","btn-info","pull-right",3,"click"],["type","button",1,"btn","btn-info","pull-right",2,"margin-right","4px",3,"click"],[3,"Blist","BatchClosedEmit","dbClickEvent"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h5"),e._uU(3),e.qZA()(),e.TgZ(4,"div")(5,"div",2),e.NdJ("onFileUploadPopupEmit",function(o){return i.showBulkPricePopup(o)}),e.qZA()(),e.TgZ(6,"div",3)(7,"div",4)(8,"button",5),e.NdJ("click",function(){return i.onSave()}),e._uU(9,"Save"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return i.Reset()}),e._uU(11,"Reset"),e.qZA(),e.TgZ(12,"button",6),e.NdJ("click",function(){return i.cancel()}),e._uU(13,"Back"),e.qZA()()()(),e.TgZ(14,"div",7)(15,"div",1)(16,"div",8)(17,"label",9),e._uU(18,"Item Group:"),e.qZA(),e.TgZ(19,"input",10),e.NdJ("ngModelChange",function(o){return i.groupDesca=o})("keydown.Enter",function(){return i.itemGroup()}),e.qZA()()(),e.TgZ(20,"div",11)(21,"div",8)(22,"label",12),e._uU(23,"Category:"),e.qZA(),e.TgZ(24,"select",13),e.NdJ("ngModelChange",function(o){return i.BulkgrpSelectObj.MCAT=o})("change",function(){return i.categoryListclick()}),e._UZ(25,"option",14),e.YNc(26,H,2,2,"option",15),e.qZA()()(),e.TgZ(27,"div",11)(28,"div",8)(29,"label",16),e._uU(30,"Division:"),e.qZA(),e.TgZ(31,"select",17),e.NdJ("ngModelChange",function(o){return i.division=o})("change",function(){return i.onChangeDivision()}),e.YNc(32,q,2,2,"option",18),e.qZA()()(),e.YNc(33,V,5,2,"div",19),e.qZA(),e.TgZ(34,"div",20)(35,"div",21)(36,"div",22)(37,"label",23),e._uU(38,"Search:"),e.qZA(),e.TgZ(39,"div",24)(40,"input",25),e.NdJ("ngModelChange",function(o){return i.filter=o})("keydown.enter",function(){return i.searchEnter()}),e.qZA()()()()(),e.TgZ(41,"div")(42,"div",26)(43,"div",27)(44,"table",28)(45,"thead")(46,"tr")(47,"th",29),e._uU(48,"SNo."),e.qZA(),e.TgZ(49,"th",30),e._uU(50,"ITEM NAME"),e.qZA(),e.TgZ(51,"th",31),e._uU(52,"UNIT"),e.qZA(),e.TgZ(53,"th",31),e._uU(54,"REC MARGIN"),e.qZA(),e.YNc(55,K,2,0,"th",32),e.TgZ(56,"th",31),e._uU(57,"P-RATE"),e.qZA(),e.TgZ(58,"th",31),e._uU(59,"CURRENT MARGIN"),e.qZA(),e.TgZ(60,"th",33),e._uU(61,"CURRENT S-PRICE (EX-VAT)"),e.qZA(),e.TgZ(62,"th",33),e._uU(63,"CURRENT S-PRICE (INC-VAT)"),e.qZA(),e.TgZ(64,"th",33),e._uU(65,"NEW S-PRICE (EX-VAT)"),e.qZA(),e.TgZ(66,"th",33),e._uU(67,"NEW S-PRICE (INC-VAT)"),e.qZA(),e.TgZ(68,"th",33),e._uU(69,"CURRENT W-PRICE (EX-VAT)"),e.qZA(),e.TgZ(70,"th",33),e._uU(71,"CURRENT W-PRICE (INC-VAT)"),e.qZA(),e.TgZ(72,"th",33),e._uU(73,"NEW W-PRICE (EX-VAT)"),e.qZA(),e.TgZ(74,"th",33),e._uU(75,"NEW W-PRICE (INC-VAT)"),e.qZA(),e.TgZ(76,"th",31),e._uU(77,"NEW MARGIN"),e.qZA()()(),e.TgZ(78,"tbody"),e.YNc(79,Q,39,37,"tr",34),e.ALo(80,"searchDatas"),e.qZA()()()()(),e.TgZ(81,"generic-popup-grid",35,36),e.NdJ("onItemDoubleClick",function(o){return i.dblClickPopupItem(o)}),e.qZA(),e.YNc(83,te,48,11,"div",37),e.YNc(84,ie,2,1,"div",38),e.TgZ(85,"file-uploader-popup",39,40),e.NdJ("onUploaded",function(o){return i.fileUploadSuccess(o)}),e.qZA()),2&t&&(e.xp6(3),e.Oqu(i.modeTitle),e.xp6(5),e.Q6J("disabled",i.disableOnView),e.xp6(11),e.Q6J("ngModel",i.groupDesca),e.xp6(5),e.Q6J("ngModel",i.BulkgrpSelectObj.MCAT),e.xp6(2),e.Q6J("ngForOf",i.MCatList),e.xp6(5),e.Q6J("ngModel",i.division)("disabled","VIEW"==i._trnMainService.TrnMainObj.Mode),e.xp6(1),e.Q6J("ngForOf",i.divisionlist),e.xp6(1),e.Q6J("ngIf",1==i.userSetting.LateBulkPriceUpdate),e.xp6(7),e.Q6J("ngModel",i.filter),e.xp6(15),e.Q6J("ngIf",1==i.userSetting.EnableBatchWisePrice),e.xp6(24),e.Q6J("ngForOf",e.xi3(80,16,i.BulkPriceArray,i.filter)),e.xp6(2),e.Q6J("popupsettings",i.gridPopupSettings),e.xp6(2),e.Q6J("ngIf",i.ItemGroup),e.xp6(1),e.Q6J("ngIf",i.showBatchPopup),e.xp6(1),e.Q6J("popupsettings",i.fileUploadPopupSettings))},dependencies:[x.n,r.sg,r.O5,B.YN,B.Kr,B.Fj,B.wV,B.Wl,B.EJ,B.JJ,B.On,A.Zl,w.U,v.j,r.JJ,W.g,G],styles:["input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border:1px solid #cbcbcb;border-radius:3px;height:30px;color:#000}label[_ngcontent-%COMP%]{width:62px;height:25px;font-size:13px}.form-control[_ngcontent-%COMP%]{font-size:13px}td[_ngcontent-%COMP%]{border:1px solid #e6e6e6}input[_ngcontent-%COMP%]{padding:8px}.form-group[_ngcontent-%COMP%]{margin-bottom:0rem}.party_container[_ngcontent-%COMP%]{position:fixed;transform:translateY(-35px);background:#ffffff;z-index:99999;width:77%;top:21%;left:13%}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:2px solid #e6e6e6;border-top:2px solid #e6e6e6;height:30px;background:#9ccae4;color:#000}thead[_ngcontent-%COMP%]{position:sticky;top:0}.selectrow[_ngcontent-%COMP%]{width:100%}"]}),l})();const ne=[{path:"",component:D},{path:"bulkprice",component:D}];let re=(()=>{class l{}return l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[f.Bz.forChild(ne),f.Bz]}),l})();var oe=c(59629),se=c(88465),le=c(55618),ce=c(92849);let ae=(()=>{class l{}return l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({providers:[m],imports:[ce.S,r.ez,re,E.m,d.JX,I.Xd,b.Is,g.b.forRoot(),se.x.forRoot(),le.c.forRoot(),oe.Z]}),l})()}}]);